var __defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,s)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,__spreadValues=(e,t)=>{for(var s in t||(t={}))__hasOwnProp.call(t,s)&&__defNormalProp(e,s,t[s]);if(__getOwnPropSymbols)for(var s of __getOwnPropSymbols(t))__propIsEnum.call(t,s)&&__defNormalProp(e,s,t[s]);return e},__publicField=(e,t,s)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,s),__async=(e,t,s)=>new Promise((i,o)=>{var n=e=>{try{r(s.next(e))}catch(t){o(t)}},a=e=>{try{r(s.throw(e))}catch(t){o(t)}},r=e=>e.done?i(e.value):Promise.resolve(e.value).then(n,a);r((s=s.apply(e,t)).next())});!function(){"use strict";const e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNtbW5nZWdlc3VtdW9rbXJkdWp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyNzIzMDMsImV4cCI6MjA4Mzg0ODMwM30.0tG0QyjReEMh8QXpmaR-vgPa7mGEPENCUaVTZ_Dz6pA",t={WIDTH:1280,HEIGHT:720,GAME_DURATION:9e4,PHASE_1_END:25e3,PHASE_2_END:6e4,GATE_INTERVAL:15e3,STORM_MIN_INTERVAL:12e3,STORM_MAX_INTERVAL:2e4,STORM_DURATION:4e3,BOOST_DURATION:6e3,SHIP:{SPEED:300,DRIFT_SPEED:150,START_Y:500,BOUNDS_MARGIN:40},INSIGHT:{SPAWN_INTERVAL_BASE:800,SPAWN_INTERVAL_MIN:400,SPEED_BASE:150,SPEED_MAX:250,REAL_CHANCE_BASE:.7,REAL_CHANCE_MIN:.4,POINTS_REAL:100,POINTS_FAKE:-30,METER_FILL_REAL:15,METER_FILL_FAKE:-5},COMBO:{TIMEOUT:2e3,MULTIPLIERS:[1,1.2,1.5,2,2.5,3],SHAKE_INTENSITY:[0,2,4,6,8,10],PARTICLE_COUNT:[3,5,8,12,16,20]},POWERUPS:{SPAWN_CHANCE:.15,DURATION:8e3,TYPES:{MAGNET:{name:"Magnet",color:10181046,radius:150,description:"Zieht Insights an"},SHIELD:{name:"Schild",color:3447003,description:"Blockiert Fake-Schaden"},DOUBLE:{name:"2x Punkte",color:15844367,multiplier:2,description:"Doppelte Punkte"},GOLDEN:{name:"Golden Insight",color:16766720,points:500,description:"Mega-Punkte!"}}},ACHIEVEMENTS:{COMBO_5:{id:"combo_5",name:"Combo Master",description:"5er Combo erreichen",icon:"ðŸ”¥"},COMBO_10:{id:"combo_10",name:"Combo Legend",description:"10er Combo erreichen",icon:"ðŸ’¥"},NO_FAKE:{id:"no_fake",name:"Scharfes Auge",description:"Kein Fake gesammelt",icon:"ðŸ‘ï¸"},PERFECT_GATE:{id:"perfect_gate",name:"Stratege",description:"Alle Gates gewÃ¤hlt",icon:"ðŸŽ¯"},HIGH_SCORE:{id:"high_score",name:"Highscore!",description:"Neuer persÃ¶nlicher Rekord",icon:"ðŸ†"},FIRST_GAME:{id:"first_game",name:"Willkommen",description:"Erstes Spiel abgeschlossen",icon:"âš“"},SPEED_RUN:{id:"speed_run",name:"Turbo",description:"50 Insights in 30 Sekunden",icon:"âš¡"},SURVIVOR:{id:"survivor",name:"Ãœberlebender",description:"3 StÃ¼rme Ã¼berstanden",icon:"ðŸŒŠ"}},GATES:{SPEED:{name:"Speed",color:15158332,multiplier:1.5,noiseIncrease:.15,stormChanceIncrease:.1,hint:"+Punkte, +Risiko"},QUALITY:{name:"Quality",color:3066993,multiplier:1,insightQualityBonus:.2,spawnReduction:.3,hint:"Mehr echte Insights"},SAFETY:{name:"Safety",color:3447003,multiplier:.8,stormChanceReduction:.3,noiseReduction:.1,hint:"Weniger StÃ¼rme"}},BOOSTS:{NAVIGATOR:{name:"Navigator",description:"Echte Insights markiert + 2x Punkte",color:1752220,showRealInsights:!0,pointsMultiplier:2},CAPTAIN:{name:"Captain",description:"Weniger Drift + Schild gegen Fakes",color:15965202,reduceDrift:!0,shieldFromFakes:!0}},STORMS:{FOG:{name:"Nebel",radarBlur:.6},CROSSWIND:{name:"Seitenwind",driftForce:200},SIGNAL_FLOOD:{name:"Signal Flood",spawnMultiplier:3,noiseRatio:.7},NARROW_PASS:{name:"Engpass",passWidth:200}},COLORS:{BACKGROUND:661032,WATER_DARK:859964,WATER_LIGHT:1718876,ACCENT:1752220,INSIGHT_REAL:3066993,INSIGHT_FAKE:15158332,UI_TEXT:15528177,UI_DARK:2899536},SCORING:{QUALITY_BONUS_THRESHOLD:.7,QUALITY_BONUS_MULTIPLIER:1.5,STABILITY_BONUS_MAX:500,BOOST_EFFICIENCY_BONUS:200},SHIP_SKINS:{DEFAULT:{id:"default",name:"Standard",hullColor:1752220,cabinColor:15528177,accentColor:1482885,wakeColor:6139362,unlockPoints:0,icon:"â›µ",hasGlow:!1,hasSparkle:!1},BRONZE:{id:"bronze",name:"Bronze",hullColor:13467442,cabinColor:16770229,accentColor:9127187,wakeColor:13467442,unlockPoints:1e4,icon:"ðŸ¥‰",hasGlow:!1,hasSparkle:!1},SILVER:{id:"silver",name:"Silber",hullColor:12632256,cabinColor:16777215,accentColor:8421504,wakeColor:12632256,unlockPoints:25e3,icon:"ðŸ¥ˆ",hasGlow:!0,glowColor:15263976,glowAlpha:.25,glowRadius:50,hasSparkle:!1},GOLD:{id:"gold",name:"Gold",hullColor:16766720,cabinColor:16775885,accentColor:14329120,wakeColor:16766720,unlockPoints:5e4,icon:"ðŸ¥‡",hasGlow:!0,glowColor:16766720,glowAlpha:.35,glowRadius:55,hasSparkle:!0,sparkleColor:16766720,sparkleFrequency:600},DIAMOND:{id:"diamond",name:"Diamant",hullColor:49151,cabinColor:14745599,accentColor:2003199,wakeColor:49151,unlockPoints:1e5,icon:"ðŸ’Ž",hasGlow:!0,glowColor:49151,glowAlpha:.4,glowRadius:60,hasSparkle:!0,sparkleColor:16777215,sparkleFrequency:400},RUBY:{id:"ruby",name:"Rubin",hullColor:14684511,cabinColor:16758465,accentColor:10162462,wakeColor:14684511,unlockPoints:2e5,icon:"ðŸ’ ",hasGlow:!0,glowColor:14684511,glowAlpha:.45,glowRadius:65,hasSparkle:!0,sparkleColor:16738740,sparkleFrequency:250}}},s={1:{insightSpawnRate:1,insightSpeed:1,realChance:t.INSIGHT.REAL_CHANCE_BASE,stormChance:0},2:{insightSpawnRate:.8,insightSpeed:1.2,realChance:.6,stormChance:.3},3:{insightSpawnRate:.6,insightSpeed:1.5,realChance:.5,stormChance:.5}};class i extends Phaser.Scene{constructor(){super("Boot")}create(){this.generateTextures(),this.textures.exists("flybridge-logo")?this.scene.start("Menu"):this.textures.once("addtexture-flybridge-logo",()=>{this.scene.start("Menu")})}generateTextures(){this.generateShipTextures(),this.generateInsightTextures(),this.generateBuoyTexture(),this.generateRadarSweep(),this.generateGateTextures(),this.generateBoostIcons(),this.generateLogo()}generateLogo(){const e=`data:image/svg+xml;base64,${btoa('<svg width="609" height="127" viewBox="0 0 609 127" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g clip-path="url(#clip0_72_410)">\n<path d="M97.8161 5.27979V94.0798H81.0161V5.27979H97.8161Z" fill="white"/>\n<path d="M179.976 27.6001L138.816 125.52H120.936L135.336 92.4001L108.696 27.6001H127.536L144.696 74.0401L162.096 27.6001H179.976Z" fill="white"/>\n<path d="M217.716 29.5198C221.515 27.5208 225.855 26.5198 230.736 26.5198C236.415 26.5198 241.555 27.9208 246.156 30.7198C250.756 33.5208 254.395 37.4998 257.076 42.6598C259.756 47.8198 261.096 53.8008 261.096 60.5998C261.096 67.3988 259.756 73.4208 257.076 78.6598C254.395 83.9008 250.756 87.9598 246.156 90.8398C241.555 93.7198 236.415 95.1598 230.736 95.1598C225.775 95.1598 221.436 94.1798 217.716 92.2198C213.996 90.2598 211.015 87.7198 208.776 84.5998V94.0798H191.976V5.27979H208.776V37.3198C210.936 34.1208 213.915 31.5198 217.716 29.5198ZM241.475 50.2198C239.834 47.3008 237.675 45.0798 234.995 43.5598C232.314 42.0408 229.415 41.2798 226.295 41.2798C223.253 41.2798 220.394 42.0598 217.715 43.6198C215.034 45.1798 212.874 47.4408 211.235 50.3998C209.594 53.3608 208.775 56.8408 208.775 60.8398C208.775 64.8388 209.594 68.3208 211.235 71.2798C212.874 74.2398 215.034 76.4998 217.715 78.0598C220.394 79.6198 223.254 80.3998 226.295 80.3998C229.415 80.3998 232.314 79.6018 234.995 77.9998C237.675 76.4008 239.834 74.1208 241.475 71.1598C243.114 68.2008 243.935 64.6798 243.935 60.5998C243.935 56.5998 243.114 53.1408 241.475 50.2198Z" fill="white"/>\n<path d="M297.595 29.6401C301.075 27.6411 305.053 26.6401 309.535 26.6401V44.2801H305.095C299.815 44.2801 295.834 45.5211 293.155 48.0001C290.474 50.4801 289.135 54.8011 289.135 60.9601V94.0801H272.335V27.6001H289.135V37.9201C291.295 34.4011 294.115 31.6411 297.595 29.6401Z" fill="white"/>\n<path d="M321.954 16.86C319.993 14.982 319.014 12.641 319.014 9.84C319.014 7.039 319.993 4.701 321.954 2.82C323.913 0.941 326.373 0 329.334 0C332.295 0 334.753 0.941 336.714 2.82C338.673 4.7 339.654 7.04 339.654 9.84C339.654 12.64 338.673 14.982 336.714 16.86C334.753 18.741 332.293 19.68 329.334 19.68C326.375 19.68 323.914 18.741 321.954 16.86ZM337.614 27.6V94.08H320.814V27.6H337.614Z" fill="white"/>\n<path d="M352.874 42.7198C355.553 37.5198 359.213 33.5208 363.854 30.7198C368.493 27.9208 373.653 26.5198 379.334 26.5198C383.654 26.5198 387.773 27.4608 391.694 29.3398C395.613 31.2208 398.733 33.7198 401.054 36.8398V5.27979H418.094V94.0798H401.054V84.2398C398.972 87.5208 396.053 90.1608 392.294 92.1598C388.533 94.1588 384.173 95.1598 379.214 95.1598C373.613 95.1598 368.493 93.7198 363.854 90.8398C359.213 87.9598 355.553 83.9008 352.874 78.6598C350.193 73.4208 348.854 67.4008 348.854 60.5998C348.854 53.8798 350.193 47.9208 352.874 42.7198ZM398.774 50.3398C397.173 47.4208 395.013 45.1798 392.294 43.6198C389.573 42.0598 386.654 41.2798 383.534 41.2798C380.414 41.2798 377.534 42.0408 374.894 43.5598C372.254 45.0808 370.113 47.3008 368.474 50.2198C366.833 53.1408 366.014 56.5998 366.014 60.5998C366.014 64.5998 366.833 68.0998 368.474 71.0998C370.113 74.0998 372.273 76.4008 374.954 77.9998C377.633 79.6018 380.493 80.3998 383.534 80.3998C386.654 80.3998 389.573 79.6198 392.294 78.0598C395.013 76.4998 397.173 74.2608 398.774 71.3398C400.374 68.4208 401.174 64.9198 401.174 60.8398C401.174 56.7598 400.374 53.2608 398.774 50.3398Z" fill="white"/>\n<path d="M472.806 29.46C476.565 31.421 479.526 33.96 481.686 37.08V27.6H498.606V94.56C498.606 100.719 497.365 106.219 494.886 111.06C492.405 115.899 488.685 119.739 483.726 122.58C478.764 125.419 472.765 126.84 465.726 126.84C456.286 126.84 448.545 124.639 442.506 120.24C436.464 115.839 433.045 109.839 432.246 102.24H448.926C449.805 105.279 451.705 107.7 454.626 109.5C457.545 111.3 461.085 112.2 465.246 112.2C470.125 112.2 474.085 110.739 477.126 107.82C480.166 104.899 481.686 100.479 481.686 94.56V84.24C479.526 87.36 476.544 89.961 472.746 92.04C468.946 94.12 464.605 95.16 459.726 95.16C454.125 95.16 449.005 93.72 444.366 90.84C439.725 87.96 436.065 83.901 433.386 78.66C430.705 73.421 429.366 67.401 429.366 60.6C429.366 53.88 430.705 47.921 433.386 42.72C436.065 37.52 439.705 33.521 444.306 30.72C448.906 27.921 454.045 26.52 459.726 26.52C464.685 26.52 469.045 27.5 472.806 29.46ZM479.286 50.34C477.685 47.421 475.525 45.18 472.806 43.62C470.085 42.06 467.166 41.28 464.046 41.28C460.926 41.28 458.046 42.041 455.406 43.56C452.766 45.081 450.625 47.301 448.986 50.22C447.345 53.141 446.526 56.6 446.526 60.6C446.526 64.6 447.345 68.1 448.986 71.1C450.625 74.1 452.785 76.401 455.466 78C458.145 79.602 461.005 80.4 464.046 80.4C467.166 80.4 470.085 79.62 472.806 78.06C475.525 76.5 477.685 74.261 479.286 71.34C480.886 68.421 481.686 64.92 481.686 60.84C481.686 56.76 480.885 53.261 479.286 50.34Z" fill="white"/>\n<path d="M69.744 5.27979H0.624023V22.0798H69.744V5.27979Z" fill="white"/>\n<path d="M45.836 33.356H41.43C18.698 33.356 0.19 51.76 0.008 74.45H0V74.752C0 74.763 0 74.774 0 74.786V80.203V94.522H16.8V74.733C16.829 61.176 27.866 50.156 41.43 50.156H47.944V50.153H69.743V33.353H45.836V33.356Z" fill="white"/>\n<path d="M575.518 65.88H526.918C527.317 70.68 528.997 74.442 531.958 77.16C534.917 79.881 538.558 81.24 542.878 81.24C549.118 81.24 553.558 78.56 556.198 73.2H574.318C572.398 79.601 568.717 84.861 563.278 88.98C557.837 93.102 551.158 95.16 543.238 95.16C536.837 95.16 531.097 93.741 526.017 90.9C520.936 88.062 516.976 84.042 514.137 78.84C511.296 73.641 509.877 67.641 509.877 60.84C509.877 53.961 511.275 47.922 514.077 42.72C516.876 37.52 520.797 33.521 525.837 30.72C530.877 27.921 536.677 26.52 543.237 26.52C549.555 26.52 555.216 27.881 560.216 30.6C565.215 33.321 569.096 37.181 571.857 42.18C574.617 47.18 575.997 52.92 575.997 59.4C575.997 61.8 575.837 63.96 575.518 65.88ZM558.598 54.6C558.518 50.28 556.957 46.821 553.918 44.22C550.877 41.621 547.156 40.32 542.758 40.32C538.598 40.32 535.097 41.58 532.258 44.1C529.417 46.62 527.678 50.121 527.038 54.6H558.598Z" fill="white"/>\n<path d="M597.867 95.1601C603.555 95.1601 608.167 90.5486 608.167 84.8601C608.167 79.1715 603.555 74.5601 597.867 74.5601C592.178 74.5601 587.567 79.1715 587.567 84.8601C587.567 90.5486 592.178 95.1601 597.867 95.1601Z" fill="white"/>\n</g>\n<defs>\n<clipPath id="clip0_72_410">\n<rect width="608.167" height="126.84" fill="white"/>\n</clipPath>\n</defs>\n</svg>')}`;this.textures.addBase64("flybridge-logo",e)}generateShipTextures(){this.generateShipTexture();const e=t.SHIP_SKINS;Object.keys(e).forEach(t=>{const s=e[t];this.generateShipTextureWithColors(s.id,s.hullColor,s.cabinColor,s.accentColor)})}generateShipTexture(){const e=this.add.graphics(),s=28;e.fillStyle(661032,.4),e.fillEllipse(s,66,44,10),e.fillStyle(15528177),e.beginPath(),e.moveTo(s,4),e.lineTo(34,8),e.lineTo(42,20),e.lineTo(44,45),e.lineTo(42,58),e.lineTo(32,62),e.lineTo(24,62),e.lineTo(14,58),e.lineTo(12,45),e.lineTo(14,20),e.lineTo(22,8),e.closePath(),e.fillPath(),e.fillStyle(2899536),e.beginPath(),e.moveTo(42,52),e.lineTo(44,45),e.lineTo(44,55),e.lineTo(42,60),e.lineTo(14,60),e.lineTo(12,55),e.lineTo(12,45),e.lineTo(14,52),e.closePath(),e.fillPath(),e.fillStyle(12436423,.5),e.beginPath(),e.moveTo(s,6),e.lineTo(23,10),e.lineTo(15,22),e.lineTo(13,44),e.lineTo(15,56),e.lineTo(25,60),e.lineTo(s,60),e.lineTo(s,6),e.closePath(),e.fillPath(),e.fillStyle(9139029),e.beginPath(),e.moveTo(s,12),e.lineTo(38,22),e.lineTo(40,44),e.lineTo(38,54),e.lineTo(18,54),e.lineTo(16,44),e.lineTo(18,22),e.closePath(),e.fillPath(),e.lineStyle(1,7033668,.3);for(let t=-8;t<=8;t+=4)e.lineBetween(s+t,24,s+t,52);e.fillStyle(16777215),e.fillRoundedRect(18,26,20,20,3),e.fillStyle(15528177),e.fillRoundedRect(17,24,22,6,2),e.fillStyle(6139362,.9),e.fillRoundedRect(21,28,6,5,1),e.fillRoundedRect(29,28,6,5,1),e.fillStyle(8765929,.7),e.fillRect(18,32,2,8),e.fillRect(36,32,2,8),e.fillStyle(16777215),e.fillRoundedRect(20,16,16,10,2),e.lineStyle(1,9807270),e.strokeRect(21,17,14,8),e.fillStyle(2899536),e.fillCircle(25,21,2),e.fillCircle(31,21,2),e.fillStyle(3426654),e.fillRect(26,17,4,3),e.fillStyle(8359053),e.fillRect(27,6,2,12),e.fillStyle(16777215),e.fillCircle(s,6,4),e.fillStyle(t.COLORS.ACCENT,.6),e.fillCircle(s,6,3),e.lineStyle(1,1752220),e.strokeCircle(s,6,4),e.fillStyle(9139029),e.fillRect(20,60,16,4),e.fillStyle(2899536),e.fillRect(22,62,4,5),e.fillRect(30,62,4,5),e.fillStyle(1710618),e.fillRect(23,65,2,3),e.fillRect(31,65,2,3),e.fillStyle(3066993),e.fillCircle(40,22,2),e.fillStyle(15158332),e.fillCircle(16,22,2),e.fillStyle(16777215),e.fillCircle(s,10,1.5),e.generateTexture("ship",56,70),e.destroy()}generateShipTextureWithColors(e,t,s,i){const o=this.add.graphics(),n=28,a=(e,t)=>Math.max(0,(e>>16&255)-t)<<16|Math.max(0,(e>>8&255)-t)<<8|Math.max(0,(255&e)-t);o.fillStyle(661032,.4),o.fillEllipse(n,66,44,10),o.fillStyle(t),o.beginPath(),o.moveTo(n,4),o.lineTo(34,8),o.lineTo(42,20),o.lineTo(44,45),o.lineTo(42,58),o.lineTo(32,62),o.lineTo(24,62),o.lineTo(14,58),o.lineTo(12,45),o.lineTo(14,20),o.lineTo(22,8),o.closePath(),o.fillPath(),o.fillStyle(a(t,60)),o.beginPath(),o.moveTo(42,52),o.lineTo(44,45),o.lineTo(44,55),o.lineTo(42,60),o.lineTo(14,60),o.lineTo(12,55),o.lineTo(12,45),o.lineTo(14,52),o.closePath(),o.fillPath(),o.fillStyle(a(t,30),.5),o.beginPath(),o.moveTo(n,6),o.lineTo(23,10),o.lineTo(15,22),o.lineTo(13,44),o.lineTo(15,56),o.lineTo(25,60),o.lineTo(n,60),o.lineTo(n,6),o.closePath(),o.fillPath(),o.fillStyle(9139029),o.beginPath(),o.moveTo(n,12),o.lineTo(38,22),o.lineTo(40,44),o.lineTo(38,54),o.lineTo(18,54),o.lineTo(16,44),o.lineTo(18,22),o.closePath(),o.fillPath(),o.lineStyle(1,7033668,.3);for(let r=-8;r<=8;r+=4)o.lineBetween(n+r,24,n+r,52);o.fillStyle(s),o.fillRoundedRect(18,26,20,20,3),o.fillStyle(a(s,20)),o.fillRoundedRect(17,24,22,6,2),o.fillStyle(6139362,.9),o.fillRoundedRect(21,28,6,5,1),o.fillRoundedRect(29,28,6,5,1),o.fillStyle(8765929,.7),o.fillRect(18,32,2,8),o.fillRect(36,32,2,8),o.fillStyle(s),o.fillRoundedRect(20,16,16,10,2),o.lineStyle(1,9807270),o.strokeRect(21,17,14,8),o.fillStyle(i),o.fillCircle(25,21,2),o.fillCircle(31,21,2),o.fillStyle(a(i,40)),o.fillRect(26,17,4,3),o.fillStyle(8359053),o.fillRect(27,6,2,12),o.fillStyle(s),o.fillCircle(n,6,4),o.fillStyle(i,.6),o.fillCircle(n,6,3),o.lineStyle(1,i),o.strokeCircle(n,6,4),o.fillStyle(9139029),o.fillRect(20,60,16,4),o.fillStyle(2899536),o.fillRect(22,62,4,5),o.fillRect(30,62,4,5),o.fillStyle(1710618),o.fillRect(23,65,2,3),o.fillRect(31,65,2,3),o.fillStyle(3066993),o.fillCircle(40,22,2),o.fillStyle(15158332),o.fillCircle(16,22,2),o.fillStyle(16777215),o.fillCircle(n,10,1.5),o.generateTexture(`ship-${e}`,56,70),o.destroy()}generateInsightTextures(){const e=40,s=20,i=this.add.graphics();i.fillStyle(3066993,.08),i.fillCircle(s,s,18),i.fillStyle(3066993,.12),i.fillCircle(s,s,15),i.fillStyle(3066993,.2),i.fillCircle(s,s,12),i.fillStyle(t.COLORS.INSIGHT_REAL,.9),i.fillCircle(s,s,10),i.lineStyle(2,2600544),i.strokeCircle(s,s,10),i.fillStyle(5822093,.7),i.fillCircle(s,s,6),i.fillStyle(8577194,.8),i.fillCircle(s,s,3),i.fillStyle(16777215,.4),i.fillCircle(17,17,2),i.generateTexture("insight-real",e,e),i.destroy();const o=this.add.graphics();o.fillStyle(15158332,.06),o.fillCircle(21,s,16),o.fillStyle(15158332,.1),o.fillCircle(19,21,14),o.fillStyle(15158332,.15),o.fillCircle(s,s,11),o.fillStyle(t.COLORS.INSIGHT_FAKE,.8),o.fillCircle(s,s,8),o.lineStyle(2,12597547),o.strokeCircle(s,s,8),o.fillStyle(15037299,.5),o.fillCircle(18,18,3),o.fillStyle(15832202,.4),o.fillCircle(22,21,2),o.generateTexture("insight-fake",e,e),o.destroy();const n=this.add.graphics();n.fillStyle(15844367,.15),n.fillCircle(s,s,19),n.fillStyle(15844367,.25),n.fillCircle(s,s,16),n.lineStyle(3,15844367,.9),n.strokeCircle(s,s,14),n.fillStyle(3066993,.2),n.fillCircle(s,s,12),n.fillStyle(t.COLORS.INSIGHT_REAL,.95),n.fillCircle(s,s,10),n.lineStyle(2,2600544),n.strokeCircle(s,s,10),n.fillStyle(5822093,.8),n.fillCircle(s,s,6),n.fillStyle(11267014,.9),n.fillCircle(s,s,3),n.generateTexture("insight-highlighted",e,e),n.destroy()}generateBuoyTexture(){const e=this.add.graphics();e.fillStyle(15158332),e.fillRoundedRect(4,0,12,30,4),e.fillStyle(16777215),e.fillRect(4,10,12,8),e.fillStyle(12597547),e.fillCircle(10,4,6),e.generateTexture("buoy",20,34),e.destroy()}generateRadarSweep(){const e=this.add.graphics(),s=100;for(let i=0;i<60;i++){const o=(60-i)/60*.4,n=-i*(Math.PI/180);e.lineStyle(3,t.COLORS.ACCENT,o),e.beginPath(),e.moveTo(s,s),e.lineTo(s+90*Math.cos(n),s+90*Math.sin(n)),e.strokePath()}e.generateTexture("radar-sweep",200,200),e.destroy()}generateGateTextures(){const e=[15158332,3066993,3447003];["SPEED","QUALITY","SAFETY"].forEach((t,s)=>{const i=this.add.graphics();i.lineStyle(4,e[s],.9),i.strokeRoundedRect(2,2,96,56,8),i.fillStyle(e[s],.2),i.fillRoundedRect(4,4,92,52,6),i.fillStyle(e[s],.8),i.fillTriangle(50,45,40,35,60,35),i.generateTexture(`gate-${t.toLowerCase()}`,100,60),i.destroy()})}generateBoostIcons(){const e=t.BOOSTS;Object.entries(e).forEach(([e,t])=>{const s=this.add.graphics();s.fillStyle(t.color,.3),s.fillCircle(20,20,18),s.lineStyle(3,t.color),s.strokeCircle(20,20,18),s.fillStyle(t.color),"NAVIGATOR"===e?s.fillTriangle(20,8,14,26,26,26):"ANALYST"===e?(s.fillRect(10,24,6,10),s.fillRect(17,18,6,16),s.fillRect(24,12,6,22)):"CAPTAIN"===e?(s.lineStyle(3,t.color),s.strokeCircle(20,14,5),s.lineBetween(20,19,20,32),s.lineBetween(12,28,20,32),s.lineBetween(28,28,20,32)):"CREW_SYNC"===e&&(s.fillCircle(14,14,4),s.fillCircle(26,14,4),s.fillRect(10,20,8,12),s.fillRect(22,20,8,12)),s.generateTexture(`boost-${e.toLowerCase()}`,40,40),s.destroy()})}}class o{constructor(e){this.scene=e,this.waves=[],this.stars=[],this.particles=[],this.createBackground(),this.createStars(),this.createWaves(),this.createAmbientParticles()}createBackground(){const e=this.scene.add.graphics().setDepth(-10);for(let s=0;s<.6*t.HEIGHT;s+=4){const i=s/(.6*t.HEIGHT),o=Math.floor(10+5*i)<<16|Math.floor(22+10*i)<<8|Math.floor(40+20*i);e.fillStyle(o,1),e.fillRect(0,s,t.WIDTH,4)}e.fillStyle(1718876,.3),e.fillRect(0,.4*t.HEIGHT,t.WIDTH,60),e.fillStyle(2771564,.2),e.fillRect(0,.42*t.HEIGHT,t.WIDTH,40),this.background=e}createStars(){for(let e=0;e<50;e++){const e=Phaser.Math.Between(0,t.WIDTH),s=Phaser.Math.Between(0,.5*t.HEIGHT),i=Phaser.Math.FloatBetween(.5,2),o=Phaser.Math.FloatBetween(.3,.8),n=Phaser.Math.FloatBetween(.001,.003),a=Phaser.Math.FloatBetween(0,2*Math.PI),r=this.scene.add.circle(e,s,i,16777215,o).setDepth(-5);this.stars.push({sprite:r,baseAlpha:o,twinkleSpeed:n,twinkleOffset:a})}}createAmbientParticles(){for(let e=0;e<20;e++){const e=Phaser.Math.Between(0,t.WIDTH),s=Phaser.Math.Between(.3*t.HEIGHT,t.HEIGHT),i=Phaser.Math.FloatBetween(1,3),o=Phaser.Math.FloatBetween(.1,.3),n=Phaser.Math.FloatBetween(-.3,.3),a=Phaser.Math.FloatBetween(-.2,.1),r=this.scene.add.circle(e,s,i,6139362,o).setDepth(2);this.particles.push({sprite:r,speedX:n,speedY:a,baseY:s})}}createWaves(){const e=[661032,859964,1718876,859964,1453386],t=[.9,.7,.5,.4,.3];for(let s=0;s<5;s++){const i=this.createWaveGraphics(e[s],t[s],s);this.waves.push(i)}}createWaveGraphics(e,s,i){return{graphics:this.scene.add.graphics().setDepth(i),amplitude:15+5*i,frequency:.02-.003*i,baseY:t.HEIGHT-150+40*i,speed:.5+.2*i,offset:50*i,color:e,alpha:s}}update(e){this.stars.forEach(t=>{const s=Math.sin(e*t.twinkleSpeed+t.twinkleOffset);t.sprite.setAlpha(t.baseAlpha*(.5+.5*s))}),this.particles.forEach(e=>{e.sprite.x+=e.speedX,e.sprite.y+=e.speedY,e.sprite.x<0&&(e.sprite.x=t.WIDTH),e.sprite.x>t.WIDTH&&(e.sprite.x=0),e.sprite.y<.3*t.HEIGHT&&(e.sprite.y=t.HEIGHT),e.sprite.y>t.HEIGHT&&(e.sprite.y=.3*t.HEIGHT)}),this.waves.forEach((s,i)=>{const o=s.graphics;o.clear(),o.fillStyle(s.color,s.alpha),o.beginPath(),o.moveTo(0,t.HEIGHT);for(let n=0;n<=t.WIDTH;n+=8){const t=s.baseY+Math.sin((n+e*s.speed+s.offset)*s.frequency)*s.amplitude+Math.sin((.5*n+e*s.speed*1.5)*s.frequency*2)*(.3*s.amplitude);o.lineTo(n,t)}if(o.lineTo(t.WIDTH,t.HEIGHT),o.closePath(),o.fillPath(),i===this.waves.length-1){o.lineStyle(1,6139362,.2);for(let i=0;i<=t.WIDTH;i+=8){const t=s.baseY+Math.sin((i+e*s.speed+s.offset)*s.frequency)*s.amplitude+Math.sin((.5*i+e*s.speed*1.5)*s.frequency*2)*(.3*s.amplitude);o.lineTo(i,t)}}})}setIntensity(e){this.waves.forEach((t,s)=>{t.amplitude=(15+5*s)*(1+.5*e),t.speed=(.5+.2*s)*(1+.3*e)})}destroy(){this.waves.forEach(e=>e.graphics.destroy()),this.waves=[],this.stars.forEach(e=>e.sprite.destroy()),this.stars=[],this.particles.forEach(e=>e.sprite.destroy()),this.particles=[],this.background&&this.background.destroy()}}const n="flybridge_radar_run",a=new class{constructor(){this.data=this.loadData()}loadData(){try{const e=localStorage.getItem(n);if(e)return JSON.parse(e)}catch(e){}return{highScore:0,gamesPlayed:0,totalInsightsCollected:0,totalFakesAvoided:0,totalPointsEarned:0,maxCombo:0,achievements:[],selectedSkin:"default",lastPlayed:null}}saveData(){try{this.data.lastPlayed=(new Date).toISOString(),localStorage.setItem(n,JSON.stringify(this.data))}catch(e){}}getHighScore(){return this.data.highScore}updateHighScore(e){return e>this.data.highScore&&(this.data.highScore=e,this.saveData(),!0)}addGameStats(e){this.data.gamesPlayed++,this.data.totalInsightsCollected+=e.realInsights||0,this.data.totalPointsEarned+=e.finalScore||0,e.maxCombo>this.data.maxCombo&&(this.data.maxCombo=e.maxCombo),this.saveData()}getSelectedSkin(){return this.data.selectedSkin||"default"}setSelectedSkin(e){return!!this.isSkinUnlocked(e)&&(this.data.selectedSkin=e,this.saveData(),!0)}getTotalPointsEarned(){return this.data.totalPointsEarned||0}isSkinUnlocked(e){const s=t.SHIP_SKINS,i=Object.keys(s).find(t=>s[t].id===e);if(!i)return!1;const o=s[i];return this.getTotalPointsEarned()>=o.unlockPoints}getUnlockedSkins(){const e=this.getTotalPointsEarned(),s=t.SHIP_SKINS;return Object.keys(s).filter(t=>s[t].unlockPoints<=e).map(e=>s[e])}getNextSkinToUnlock(){const e=this.getTotalPointsEarned(),s=t.SHIP_SKINS,i=Object.keys(s).filter(t=>s[t].unlockPoints>e).sort((e,t)=>s[e].unlockPoints-s[t].unlockPoints);return i.length>0?s[i[0]]:null}unlockAchievement(e){return!this.data.achievements.includes(e)&&(this.data.achievements.push(e),this.saveData(),!0)}hasAchievement(e){return this.data.achievements.includes(e)}getUnlockedAchievements(){return this.data.achievements}getStats(){return __spreadValues({},this.data)}resetProgress(){this.data={highScore:0,gamesPlayed:0,totalInsightsCollected:0,totalFakesAvoided:0,totalPointsEarned:0,maxCombo:0,achievements:[],selectedSkin:"default",lastPlayed:null},this.saveData()}};class r{constructor(e){this.scene=e,this.queue=[],this.isShowing=!1,this.createContainer()}createContainer(){this.container=this.scene.add.container(t.WIDTH/2,-80).setDepth(500),this.bg=this.scene.add.rectangle(0,0,300,70,0,.9).setStrokeStyle(3,15844367),this.icon=this.scene.add.text(-120,0,"",{fontSize:"32px"}).setOrigin(.5),this.title=this.scene.add.text(-80,-12,"",{fontFamily:"Arial",fontSize:"18px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(0,.5),this.desc=this.scene.add.text(-80,12,"",{fontFamily:"Arial",fontSize:"14px",color:"#BDC3C7"}).setOrigin(0,.5),this.container.add([this.bg,this.icon,this.title,this.desc])}show(e){const s=t.ACHIEVEMENTS[e];s&&(a.hasAchievement(e)||(a.unlockAchievement(e),this.queue.push(s),this.processQueue()))}processQueue(){if(this.isShowing||0===this.queue.length)return;this.isShowing=!0;const e=this.queue.shift();this.icon.setText(e.icon),this.title.setText(e.name),this.desc.setText(e.description),this.scene.tweens.add({targets:this.container,y:50,duration:500,ease:"Back.out",onComplete:()=>{this.scene.time.delayedCall(2500,()=>{this.scene.tweens.add({targets:this.container,y:-80,duration:400,ease:"Back.in",onComplete:()=>{this.isShowing=!1,this.processQueue()}})})}}),this.scene.soundGen&&this.scene.soundGen.playAchievementSound&&this.scene.soundGen.playAchievementSound()}destroy(){this.container.destroy()}}const l=class e{static isMobile(){null===e._cachedTouch&&(e._cachedTouch="ontouchstart"in window||navigator.maxTouchPoints>0,e._cachedUserAgent=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));const t=e._cachedUserAgent,s=window.innerWidth<=1024||window.innerHeight<=500;return t||s}static hasTouch(){return null===e._cachedTouch&&(e._cachedTouch="ontouchstart"in window||navigator.maxTouchPoints>0),e._cachedTouch}static isTablet(){return e.hasTouch()&&window.innerWidth>1024&&window.innerWidth<=1366&&window.innerHeight>600}static isDesktop(){return!e.isMobile()&&!e.isTablet()}};__publicField(l,"_cachedTouch",null),__publicField(l,"_cachedUserAgent",null);let h=l;class c extends Phaser.Scene{constructor(){super("Menu")}create(){this.showingTutorial=!1,this.isMobile=h.isMobile(),this.waveEffect=new o(this),this.isMobile&&this.createOrientationOverlay(),this.isMobile?this.createMobileLayout():this.createDesktopLayout(),this.cameras.main.fadeIn(500)}createMobileLayout(){const e=t.HEIGHT,s=t.WIDTH/2;this.add.text(s,.08*e,"SET THE COURSE",{fontFamily:"Arial, sans-serif",fontSize:"24px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5),this.add.text(s,.15*e,"FLYBRIDGE RADAR RUN",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#1ABC9C"}).setOrigin(.5);const i=a.getStats();i.highScore>0&&this.add.text(s,.23*e,`â­ ${i.highScore.toLocaleString()}`,{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(.5);const o=a.getSelectedSkin();this.shipPreview=this.add.image(s,.45*e,`ship-${o}`).setScale(1),this.tweens.add({targets:this.shipPreview,y:.45*e+5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.createSkinButton();const n=this.createButton(s,.68*e,"STARTEN","#1ABC9C",()=>{this.startGame()},140,40);this.tweens.add({targets:n.bg,scaleX:1.03,scaleY:1.03,duration:800,yoyo:!0,repeat:-1}),this.createButton(s,.82*e,"HILFE","#34495E",()=>{this.showTutorial()},80,28),this.createFullscreenButton()}createDesktopLayout(){const e=t.WIDTH/2;this.addLogoWatermark(),this.add.text(e,60,"SET THE COURSE",{fontFamily:"Arial, sans-serif",fontSize:"48px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5),this.add.text(e,110,"FLYBRIDGE RADAR RUN",{fontFamily:"Arial, sans-serif",fontSize:"24px",color:"#1ABC9C"}).setOrigin(.5);const s=a.getSelectedSkin();this.shipPreview=this.add.image(e,200,`ship-${s}`).setScale(2.2),this.tweens.add({targets:this.shipPreview,y:215,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.createSkinButton();const i=a.getStats();i.highScore>0&&(this.add.text(e,310,`HIGHSCORE: ${i.highScore.toLocaleString()}`,{fontFamily:"Arial, sans-serif",fontSize:"18px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(.5),this.add.text(e,335,`Spiele: ${i.gamesPlayed} | Max Combo: ${i.maxCombo}x`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#95A5A6"}).setOrigin(.5)),this.createQuickInstructions(),this.createButtons()}createQuickInstructions(){this.isMobile||(this.add.text(t.WIDTH/2,365,"90 Sekunden. Sammle echte Insights. Setze deinen Kurs.",{fontFamily:"Arial, sans-serif",fontSize:"17px",fontStyle:"italic",color:"#95A5A6"}).setOrigin(.5),this.add.text(t.WIDTH/2,410,"â† â†’  Steuern   |   SPACE  Starten   |   H  Anleitung",{fontFamily:"Arial, sans-serif",fontSize:"15px",color:"#7F8C8D",backgroundColor:"#1a2a3a",padding:{x:18,y:10}}).setOrigin(.5))}createButtons(){const e=this.isMobile?t.HEIGHT-100:480,s=this.createButton(t.WIDTH/2,e,"SPIEL STARTEN","#1ABC9C",()=>{this.startGame()},220,50);this.tweens.add({targets:s.bg,scaleX:1.03,scaleY:1.03,duration:800,yoyo:!0,repeat:-1}),this.createButton(t.WIDTH/2,e+55,"ANLEITUNG","#34495E",()=>{this.showTutorial()},140,34),this.createFullscreenButton(),this.input.keyboard.on("keydown-SPACE",()=>{this.showingTutorial||this.startGame()}),this.input.keyboard.on("keydown-H",()=>{this.showingTutorial||this.showTutorial()})}createButton(e,t,s,i,o,n=200,a=40){const r=this.add.rectangle(e,t,n,a,Phaser.Display.Color.HexStringToColor(i).color,.9).setInteractive({useHandCursor:!0}).on("pointerover",()=>r.setFillStyle(Phaser.Display.Color.HexStringToColor(i).color,1)).on("pointerout",()=>r.setFillStyle(Phaser.Display.Color.HexStringToColor(i).color,.9)).on("pointerdown",o),l=a>40?"18px":"14px",h=this.add.text(e,t,s,{fontFamily:"Arial, sans-serif",fontSize:l,fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5);return{bg:r,label:h}}createOrientationOverlay(){this.orientationOverlay=this.add.container(t.WIDTH/2,t.HEIGHT/2).setDepth(200);const e=this.add.rectangle(0,0,t.WIDTH,t.HEIGHT,859964,.98);this.orientationOverlay.add(e);const s=this.add.text(0,-40,"ðŸ“±â†»",{fontSize:"48px"}).setOrigin(.5);this.orientationOverlay.add(s);const i=this.add.text(0,30,"Bitte drehe dein GerÃ¤t\nins Querformat",{fontFamily:"Arial, sans-serif",fontSize:"20px",fontStyle:"bold",color:"#ECF0F1",align:"center"}).setOrigin(.5);this.orientationOverlay.add(i);const o=this.add.text(0,90,"Das Spiel funktioniert am besten\nim Landscape-Modus",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#7F8C8D",align:"center"}).setOrigin(.5);this.orientationOverlay.add(o),this.checkOrientation(),window.addEventListener("resize",()=>this.checkOrientation()),window.addEventListener("orientationchange",()=>{setTimeout(()=>this.checkOrientation(),100)})}checkOrientation(){if(!this.orientationOverlay)return;const e=window.innerHeight>window.innerWidth;this.orientationOverlay.setVisible(e)}createSkinButton(){const e=a.getSelectedSkin(),s=t.SHIP_SKINS,i=Object.values(s).find(t=>t.id===e)||s.DEFAULT,o=t.WIDTH/2,n=this.isMobile?.56*t.HEIGHT:265,r=this.isMobile?"10px":"14px",l=this.isMobile?"9px":"13px",h=this.isMobile?90:120;this.skinBtn=this.add.rectangle(o,n,h,18,1752220,.3).setStrokeStyle(1,1752220,.6).setInteractive({useHandCursor:!0}).on("pointerover",()=>this.skinBtn.setFillStyle(1752220,.5)).on("pointerout",()=>this.skinBtn.setFillStyle(1752220,.3)).on("pointerdown",()=>this.showSkinSelector()),this.skinBtnText=this.add.text(o,n,`${i.icon} ${i.name} â–¼`,{fontFamily:"Arial, sans-serif",fontSize:r,color:"#ECF0F1"}).setOrigin(.5);const c=a.getNextSkinToUnlock();if(c&&!this.isMobile){const e=a.getTotalPointsEarned(),t=Math.min(100,Math.round(e/c.unlockPoints*100));this.add.text(o,n+18,`NÃ¤chstes: ${c.icon} ${c.name} (${t}%)`,{fontFamily:"Arial, sans-serif",fontSize:l,color:"#95A5A6"}).setOrigin(.5)}}showSkinSelector(){if(this.showingTutorial)return;this.showingTutorial=!0;const e=this.add.rectangle(t.WIDTH/2,t.HEIGHT/2,t.WIDTH,t.HEIGHT,0,.9).setDepth(100).setInteractive(),s=this.add.container(t.WIDTH/2,t.HEIGHT/2).setDepth(101),i=this.isMobile,o=i?t.WIDTH-40:t.WIDTH-80,n=i?t.HEIGHT-40:t.HEIGHT-100,r=this.add.rectangle(0,0,o,n,1714746,.98).setStrokeStyle(2,1752220);s.add(r);const l=i?-n/2+25:-200,h=this.add.text(0,l,"SCHIFF AUSWÃ„HLEN",{fontFamily:"Arial, sans-serif",fontSize:i?"18px":"24px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5);s.add(h);const c=a.getTotalPointsEarned(),d=this.add.text(0,l+25,`Gesammelte Punkte: ${c.toLocaleString()}`,{fontFamily:"Arial, sans-serif",fontSize:i?"12px":"14px",color:"#F1C40F"}).setOrigin(.5);s.add(d);const u=t.SHIP_SKINS,p=Object.keys(u),f=i?130:180,g=i?115:160,m=i?90:120,S=i?100:140,y=-2*f/2,T=i?-60:-80;p.forEach((t,o)=>{const n=u[t],r=o%3,l=Math.floor(o/3),h=y+r*f,c=T+l*S,d=a.isSkinUnlocked(n.id),p=a.getSelectedSkin()===n.id,C=p?1752220:d?2899536:1710618,w=this.add.rectangle(h,c,g,m,C,d?.8:.4).setStrokeStyle(2,p?1752220:d?8359053:4473924);d&&w.setInteractive({useHandCursor:!0}).on("pointerdown",()=>{a.setSelectedSkin(n.id),this.shipPreview.setTexture(`ship-${n.id}`),this.skinBtnText.setText(`${n.icon} ${n.name}`),s.destroy(),e.destroy(),this.showingTutorial=!1}),s.add(w);const I=i?.9:1.2,b=i?-18:-25,E=this.add.image(h,c+b,`ship-${n.id}`).setScale(I);d||E.setAlpha(.3),s.add(E);const x=i?18:25,A=this.add.text(h,c+x,`${n.icon} ${n.name}`,{fontFamily:"Arial, sans-serif",fontSize:i?"11px":"14px",fontStyle:"bold",color:d?"#ECF0F1":"#666666"}).setOrigin(.5);let O;s.add(A),O=p?"AUSGEWÃ„HLT":d?i?"AuswÃ¤hlen":"Klicken zum AuswÃ¤hlen":`ðŸ”’ ${n.unlockPoints.toLocaleString()}`;const F=i?32:45,H=this.add.text(h,c+F,O,{fontFamily:"Arial, sans-serif",fontSize:i?"9px":"10px",color:p?"#1ABC9C":d?"#7F8C8D":"#E74C3C"}).setOrigin(.5);s.add(H)});const C=i?n/2-25:200,w=this.add.rectangle(0,C,120,32,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{s.destroy(),e.destroy(),this.showingTutorial=!1});s.add(w);const I=this.add.text(0,C,"SCHLIESSEN",{fontFamily:"Arial, sans-serif",fontSize:"12px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5);s.add(I),this.input.keyboard.once("keydown-ESC",()=>{s.destroy(),e.destroy(),this.showingTutorial=!1})}createFullscreenButton(){const e=t.WIDTH-50;this.add.rectangle(e,30,70,30,2899536,.8).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.toggleFullscreen()),this.fullscreenIcon=this.add.text(e,30,"â›¶ Vollbild",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#ECF0F1"}).setOrigin(.5),document.addEventListener("fullscreenchange",()=>this.updateFullscreenButton())}toggleFullscreen(){const e=document.getElementById("game-container")||document.documentElement;document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():(e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape").catch(()=>{}))}updateFullscreenButton(){this.fullscreenIcon&&(document.fullscreenElement?this.fullscreenIcon.setText("âœ• Beenden"):this.fullscreenIcon.setText("â›¶ Vollbild"))}showTutorial(){this.showingTutorial=!0;const e=this.isMobile,s=this.add.rectangle(t.WIDTH/2,t.HEIGHT/2,t.WIDTH,t.HEIGHT,0,.9).setDepth(100).setInteractive(),i=this.add.container(t.WIDTH/2,t.HEIGHT/2).setDepth(101),o=e?t.WIDTH-30:t.WIDTH-60,n=e?t.HEIGHT-30:t.HEIGHT-60,a=this.add.rectangle(0,0,o,n,1714746,.98).setStrokeStyle(2,1752220);i.add(a);const r=e?-n/2+25:-220,l=this.add.text(0,r,"WIE SPIELT MAN?",{fontFamily:"Arial, sans-serif",fontSize:e?"20px":"28px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5);i.add(l);const h=e?-o/2+20:-300;let c=e?-n/2+65:-180;(e?[{title:"ZIEL",content:"90 Sekunden Boot steuern, grÃ¼ne Insights sammeln,\nrote Noise vermeiden. Je mehr Insights, desto mehr Punkte!"},{title:"STEUERUNG",content:"Links/rechts auf dem Bildschirm tippen oder wischen.\nDas Boot folgt deiner BerÃ¼hrung."},{title:"BOOST-METER",content:"Linker Balken fÃ¼llt sich durch Insights. Bei 100% wÃ¤hle:\nâ— Navigator: 2x Punkte + echte Insights markiert\nâ— Captain: Schild gegen Fakes + weniger Drift"},{title:"STRATEGY GATES",content:"Alle 15 Sek. erscheint ein MenÃ¼ oben - tippe darauf:\nâ— SPEED: Mehr Punkte, mehr Risiko\nâ— QUALITY: Mehr echte Insights\nâ— SAFETY: Weniger StÃ¼rme"},{title:"POWER-UPS & STÃœRME",content:"Sammle Power-Ups fÃ¼r Boni! StÃ¼rme bringen Nebel,\nWind oder Signal-Flut - halte durch!"}]:[{title:"ZIEL DES SPIELS",content:"Navigiere dein Boot 90 Sekunden lang durch den Datenstrom.\nSammle echte Insights (grÃ¼n) und vermeide Noise (rot)."},{title:"STEUERUNG",content:"â† â†’ oder A/D: Boot steuern | H/ESC: Pause"},{title:"INSIGHTS & POWER-UPS",content:"â— GrÃ¼ne Insights: +100 Punkte, fÃ¼llt Boost-Meter\nâ— Rote Noise: -30 Punkte, bricht Combo\nâ¬¡ Power-Ups erscheinen zufÃ¤llig - einsammeln!"},{title:"BOOST-METER (gelber Balken links)",content:"FÃ¼llt sich durch Insight-Sammeln. Bei 100%: WÃ¤hle Boost!\n[Q] Navigator: 2x Punkte + echte Insights markiert\n[E] Captain: Schild gegen Fakes + weniger Drift"},{title:"STRATEGY GATES (alle ~15 Sek.)",content:"MenÃ¼ erscheint oben - KLICKE oder 1/2/3:\nSPEED (x1.5) | QUALITY | SAFETY (x0.8)"},{title:"RADAR & STÃœRME",content:"Radar (unten rechts): Zeigt wo Insights kommen\nStÃ¼rme: Nebel, Wind, Signal-Flut"}]).forEach((t,s)=>{const n=this.add.text(h,c,t.title,{fontFamily:"Arial, sans-serif",fontSize:e?"12px":"13px",fontStyle:"bold",color:"#F1C40F"});i.add(n);const a=this.add.text(h,c+15,t.content,{fontFamily:"Arial, sans-serif",fontSize:e?"10px":"11px",color:"#BDC3C7",lineSpacing:e?2:3,wordWrap:{width:o-40}});i.add(a);const r=a.height;c+=20+r});const d=e?n/2-25:220,u=this.add.rectangle(0,d,150,36,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{i.destroy(),s.destroy(),this.showingTutorial=!1});i.add(u);const p=this.add.text(0,d,"VERSTANDEN!",{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5);i.add(p),this.input.keyboard.once("keydown-ESC",()=>{i.destroy(),s.destroy(),this.showingTutorial=!1})}addLogoWatermark(){const e=(this.isMobile?100:180)/609;this.add.image(15,t.HEIGHT-10,"flybridge-logo").setOrigin(0,1).setAlpha(this.isMobile?.12:.15).setDepth(1).setScale(e)}update(e,t){this.waveEffect.update(e)}startGame(){this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>{this.waveEffect.destroy(),this.scene.start("Game")})}}class d extends Phaser.Physics.Arcade.Sprite{constructor(e,s,i){const o=a.getSelectedSkin();super(e,s,i,`ship-${o}`);const n=o.toUpperCase();this.skinConfig=t.SHIP_SKINS[n]||t.SHIP_SKINS.DEFAULT,e.add.existing(this),e.physics.add.existing(this),this.setCollideWorldBounds(!0),this.body.setSize(36,50),this.setDrag(800),this.setMaxVelocity(t.SHIP.SPEED,50),this.driftForce=0,this.driftDirection=0,this.isStabilized=!1,this.isShielded=!1,this.stabilityScore=100,this.lastX=s,this.createTrail(e)}createTrail(e){const t=this.skinConfig.wakeColor||6139362;if(this.trail=e.add.particles(this.x,this.y,"insight-real",{scale:{start:.25,end:0},alpha:{start:.4,end:0},speed:{min:15,max:30},lifespan:500,frequency:40,follow:this,followOffset:{x:0,y:32},tint:t}),this.wakeLeft=e.add.particles(this.x,this.y,"insight-real",{scale:{start:.15,end:0},alpha:{start:.3,end:0},speed:{min:20,max:40},angle:{min:150,max:180},lifespan:400,frequency:60,follow:this,followOffset:{x:-14,y:28},tint:t}),this.wakeRight=e.add.particles(this.x,this.y,"insight-real",{scale:{start:.15,end:0},alpha:{start:.3,end:0},speed:{min:20,max:40},angle:{min:0,max:30},lifespan:400,frequency:60,follow:this,followOffset:{x:14,y:28},tint:t}),this.skinConfig.hasGlow){const t=this.skinConfig.glowRadius||45;this.glowAura=e.add.circle(this.x,this.y,t,this.skinConfig.glowColor,this.skinConfig.glowAlpha).setDepth(-1),e.tweens.add({targets:this.glowAura,scale:{from:1,to:1.2},alpha:{from:this.skinConfig.glowAlpha,to:.5*this.skinConfig.glowAlpha},duration:1200,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}this.skinConfig.hasSparkle&&(this.sparkleTimer=e.time.addEvent({delay:this.skinConfig.sparkleFrequency,callback:()=>this.spawnSparkle(e),loop:!0}));const s=this.skinConfig.accentColor||1752220;this.radarGlow=e.add.circle(this.x,this.y-28,8,s,.3).setDepth(10),e.tweens.add({targets:this.radarGlow,scale:{from:1,to:1.5},alpha:{from:.3,to:.1},duration:1e3,yoyo:!0,repeat:-1}),this.shieldGraphic=e.add.circle(this.x,this.y,40,3447003,.2).setStrokeStyle(3,3447003,.8).setDepth(10).setVisible(!1)}spawnSparkle(e){if(!this.active)return;const t=this.skinConfig.sparkleColor||16777215,s=Phaser.Math.Between(-20,20),i=Phaser.Math.Between(-30,20),o=e.add.circle(this.x+s,this.y+i,3,t,.8).setDepth(11);e.tweens.add({targets:o,scale:{from:0,to:1.5},alpha:{from:.8,to:0},y:o.y-15,duration:400,ease:"Power2",onComplete:()=>o.destroy()})}update(e,s){var i,o,n;if(s.left?(this.setVelocityX(-300),this.setAngle(-8)):s.right?(this.setVelocityX(t.SHIP.SPEED),this.setAngle(8)):this.setAngle(0),this.driftForce>0&&!this.isStabilized){const s=this.driftForce*this.driftDirection*(e/1e3);this.x+=s,this.x=Phaser.Math.Clamp(this.x,t.SHIP.BOUNDS_MARGIN,t.WIDTH-t.SHIP.BOUNDS_MARGIN)}const a=Math.abs(this.x-this.lastX);a<2?this.stabilityScore=Math.min(100,this.stabilityScore+.1):a>5&&(this.stabilityScore=Math.max(0,this.stabilityScore-.2)),this.lastX=this.x;const{x:r,y:l}=this;null==(i=this.shieldGraphic)||i.setPosition(r,l),null==(o=this.radarGlow)||o.setPosition(r,l-24),null==(n=this.glowAura)||n.setPosition(r,l)}setShielded(e){this.isShielded=e,this.shieldGraphic&&(this.shieldGraphic.setVisible(e),e?this.scene.tweens.add({targets:this.shieldGraphic,scale:{from:1,to:1.1},alpha:{from:.3,to:.5},duration:500,yoyo:!0,repeat:-1}):(this.scene.tweens.killTweensOf(this.shieldGraphic),this.shieldGraphic.setScale(1)))}setDrift(e,t){this.driftForce=e,this.driftDirection=t}clearDrift(){this.driftForce=0,this.driftDirection=0}setStabilized(e){this.isStabilized=e}getStabilityScore(){return this.stabilityScore}flash(e=16777215){this.setTint(e),this.scene.time.delayedCall(100,()=>{this.clearTint()})}destroy(){this.trail&&this.trail.destroy(),this.wakeLeft&&this.wakeLeft.destroy(),this.wakeRight&&this.wakeRight.destroy(),this.radarGlow&&(this.scene&&this.scene.tweens&&this.scene.tweens.killTweensOf(this.radarGlow),this.radarGlow.destroy()),this.shieldGraphic&&this.shieldGraphic.destroy(),this.glowAura&&(this.scene&&this.scene.tweens&&this.scene.tweens.killTweensOf(this.glowAura),this.glowAura.destroy()),this.sparkleTimer&&this.sparkleTimer.destroy(),super.destroy()}}class u extends Phaser.Physics.Arcade.Sprite{constructor(e,s,i,o=!0){super(e,s,i,o?"insight-real":"insight-fake"),e.add.existing(this),e.physics.add.existing(this),this.isReal=o,this.isHighlighted=!1,this.collected=!1,this.setVelocityY(t.INSIGHT.SPEED_BASE),o?(this.createPulseEffect(e),this.createGlowTrail(e)):this.createFlickerEffect(e),this.body.setCircle(14,6,6)}createGlowTrail(e){this.glowTrail=e.add.circle(this.x,this.y,18,3066993,.15).setDepth(this.depth-1),e.tweens.add({targets:this.glowTrail,scale:{from:1,to:1.3},alpha:{from:.15,to:.05},duration:800,yoyo:!0,repeat:-1})}createPulseEffect(e){e.tweens.add({targets:this,scale:{from:.95,to:1.15},alpha:{from:.85,to:1},duration:700,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:this,angle:{from:-3,to:3},duration:1200,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createFlickerEffect(e){e.tweens.add({targets:this,alpha:{from:.35,to:.85},scale:{from:.7,to:1},duration:180,yoyo:!0,repeat:-1,ease:"Stepped",hold:Phaser.Math.Between(30,150)}),e.tweens.add({targets:this,angle:{from:-20,to:20},duration:250,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:this,scaleX:{from:.8,to:1.1},scaleY:{from:1.1,to:.85},duration:350,yoyo:!0,repeat:-1,ease:"Stepped"})}setHighlighted(e){e&&this.isReal&&!this.isHighlighted&&(this.isHighlighted=!0,this.setTexture("insight-highlighted"))}collect(){var e,t;return!this.collected&&(this.collected=!0,(null==(e=this.scene)?void 0:e.tweens)&&this.scene.tweens.killTweensOf(this),this.glowTrail&&((null==(t=this.scene)?void 0:t.tweens)&&this.scene.tweens.killTweensOf(this.glowTrail),this.glowTrail.destroy(),this.glowTrail=null),this.scene.tweens.add({targets:this,scale:1.8,alpha:0,duration:250,ease:"Quad.out",onComplete:()=>this.destroy()}),this.isReal&&this.createCollectionBurst(),!0)}createCollectionBurst(){const e=this.isReal?3066993:15158332;for(let t=0;t<8;t++){const s=t/8*Math.PI*2,i=this.scene.add.circle(this.x,this.y,4,e,.8).setDepth(100);this.scene.tweens.add({targets:i,x:this.x+40*Math.cos(s),y:this.y+40*Math.sin(s),alpha:0,scale:0,duration:300,ease:"Quad.out",onComplete:()=>i.destroy()})}}update(e){this.glowTrail&&this.glowTrail.setPosition(this.x,this.y),this.y>t.HEIGHT+50&&(this.cleanup(),this.destroy())}cleanup(){var e,t;(null==(e=this.scene)?void 0:e.tweens)&&this.scene.tweens.killTweensOf(this),this.glowTrail&&((null==(t=this.scene)?void 0:t.tweens)&&this.scene.tweens.killTweensOf(this.glowTrail),this.glowTrail.destroy(),this.glowTrail=null)}destroy(){this.cleanup(),super.destroy()}getPoints(){return this.isReal?t.INSIGHT.POINTS_REAL:t.INSIGHT.POINTS_FAKE}getMeterValue(){return this.isReal?t.INSIGHT.METER_FILL_REAL:t.INSIGHT.METER_FILL_FAKE}}class p{constructor(e,t=-100){this.scene=e,this.y=t,this.speed=100,this.selected=!1,this.selectedRoute=null,this.routes=["SPEED","QUALITY","SAFETY"],this.createGate()}createGate(){const e=this.scene,s=t.WIDTH/3;this.container=e.add.container(0,this.y).setDepth(40),this.isMobile=h.isMobile();const i=this.isMobile?140:120;this.overlay=e.add.rectangle(t.WIDTH/2,30,t.WIDTH,i,661032,.95),this.container.add(this.overlay),this.title=e.add.text(t.WIDTH/2,8,"WÃ„HLE DEINEN KURS",{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"20px":"18px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5,0),this.container.add(this.title),this.routeButtons=[];const o=this.isMobile?1.3:1;this.routes.forEach((i,n)=>{const a=s*n+s/2,r=t.GATES[i],l=e.add.rectangle(a,75,s-10,90,0,0).setInteractive({useHandCursor:!0}).on("pointerover",()=>this.onRouteHover(n)).on("pointerout",()=>this.onRouteOut(n)).on("pointerdown",()=>this.selectRoute(n)),h=e.add.image(a,60,`gate-${i.toLowerCase()}`).setScale(o),c=e.add.text(a,90,`${r.name} x${r.multiplier.toFixed(1)}`,{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"15px":"13px",fontStyle:"bold",color:"#"+r.color.toString(16).padStart(6,"0")}).setOrigin(.5,0),d=e.add.text(a,108,r.hint||"",{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"12px":"11px",color:"#95A5A6"}).setOrigin(.5,0),u=e.add.text(a,45,this.isMobile?"TAP":`[${n+1}]`,{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5,1);this.routeButtons.push({button:h,hitArea:l,nameText:c,hintText:d,keyHint:u,route:i}),this.container.add([l,h,c,d,u])}),e.input.keyboard.on("keydown-ONE",()=>this.selectRoute(0)),e.input.keyboard.on("keydown-TWO",()=>this.selectRoute(1)),e.input.keyboard.on("keydown-THREE",()=>this.selectRoute(2));for(let t=1;t<3;t++){const i=e.add.line(0,0,s*t,40,s*t,120,3426654,.5).setLineWidth(2);this.container.add(i)}}onRouteHover(e){if(this.selected)return;const{button:t}=this.routeButtons[e];this.scene.tweens.add({targets:t,scale:1.15,duration:100})}onRouteOut(e){if(this.selected)return;const{button:t}=this.routeButtons[e];this.scene.tweens.add({targets:t,scale:1,duration:100})}selectRoute(e){if(this.selected||e>=this.routes.length)return;this.selected=!0,this.selectedRoute=this.routes[e];const s=t.GATES[this.selectedRoute],i=this.routeButtons[e];this.scene.tweens.add({targets:i.button,scale:1.3,duration:200}),this.routeButtons.forEach((t,s)=>{s!==e&&this.scene.tweens.add({targets:[t.button,t.nameText,t.hintText],alpha:.3,duration:200})});const o=this.scene.add.text(t.WIDTH/2,140,`${s.name} gewÃ¤hlt!`,{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#"+s.color.toString(16).padStart(6,"0")}).setOrigin(.5,0);this.container.add(o),this.speed=300,this.scene.events.emit("gateSelected",this.selectedRoute)}update(e){return this.container.y+=this.speed*(e/1e3),!this.selected&&this.container.y>150&&this.selectRoute(1),this.container.y>t.HEIGHT+200}getSelectedRoute(){return this.selectedRoute}getModifiers(){if(!this.selectedRoute)return{};const e=t.GATES[this.selectedRoute];return{multiplier:e.multiplier,noiseChange:e.noiseIncrease||-(e.noiseReduction||0),stormChange:e.stormChanceIncrease||-(e.stormChanceReduction||0),qualityBonus:e.insightQualityBonus||0,spawnReduction:e.spawnReduction||0}}destroy(){this.scene.input.keyboard.off("keydown-ONE"),this.scene.input.keyboard.off("keydown-TWO"),this.scene.input.keyboard.off("keydown-THREE"),this.container.destroy()}}class f extends Phaser.Physics.Arcade.Sprite{constructor(e,s,i,o){const n=t.POWERUPS.TYPES[o];super(e,s,i,`powerup-${o.toLowerCase()}`),e.add.existing(this),e.physics.add.existing(this),this.type=o,this.config=n,this.collected=!1,this.speed=120,this.floatOffset=0,this.floatDirection=1,this.createGlow(),"GOLDEN"!==o?e.tweens.add({targets:this,angle:360,duration:3e3,repeat:-1,ease:"Linear"}):e.tweens.add({targets:this,scale:{from:1,to:1.3},duration:400,yoyo:!0,repeat:-1}),this.body.setCircle(16,0,0)}createGlow(){this.glow=this.scene.add.circle(this.x,this.y,25,this.config.color,.3).setDepth(this.depth-1),this.scene.tweens.add({targets:this.glow,scale:{from:1,to:1.5},alpha:{from:.3,to:0},duration:800,repeat:-1})}update(e){this.y+=this.speed*(e/1e3),this.floatOffset+=.1*this.floatDirection,Math.abs(this.floatOffset)>5&&(this.floatDirection*=-1),this.x+=.3*this.floatDirection,this.glow&&this.glow.setPosition(this.x,this.y),this.y>t.HEIGHT+50&&this.destroy()}collect(){var e,t;return!this.collected&&(this.collected=!0,(null==(e=this.scene)?void 0:e.tweens)&&this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,scale:2,alpha:0,duration:300,ease:"Power2",onComplete:()=>this.destroy()}),this.glow&&((null==(t=this.scene)?void 0:t.tweens)&&this.scene.tweens.killTweensOf(this.glow),this.scene.tweens.add({targets:this.glow,scale:3,alpha:0,duration:300,onComplete:()=>{this.glow&&(this.glow.destroy(),this.glow=null)}})),!0)}destroy(){var e;(null==(e=this.scene)?void 0:e.tweens)&&(this.scene.tweens.killTweensOf(this),this.glow&&this.scene.tweens.killTweensOf(this.glow)),this.glow&&(this.glow.destroy(),this.glow=null),super.destroy()}}class g{constructor(e){this.scene=e,this.powerUps=e.add.group(),this.activePowerUps={},this.generateTextures(),this.createUI()}generateTextures(){const e=t.POWERUPS.TYPES;Object.entries(e).forEach(([e,t])=>{const s=`powerup-${e.toLowerCase()}`;if(this.scene.textures.exists(s))return;const i=this.scene.add.graphics();if("MAGNET"===e)i.fillStyle(t.color),i.fillRoundedRect(4,4,8,24,2),i.fillRoundedRect(20,4,8,24,2),i.fillRoundedRect(4,4,24,8,2),i.fillStyle(15158332),i.fillRect(4,20,8,8),i.fillStyle(3447003),i.fillRect(20,20,8,8);else if("SHIELD"===e)i.fillStyle(t.color,.8),i.beginPath(),i.moveTo(16,4),i.lineTo(28,10),i.lineTo(26,24),i.lineTo(16,30),i.lineTo(6,24),i.lineTo(4,10),i.closePath(),i.fillPath(),i.lineStyle(2,16777215,.5),i.strokePath();else if("DOUBLE"===e)i.fillStyle(t.color),i.fillRoundedRect(2,8,28,18,4);else if("GOLDEN"===e){i.fillStyle(t.color),i.beginPath();const e=16,s=16,o=5,n=14,a=7;let r=Math.PI/2*3;const l=Math.PI/o;i.moveTo(e,s-n);for(let t=0;t<o;t++){let t=e+Math.cos(r)*n,o=s+Math.sin(r)*n;i.lineTo(t,o),r+=l,t=e+Math.cos(r)*a,o=s+Math.sin(r)*a,i.lineTo(t,o),r+=l}i.lineTo(e,s-n),i.closePath(),i.fillPath(),i.lineStyle(2,16777215,.8),i.strokePath()}i.generateTexture(s,32,32),i.destroy()})}createUI(){this.indicators={};let e=t.WIDTH/2-100;Object.keys(t.POWERUPS.TYPES).forEach((s,i)=>{if("GOLDEN"===s)return;const o=t.POWERUPS.TYPES[s],n=this.scene.add.container(e+70*i,75).setDepth(100).setAlpha(0),a=this.scene.add.circle(0,0,20,o.color,.3),r=this.scene.add.image(0,0,`powerup-${s.toLowerCase()}`).setScale(.8),l=this.scene.add.text(0,25,"",{fontFamily:"Arial",fontSize:"12px",color:"#ECF0F1"}).setOrigin(.5);n.add([a,r,l]),this.indicators[s]={container:n,timer:l,bg:a}})}spawnPowerUp(e){const t=Math.random();let s;s=t<.1?"GOLDEN":t<.4?"MAGNET":t<.7?"SHIELD":"DOUBLE";const i=new f(this.scene,e,-30,s);return this.powerUps.add(i),i}collectPowerUp(e){if(!e.collect())return;const t=e.type,s=e.config;this.scene.hud.showMessage(`${s.name}!`,800),this.scene.soundGen&&this.scene.soundGen.playPowerUpSound&&this.scene.soundGen.playPowerUpSound(),"GOLDEN"===t?(this.scene.scoreManager.addBonus(s.points),this.scene.hud.showPointsPopup(e.x,e.y,s.points),this.createGoldenBurst(e.x,e.y)):this.activatePowerUp(t)}activatePowerUp(e){this.activePowerUps[e]?this.activePowerUps[e].timeLeft=t.POWERUPS.DURATION:this.activePowerUps[e]={timeLeft:t.POWERUPS.DURATION,startTime:this.scene.time.now};const s=this.indicators[e];s&&(s.container.setAlpha(1),this.scene.tweens.add({targets:s.bg,scale:{from:1.3,to:1},duration:200})),this.applyPowerUpEffect(e,!0)}applyPowerUpEffect(e,t){"SHIELD"===e&&this.scene.ship&&this.scene.ship.setShielded(t)}update(e){this.powerUps.children.iterate(t=>{t&&t.update(e)}),Object.entries(this.activePowerUps).forEach(([t,s])=>{s.timeLeft-=e;const i=this.indicators[t];if(i){const e=Math.ceil(s.timeLeft/1e3);i.timer.setText(`${e}s`),s.timeLeft<2e3&&i.container.setAlpha(.5*Math.sin(this.scene.time.now/100)+.5)}s.timeLeft<=0&&this.deactivatePowerUp(t)}),this.isActive("MAGNET")&&this.scene.ship&&this.applyMagnetEffect()}applyMagnetEffect(){const e=this.scene.ship,s=t.POWERUPS.TYPES.MAGNET.radius;this.scene.insights.children.iterate(t=>{if(!t||!t.isReal)return;const i=Phaser.Math.Distance.Between(e.x,e.y,t.x,t.y);if(i<s){const o=Phaser.Math.Angle.Between(t.x,t.y,e.x,e.y),n=300*(1-i/s);t.x+=Math.cos(o)*n*.016,t.y+=Math.sin(o)*n*.016}})}createGoldenBurst(e,t){for(let s=0;s<20;s++){const i=2*Math.PI*s/20,o=this.scene.add.circle(e,t,6,16766720).setDepth(150);this.scene.tweens.add({targets:o,x:e+150*Math.cos(i),y:t+150*Math.sin(i),scale:0,duration:600,ease:"Power2",onComplete:()=>o.destroy()})}}deactivatePowerUp(e){this.applyPowerUpEffect(e,!1),delete this.activePowerUps[e];const t=this.indicators[e];t&&this.scene.tweens.add({targets:t.container,alpha:0,duration:300})}isActive(e){return!!this.activePowerUps[e]}getMultiplier(){return this.isActive("DOUBLE")?t.POWERUPS.TYPES.DOUBLE.multiplier:1}destroy(){this.powerUps.clear(!0,!0),Object.values(this.indicators).forEach(e=>e.container.destroy())}}class m{constructor(e){if(this.scene=e,this.cursors=e.input.keyboard.createCursorKeys(),this.wasd=e.input.keyboard.addKeys({left:Phaser.Input.Keyboard.KeyCodes.A,right:Phaser.Input.Keyboard.KeyCodes.D,boost:Phaser.Input.Keyboard.KeyCodes.SPACE}),this.touchLeft=!1,this.touchRight=!1,this.touchBoost=!1,this.isMobile=h.isMobile(),this.swipeStartX=null,this.swipeStartY=null,this.swipeDirection=0,this.swipeThreshold=30,this.isMobile)try{this.createTouchControls(),this.setupSwipeDetection()}catch(t){this.isMobile=!1}}createTouchControls(){const e=this.scene,s=t.HEIGHT-50,i=60;this.touchContainer=e.add.container(0,0).setDepth(150);const o=t.WIDTH-100,n=e.add.rectangle(o,38,50,36,2899536,.8).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{e.togglePauseHelp&&e.togglePauseHelp()}),a=e.add.text(o,38,"â¸",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#ECF0F1"}).setOrigin(.5);this.touchContainer.add([n,a]),this.leftBtn=e.add.rectangle(150,s,i,i,1752220,.7).setInteractive().on("pointerdown",()=>{this.touchLeft=!0,this.leftBtn.setFillStyle(1482885,.9)}).on("pointerup",()=>{this.touchLeft=!1,this.leftBtn.setFillStyle(1752220,.7)}).on("pointerout",()=>{this.touchLeft=!1,this.leftBtn.setFillStyle(1752220,.7)}),this.leftIcon=e.add.text(150,s,"â—€",{fontSize:"24px",color:"#FFFFFF"}).setOrigin(.5);const r=t.WIDTH-150;this.rightBtn=e.add.rectangle(r,s,i,i,1752220,.7).setInteractive().on("pointerdown",()=>{this.touchRight=!0,this.rightBtn.setFillStyle(1482885,.9)}).on("pointerup",()=>{this.touchRight=!1,this.rightBtn.setFillStyle(1752220,.7)}).on("pointerout",()=>{this.touchRight=!1,this.rightBtn.setFillStyle(1752220,.7)}),this.rightIcon=e.add.text(r,s,"â–¶",{fontSize:"24px",color:"#FFFFFF"}).setOrigin(.5),this.boostBtn=e.add.rectangle(t.WIDTH/2,s,i,i,8359053,.5).setInteractive().on("pointerdown",()=>{this.touchBoost=!0}).on("pointerup",()=>{this.touchBoost=!1}),this.boostIcon=e.add.text(t.WIDTH/2,s,"âš¡",{fontSize:"22px"}).setOrigin(.5),this.boostLabel=e.add.text(t.WIDTH/2,s+35,"BOOST",{fontFamily:"Arial, sans-serif",fontSize:"9px",color:"#7F8C8D"}).setOrigin(.5),this.touchContainer.add([this.leftBtn,this.leftIcon,this.rightBtn,this.rightIcon,this.boostBtn,this.boostIcon,this.boostLabel])}setupSwipeDetection(){const e=this.scene,s=t.HEIGHT-50,i=60,o=t.WIDTH-150,n=t.WIDTH/2;e.input.on("pointerdown",e=>{var a,r;a=e.x,(r=e.y)>t.HEIGHT-100||Math.abs(a-150)<i&&Math.abs(r-s)<i||Math.abs(a-o)<i&&Math.abs(r-s)<i||Math.abs(a-n)<i&&Math.abs(r-s)<i||a<120&&r<60||(this.swipeStartX=e.x,this.swipeStartY=e.y,this.swipeDirection=0)}),e.input.on("pointermove",e=>{if(null!==this.swipeStartX&&e.isDown){const t=e.x-this.swipeStartX;Math.abs(t)>this.swipeThreshold?this.swipeDirection=t>0?1:-1:this.swipeDirection=0}}),e.input.on("pointerup",()=>{this.swipeStartX=null,this.swipeStartY=null,this.swipeDirection=0})}getInput(){const e={left:!1,right:!1,boost:!1};return(this.cursors.left.isDown||this.wasd.left.isDown)&&(e.left=!0),(this.cursors.right.isDown||this.wasd.right.isDown)&&(e.right=!0),Phaser.Input.Keyboard.JustDown(this.wasd.boost)&&(e.boost=!0),this.touchLeft&&(e.left=!0),this.touchRight&&(e.right=!0),this.touchBoost&&(e.boost=!0,this.touchBoost=!1),this.swipeDirection<0?e.left=!0:this.swipeDirection>0&&(e.right=!0),e}isBoostPressed(){return Phaser.Input.Keyboard.JustDown(this.wasd.boost)||this.touchBoost}setBoostReady(e){this.isMobile&&this.boostBtn&&(e?(this.boostBtn.setFillStyle(15844367,.9),this.boostLabel.setText("BEREIT!"),this.boostLabel.setColor("#F1C40F"),this.boostPulseTween||(this.boostPulseTween=this.scene.tweens.add({targets:[this.boostBtn,this.boostIcon],scale:{from:1,to:1.15},duration:400,yoyo:!0,repeat:-1}))):(this.boostBtn.setFillStyle(8359053,.4),this.boostLabel.setText("BOOST"),this.boostLabel.setColor("#7F8C8D"),this.boostPulseTween&&(this.boostPulseTween.stop(),this.boostPulseTween=null,this.boostBtn.setScale(1),this.boostIcon.setScale(1))))}destroy(){this.scene&&this.scene.input&&(this.scene.input.off("pointerdown"),this.scene.input.off("pointermove"),this.scene.input.off("pointerup")),this.touchContainer&&this.touchContainer.destroy(),this.boostPulseTween&&(this.boostPulseTween.stop(),this.boostPulseTween=null)}}class S{constructor(e){this.scene=e,this.reset()}reset(){this.score=0,this.realInsightsCollected=0,this.fakeInsightsCollected=0,this.totalInsightsCollected=0,this.multiplier=1,this.gateChoices=[],this.boostsUsed=0,this.boostEfficiency=0,this.perfectBoosts=0}addInsight(e,s=1){this.totalInsightsCollected++;const i=e?t.INSIGHT.POINTS_REAL:t.INSIGHT.POINTS_FAKE,o=Math.round(i*s*this.multiplier);return this.score+=o,e?this.realInsightsCollected++:this.fakeInsightsCollected++,o}addGateChoice(e){this.gateChoices.push(e);const s=t.GATES[e.toUpperCase()];s&&(this.multiplier*=s.multiplier)}addBoostUsage(e){this.boostsUsed++,e&&this.perfectBoosts++}addBonus(e){this.score+=e}getScore(){return Math.max(0,this.score)}getMultiplier(){return this.multiplier}getQualityRatio(){return 0===this.totalInsightsCollected?0:this.realInsightsCollected/this.totalInsightsCollected}getQualityScore(){return Math.round(100*this.getQualityRatio())}calculateFinalScore(e){let s=this.score;return this.getQualityRatio()>=t.SCORING.QUALITY_BONUS_THRESHOLD&&(s*=t.SCORING.QUALITY_BONUS_MULTIPLIER),s+=e/100*t.SCORING.STABILITY_BONUS_MAX,this.boostsUsed>0&&(s+=this.perfectBoosts/this.boostsUsed*t.SCORING.BOOST_EFFICIENCY_BONUS),Math.round(s)}getStrategyProfile(){if(0===this.gateChoices.length)return"Balanced";const e={};this.gateChoices.forEach(t=>{e[t]=(e[t]||0)+1});const t=Object.entries(e).sort((e,t)=>t[1]-e[1])[0];return t?t[0]:"Balanced"}getCrewImpact(){return 0===this.boostsUsed?"Low":this.boostsUsed<=2?"Medium":"High"}getResultType(e,t){const s=(e+t)/2;return s>=80?"Quality"===this.getStrategyProfile()?"High Quality Navigator":"Stable Course":s>=60?"Speed"===this.getStrategyProfile()?"Fast but Noisy":"Balanced Approach":s>=40?"Rough Waters":"Lost at Sea"}getStats(e){const t=this.getQualityScore();return{finalScore:this.calculateFinalScore(e),qualityScore:t,stabilityScore:Math.round(e),strategyProfile:this.getStrategyProfile(),crewImpact:this.getCrewImpact(),resultType:this.getResultType(t,e),realInsights:this.realInsightsCollected,fakeInsights:this.fakeInsightsCollected,multiplier:this.multiplier.toFixed(2)}}}class y{constructor(e){this.scene=e,this.activeStorm=null,this.stormEndTime=0,this.stormChance=0,this.lastStormTime=0,this.minInterval=t.STORM_MIN_INTERVAL,this.stormTypes=["FOG","CROSSWIND","SIGNAL_FLOOD","NARROW_PASS"],this.createEffects()}createEffects(){this.fogOverlay=this.scene.add.rectangle(t.WIDTH/2,t.HEIGHT/2,t.WIDTH,t.HEIGHT,6122878,0).setDepth(30),this.fogOverlay2=this.scene.add.rectangle(t.WIDTH/2,t.HEIGHT/2,t.WIDTH,t.HEIGHT,8753822,0).setDepth(31),this.fogParticles=null,this.windIndicator=this.scene.add.text(t.WIDTH/2,80,"",{fontFamily:"Arial, sans-serif",fontSize:"24px",color:"#F39C12"}).setOrigin(.5).setDepth(100).setVisible(!1),this.buoys=this.scene.add.group(),this.warningText=this.scene.add.text(t.WIDTH/2,t.HEIGHT/2-100,"",{fontFamily:"Arial, sans-serif",fontSize:"32px",fontStyle:"bold",color:"#E74C3C",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(150).setVisible(!1)}setStormChance(e){this.stormChance=Math.max(0,Math.min(1,e))}adjustStormChance(e){this.stormChance=Math.max(0,Math.min(1,this.stormChance+e))}checkForStorm(e){this.activeStorm||e-this.lastStormTime<this.minInterval||e<t.PHASE_1_END||Math.random()<.02*this.stormChance&&this.triggerRandomStorm(e)}triggerRandomStorm(e){const t=this.stormTypes[Math.floor(Math.random()*this.stormTypes.length)];this.triggerStorm(t,e)}triggerStorm(e,s){this.activeStorm=e,this.stormEndTime=s+t.STORM_DURATION,this.lastStormTime=s;const i=t.STORMS[e];switch(this.showWarning(i.name),e){case"FOG":this.startFog();break;case"CROSSWIND":this.startCrosswind();break;case"SIGNAL_FLOOD":this.startSignalFlood();break;case"NARROW_PASS":this.startNarrowPass()}this.scene.events.emit("stormStarted",e)}showWarning(e){this.warningText.setText(`âš  ${e.toUpperCase()}! âš `),this.warningText.setVisible(!0);const s=this.scene.add.rectangle(t.WIDTH/2,t.HEIGHT/2,t.WIDTH,t.HEIGHT,15158332,.4).setDepth(149);this.scene.tweens.add({targets:s,alpha:0,duration:500,onComplete:()=>s.destroy()}),this.scene.cameras.main.shake(300,.008);const i=this.scene.add.rectangle(t.WIDTH/2,t.HEIGHT/2,t.WIDTH-20,t.HEIGHT-20).setStrokeStyle(4,15158332,1).setDepth(148);this.scene.tweens.add({targets:i,alpha:{from:1,to:0},scale:{from:1,to:1.02},duration:600,repeat:2,yoyo:!0,onComplete:()=>i.destroy()}),this.scene.tweens.add({targets:this.warningText,alpha:{from:1,to:0},scale:{from:1,to:1.3},duration:2500,ease:"Power2",onComplete:()=>{this.warningText.setVisible(!1),this.warningText.setAlpha(1),this.warningText.setScale(1)}}),this.showStormIndicator(e)}showStormIndicator(e){const s={Nebel:{icon:"ðŸŒ«ï¸",color:"#7F8C8D",tip:"Radar ungenau!"},Seitenwind:{icon:"ðŸ’¨",color:"#F39C12",tip:"Gegensteuern!"},"Signal Flood":{icon:"ðŸ“¡",color:"#E74C3C",tip:"Viele Fakes!"},Engpass:{icon:"ðŸš§",color:"#9B59B6",tip:"Mitte halten!"}}[e]||{icon:"âš ï¸",color:"#E74C3C",tip:""},i=this.scene.add.container(t.WIDTH/2,-50).setDepth(160),o=this.scene.add.rectangle(0,0,300,45,1710618,.95).setStrokeStyle(2,Phaser.Display.Color.HexStringToColor(s.color).color);i.add(o);const n=this.scene.add.text(-120,0,s.icon,{fontSize:"24px"}).setOrigin(.5);i.add(n);const a=this.scene.add.text(-70,-8,e.toUpperCase(),{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:s.color}).setOrigin(0,.5);i.add(a);const r=this.scene.add.text(-70,10,s.tip,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#BDC3C7"}).setOrigin(0,.5);i.add(r);const l=this.scene.add.rectangle(80,0,80,8,2899536);i.add(l);const h=this.scene.add.rectangle(40,0,80,8,Phaser.Display.Color.HexStringToColor(s.color).color).setOrigin(0,.5);i.add(h),this.scene.tweens.add({targets:i,y:35,duration:400,ease:"Back.out"}),this.scene.tweens.add({targets:h,scaleX:0,duration:t.STORM_DURATION,ease:"Linear"}),this.scene.time.delayedCall(t.STORM_DURATION-300,()=>{this.scene.tweens.add({targets:i,y:-50,duration:300,ease:"Back.in",onComplete:()=>i.destroy()})})}startFog(){this.scene.tweens.add({targets:this.fogOverlay,alpha:.7,duration:800}),this.scene.tweens.add({targets:this.fogOverlay2,alpha:.4,duration:1200}),this.fogParticles=this.scene.add.particles(0,0,"insight-real",{x:{min:0,max:t.WIDTH},y:{min:0,max:t.HEIGHT},scale:{min:2,max:5},alpha:{start:.15,end:.05},speedX:{min:-30,max:-10},speedY:{min:10,max:30},lifespan:4e3,frequency:100,tint:11450047,blendMode:"ADD"}).setDepth(32),this.scene.radarUI&&this.scene.radarUI.setBlurred(!0,.8),this.fogLabel=this.scene.add.text(t.WIDTH/2,t.HEIGHT-50,"ðŸŒ«ï¸ DICHTER NEBEL - SICHT EINGESCHRÃ„NKT!",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#BDC3C7",stroke:"#2C3E50",strokeThickness:3}).setOrigin(.5).setDepth(100),this.scene.tweens.add({targets:this.fogLabel,alpha:{from:1,to:.6},duration:1e3,yoyo:!0,repeat:-1})}startCrosswind(){const e=Math.random()>.5?1:-1,s=e>0?"â†’â†’â†’":"â†â†â†";this.windIndicator.setText(`WIND ${s}`),this.windIndicator.setVisible(!0),this.scene.ship&&this.scene.ship.setDrift(t.STORMS.CROSSWIND.driftForce,e),this.scene.tweens.add({targets:this.windIndicator,x:t.WIDTH/2+20*e,duration:500,yoyo:!0,repeat:-1})}startSignalFlood(){this.scene.events.emit("signalFlood",{spawnMultiplier:t.STORMS.SIGNAL_FLOOD.spawnMultiplier,noiseRatio:t.STORMS.SIGNAL_FLOOD.noiseRatio})}startNarrowPass(){const e=t.STORMS.NARROW_PASS.passWidth,s=t.WIDTH/2,i=s-e/2,o=s+e/2;for(let t=0;t<6;t++){const e=-50-60*t,s=this.scene.physics.add.sprite(i-20,e,"buoy");s.setVelocityY(150),this.buoys.add(s);const n=this.scene.physics.add.sprite(o+20,e,"buoy");n.setVelocityY(150),this.buoys.add(n)}this.scene.ship&&(this.buoyCollider=this.scene.physics.add.overlap(this.scene.ship,this.buoys,(e,t)=>{e.flash(15158332),this.scene.scoreManager.addInsight(!1),t.destroy()}))}update(e,s){return this.activeStorm?e>=this.stormEndTime?(this.endStorm(),{active:!1}):(this.buoys.children.iterate(e=>{e&&e.y>t.HEIGHT+50&&e.destroy()}),{active:!0,type:this.activeStorm,remaining:this.stormEndTime-e}):(this.checkForStorm(e),{active:!1})}endStorm(){const e=this.activeStorm;switch(this.activeStorm=null,e){case"FOG":this.scene.tweens.add({targets:this.fogOverlay,alpha:0,duration:800}),this.scene.tweens.add({targets:this.fogOverlay2,alpha:0,duration:800}),this.fogParticles&&(this.fogParticles.destroy(),this.fogParticles=null),this.fogLabel&&(this.scene.tweens.killTweensOf(this.fogLabel),this.fogLabel.destroy(),this.fogLabel=null),this.scene.radarUI&&this.scene.radarUI.setBlurred(!1);break;case"CROSSWIND":this.windIndicator.setVisible(!1),this.scene.tweens.killTweensOf(this.windIndicator),this.windIndicator.x=t.WIDTH/2,this.scene.ship&&this.scene.ship.clearDrift();break;case"SIGNAL_FLOOD":this.scene.events.emit("signalFloodEnd");break;case"NARROW_PASS":this.buoys.clear(!0,!0),this.buoyCollider&&(this.buoyCollider.destroy(),this.buoyCollider=null)}this.scene.events.emit("stormEnded",e)}isNavigatorEffective(){return"FOG"===this.activeStorm||"SIGNAL_FLOOD"===this.activeStorm}isCaptainEffective(){return"CROSSWIND"===this.activeStorm}getActiveStorm(){return this.activeStorm}destroy(){this.fogOverlay.destroy(),this.fogOverlay2.destroy(),this.fogParticles&&this.fogParticles.destroy(),this.fogLabel&&this.fogLabel.destroy(),this.windIndicator.destroy(),this.warningText.destroy(),this.buoys.clear(!0,!0)}}class T{constructor(e){this.scene=e,this.combo=0,this.maxCombo=0,this.lastCollectTime=0,this.comboTimer=null,this.createComboDisplay(),this.createParticleEmitter()}createComboDisplay(){this.comboContainer=this.scene.add.container(t.WIDTH/2,100).setDepth(200),this.comboText=this.scene.add.text(0,0,"",{fontFamily:"Arial, sans-serif",fontSize:"48px",fontStyle:"bold",color:"#F1C40F",stroke:"#000000",strokeThickness:6}).setOrigin(.5).setAlpha(0),this.comboLabel=this.scene.add.text(0,35,"COMBO",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5).setAlpha(0),this.comboContainer.add([this.comboText,this.comboLabel])}createParticleEmitter(){if(!this.scene.textures.exists("particle")){const e=this.scene.add.graphics();e.fillStyle(16777215),e.fillCircle(4,4,4),e.generateTexture("particle",8,8),e.destroy()}}addCombo(e,s,i){if(!i)return this.resetCombo(),0;this.combo++,this.maxCombo=Math.max(this.maxCombo,this.combo),this.lastCollectTime=this.scene.time.now,this.comboTimer&&this.comboTimer.remove(),this.comboTimer=this.scene.time.delayedCall(t.COMBO.TIMEOUT,()=>{this.resetCombo()});const o=Math.min(this.combo-1,t.COMBO.MULTIPLIERS.length-1),n=t.COMBO.MULTIPLIERS[o];return this.combo>=2&&(this.showComboDisplay(),this.spawnParticles(e,s,o),this.shakeScreen(o),this.scene.soundGen&&this.scene.soundGen.playComboSound&&this.scene.soundGen.playComboSound(o)),5===this.combo?this.scene.events.emit("achievement","COMBO_5"):10===this.combo&&this.scene.events.emit("achievement","COMBO_10"),n}showComboDisplay(){const e=["#F1C40F","#E67E22","#E74C3C","#9B59B6","#FF0000","#FF00FF"],t=Math.min(this.combo-1,e.length-1);this.comboText.setText(`${this.combo}x`),this.comboText.setColor(e[t]),this.scene.tweens.killTweensOf(this.comboText),this.scene.tweens.killTweensOf(this.comboLabel),this.comboText.setAlpha(1).setScale(1.5),this.comboLabel.setAlpha(1),this.scene.tweens.add({targets:this.comboText,scale:1,duration:200,ease:"Back.out"}),this.combo>=5&&this.scene.tweens.add({targets:this.comboText,scale:{from:1,to:1.1},duration:300,yoyo:!0,repeat:-1})}hideComboDisplay(){this.scene.tweens.add({targets:[this.comboText,this.comboLabel],alpha:0,duration:300})}spawnParticles(e,s,i){const o=t.COMBO.PARTICLE_COUNT[i]||5,n=[3066993,15844367,15105570,15158332,10181046,16711935][i]||3066993;for(let t=0;t<o;t++){const a=2*Math.PI*t/o,r=100+30*i,l=this.scene.add.circle(e,s,4+i,n).setDepth(100);this.scene.tweens.add({targets:l,x:e+Math.cos(a)*r,y:s+Math.sin(a)*r,scale:0,alpha:0,duration:400+50*i,ease:"Power2",onComplete:()=>l.destroy()})}if(i>=3)for(let t=0;t<2*i;t++){const i=this.scene.add.circle(e+Phaser.Math.Between(-30,30),s+Phaser.Math.Between(-30,30),4,16777215).setDepth(101);this.scene.tweens.add({targets:i,scale:0,alpha:0,duration:500,delay:30*t,onComplete:()=>i.destroy()})}}shakeScreen(e){const s=t.COMBO.SHAKE_INTENSITY[e]||0;s>0&&this.scene.cameras.main.shake(100,s/1e3)}resetCombo(e=!0){this.combo>=2&&(this.hideComboDisplay(),e&&this.showComboBreak()),this.combo=0,this.comboTimer&&(this.comboTimer.remove(),this.comboTimer=null)}showComboBreak(){const e=this.scene.add.text(t.WIDTH/2,140,"COMBO Ã—",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#E74C3C"}).setOrigin(.5).setDepth(200).setAlpha(.8);this.scene.tweens.add({targets:e,y:120,alpha:0,duration:600,ease:"Power2",onComplete:()=>e.destroy()})}getCombo(){return this.combo}getMaxCombo(){return this.maxCombo}getMultiplier(){if(0===this.combo)return 1;const e=Math.min(this.combo-1,t.COMBO.MULTIPLIERS.length-1);return t.COMBO.MULTIPLIERS[e]}destroy(){this.comboTimer&&this.comboTimer.remove(),this.comboContainer.destroy()}}class C{constructor(e){this.scene=e,this.createElements()}createElements(){const e=this.scene;this.scoreText=e.add.text(20,20,"SCORE: 0",{fontFamily:"Arial, sans-serif",fontSize:"24px",fontStyle:"bold",color:"#ECF0F1"}).setDepth(100),this.multiplierText=e.add.text(20,50,"x1.00",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#1ABC9C"}).setDepth(100),this.timerText=e.add.text(t.WIDTH-20,20,"90",{fontFamily:"Arial, sans-serif",fontSize:"32px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(1,0).setDepth(100),this.timerLabel=e.add.text(t.WIDTH-20,55,"SEKUNDEN",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(1,0).setDepth(100),this.phaseText=e.add.text(t.WIDTH/2,20,"PHASE 1",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#1ABC9C"}).setOrigin(.5,0).setDepth(100),this.createFullscreenButton(e),this.createQualityBar(e)}createQualityBar(e){const s=t.WIDTH/2-75;this.qualityBarBg=e.add.rectangle(s,45,150,8,2899536).setOrigin(0,0).setDepth(100),this.qualityBarFill=e.add.rectangle(s,45,0,8,t.COLORS.INSIGHT_REAL).setOrigin(0,0).setDepth(100),this.qualityLabel=e.add.text(t.WIDTH/2,58,"INSIGHT QUALITÃ„T",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5,0).setDepth(100),this.highScoreText=e.add.text(20,75,"",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setDepth(100)}createFullscreenButton(e){const s=t.WIDTH-90;this.fullscreenBtn=e.add.rectangle(s,38,36,36,2899536,.8).setInteractive({useHandCursor:!0}).setDepth(100).on("pointerover",()=>this.fullscreenBtn.setFillStyle(4020864,1)).on("pointerout",()=>this.fullscreenBtn.setFillStyle(2899536,.8)).on("pointerdown",()=>this.toggleFullscreen()),this.fullscreenIcon=e.add.text(s,38,"â›¶",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ECF0F1"}).setOrigin(.5).setDepth(100),this.updateFullscreenIcon()}toggleFullscreen(){this.scene.scale.isFullscreen?this.scene.scale.stopFullscreen():this.scene.scale.startFullscreen(),this.scene.time.delayedCall(100,()=>this.updateFullscreenIcon())}updateFullscreenIcon(){this.fullscreenIcon&&this.fullscreenIcon.setText((this.scene.scale.isFullscreen,"â›¶"))}setHighScore(e){this.highScoreText.setText(`BEST: ${e}`)}update(e,s,i=1,o=1,n=1,a=0){(isNaN(i)||void 0===i)&&(i=1),this.scoreText.setText(`SCORE: ${s}`),this.multiplierText.setText(`x${i.toFixed(2)}`),i>1?this.multiplierText.setColor("#F1C40F"):i<1?this.multiplierText.setColor("#E74C3C"):this.multiplierText.setColor("#1ABC9C");const r=Math.max(0,Math.ceil((t.GAME_DURATION-e)/1e3));this.timerText.setText(r.toString()),r<=10&&this.timerText.setColor(r%2==0?"#E74C3C":"#ECF0F1"),this.phaseText.setText(`PHASE ${n}`);const l=150*Math.max(0,Math.min(1,o));this.qualityBarFill.width=l,o>=.7?this.qualityBarFill.setFillStyle(t.COLORS.INSIGHT_REAL):o>=.4?this.qualityBarFill.setFillStyle(15965202):this.qualityBarFill.setFillStyle(t.COLORS.INSIGHT_FAKE)}showPointsPopup(e,t,s){const i=s>=0?"#2ECC71":"#E74C3C",o=s>=0?"+":"",n=this.scene.add.text(e,t,`${o}${s}`,{fontFamily:"Arial, sans-serif",fontSize:"20px",fontStyle:"bold",color:i}).setOrigin(.5).setDepth(100);this.scene.tweens.add({targets:n,y:t-50,alpha:0,duration:800,ease:"Power2",onComplete:()=>n.destroy()})}showMessage(e,s=2e3){const i=this.scene.add.text(t.WIDTH/2,t.HEIGHT/2-50,e,{fontFamily:"Arial, sans-serif",fontSize:"28px",fontStyle:"bold",color:"#ECF0F1",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(150).setAlpha(0);this.scene.tweens.add({targets:i,alpha:1,duration:200,yoyo:!0,hold:s-400,onComplete:()=>i.destroy()})}destroy(){this.scoreText.destroy(),this.multiplierText.destroy(),this.timerText.destroy(),this.timerLabel.destroy(),this.phaseText.destroy(),this.qualityBarBg.destroy(),this.qualityBarFill.destroy(),this.qualityLabel.destroy(),this.highScoreText.destroy(),this.fullscreenBtn&&this.fullscreenBtn.destroy(),this.fullscreenIcon&&this.fullscreenIcon.destroy()}}class w{constructor(e){this.scene=e,this.isBlurred=!1,this.blurAmount=0,this.createRadar()}createRadar(){const e=this.scene,s=t.WIDTH-110,i=t.HEIGHT-110;this.radarBg=e.add.graphics().setDepth(50),this.drawRadarBackground(s,i,80),this.sweep=e.add.image(s,i,"radar-sweep").setScale(.8).setAlpha(.6).setDepth(51),e.tweens.add({targets:this.sweep,angle:360,duration:2e3,repeat:-1,ease:"Linear"}),this.centerDot=e.add.circle(s,i,4,t.COLORS.ACCENT).setDepth(52),this.pings=e.add.group(),this.fogOverlay=e.add.rectangle(s,i,160,160,8359053,0).setDepth(53)}drawRadarBackground(e,s,i){const o=this.radarBg;o.clear(),o.lineStyle(2,t.COLORS.ACCENT,.8),o.strokeCircle(e,s,i),o.lineStyle(1,t.COLORS.ACCENT,.3),o.strokeCircle(e,s,.66*i),o.strokeCircle(e,s,.33*i),o.lineStyle(1,t.COLORS.ACCENT,.2),o.lineBetween(e-i,s,e+i,s),o.lineBetween(e,s-i,e,s+i);const n={fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#1ABC9C"};this.compassN=this.scene.add.text(e,s-i-8,"N",n).setOrigin(.5).setDepth(52),this.compassS=this.scene.add.text(e,s+i+8,"S",n).setOrigin(.5).setDepth(52)}addPing(e,s,i){const o=2*(e/t.WIDTH-.5)*70,n=2*((s+50)/(t.HEIGHT+100)-.5)*70,a=t.WIDTH-110+o,r=t.HEIGHT-110+n;if(Math.sqrt(o*o+n*n)>84)return;const l=i?t.COLORS.INSIGHT_REAL:t.COLORS.INSIGHT_FAKE,h=this.scene.add.circle(a,r,3,l,.8).setDepth(52);this.isBlurred&&!i&&(h.x+=Phaser.Math.Between(-10,10)*this.blurAmount,h.y+=Phaser.Math.Between(-10,10)*this.blurAmount),this.pings.add(h),this.scene.tweens.add({targets:h,alpha:0,scale:2,duration:2e3,onComplete:()=>h.destroy()})}setBlurred(e,t=.6){this.isBlurred=e,this.blurAmount=t,e?this.scene.tweens.add({targets:this.fogOverlay,alpha:.5*t,duration:500}):this.scene.tweens.add({targets:this.fogOverlay,alpha:0,duration:500})}update(e){}destroy(){this.scene&&this.scene.tweens&&(this.scene.tweens.killTweensOf(this.sweep),this.scene.tweens.killTweensOf(this.fogOverlay)),this.radarBg.destroy(),this.sweep.destroy(),this.centerDot.destroy(),this.fogOverlay.destroy(),this.compassN.destroy(),this.compassS.destroy(),this.pings.clear(!0,!0)}}class I{constructor(e,t){this.scene=e,this.availableBoosts=t,this.meterValue=0,this.maxValue=100,this.isReady=!1,this.activeBoost=null,this.createMeter()}createMeter(){const e=this.scene,s=t.HEIGHT-100;this.meterBg=e.add.rectangle(20,s,30,80,2899536).setOrigin(0,1).setDepth(100),this.meterBorder=e.add.rectangle(20,s,30,80).setOrigin(0,1).setStrokeStyle(2,t.COLORS.ACCENT).setDepth(100),this.meterFill=e.add.rectangle(22,s-2,26,0,t.COLORS.ACCENT).setOrigin(0,1).setDepth(100),this.label=e.add.text(35,s+10,"CREW",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5,0).setDepth(100),this.anchorIcon=e.add.text(35,s-40,"âš“",{fontSize:"24px"}).setOrigin(.5).setDepth(100),this.readyText=e.add.text(35,s-85,"BEREIT!",{fontFamily:"Arial, sans-serif",fontSize:"12px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(.5).setDepth(100).setVisible(!1),this.createBoostChoicePanel(75,s-60),this.scene.input.keyboard.on("keydown-Q",()=>this.activateBoost(0)),this.scene.input.keyboard.on("keydown-E",()=>this.activateBoost(1))}createBoostChoicePanel(e,s){this.choicePanel=this.scene.add.container(e,s).setDepth(100).setAlpha(0);const i=this.scene.add.rectangle(0,0,160,90,1714746,.95).setStrokeStyle(1,t.COLORS.ACCENT);this.choicePanel.add(i);const o=this.scene.add.text(0,-35,"WÃ¤hle Boost:",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5);this.choicePanel.add(o),this.boostOptions=[],this.availableBoosts.forEach((e,s)=>{const i=t.BOOSTS[e],o=35*s-15,n=this.scene.add.text(-70,o,0===s?"[Q]":"[E]",{fontFamily:"Arial, sans-serif",fontSize:"11px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(0,.5),a=this.scene.add.text(-45,o,i.name,{fontFamily:"Arial, sans-serif",fontSize:"11px",fontStyle:"bold",color:"#"+i.color.toString(16).padStart(6,"0")}).setOrigin(0,.5),r=this.scene.add.text(-45,o+12,i.description,{fontFamily:"Arial, sans-serif",fontSize:"9px",color:"#95A5A6"}).setOrigin(0,.5);this.choicePanel.add([n,a,r]),this.boostOptions.push({keyLabel:n,nameLabel:a,descLabel:r,boostKey:e})})}addValue(e){this.activeBoost||(this.meterValue=Math.max(0,Math.min(this.maxValue,this.meterValue+e)),this.updateMeterFill(),this.meterValue>=this.maxValue&&!this.isReady&&(this.isReady=!0,this.showReadyState()))}updateMeterFill(){const e=this.meterValue/this.maxValue*76;this.meterFill.height=e,this.meterValue>=this.maxValue?this.meterFill.setFillStyle(15844367):this.meterValue>=.7*this.maxValue?this.meterFill.setFillStyle(3066993):this.meterFill.setFillStyle(t.COLORS.ACCENT)}showReadyState(){this.readyText.setVisible(!0),this.scene.tweens.add({targets:this.choicePanel,alpha:1,duration:300}),this.scene.tweens.add({targets:[this.readyText,this.meterBorder,this.anchorIcon],scale:{from:1,to:1.1},duration:500,yoyo:!0,repeat:-1})}activateBoost(e){if(!this.isReady||this.activeBoost||e>=this.availableBoosts.length)return null;const t=this.availableBoosts[e];return this.activeBoost=t,this.isReady=!1,this.meterValue=0,this.scene.tweens.killTweensOf(this.readyText),this.scene.tweens.killTweensOf(this.meterBorder),this.scene.tweens.killTweensOf(this.anchorIcon),this.readyText.setVisible(!1),this.meterBorder.setScale(1),this.anchorIcon.setScale(1),this.scene.tweens.add({targets:this.choicePanel,alpha:0,duration:200}),this.updateMeterFill(),this.startBoostTimer(t),t}startBoostTimer(e){const s=t.BOOSTS[e];this.activeBoostText=this.scene.add.text(35,t.HEIGHT-60,s.name,{fontFamily:"Arial, sans-serif",fontSize:"12px",fontStyle:"bold",color:"#"+s.color.toString(16).padStart(6,"0")}).setDepth(100),this.boostTimerText=this.scene.add.text(35,t.HEIGHT-45,"6s",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#F1C40F"}).setDepth(100);let i=t.BOOST_DURATION/1e3;this.boostTimer=this.scene.time.addEvent({delay:1e3,repeat:i-1,callback:()=>{i--,this.boostTimerText&&this.boostTimerText.setText(i+"s")}}),this.scene.time.delayedCall(t.BOOST_DURATION,()=>{this.endBoost()})}endBoost(){const e=this.activeBoost;return this.activeBoost=null,this.boostTimerText&&(this.boostTimerText.destroy(),this.boostTimerText=null),this.activeBoostText&&(this.activeBoostText.destroy(),this.activeBoostText=null),this.boostTimer&&(this.boostTimer.remove(),this.boostTimer=null),e}getActiveBoost(){return this.activeBoost}isBoostActive(){return null!==this.activeBoost}destroy(){this.scene&&this.scene.input&&this.scene.input.keyboard&&(this.scene.input.keyboard.off("keydown-Q"),this.scene.input.keyboard.off("keydown-E")),this.scene&&this.scene.tweens&&(this.scene.tweens.killTweensOf(this.readyText),this.scene.tweens.killTweensOf(this.meterBorder),this.scene.tweens.killTweensOf(this.anchorIcon),this.scene.tweens.killTweensOf(this.choicePanel)),this.boostTimer&&(this.boostTimer.remove(),this.boostTimer=null),this.meterBg.destroy(),this.meterBorder.destroy(),this.meterFill.destroy(),this.label.destroy(),this.readyText.destroy(),this.anchorIcon.destroy(),this.choicePanel.destroy(),this.boostTimerText&&this.boostTimerText.destroy(),this.activeBoostText&&this.activeBoostText.destroy()}}class b{constructor(){this.audioContext=null,this.windSource=null,this.windGain=null,this.enabled=!0}init(){try{return this.audioContext=new(window.AudioContext||window.webkitAudioContext),!0}catch(e){return this.enabled=!1,!1}}resume(){this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume()}playSonarPing(e=!0){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,s=t.currentTime,i=t.createOscillator(),o=t.createGain();i.type="sine",e?(i.frequency.setValueAtTime(600,s),i.frequency.exponentialRampToValueAtTime(1200,s+.1),o.gain.setValueAtTime(.2,s)):(i.frequency.setValueAtTime(400,s),i.frequency.exponentialRampToValueAtTime(200,s+.15),o.gain.setValueAtTime(.15,s)),o.gain.exponentialRampToValueAtTime(.001,s+.3),i.connect(o),o.connect(t.destination),i.start(s),i.stop(s+.3)}playSuccessChime(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,t=e.currentTime;[523.25,659.25,783.99].forEach((s,i)=>{const o=e.createOscillator(),n=e.createGain();o.type="sine",o.frequency.setValueAtTime(s,t);const a=t+.08*i;n.gain.setValueAtTime(0,a),n.gain.linearRampToValueAtTime(.15,a+.02),n.gain.exponentialRampToValueAtTime(.001,a+.3),o.connect(n),n.connect(e.destination),o.start(a),o.stop(a+.3)})}playWarning(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,t=e.currentTime;for(let s=0;s<2;s++){const i=e.createOscillator(),o=e.createGain();i.type="sawtooth",i.frequency.setValueAtTime(200,t+.2*s),i.frequency.linearRampToValueAtTime(400,t+.2*s+.1),o.gain.setValueAtTime(.1,t+.2*s),o.gain.exponentialRampToValueAtTime(.001,t+.2*s+.15),i.connect(o),o.connect(e.destination),i.start(t+.2*s),i.stop(t+.2*s+.15)}}playBoostActivate(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,t=e.currentTime,s=e.createOscillator(),i=e.createGain();s.type="triangle",s.frequency.setValueAtTime(300,t),s.frequency.exponentialRampToValueAtTime(800,t+.2),i.gain.setValueAtTime(.2,t),i.gain.exponentialRampToValueAtTime(.001,t+.4),s.connect(i),i.connect(e.destination),s.start(t),s.stop(t+.4)}startWindAmbience(){if(!this.enabled||!this.audioContext||this.windSource)return;const e=this.audioContext,t=2*e.sampleRate,s=e.createBuffer(1,t,e.sampleRate),i=s.getChannelData(0);for(let n=0;n<t;n++)i[n]=2*Math.random()-1;this.windSource=e.createBufferSource(),this.windSource.buffer=s,this.windSource.loop=!0;const o=e.createBiquadFilter();o.type="bandpass",o.frequency.value=400,o.Q.value=.5,this.windGain=e.createGain(),this.windGain.gain.value=.03,this.windSource.connect(o),o.connect(this.windGain),this.windGain.connect(e.destination),this.windSource.start()}setWindIntensity(e){this.windGain&&this.windGain.gain.linearRampToValueAtTime(.03+.05*e,this.audioContext.currentTime+.1)}stopWindAmbience(){this.windSource&&(this.windSource.stop(),this.windSource=null,this.windGain=null)}playGameOver(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,t=e.currentTime,s=e.createOscillator(),i=e.createGain();s.type="sine",s.frequency.setValueAtTime(440,t),s.frequency.exponentialRampToValueAtTime(220,t+.5),i.gain.setValueAtTime(.2,t),i.gain.exponentialRampToValueAtTime(.001,t+.6),s.connect(i),i.connect(e.destination),s.start(t),s.stop(t+.6)}playComboSound(e){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,s=t.currentTime,i=400+100*e;if([i,1.25*i,1.5*i].forEach((i,o)=>{const n=t.createOscillator(),a=t.createGain();n.type=e>=4?"square":"sine",n.frequency.setValueAtTime(i,s+.05*o),a.gain.setValueAtTime(.15,s+.05*o),a.gain.exponentialRampToValueAtTime(.001,s+.05*o+.15),n.connect(a),a.connect(t.destination),n.start(s+.05*o),n.stop(s+.05*o+.15)}),e>=3){const i=t.createOscillator(),o=t.createGain();i.type="sine",i.frequency.setValueAtTime(2e3+200*e,s),i.frequency.exponentialRampToValueAtTime(3e3,s+.1),o.gain.setValueAtTime(.1,s),o.gain.exponentialRampToValueAtTime(.001,s+.15),i.connect(o),o.connect(t.destination),i.start(s),i.stop(s+.15)}}playPowerUpSound(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,t=e.currentTime;[800,1e3,1200,1500,1800].forEach((s,i)=>{const o=e.createOscillator(),n=e.createGain();o.type="sine",o.frequency.setValueAtTime(s,t+.03*i),n.gain.setValueAtTime(.12,t+.03*i),n.gain.exponentialRampToValueAtTime(.001,t+.03*i+.2),o.connect(n),n.connect(e.destination),o.start(t+.03*i),o.stop(t+.03*i+.2)})}playAchievementSound(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,t=e.currentTime;[{freq:523.25,time:0},{freq:659.25,time:.1},{freq:783.99,time:.2},{freq:1046.5,time:.35}].forEach(({freq:s,time:i})=>{const o=e.createOscillator(),n=e.createGain();o.type="triangle",o.frequency.setValueAtTime(s,t+i),n.gain.setValueAtTime(.2,t+i),n.gain.exponentialRampToValueAtTime(.001,t+i+.4),o.connect(n),n.connect(e.destination),o.start(t+i),o.stop(t+i+.4)})}playPhaseChange(e){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,s=t.currentTime,i=t.createBufferSource(),o=.5*t.sampleRate,n=t.createBuffer(1,o,t.sampleRate),a=n.getChannelData(0);for(let h=0;h<o;h++)a[h]=2*Math.random()-1;i.buffer=n;const r=t.createBiquadFilter();r.type="bandpass",r.frequency.setValueAtTime(200,s),r.frequency.exponentialRampToValueAtTime(2e3,s+.3),r.Q.value=1;const l=t.createGain();if(l.gain.setValueAtTime(.3,s),l.gain.exponentialRampToValueAtTime(.001,s+.5),i.connect(r),r.connect(l),l.connect(t.destination),i.start(s),i.stop(s+.5),3===e){const e=t.createOscillator(),i=t.createGain();e.type="sine",e.frequency.setValueAtTime(80,s),e.frequency.exponentialRampToValueAtTime(40,s+.3),i.gain.setValueAtTime(.4,s),i.gain.exponentialRampToValueAtTime(.001,s+.4),e.connect(i),i.connect(t.destination),e.start(s),e.stop(s+.4)}}playNearMiss(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,t=e.currentTime,s=e.createOscillator(),i=e.createGain();s.type="sine",s.frequency.setValueAtTime(300,t),s.frequency.exponentialRampToValueAtTime(600,t+.1),i.gain.setValueAtTime(.08,t),i.gain.exponentialRampToValueAtTime(.001,t+.15),s.connect(i),i.connect(e.destination),s.start(t),s.stop(t+.15)}destroy(){this.stopWindAmbience(),this.audioContext&&this.audioContext.close()}}class E extends Phaser.Scene{constructor(){super("Game")}init(){this.gameTime=0,this.phase=1,this.currentMultiplier=1,this.noiseModifier=0,this.spawnModifier=0,this.lastInsightSpawn=0,this.lastGateTime=0,this.signalFloodActive=!1,this.isGameOver=!1,this.isPaused=!1,this.stormsWeathered=0,this.insightsInLast30Sec=0,this.last30SecCheck=0,this.collectedNoFakes=!0,this.physics&&this.physics.resume(),this.time&&(this.time.paused=!1)}create(){this.soundGen=new b,this.soundGen.init(),this.waveEffect=new o(this),this.createLogoWatermark(),this.ship=new d(this,t.WIDTH/2,t.SHIP.START_Y),this.insights=this.add.group(),this.gates=[],this.inputManager=new m(this),this.scoreManager=new S(this),this.stormManager=new y(this),this.comboManager=new T(this),this.powerUpManager=new g(this),this.achievementNotification=new r(this),this.availableBoosts=["NAVIGATOR","CAPTAIN"],this.hud=new C(this),this.radarUI=new w(this),this.boostMeter=new I(this,this.availableBoosts),this.physics.add.overlap(this.ship,this.insights,this.collectInsight,null,this),this.physics.add.overlap(this.ship,this.powerUpManager.powerUps,(e,t)=>this.powerUpManager.collectPowerUp(t),null,this),this.events.on("gateSelected",this.onGateSelected,this),this.events.on("stormStarted",this.onStormStarted,this),this.events.on("stormEnded",this.onStormEnded,this),this.events.on("signalFlood",this.onSignalFlood,this),this.events.on("signalFloodEnd",this.onSignalFloodEnd,this),this.events.on("achievement",this.onAchievement,this),this.input.keyboard.on("keydown-H",()=>this.togglePauseHelp()),this.input.keyboard.on("keydown-ESC",()=>this.togglePauseHelp()),this.soundGen.startWindAmbience(),this.hud.showMessage("LOS GEHT'S!",1500);const e=a.getHighScore();e>0&&this.hud.setHighScore(e)}update(e,s){try{if(this.isGameOver||this.isPaused)return;if((isNaN(s)||s<=0)&&(s=16),s=Math.min(s,100),this.gameTime+=s,(isNaN(this.gameTime)||this.gameTime<0)&&(this.gameTime=0),this.gameTime>=t.GAME_DURATION-100)return void this.endGame();this.updatePhase();const i=this.inputManager.getInput();this.ship.update(s,i),i.boost&&this.activateBoost(),this.spawnInsights(),this.spawnGates(),this.stormManager.update(this.gameTime,s).active?(this.waveEffect.setIntensity(.5),this.soundGen.setWindIntensity(.5)):(this.waveEffect.setIntensity(0),this.soundGen.setWindIntensity(0)),this.gates=this.gates.filter(e=>!e.update(s)||(e.destroy(),!1)),this.insights.children.iterate(e=>{e&&e.update(s)}),this.powerUpManager.update(s),"NAVIGATOR"===this.boostMeter.getActiveBoost()&&this.insights.children.iterate(e=>{e&&e.isReal&&e.setHighlighted(!0)}),this.checkNearMisses(),this.waveEffect.update(e);const o=this.comboManager.getMultiplier()||1,n=this.powerUpManager.getMultiplier()||1,a=(this.currentMultiplier||1)*o*n;this.hud.update(this.gameTime,this.scoreManager.getScore(),a,this.scoreManager.getQualityRatio(),this.phase,this.comboManager.getCombo()),this.inputManager.isMobile&&this.inputManager.setBoostReady(this.boostMeter.isReady),this.gameTime-this.last30SecCheck>=3e4&&(this.insightsInLast30Sec>=50&&this.events.emit("achievement","SPEED_RUN"),this.insightsInLast30Sec=0,this.last30SecCheck=this.gameTime)}catch(i){}}updatePhase(){let e=1;if(this.gameTime>=t.PHASE_2_END?e=3:this.gameTime>=t.PHASE_1_END&&(e=2),e!==this.phase){this.phase=e,this.hud.showMessage(`PHASE ${this.phase}`,1500),this.soundGen.playPhaseChange(this.phase);const t=s[this.phase];this.stormManager.setStormChance(t.stormChance)}}spawnInsights(){const e=s[this.phase];let i=t.INSIGHT.SPAWN_INTERVAL_BASE*e.insightSpawnRate;if(i*=1+this.spawnModifier,this.signalFloodActive&&(i*=.3),this.gameTime-this.lastInsightSpawn<i)return;if(this.lastInsightSpawn=this.gameTime,Math.random()<t.POWERUPS.SPAWN_CHANCE){const e=Phaser.Math.Between(100,t.WIDTH-100);return void this.powerUpManager.spawnPowerUp(e)}let o=e.realChance-this.noiseModifier;o=Math.max(.3,o),this.signalFloodActive&&(o=.3);const n=Math.random()<o,a=Phaser.Math.Between(50,t.WIDTH-50),r=new u(this,a,-30,n);r.setVelocityY(t.INSIGHT.SPEED_BASE*e.insightSpeed),this.insights.add(r),this.radarUI.addPing(a,-30,n)}spawnGates(){if(this.gameTime<t.GATE_INTERVAL)return;if(this.gameTime-this.lastGateTime<t.GATE_INTERVAL)return;if(this.gates.length>0)return;this.lastGateTime=this.gameTime;const e=new p(this);this.gates.push(e)}collectInsight(e,s){if(s.collected)return;if(!s.collect())return;const i=s.isReal;let o=s.getPoints(),n=s.getMeterValue();i||(this.collectedNoFakes=!1),i||"CAPTAIN"!==this.boostMeter.getActiveBoost()||(o=0,n=0,this.hud.showMessage("SCHILD!",500)),!i&&this.powerUpManager.isActive("SHIELD")&&(o=0,n=0,this.hud.showMessage("GEBLOCKT!",500)),i&&"NAVIGATOR"===this.boostMeter.getActiveBoost()&&(o*=2);const a=this.comboManager.addCombo(e.x,e.y,i),r=this.currentMultiplier*a*this.powerUpManager.getMultiplier();o=Math.round(o*r),this.scoreManager.addInsight(i,r),i&&this.insightsInLast30Sec++,this.boostMeter.addValue(n),this.hud.showPointsPopup(e.x,e.y-30,o),e.flash(i?t.COLORS.INSIGHT_REAL:t.COLORS.INSIGHT_FAKE),this.spawnCollectParticles(s.x,s.y,i),this.soundGen.playSonarPing(i)}spawnCollectParticles(e,s,i){const o=i?t.COLORS.INSIGHT_REAL:t.COLORS.INSIGHT_FAKE,n=i?8:5,a=i?120:80,r=i?5:3,l=2*Math.PI/n;for(let t=0;t<n;t++){const i=l*t,n=this.add.circle(e,s,r,o).setDepth(100),h=a*(.8+.4*Math.random());this.tweens.add({targets:n,x:e+Math.cos(i)*h,y:s+Math.sin(i)*h,scale:0,alpha:0,duration:350+150*Math.random(),ease:"Power2",onComplete:()=>n.destroy()})}if(i){const t=this.add.circle(e,s,10,16777215,0).setStrokeStyle(2,o,1).setDepth(99);this.tweens.add({targets:t,scale:3,alpha:0,duration:400,ease:"Power1",onComplete:()=>t.destroy()})}}checkNearMisses(){const e=this.ship;this.insights.children.iterate(t=>{if(!t||t.isReal||t.nearMissTriggered)return;const s=Phaser.Math.Distance.Between(e.x,e.y,t.x,t.y);if(s<40&&s>25){t.nearMissTriggered=!0,this.soundGen.playNearMiss();const e=10;this.scoreManager.addBonus(e),this.hud.showPointsPopup(t.x,t.y-20,e);const s=this.add.text(t.x,t.y-30,"NICE!",{fontFamily:"Arial",fontSize:"14px",color:"#F39C12"}).setOrigin(.5).setDepth(100);this.tweens.add({targets:s,y:t.y-60,alpha:0,duration:600,onComplete:()=>s.destroy()})}})}activateBoost(){const e=this.boostMeter.activateBoost(0)||this.boostMeter.activateBoost(1);if(!e)return;this.soundGen.playBoostActivate(),this.hud.showMessage(`${t.BOOSTS[e].name} AKTIVIERT!`,1e3),"CAPTAIN"===e&&(this.ship.setStabilized(!0),this.time.delayedCall(t.BOOST_DURATION,()=>{this.ship.setStabilized(!1)}));const s=this.checkBoostEffectiveness(e);this.scoreManager.addBoostUsage(s)}checkBoostEffectiveness(e){const t=this.stormManager.getActiveStorm();return"NAVIGATOR"===e||"CAPTAIN"===e&&"CROSSWIND"===t||"CAPTAIN"===e}onGateSelected(e){this.soundGen.playSuccessChime();const s=t.GATES[e];this.currentMultiplier*=s.multiplier,this.scoreManager.addGateChoice(e),s.noiseIncrease&&(this.noiseModifier+=s.noiseIncrease),s.noiseReduction&&(this.noiseModifier-=s.noiseReduction),s.stormChanceIncrease&&this.stormManager.adjustStormChance(s.stormChanceIncrease),s.stormChanceReduction&&this.stormManager.adjustStormChance(-s.stormChanceReduction),s.spawnReduction&&(this.spawnModifier+=s.spawnReduction),this.scoreManager.gateChoices.length>=5&&this.events.emit("achievement","PERFECT_GATE")}onStormStarted(e){this.soundGen.playWarning()}onStormEnded(e){this.stormsWeathered++,this.stormsWeathered>=3&&this.events.emit("achievement","SURVIVOR")}onSignalFlood(e){this.signalFloodActive=!0}onSignalFloodEnd(){this.signalFloodActive=!1}onAchievement(e){this.achievementNotification.show(e)}togglePauseHelp(){if(!this.isGameOver)if(this.isPaused=!this.isPaused,this.isPaused){this.physics.pause(),this.time.paused=!0,this.pauseOverlay=this.add.rectangle(t.WIDTH/2,t.HEIGHT/2,t.WIDTH,t.HEIGHT,0,.85).setDepth(200),this.pauseContainer=this.add.container(t.WIDTH/2,t.HEIGHT/2).setDepth(201);const e=this.add.text(0,-230,"PAUSE",{fontFamily:"Arial, sans-serif",fontSize:"36px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5);this.pauseContainer.add(e);const s=-185,i=this.scoreManager.getScore(),o=Math.max(0,Math.ceil((t.GAME_DURATION-this.gameTime)/1e3));this.comboManager.getCombo();const n=this.comboManager.getMultiplier(),a=this.currentMultiplier*n*this.powerUpManager.getMultiplier(),r=this.scoreManager.gateChoices||[],l=this.add.rectangle(0,s,500,55,1714746,.9).setStrokeStyle(1,1752220,.5);this.pauseContainer.add(l);const h=this.add.text(-200,s,`PUNKTE: ${i.toLocaleString()}`,{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(0,.5);this.pauseContainer.add(h);const c=this.add.text(-30,s,`ZEIT: ${o}s`,{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(0,.5);this.pauseContainer.add(c);const d=this.add.text(100,s,`x${a.toFixed(1)}`,{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#9B59B6"}).setOrigin(0,.5);if(this.pauseContainer.add(d),r.length>0){const e=r.map(e=>"SPEED"===e?"ðŸ”´":"QUALITY"===e?"ðŸŸ¢":"ðŸ”µ").join(" "),t=this.add.text(160,s,`GATES: ${e}`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(0,.5);this.pauseContainer.add(t)}const u=this.inputManager&&this.inputManager.isMobile;let p=-140;(u?[{title:"STEUERUNG",items:["Links/rechts tippen = Boot steuern","Pause-Button oben = Hilfe/Pause"]},{title:"INSIGHTS & POWER-UPS",items:["â— GrÃ¼n = Echte Insights (+Punkte)","â— Rot = Fake/Noise (ausweichen!)","â¬¡ Power-Ups: Einsammeln = sofort aktiv!"]},{title:"BOOST-METER (links)",items:["FÃ¼llt sich durch Insight-Sammeln","Bei 100%: Tippe auf Navigator oder Captain!"]},{title:"STRATEGY GATES (alle ~15 Sek.)",items:["Erscheint oben - tippe auf eine Option:","SPEED | QUALITY | SAFETY"]}]:[{title:"STEUERUNG",items:["â† â†’ oder A/D: Boot steuern","H oder ESC: Pause/Hilfe"]},{title:"INSIGHTS & POWER-UPS",items:["â— GrÃ¼n = Echte Insights (+Punkte)","â— Rot = Fake/Noise (ausweichen!)","â¬¡ Power-Ups: Einsammeln = sofort aktiv!"]},{title:"BOOST-METER (links)",items:["FÃ¼llt sich durch Insight-Sammeln","Bei 100%: WÃ¤hle deinen Boost!","[Q] Navigator: 2x Punkte + Insights markiert","[E] Captain: Schild + weniger Drift"]},{title:"STRATEGY GATES (alle ~15 Sek.)",items:["Erscheint oben - KLICKE oder 1/2/3:","SPEED | QUALITY | SAFETY"]}]).forEach(e=>{const t=this.add.text(-200,p,e.title,{fontFamily:"Arial, sans-serif",fontSize:"13px",fontStyle:"bold",color:"#F1C40F"});this.pauseContainer.add(t),p+=18,e.items.forEach(e=>{const t=this.add.text(-200,p,e,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#BDC3C7"});this.pauseContainer.add(t),p+=16}),p+=8});const f=this.add.rectangle(0,180,180,40,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.togglePauseHelp());this.pauseContainer.add(f);const g=this.add.text(0,180,"WEITERSPIELEN",{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5);if(this.pauseContainer.add(g),!u){const e=this.add.text(0,215,"H oder ESC zum Fortsetzen",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#7F8C8D"}).setOrigin(.5);this.pauseContainer.add(e)}}else this.physics.resume(),this.time.paused=!1,this.pauseOverlay&&(this.pauseOverlay.destroy(),this.pauseOverlay=null),this.pauseContainer&&(this.pauseContainer.destroy(),this.pauseContainer=null)}endGame(){if(this.isGameOver)return;this.isGameOver=!0;try{this.soundGen.playGameOver(),this.soundGen.stopWindAmbience()}catch(t){}let e={};try{const t=this.ship?this.ship.getStabilityScore():50;e=this.scoreManager.getStats(t),e.maxCombo=this.comboManager?this.comboManager.getMaxCombo():0,e.totalInsights=(e.realInsights||0)+(e.fakeInsights||0),this.collectedNoFakes&&e.totalInsights>10&&(a.unlockAchievement("NO_FAKE"),e.noFakeAchievement=!0),0===a.getStats().gamesPlayed&&a.unlockAchievement("FIRST_GAME");const s=a.updateHighScore(e.finalScore);e.isNewHighScore=s,s&&a.unlockAchievement("HIGH_SCORE"),a.addGameStats(e)}catch(t){e={finalScore:this.scoreManager?this.scoreManager.getScore():0,realInsights:0,fakeInsights:0,maxCombo:0,totalInsights:0}}window._gameEndStats=e,this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("End",e)}),setTimeout(()=>{this.scene&&this.scene.isActive("Game")&&this.scene.start("End",window._gameEndStats||e)},500)}createLogoWatermark(){this.textures.exists("flybridge-logo")?this.addLogoSprite():this.time.delayedCall(100,()=>{this.textures.exists("flybridge-logo")&&this.addLogoSprite()})}addLogoSprite(){const e=this.inputManager&&this.inputManager.isMobile,s=(e?100:180)/609;this.logoWatermark=this.add.image(15,t.HEIGHT-10,"flybridge-logo").setOrigin(0,1).setAlpha(e?.12:.15).setDepth(1).setScale(s)}shutdown(){this.events.off("gateSelected"),this.events.off("stormStarted"),this.events.off("stormEnded"),this.events.off("signalFlood"),this.events.off("signalFloodEnd"),this.events.off("achievement"),this.input&&this.input.keyboard&&(this.input.keyboard.off("keydown-H"),this.input.keyboard.off("keydown-ESC")),this.pauseOverlay&&(this.pauseOverlay.destroy(),this.pauseOverlay=null),this.pauseContainer&&(this.pauseContainer.destroy(),this.pauseContainer=null),this.inputManager&&this.inputManager.destroy(),this.stormManager&&this.stormManager.destroy(),this.comboManager&&this.comboManager.destroy(),this.powerUpManager&&this.powerUpManager.destroy(),this.achievementNotification&&this.achievementNotification.destroy(),this.hud&&this.hud.destroy(),this.radarUI&&this.radarUI.destroy(),this.boostMeter&&this.boostMeter.destroy(),this.waveEffect&&this.waveEffect.destroy(),this.soundGen&&this.soundGen.destroy(),this.logoWatermark&&this.logoWatermark.destroy(),this.insights&&this.insights.clear(!0,!0),this.gates&&(this.gates.forEach(e=>e.destroy()),this.gates=[]),this.ship&&this.ship.destroy()}}const x=new class{constructor(){this.isConfigured=e,this.baseUrl="https://smmngegesumuokmrdujx.supabase.co",this.apiKey=e,this.cachedLeaderboard=null,this.lastFetch=0,this.cacheTimeout=3e4}submitScore(e,t){return __async(this,arguments,function*(e,t,s={}){if(!this.isConfigured)return{success:!1,error:"not_configured"};const i={player_name:e.substring(0,20).replace(/[<>]/g,""),score:Math.floor(t),max_combo:s.maxCombo||0,achievements:s.achievements||[],strategy_profile:s.strategyProfile||"Balanced",ship_skin:s.shipSkin||"default"};try{const e=yield fetch(`${this.baseUrl}/rest/v1/leaderboard`,{method:"POST",headers:{"Content-Type":"application/json",apikey:this.apiKey,Authorization:`Bearer ${this.apiKey}`,Prefer:"return=representation"},body:JSON.stringify(i)});if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=yield e.json();return this.cachedLeaderboard=null,{success:!0,data:t}}catch(o){return{success:!1,error:o.message}}})}getTopScores(e=10){return __async(this,null,function*(){if(!this.isConfigured)return{success:!1,scores:[],error:"not_configured"};const t=Date.now();if(this.cachedLeaderboard&&t-this.lastFetch<this.cacheTimeout)return{success:!0,scores:this.cachedLeaderboard,cached:!0};try{const s=yield fetch(`${this.baseUrl}/rest/v1/leaderboard?select=player_name,score,max_combo,strategy_profile,ship_skin,created_at&order=score.desc&limit=${e}`,{headers:{apikey:this.apiKey,Authorization:`Bearer ${this.apiKey}`}});if(!s.ok)throw new Error(`HTTP ${s.status}`);const i=yield s.json();return this.cachedLeaderboard=i,this.lastFetch=t,{success:!0,scores:i}}catch(s){return{success:!1,scores:[],error:s.message}}})}getPlayerRank(e){return __async(this,null,function*(){if(!this.isConfigured)return{success:!1,rank:null};try{const t=(yield fetch(`${this.baseUrl}/rest/v1/leaderboard?select=count&score=gte.${e}`,{headers:{apikey:this.apiKey,Authorization:`Bearer ${this.apiKey}`,Prefer:"count=exact"}})).headers.get("content-range");return{success:!0,rank:t?parseInt(t.split("/")[1]):null}}catch(t){return{success:!1,rank:null}}})}isAvailable(){return this.isConfigured}};class A extends Phaser.Scene{constructor(){super("End")}init(e){this.stats=e||{},this.nameEntered=!1,this.submittedScore=!1,this.isEnteringName=!1}create(){this.isMobile=h.isMobile(),this.add.rectangle(t.WIDTH/2,t.HEIGHT/2,t.WIDTH,t.HEIGHT,t.COLORS.BACKGROUND),this.createCourseReport(),this.createLeaderboardSection(),this.createCTAButtons();const e=this.isMobile?t.HEIGHT-80:t.HEIGHT-15,s=this.isMobile?160:130,i=this.isMobile?50:24,o=this.isMobile?100:80;this.add.rectangle(t.WIDTH/2-o,e,s,i,1752220,.9).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.restartGame()),this.add.text(t.WIDTH/2-o,e,"â–¶ Nochmal",{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"14px":"11px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5),this.add.rectangle(t.WIDTH/2+o,e,s,i,2899536,.9).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.goToMenu()),this.add.text(t.WIDTH/2+o,e,"âš™ MenÃ¼",{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"14px":"11px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5),this.isMobile&&document.fullscreenElement&&this.createExitFullscreenButton(),this.input.keyboard.on("keydown-SPACE",()=>{this.isEnteringName||this.restartGame()}),this.cameras.main.fadeIn(500),this.loadLeaderboard()}createExitFullscreenButton(){const e=t.WIDTH-50;this.add.rectangle(e,30,80,36,3426654,.9).setInteractive({useHandCursor:!0}).setDepth(200).on("pointerdown",()=>{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}),this.add.text(e,30,"âœ• Beenden",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#ECF0F1"}).setOrigin(.5).setDepth(200)}createCourseReport(){const e=this.isMobile?t.WIDTH/2:.25*t.WIDTH,s=this.isMobile?30:60;this.add.text(e,s,"COURSE REPORT",{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"20px":"28px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5);const i=this.stats.resultType||"Game Over";this.add.text(e,s+28,i,{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"14px":"18px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5),this.add.text(e,s+55,"FINAL SCORE",{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"10px":"12px",color:"#7F8C8D"}).setOrigin(.5);const o=this.stats.finalScore||0;if(this.add.text(e,s+82,o.toLocaleString(),{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"36px":"48px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(.5),this.stats.isNewHighScore&&this.add.text(e,s+115,"â˜… NEUER HIGHSCORE! â˜…",{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"12px":"14px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(.5),this.isMobile){const t=s+(this.stats.isNewHighScore?140:125),i=this.stats.realInsights||0,o=this.stats.qualityScore||0;this.add.text(e,t,`${i} Insights | ${o}% QualitÃ¤t`,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#7F8C8D"}).setOrigin(.5)}else{const t=s+170,i=120;this.createStatBox(e-i,t,"QUALITÃ„T",`${this.stats.qualityScore||0}%`,this.getQualityColor(this.stats.qualityScore||0)),this.createStatBox(e,t,"STABILITÃ„T",`${this.stats.stabilityScore||0}%`,this.getQualityColor(this.stats.stabilityScore||0)),this.createStatBox(e+i,t,"STRATEGIE",this.stats.strategyProfile||"Balanced","#9B59B6");const o=this.stats.realInsights||0,n=this.stats.fakeInsights||0;this.add.text(e,t+80,`${o} echte / ${n} falsche Insights`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#7F8C8D"}).setOrigin(.5);const a=this.stats.multiplier||"1.00";this.add.text(e,t+105,`Multiplikator: x${a}`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#7F8C8D"}).setOrigin(.5)}}createStatBox(e,t,s,i,o){this.add.text(e,t,s,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5),this.add.text(e,t+22,i,{fontFamily:"Arial, sans-serif",fontSize:"18px",fontStyle:"bold",color:o}).setOrigin(.5)}getQualityColor(e){return e>=70?"#2ECC71":e>=40?"#F39C12":"#E74C3C"}createLeaderboardSection(){if(this.isMobile)return x.isAvailable()&&this.createNameInput(t.WIDTH/2,t.HEIGHT-180),void(this.leaderboardContainer=this.add.container(0,0));const e=t.WIDTH-200;this.add.rectangle(e,t.HEIGHT/2-40,280,t.HEIGHT-140,859964,.8).setStrokeStyle(1,1752220,.5),this.add.text(e,60,"LEADERBOARD",{fontFamily:"Arial, sans-serif",fontSize:"18px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5),this.leaderboardLoading=this.add.text(e,140,"Laden...",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5),this.leaderboardContainer=this.add.container(e-120,90),x.isAvailable()&&this.createNameInput(e,t.HEIGHT-120)}createNameInput(e,t){this.add.text(e,t-35,"Name fÃ¼r Leaderboard:",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#F1C40F"}).setOrigin(.5),this.isMobile?this.createMobileNameInput(e,t):(this.add.rectangle(e,t,180,28,1714746).setStrokeStyle(2,1752220),this.playerName="",this.nameText=this.add.text(e,t,"|",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ECF0F1"}).setOrigin(.5),this.add.rectangle(e,t+30,100,24,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.submitScore()),this.add.text(e,t+30,"EINTRAGEN",{fontFamily:"Arial, sans-serif",fontSize:"11px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5),this.isEnteringName=!0,this.input.keyboard.on("keydown",e=>{this.isEnteringName&&!this.submittedScore&&("Enter"===e.key?this.submitScore():"Backspace"===e.key?this.playerName=this.playerName.slice(0,-1):1===e.key.length&&this.playerName.length<12&&/^[a-zA-Z0-9_\-\. ]$/.test(e.key)&&(this.playerName+=e.key),this.nameText.setText(this.playerName+"|"))}),this.time.addEvent({delay:500,callback:()=>{if(this.nameText&&this.isEnteringName&&!this.submittedScore){const e=this.nameText.text.endsWith("|")?"":"|";this.nameText.setText(this.playerName+e)}},loop:!0}))}createMobileNameInput(e,t){const s=document.getElementById("mobile-name-input"),i=document.getElementById("player-name-input");s&&i&&(s.style.display="block",i.value="",this.htmlInput=i,this.htmlInputContainer=s,this.add.rectangle(e,t,200,40,1714746).setStrokeStyle(2,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{i.focus()}),this.add.text(e,t,"Tippen zum Eingeben",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5),this.add.rectangle(e,t+45,140,40,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.playerName=i.value,this.submitScore()}),this.add.text(e,t+45,"EINTRAGEN",{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5),i.addEventListener("keypress",e=>{"Enter"===e.key&&(this.playerName=i.value,this.submitScore(),i.blur())}),this.isEnteringName=!0)}submitScore(){return __async(this,null,function*(){if(this.submittedScore||!this.playerName.trim())return;const e=this.playerName.trim()||"Anonym",t=this.stats.finalScore||0;this.submittedScore=!0,this.isEnteringName=!1,this.nameText.setText(e+" ...");const s=yield x.submitScore(e,t,{maxCombo:this.stats.maxCombo||0,strategyProfile:this.stats.strategyProfile||"Balanced",shipSkin:a.getSelectedSkin()});s.success?(this.nameText.setText(e+" âœ“"),this.loadLeaderboard()):this.nameText.setText(e+" âœ— "+(s.error||""))})}loadLeaderboard(){return __async(this,null,function*(){const e=yield x.getTopScores(8);if(this.leaderboardLoading&&(this.leaderboardLoading.destroy(),this.leaderboardLoading=null),this.leaderboardContainer.removeAll(!0),!e.success||0===e.scores.length){const t=e.success?"Noch keine EintrÃ¤ge":"Nicht verfÃ¼gbar: "+(e.error||""),s=this.add.text(110,50,t,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#7F8C8D"}).setOrigin(.5);return void this.leaderboardContainer.add(s)}e.scores.forEach((e,s)=>{const i=28*s,o=e.score===this.stats.finalScore&&this.submittedScore,n=0===s?"#F1C40F":1===s?"#BDC3C7":2===s?"#CD7F32":"#7F8C8D",a=this.add.text(0,i,`${s+1}.`,{fontFamily:"Arial, sans-serif",fontSize:"13px",color:n}),r=this.add.text(24,i,(e=>{const s=t.SHIP_SKINS,i=Object.values(s).find(t=>t.id===e);return i?i.icon:"â›µ"})(e.ship_skin),{fontSize:"14px"}),l=this.add.text(46,i,e.player_name.substring(0,10),{fontFamily:"Arial, sans-serif",fontSize:"13px",color:o?"#1ABC9C":"#ECF0F1"}),h=this.add.text(240,i,e.score.toLocaleString(),{fontFamily:"Arial, sans-serif",fontSize:"13px",color:o?"#1ABC9C":"#F1C40F"}).setOrigin(1,0);this.leaderboardContainer.add([a,r,l,h])})})}createCTAButtons(){if(this.isMobile)return;const e=t.HEIGHT-55,s=.25*t.WIDTH;this.createButton(s-90,e,160,36,"GesprÃ¤ch vereinbaren",t.COLORS.ACCENT,()=>window.open("https://www.flybridge.ch/kontakt","_blank")),this.createButton(s+90,e,160,36,"Mehr erfahren",3426654,()=>window.open("https://www.flybridge.ch","_blank"))}createButton(e,t,s,i,o,n,a){const r=this.add.rectangle(e,t,s,i,n).setInteractive({useHandCursor:!0}).on("pointerover",()=>r.setScale(1.05)).on("pointerout",()=>r.setScale(1)).on("pointerdown",a);this.add.text(e,t,o,{fontFamily:"Arial, sans-serif",fontSize:"12px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5)}restartGame(){this.hideHtmlInput(),this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>{this.scene.start("Game")})}goToMenu(){this.hideHtmlInput(),this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>{this.scene.start("Menu")})}hideHtmlInput(){const e=document.getElementById("mobile-name-input");e&&(e.style.display="none")}shutdown(){this.input&&this.input.keyboard&&(this.input.keyboard.off("keydown-SPACE"),this.input.keyboard.off("keydown"));const e=document.getElementById("player-name-input");e&&e.replaceWith(e.cloneNode(!0)),this.hideHtmlInput()}}const O={type:Phaser.AUTO,parent:"game-container",width:t.WIDTH,height:t.HEIGHT,backgroundColor:t.COLORS.BACKGROUND,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:t.WIDTH,height:t.HEIGHT,fullscreenTarget:"game-container"},physics:{default:"arcade",arcade:{debug:!1}},scene:[i,c,E,A],input:{activePointers:2}},F=new Phaser.Game(O);window.FlybridgeRadarRun={game:F,restart:()=>{F.scene.start("Menu")},debug:{setPoints:e=>{a.data.totalPointsEarned=e,a.saveData()},setSkin:e=>{a.data.selectedSkin=e,a.saveData()},listSkins:()=>{},testRuby:()=>{a.data.totalPointsEarned=25e4,a.data.selectedSkin="ruby",a.saveData()}}}}();
