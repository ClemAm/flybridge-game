var __defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(t,e,s)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,__spreadValues=(t,e)=>{for(var s in e||(e={}))__hasOwnProp.call(e,s)&&__defNormalProp(t,s,e[s]);if(__getOwnPropSymbols)for(var s of __getOwnPropSymbols(e))__propIsEnum.call(e,s)&&__defNormalProp(t,s,e[s]);return t},__async=(t,e,s)=>new Promise((i,o)=>{var a=t=>{try{r(s.next(t))}catch(e){o(e)}},n=t=>{try{r(s.throw(t))}catch(e){o(e)}},r=t=>t.done?i(t.value):Promise.resolve(t.value).then(a,n);r((s=s.apply(t,e)).next())});!function(){"use strict";const t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNtbW5nZWdlc3VtdW9rbXJkdWp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyNzIzMDMsImV4cCI6MjA4Mzg0ODMwM30.0tG0QyjReEMh8QXpmaR-vgPa7mGEPENCUaVTZ_Dz6pA",e={WIDTH:800,HEIGHT:600,GAME_DURATION:9e4,PHASE_1_END:25e3,PHASE_2_END:6e4,GATE_INTERVAL:15e3,STORM_MIN_INTERVAL:12e3,STORM_MAX_INTERVAL:2e4,STORM_DURATION:4e3,BOOST_DURATION:6e3,SHIP:{SPEED:300,DRIFT_SPEED:150,START_Y:500,BOUNDS_MARGIN:40},INSIGHT:{SPAWN_INTERVAL_BASE:800,SPAWN_INTERVAL_MIN:400,SPEED_BASE:150,SPEED_MAX:250,REAL_CHANCE_BASE:.7,REAL_CHANCE_MIN:.4,POINTS_REAL:100,POINTS_FAKE:-30,METER_FILL_REAL:15,METER_FILL_FAKE:-5},COMBO:{TIMEOUT:2e3,MULTIPLIERS:[1,1.2,1.5,2,2.5,3],SHAKE_INTENSITY:[0,2,4,6,8,10],PARTICLE_COUNT:[3,5,8,12,16,20]},POWERUPS:{SPAWN_CHANCE:.15,DURATION:8e3,TYPES:{MAGNET:{name:"Magnet",color:10181046,radius:150,description:"Zieht Insights an"},SHIELD:{name:"Schild",color:3447003,description:"Blockiert Fake-Schaden"},DOUBLE:{name:"2x Punkte",color:15844367,multiplier:2,description:"Doppelte Punkte"},GOLDEN:{name:"Golden Insight",color:16766720,points:500,description:"Mega-Punkte!"}}},ACHIEVEMENTS:{COMBO_5:{id:"combo_5",name:"Combo Master",description:"5er Combo erreichen",icon:"üî•"},COMBO_10:{id:"combo_10",name:"Combo Legend",description:"10er Combo erreichen",icon:"üí•"},NO_FAKE:{id:"no_fake",name:"Scharfes Auge",description:"Kein Fake gesammelt",icon:"üëÅÔ∏è"},PERFECT_GATE:{id:"perfect_gate",name:"Stratege",description:"Alle Gates gew√§hlt",icon:"üéØ"},HIGH_SCORE:{id:"high_score",name:"Highscore!",description:"Neuer pers√∂nlicher Rekord",icon:"üèÜ"},FIRST_GAME:{id:"first_game",name:"Willkommen",description:"Erstes Spiel abgeschlossen",icon:"‚öì"},SPEED_RUN:{id:"speed_run",name:"Turbo",description:"50 Insights in 30 Sekunden",icon:"‚ö°"},SURVIVOR:{id:"survivor",name:"√úberlebender",description:"3 St√ºrme √ºberstanden",icon:"üåä"}},GATES:{SPEED:{name:"Speed",color:15158332,multiplier:1.5,noiseIncrease:.15,stormChanceIncrease:.1},QUALITY:{name:"Quality",color:3066993,multiplier:1,insightQualityBonus:.2,spawnReduction:.3},SAFETY:{name:"Safety",color:3447003,multiplier:.8,stormChanceReduction:.3,noiseReduction:.1}},BOOSTS:{NAVIGATOR:{name:"Navigator",description:"Zeigt echte Insights klar markiert",color:1752220},ANALYST:{name:"Analyst",description:"Noise wird neutral",color:10181046},CAPTAIN:{name:"Captain",description:"Weniger Drift bei Sturm",color:15965202},CREW_SYNC:{name:"Crew Sync",description:"+1 Multiplikator f√ºr saubere Fahrt",color:15277667}},STORMS:{FOG:{name:"Nebel",radarBlur:.6},CROSSWIND:{name:"Seitenwind",driftForce:200},SIGNAL_FLOOD:{name:"Signal Flood",spawnMultiplier:3,noiseRatio:.7},NARROW_PASS:{name:"Engpass",passWidth:200}},COLORS:{BACKGROUND:661032,WATER_DARK:859964,WATER_LIGHT:1718876,ACCENT:1752220,INSIGHT_REAL:3066993,INSIGHT_FAKE:15158332,UI_TEXT:15528177,UI_DARK:2899536},SCORING:{QUALITY_BONUS_THRESHOLD:.7,QUALITY_BONUS_MULTIPLIER:1.5,STABILITY_BONUS_MAX:500,BOOST_EFFICIENCY_BONUS:200}},s={1:{insightSpawnRate:1,insightSpeed:1,realChance:e.INSIGHT.REAL_CHANCE_BASE,stormChance:0},2:{insightSpawnRate:.8,insightSpeed:1.2,realChance:.6,stormChance:.3},3:{insightSpawnRate:.6,insightSpeed:1.5,realChance:.5,stormChance:.5}};class i extends Phaser.Scene{constructor(){super("Boot")}create(){this.generateTextures(),this.scene.start("Menu")}generateTextures(){this.generateShipTexture(),this.generateInsightTextures(),this.generateBuoyTexture(),this.generateRadarSweep(),this.generateGateTextures(),this.generateBoostIcons()}generateShipTexture(){const t=this.add.graphics(),s=28;t.fillStyle(661032,.4),t.fillEllipse(s,66,44,10),t.fillStyle(15528177),t.beginPath(),t.moveTo(s,4),t.lineTo(34,8),t.lineTo(42,20),t.lineTo(44,45),t.lineTo(42,58),t.lineTo(32,62),t.lineTo(24,62),t.lineTo(14,58),t.lineTo(12,45),t.lineTo(14,20),t.lineTo(22,8),t.closePath(),t.fillPath(),t.fillStyle(2899536),t.beginPath(),t.moveTo(42,52),t.lineTo(44,45),t.lineTo(44,55),t.lineTo(42,60),t.lineTo(14,60),t.lineTo(12,55),t.lineTo(12,45),t.lineTo(14,52),t.closePath(),t.fillPath(),t.fillStyle(12436423,.5),t.beginPath(),t.moveTo(s,6),t.lineTo(23,10),t.lineTo(15,22),t.lineTo(13,44),t.lineTo(15,56),t.lineTo(25,60),t.lineTo(s,60),t.lineTo(s,6),t.closePath(),t.fillPath(),t.fillStyle(9139029),t.beginPath(),t.moveTo(s,12),t.lineTo(38,22),t.lineTo(40,44),t.lineTo(38,54),t.lineTo(18,54),t.lineTo(16,44),t.lineTo(18,22),t.closePath(),t.fillPath(),t.lineStyle(1,7033668,.3);for(let e=-8;e<=8;e+=4)t.lineBetween(s+e,24,s+e,52);t.fillStyle(16777215),t.fillRoundedRect(18,26,20,20,3),t.fillStyle(15528177),t.fillRoundedRect(17,24,22,6,2),t.fillStyle(6139362,.9),t.fillRoundedRect(21,28,6,5,1),t.fillRoundedRect(29,28,6,5,1),t.fillStyle(8765929,.7),t.fillRect(18,32,2,8),t.fillRect(36,32,2,8),t.fillStyle(16777215),t.fillRoundedRect(20,16,16,10,2),t.lineStyle(1,9807270),t.strokeRect(21,17,14,8),t.fillStyle(2899536),t.fillCircle(25,21,2),t.fillCircle(31,21,2),t.fillStyle(3426654),t.fillRect(26,17,4,3),t.fillStyle(8359053),t.fillRect(27,6,2,12),t.fillStyle(16777215),t.fillCircle(s,6,4),t.fillStyle(e.COLORS.ACCENT,.6),t.fillCircle(s,6,3),t.lineStyle(1,1752220),t.strokeCircle(s,6,4),t.fillStyle(9139029),t.fillRect(20,60,16,4),t.fillStyle(2899536),t.fillRect(22,62,4,5),t.fillRect(30,62,4,5),t.fillStyle(1710618),t.fillRect(23,65,2,3),t.fillRect(31,65,2,3),t.fillStyle(3066993),t.fillCircle(40,22,2),t.fillStyle(15158332),t.fillCircle(16,22,2),t.fillStyle(16777215),t.fillCircle(s,10,1.5),t.generateTexture("ship",56,70),t.destroy()}generateInsightTextures(){const t=40,s=20,i=this.add.graphics();i.fillStyle(3066993,.08),i.fillCircle(s,s,18),i.fillStyle(3066993,.12),i.fillCircle(s,s,15),i.fillStyle(3066993,.2),i.fillCircle(s,s,12),i.fillStyle(e.COLORS.INSIGHT_REAL,.9),i.fillCircle(s,s,10),i.lineStyle(2,2600544),i.strokeCircle(s,s,10),i.fillStyle(5822093,.7),i.fillCircle(s,s,6),i.fillStyle(8577194,.8),i.fillCircle(s,s,3),i.fillStyle(16777215,.4),i.fillCircle(17,17,2),i.generateTexture("insight-real",t,t),i.destroy();const o=this.add.graphics();o.fillStyle(15158332,.06),o.fillCircle(21,s,16),o.fillStyle(15158332,.1),o.fillCircle(19,21,14),o.fillStyle(15158332,.15),o.fillCircle(s,s,11),o.fillStyle(e.COLORS.INSIGHT_FAKE,.8),o.fillCircle(s,s,8),o.lineStyle(2,12597547),o.strokeCircle(s,s,8),o.fillStyle(15037299,.5),o.fillCircle(18,18,3),o.fillStyle(15832202,.4),o.fillCircle(22,21,2),o.generateTexture("insight-fake",t,t),o.destroy();const a=this.add.graphics();a.fillStyle(15844367,.15),a.fillCircle(s,s,19),a.fillStyle(15844367,.25),a.fillCircle(s,s,16),a.lineStyle(3,15844367,.9),a.strokeCircle(s,s,14),a.fillStyle(3066993,.2),a.fillCircle(s,s,12),a.fillStyle(e.COLORS.INSIGHT_REAL,.95),a.fillCircle(s,s,10),a.lineStyle(2,2600544),a.strokeCircle(s,s,10),a.fillStyle(5822093,.8),a.fillCircle(s,s,6),a.fillStyle(11267014,.9),a.fillCircle(s,s,3),a.generateTexture("insight-highlighted",t,t),a.destroy()}generateBuoyTexture(){const t=this.add.graphics();t.fillStyle(15158332),t.fillRoundedRect(4,0,12,30,4),t.fillStyle(16777215),t.fillRect(4,10,12,8),t.fillStyle(12597547),t.fillCircle(10,4,6),t.generateTexture("buoy",20,34),t.destroy()}generateRadarSweep(){const t=this.add.graphics(),s=100;for(let i=0;i<60;i++){const o=(60-i)/60*.4,a=-i*(Math.PI/180);t.lineStyle(3,e.COLORS.ACCENT,o),t.beginPath(),t.moveTo(s,s),t.lineTo(s+90*Math.cos(a),s+90*Math.sin(a)),t.strokePath()}t.generateTexture("radar-sweep",200,200),t.destroy()}generateGateTextures(){const t=[15158332,3066993,3447003];["SPEED","QUALITY","SAFETY"].forEach((e,s)=>{const i=this.add.graphics();i.lineStyle(4,t[s],.9),i.strokeRoundedRect(2,2,96,56,8),i.fillStyle(t[s],.2),i.fillRoundedRect(4,4,92,52,6),i.fillStyle(t[s],.8),i.fillTriangle(50,45,40,35,60,35),i.generateTexture(`gate-${e.toLowerCase()}`,100,60),i.destroy()})}generateBoostIcons(){const t=e.BOOSTS;Object.entries(t).forEach(([t,e])=>{const s=this.add.graphics();s.fillStyle(e.color,.3),s.fillCircle(20,20,18),s.lineStyle(3,e.color),s.strokeCircle(20,20,18),s.fillStyle(e.color),"NAVIGATOR"===t?s.fillTriangle(20,8,14,26,26,26):"ANALYST"===t?(s.fillRect(10,24,6,10),s.fillRect(17,18,6,16),s.fillRect(24,12,6,22)):"CAPTAIN"===t?(s.lineStyle(3,e.color),s.strokeCircle(20,14,5),s.lineBetween(20,19,20,32),s.lineBetween(12,28,20,32),s.lineBetween(28,28,20,32)):"CREW_SYNC"===t&&(s.fillCircle(14,14,4),s.fillCircle(26,14,4),s.fillRect(10,20,8,12),s.fillRect(22,20,8,12)),s.generateTexture(`boost-${t.toLowerCase()}`,40,40),s.destroy()})}}class o{constructor(t){this.scene=t,this.waves=[],this.stars=[],this.particles=[],this.createBackground(),this.createStars(),this.createWaves(),this.createAmbientParticles()}createBackground(){const t=this.scene.add.graphics().setDepth(-10);for(let s=0;s<.6*e.HEIGHT;s+=4){const i=s/(.6*e.HEIGHT),o=Math.floor(10+5*i)<<16|Math.floor(22+10*i)<<8|Math.floor(40+20*i);t.fillStyle(o,1),t.fillRect(0,s,e.WIDTH,4)}t.fillStyle(1718876,.3),t.fillRect(0,.4*e.HEIGHT,e.WIDTH,60),t.fillStyle(2771564,.2),t.fillRect(0,.42*e.HEIGHT,e.WIDTH,40),this.background=t}createStars(){for(let t=0;t<50;t++){const t=Phaser.Math.Between(0,e.WIDTH),s=Phaser.Math.Between(0,.5*e.HEIGHT),i=Phaser.Math.FloatBetween(.5,2),o=Phaser.Math.FloatBetween(.3,.8),a=Phaser.Math.FloatBetween(.001,.003),n=Phaser.Math.FloatBetween(0,2*Math.PI),r=this.scene.add.circle(t,s,i,16777215,o).setDepth(-5);this.stars.push({sprite:r,baseAlpha:o,twinkleSpeed:a,twinkleOffset:n})}}createAmbientParticles(){for(let t=0;t<20;t++){const t=Phaser.Math.Between(0,e.WIDTH),s=Phaser.Math.Between(.3*e.HEIGHT,e.HEIGHT),i=Phaser.Math.FloatBetween(1,3),o=Phaser.Math.FloatBetween(.1,.3),a=Phaser.Math.FloatBetween(-.3,.3),n=Phaser.Math.FloatBetween(-.2,.1),r=this.scene.add.circle(t,s,i,6139362,o).setDepth(2);this.particles.push({sprite:r,speedX:a,speedY:n,baseY:s})}}createWaves(){const t=[661032,859964,1718876,859964,1453386],e=[.9,.7,.5,.4,.3];for(let s=0;s<5;s++){const i=this.createWaveGraphics(t[s],e[s],s);this.waves.push(i)}}createWaveGraphics(t,s,i){return{graphics:this.scene.add.graphics().setDepth(i),amplitude:15+5*i,frequency:.02-.003*i,baseY:e.HEIGHT-150+40*i,speed:.5+.2*i,offset:50*i,color:t,alpha:s}}update(t){this.stars.forEach(e=>{const s=Math.sin(t*e.twinkleSpeed+e.twinkleOffset);e.sprite.setAlpha(e.baseAlpha*(.5+.5*s))}),this.particles.forEach(t=>{t.sprite.x+=t.speedX,t.sprite.y+=t.speedY,t.sprite.x<0&&(t.sprite.x=e.WIDTH),t.sprite.x>e.WIDTH&&(t.sprite.x=0),t.sprite.y<.3*e.HEIGHT&&(t.sprite.y=e.HEIGHT),t.sprite.y>e.HEIGHT&&(t.sprite.y=.3*e.HEIGHT)}),this.waves.forEach((s,i)=>{const o=s.graphics;o.clear(),o.fillStyle(s.color,s.alpha),o.beginPath(),o.moveTo(0,e.HEIGHT);for(let a=0;a<=e.WIDTH;a+=8){const e=s.baseY+Math.sin((a+t*s.speed+s.offset)*s.frequency)*s.amplitude+Math.sin((.5*a+t*s.speed*1.5)*s.frequency*2)*(.3*s.amplitude);o.lineTo(a,e)}if(o.lineTo(e.WIDTH,e.HEIGHT),o.closePath(),o.fillPath(),i===this.waves.length-1){o.lineStyle(1,6139362,.2);for(let i=0;i<=e.WIDTH;i+=8){const e=s.baseY+Math.sin((i+t*s.speed+s.offset)*s.frequency)*s.amplitude+Math.sin((.5*i+t*s.speed*1.5)*s.frequency*2)*(.3*s.amplitude);o.lineTo(i,e)}}})}setIntensity(t){this.waves.forEach((e,s)=>{e.amplitude=(15+5*s)*(1+.5*t),e.speed=(.5+.2*s)*(1+.3*t)})}destroy(){this.waves.forEach(t=>t.graphics.destroy()),this.waves=[],this.stars.forEach(t=>t.sprite.destroy()),this.stars=[],this.particles.forEach(t=>t.sprite.destroy()),this.particles=[],this.background&&this.background.destroy()}}const a="flybridge_radar_run",n=new class{constructor(){this.data=this.loadData()}loadData(){try{const t=localStorage.getItem(a);if(t)return JSON.parse(t)}catch(t){}return{highScore:0,gamesPlayed:0,totalInsightsCollected:0,totalFakesAvoided:0,maxCombo:0,achievements:[],lastPlayed:null}}saveData(){try{this.data.lastPlayed=(new Date).toISOString(),localStorage.setItem(a,JSON.stringify(this.data))}catch(t){}}getHighScore(){return this.data.highScore}updateHighScore(t){return t>this.data.highScore&&(this.data.highScore=t,this.saveData(),!0)}addGameStats(t){this.data.gamesPlayed++,this.data.totalInsightsCollected+=t.realInsights||0,t.maxCombo>this.data.maxCombo&&(this.data.maxCombo=t.maxCombo),this.saveData()}unlockAchievement(t){return!this.data.achievements.includes(t)&&(this.data.achievements.push(t),this.saveData(),!0)}hasAchievement(t){return this.data.achievements.includes(t)}getUnlockedAchievements(){return this.data.achievements}getStats(){return __spreadValues({},this.data)}resetProgress(){this.data={highScore:0,gamesPlayed:0,totalInsightsCollected:0,totalFakesAvoided:0,maxCombo:0,achievements:[],lastPlayed:null},this.saveData()}};class r{constructor(t){this.scene=t,this.queue=[],this.isShowing=!1,this.createContainer()}createContainer(){this.container=this.scene.add.container(e.WIDTH/2,-80).setDepth(500),this.bg=this.scene.add.rectangle(0,0,300,70,0,.9).setStrokeStyle(3,15844367),this.icon=this.scene.add.text(-120,0,"",{fontSize:"32px"}).setOrigin(.5),this.title=this.scene.add.text(-80,-12,"",{fontFamily:"Arial",fontSize:"18px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(0,.5),this.desc=this.scene.add.text(-80,12,"",{fontFamily:"Arial",fontSize:"14px",color:"#BDC3C7"}).setOrigin(0,.5),this.container.add([this.bg,this.icon,this.title,this.desc])}show(t){const s=e.ACHIEVEMENTS[t];s&&(n.hasAchievement(t)||(n.unlockAchievement(t),this.queue.push(s),this.processQueue()))}processQueue(){if(this.isShowing||0===this.queue.length)return;this.isShowing=!0;const t=this.queue.shift();this.icon.setText(t.icon),this.title.setText(t.name),this.desc.setText(t.description),this.scene.tweens.add({targets:this.container,y:50,duration:500,ease:"Back.out",onComplete:()=>{this.scene.time.delayedCall(2500,()=>{this.scene.tweens.add({targets:this.container,y:-80,duration:400,ease:"Back.in",onComplete:()=>{this.isShowing=!1,this.processQueue()}})})}}),this.scene.soundGen&&this.scene.soundGen.playAchievementSound&&this.scene.soundGen.playAchievementSound()}destroy(){this.container.destroy()}}class h extends Phaser.Scene{constructor(){super("Menu")}create(){this.showingTutorial=!1,this.waveEffect=new o(this),this.title=this.add.text(e.WIDTH/2,80,"SET THE COURSE",{fontFamily:"Arial, sans-serif",fontSize:"42px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5),this.subtitle=this.add.text(e.WIDTH/2,120,"FLYBRIDGE RADAR RUN",{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#1ABC9C"}).setOrigin(.5),this.shipPreview=this.add.image(e.WIDTH/2,190,"ship").setScale(1.8),this.tweens.add({targets:this.shipPreview,y:200,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"});const t=n.getStats();t.highScore>0&&(this.add.text(e.WIDTH/2,245,`HIGHSCORE: ${t.highScore}`,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#F1C40F"}).setOrigin(.5),this.add.text(e.WIDTH/2,265,`Spiele: ${t.gamesPlayed} | Max Combo: ${t.maxCombo}x`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5)),this.createQuickInstructions(),this.createButtons(),this.cameras.main.fadeIn(500)}createQuickInstructions(){this.add.text(e.WIDTH/2,280,"90 Sekunden. Sammle echte Insights. Setze deinen Kurs.",{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"italic",color:"#95A5A6"}).setOrigin(.5),[{icon:"‚Üê‚Üí",text:"Pfeiltasten / A+D zum Steuern",color:"#ECF0F1"},{icon:"‚óè",text:"Gr√ºn = Echte Insights (+Punkte)",color:"#2ECC71"},{icon:"‚óè",text:"Rot = Noise (ausweichen!)",color:"#E74C3C"},{icon:"‚ñÆ",text:"Boost-Meter links: Bei 100% ‚Üí Taste Q/E",color:"#F1C40F"},{icon:"‚õ≥",text:"Strategy Gates: Klicke oder 1/2/3",color:"#F39C12"}].forEach((t,s)=>{const i=320+28*s;this.add.text(e.WIDTH/2-160,i,t.icon,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:t.color}).setOrigin(.5),this.add.text(e.WIDTH/2-130,i,t.text,{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#BDC3C7"}).setOrigin(0,.5)})}createButtons(){const t=this.createButton(e.WIDTH/2,e.HEIGHT-120,"SPIEL STARTEN","#1ABC9C",()=>{this.startGame()});this.tweens.add({targets:t.bg,scaleX:1.05,scaleY:1.05,duration:600,yoyo:!0,repeat:-1}),this.createButton(e.WIDTH/2,e.HEIGHT-60,"ANLEITUNG","#34495E",()=>{this.showTutorial()}),this.add.text(e.WIDTH/2,e.HEIGHT-20,"SPACE = Start | H = Anleitung",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#5D6D7E"}).setOrigin(.5),this.input.keyboard.on("keydown-SPACE",()=>{this.showingTutorial||this.startGame()}),this.input.keyboard.on("keydown-H",()=>{this.showingTutorial||this.showTutorial()})}createButton(t,e,s,i,o){const a=this.add.rectangle(t,e,200,40,Phaser.Display.Color.HexStringToColor(i).color,.9).setInteractive({useHandCursor:!0}).on("pointerover",()=>a.setFillStyle(Phaser.Display.Color.HexStringToColor(i).color,1)).on("pointerout",()=>a.setFillStyle(Phaser.Display.Color.HexStringToColor(i).color,.9)).on("pointerdown",o),n=this.add.text(t,e,s,{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5);return{bg:a,label:n}}showTutorial(){this.showingTutorial=!0;const t=this.add.rectangle(e.WIDTH/2,e.HEIGHT/2,e.WIDTH,e.HEIGHT,0,.9).setDepth(100).setInteractive(),s=this.add.container(e.WIDTH/2,e.HEIGHT/2).setDepth(101),i=this.add.rectangle(0,0,e.WIDTH-60,e.HEIGHT-60,1714746,.98).setStrokeStyle(2,1752220);s.add(i);const o=this.add.text(0,-220,"WIE SPIELT MAN?",{fontFamily:"Arial, sans-serif",fontSize:"28px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5);s.add(o);let a=-170;[{title:"ZIEL DES SPIELS",content:"Navigiere dein Boot 90 Sekunden lang durch den Datenstrom.\nSammle echte Insights (gr√ºn) und vermeide Noise (rot)."},{title:"STEUERUNG",content:"‚Üê ‚Üí oder A/D: Boot steuern | H/ESC: Pause"},{title:"INSIGHTS & POWER-UPS",content:"‚óè Gr√ºne Insights: +100 Punkte, f√ºllt Boost-Meter\n‚óè Rote Noise: -30 Punkte, bricht Combo\n‚¨° Power-Ups erscheinen zuf√§llig - einsammeln!"},{title:"BOOST-METER (gelber Balken links)",content:'F√ºllt sich durch Insight-Sammeln\nBei 100%: "BEREIT!" erscheint\n‚Üí Dr√ºcke dann Q oder E f√ºr Crew-Boost!'},{title:"STRATEGY GATES (alle ~15 Sek.)",content:"Men√º erscheint oben - KLICKE oder 1/2/3:\nSPEED (x1.5) | QUALITY | SAFETY (x0.8)"},{title:"RADAR & ST√úRME",content:"Radar (unten rechts): Zeigt wo Insights kommen\nSt√ºrme: Nebel, Wind, Signal-Flut"}].forEach((t,e)=>{const i=this.add.text(-300,a,t.title,{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#F1C40F"});s.add(i);const o=this.add.text(-300,a+18,t.content,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#BDC3C7",lineSpacing:4});s.add(o),a+=70});const n=this.add.rectangle(0,220,150,36,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{s.destroy(),t.destroy(),this.showingTutorial=!1});s.add(n);const r=this.add.text(0,220,"VERSTANDEN!",{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5);s.add(r),this.input.keyboard.once("keydown-ESC",()=>{s.destroy(),t.destroy(),this.showingTutorial=!1})}update(t,e){this.waveEffect.update(t)}startGame(){this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>{this.waveEffect.destroy(),this.scene.start("Game")})}}class l extends Phaser.Physics.Arcade.Sprite{constructor(t,s,i){super(t,s,i,"ship"),t.add.existing(this),t.physics.add.existing(this),this.setCollideWorldBounds(!0),this.body.setSize(36,50),this.setDrag(800),this.setMaxVelocity(e.SHIP.SPEED,50),this.driftForce=0,this.driftDirection=0,this.isStabilized=!1,this.isShielded=!1,this.stabilityScore=100,this.lastX=s,this.createTrail(t)}createTrail(t){this.trail=t.add.particles(this.x,this.y,"insight-real",{scale:{start:.25,end:0},alpha:{start:.4,end:0},speed:{min:15,max:30},lifespan:500,frequency:40,follow:this,followOffset:{x:0,y:32},tint:6139362}),this.wakeLeft=t.add.particles(this.x,this.y,"insight-real",{scale:{start:.15,end:0},alpha:{start:.3,end:0},speed:{min:20,max:40},angle:{min:150,max:180},lifespan:400,frequency:60,follow:this,followOffset:{x:-14,y:28},tint:8765929}),this.wakeRight=t.add.particles(this.x,this.y,"insight-real",{scale:{start:.15,end:0},alpha:{start:.3,end:0},speed:{min:20,max:40},angle:{min:0,max:30},lifespan:400,frequency:60,follow:this,followOffset:{x:14,y:28},tint:8765929}),this.radarGlow=t.add.circle(this.x,this.y-28,8,1752220,.3).setDepth(this.depth+1),t.tweens.add({targets:this.radarGlow,scale:{from:1,to:1.5},alpha:{from:.3,to:.1},duration:1e3,yoyo:!0,repeat:-1}),this.shieldGraphic=t.add.circle(this.x,this.y,40,3447003,.2).setStrokeStyle(3,3447003,.8).setDepth(this.depth+1).setVisible(!1)}update(t,s){if(s.left?(this.setVelocityX(-300),this.setAngle(-8)):s.right?(this.setVelocityX(e.SHIP.SPEED),this.setAngle(8)):this.setAngle(0),this.driftForce>0&&!this.isStabilized){const s=this.driftForce*this.driftDirection*(t/1e3);this.x+=s,this.x=Phaser.Math.Clamp(this.x,e.SHIP.BOUNDS_MARGIN,e.WIDTH-e.SHIP.BOUNDS_MARGIN)}const i=Math.abs(this.x-this.lastX);i<2?this.stabilityScore=Math.min(100,this.stabilityScore+.1):i>5&&(this.stabilityScore=Math.max(0,this.stabilityScore-.2)),this.lastX=this.x,this.shieldGraphic&&this.shieldGraphic.setPosition(this.x,this.y),this.radarGlow&&this.radarGlow.setPosition(this.x,this.y-24)}setShielded(t){this.isShielded=t,this.shieldGraphic&&(this.shieldGraphic.setVisible(t),t?this.scene.tweens.add({targets:this.shieldGraphic,scale:{from:1,to:1.1},alpha:{from:.3,to:.5},duration:500,yoyo:!0,repeat:-1}):(this.scene.tweens.killTweensOf(this.shieldGraphic),this.shieldGraphic.setScale(1)))}setDrift(t,e){this.driftForce=t,this.driftDirection=e}clearDrift(){this.driftForce=0,this.driftDirection=0}setStabilized(t){this.isStabilized=t}getStabilityScore(){return this.stabilityScore}flash(t=16777215){this.setTint(t),this.scene.time.delayedCall(100,()=>{this.clearTint()})}destroy(){this.trail&&this.trail.destroy(),this.wakeLeft&&this.wakeLeft.destroy(),this.wakeRight&&this.wakeRight.destroy(),this.radarGlow&&(this.scene&&this.scene.tweens&&this.scene.tweens.killTweensOf(this.radarGlow),this.radarGlow.destroy()),this.shieldGraphic&&this.shieldGraphic.destroy(),super.destroy()}}class c extends Phaser.Physics.Arcade.Sprite{constructor(t,s,i,o=!0){super(t,s,i,o?"insight-real":"insight-fake"),t.add.existing(this),t.physics.add.existing(this),this.isReal=o,this.isHighlighted=!1,this.collected=!1,this.setVelocityY(e.INSIGHT.SPEED_BASE),o?(this.createPulseEffect(t),this.createGlowTrail(t)):this.createFlickerEffect(t),this.body.setCircle(14,6,6)}createGlowTrail(t){this.glowTrail=t.add.circle(this.x,this.y,18,3066993,.15).setDepth(this.depth-1),t.tweens.add({targets:this.glowTrail,scale:{from:1,to:1.3},alpha:{from:.15,to:.05},duration:800,yoyo:!0,repeat:-1})}createPulseEffect(t){t.tweens.add({targets:this,scale:{from:.95,to:1.15},alpha:{from:.85,to:1},duration:700,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),t.tweens.add({targets:this,angle:{from:-3,to:3},duration:1200,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createFlickerEffect(t){t.tweens.add({targets:this,alpha:{from:.35,to:.85},scale:{from:.7,to:1},duration:180,yoyo:!0,repeat:-1,ease:"Stepped",hold:Phaser.Math.Between(30,150)}),t.tweens.add({targets:this,angle:{from:-20,to:20},duration:250,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),t.tweens.add({targets:this,scaleX:{from:.8,to:1.1},scaleY:{from:1.1,to:.85},duration:350,yoyo:!0,repeat:-1,ease:"Stepped"})}setHighlighted(t){t&&this.isReal&&!this.isHighlighted&&(this.isHighlighted=!0,this.setTexture("insight-highlighted"))}collect(){return!this.collected&&(this.collected=!0,this.glowTrail&&(this.scene.tweens.killTweensOf(this.glowTrail),this.glowTrail.destroy(),this.glowTrail=null),this.scene.tweens.add({targets:this,scale:1.8,alpha:0,duration:250,ease:"Quad.out",onComplete:()=>this.destroy()}),this.isReal&&this.createCollectionBurst(),!0)}createCollectionBurst(){const t=this.isReal?3066993:15158332;for(let e=0;e<8;e++){const s=e/8*Math.PI*2,i=this.scene.add.circle(this.x,this.y,4,t,.8).setDepth(100);this.scene.tweens.add({targets:i,x:this.x+40*Math.cos(s),y:this.y+40*Math.sin(s),alpha:0,scale:0,duration:300,ease:"Quad.out",onComplete:()=>i.destroy()})}}update(t){this.glowTrail&&this.glowTrail.setPosition(this.x,this.y),this.y>e.HEIGHT+50&&(this.glowTrail&&this.glowTrail.destroy(),this.destroy())}getPoints(){return this.isReal?e.INSIGHT.POINTS_REAL:e.INSIGHT.POINTS_FAKE}getMeterValue(){return this.isReal?e.INSIGHT.METER_FILL_REAL:e.INSIGHT.METER_FILL_FAKE}}class d{constructor(t,e=-100){this.scene=t,this.y=e,this.speed=100,this.selected=!1,this.selectedRoute=null,this.routes=["SPEED","QUALITY","SAFETY"],this.createGate()}createGate(){const t=this.scene,s=e.WIDTH/3;this.container=t.add.container(0,this.y).setDepth(40),this.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=900&&"ontouchstart"in window;const i=this.isMobile?140:120;this.overlay=t.add.rectangle(e.WIDTH/2,30,e.WIDTH,i,661032,.95),this.container.add(this.overlay),this.title=t.add.text(e.WIDTH/2,8,"W√ÑHLE DEINEN KURS",{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"20px":"18px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5,0),this.container.add(this.title),this.routeButtons=[];const o=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=900&&"ontouchstart"in window,a=o?1.3:1;this.routes.forEach((i,n)=>{const r=s*n+s/2,h=e.GATES[i],l=t.add.rectangle(r,75,s-10,90,0,0).setInteractive({useHandCursor:!0}).on("pointerover",()=>this.onRouteHover(n)).on("pointerout",()=>this.onRouteOut(n)).on("pointerdown",()=>this.selectRoute(n)),c=t.add.image(r,60,`gate-${i.toLowerCase()}`).setScale(a),d=t.add.text(r,95,h.name,{fontFamily:"Arial, sans-serif",fontSize:o?"16px":"14px",fontStyle:"bold",color:"#"+h.color.toString(16).padStart(6,"0")}).setOrigin(.5,0),u=t.add.text(r,114,`x${h.multiplier.toFixed(1)}`,{fontFamily:"Arial, sans-serif",fontSize:o?"14px":"12px",color:"#7F8C8D"}).setOrigin(.5,0),p=t.add.text(r,45,o?"TAP":`[${n+1}]`,{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5,1);this.routeButtons.push({button:c,hitArea:l,nameText:d,multiplierText:u,keyHint:p,route:i}),this.container.add([l,c,d,u,p])}),t.input.keyboard.on("keydown-ONE",()=>this.selectRoute(0)),t.input.keyboard.on("keydown-TWO",()=>this.selectRoute(1)),t.input.keyboard.on("keydown-THREE",()=>this.selectRoute(2));for(let e=1;e<3;e++){const i=t.add.line(0,0,s*e,40,s*e,120,3426654,.5).setLineWidth(2);this.container.add(i)}}onRouteHover(t){if(this.selected)return;const{button:e}=this.routeButtons[t];this.scene.tweens.add({targets:e,scale:1.15,duration:100})}onRouteOut(t){if(this.selected)return;const{button:e}=this.routeButtons[t];this.scene.tweens.add({targets:e,scale:1,duration:100})}selectRoute(t){if(this.selected||t>=this.routes.length)return;this.selected=!0,this.selectedRoute=this.routes[t];const s=e.GATES[this.selectedRoute],i=this.routeButtons[t];this.scene.tweens.add({targets:i.button,scale:1.3,duration:200}),this.routeButtons.forEach((e,s)=>{s!==t&&this.scene.tweens.add({targets:[e.button,e.nameText,e.multiplierText],alpha:.3,duration:200})});const o=this.scene.add.text(e.WIDTH/2,140,`${s.name} gew√§hlt!`,{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#"+s.color.toString(16).padStart(6,"0")}).setOrigin(.5,0);this.container.add(o),this.speed=300,this.scene.events.emit("gateSelected",this.selectedRoute)}update(t){return this.container.y+=this.speed*(t/1e3),!this.selected&&this.container.y>150&&this.selectRoute(1),this.container.y>e.HEIGHT+200}getSelectedRoute(){return this.selectedRoute}getModifiers(){if(!this.selectedRoute)return{};const t=e.GATES[this.selectedRoute];return{multiplier:t.multiplier,noiseChange:t.noiseIncrease||-(t.noiseReduction||0),stormChange:t.stormChanceIncrease||-(t.stormChanceReduction||0),qualityBonus:t.insightQualityBonus||0,spawnReduction:t.spawnReduction||0}}destroy(){this.scene.input.keyboard.off("keydown-ONE"),this.scene.input.keyboard.off("keydown-TWO"),this.scene.input.keyboard.off("keydown-THREE"),this.container.destroy()}}class u extends Phaser.Physics.Arcade.Sprite{constructor(t,s,i,o){const a=e.POWERUPS.TYPES[o];super(t,s,i,`powerup-${o.toLowerCase()}`),t.add.existing(this),t.physics.add.existing(this),this.type=o,this.config=a,this.collected=!1,this.speed=120,this.floatOffset=0,this.floatDirection=1,this.createGlow(),"GOLDEN"!==o?t.tweens.add({targets:this,angle:360,duration:3e3,repeat:-1,ease:"Linear"}):t.tweens.add({targets:this,scale:{from:1,to:1.3},duration:400,yoyo:!0,repeat:-1}),this.body.setCircle(16,0,0)}createGlow(){this.glow=this.scene.add.circle(this.x,this.y,25,this.config.color,.3).setDepth(this.depth-1),this.scene.tweens.add({targets:this.glow,scale:{from:1,to:1.5},alpha:{from:.3,to:0},duration:800,repeat:-1})}update(t){this.y+=this.speed*(t/1e3),this.floatOffset+=.1*this.floatDirection,Math.abs(this.floatOffset)>5&&(this.floatDirection*=-1),this.x+=.3*this.floatDirection,this.glow&&this.glow.setPosition(this.x,this.y),this.y>e.HEIGHT+50&&this.destroy()}collect(){return!this.collected&&(this.collected=!0,this.scene.tweens.add({targets:this,scale:2,alpha:0,duration:300,ease:"Power2",onComplete:()=>this.destroy()}),this.glow&&this.scene.tweens.add({targets:this.glow,scale:3,alpha:0,duration:300,onComplete:()=>this.glow.destroy()}),!0)}destroy(){this.glow&&this.glow.destroy(),super.destroy()}}class p{constructor(t){this.scene=t,this.powerUps=t.add.group(),this.activePowerUps={},this.generateTextures(),this.createUI()}generateTextures(){const t=e.POWERUPS.TYPES;Object.entries(t).forEach(([t,e])=>{const s=`powerup-${t.toLowerCase()}`;if(this.scene.textures.exists(s))return;const i=this.scene.add.graphics();if("MAGNET"===t)i.fillStyle(e.color),i.fillRoundedRect(4,4,8,24,2),i.fillRoundedRect(20,4,8,24,2),i.fillRoundedRect(4,4,24,8,2),i.fillStyle(15158332),i.fillRect(4,20,8,8),i.fillStyle(3447003),i.fillRect(20,20,8,8);else if("SHIELD"===t)i.fillStyle(e.color,.8),i.beginPath(),i.moveTo(16,4),i.lineTo(28,10),i.lineTo(26,24),i.lineTo(16,30),i.lineTo(6,24),i.lineTo(4,10),i.closePath(),i.fillPath(),i.lineStyle(2,16777215,.5),i.strokePath();else if("DOUBLE"===t)i.fillStyle(e.color),i.fillRoundedRect(2,8,28,18,4);else if("GOLDEN"===t){i.fillStyle(e.color),i.beginPath();const t=16,s=16,o=5,a=14,n=7;let r=Math.PI/2*3;const h=Math.PI/o;i.moveTo(t,s-a);for(let e=0;e<o;e++){let e=t+Math.cos(r)*a,o=s+Math.sin(r)*a;i.lineTo(e,o),r+=h,e=t+Math.cos(r)*n,o=s+Math.sin(r)*n,i.lineTo(e,o),r+=h}i.lineTo(t,s-a),i.closePath(),i.fillPath(),i.lineStyle(2,16777215,.8),i.strokePath()}i.generateTexture(s,32,32),i.destroy()})}createUI(){this.indicators={};let t=e.WIDTH/2-100;Object.keys(e.POWERUPS.TYPES).forEach((s,i)=>{if("GOLDEN"===s)return;const o=e.POWERUPS.TYPES[s],a=this.scene.add.container(t+70*i,75).setDepth(100).setAlpha(0),n=this.scene.add.circle(0,0,20,o.color,.3),r=this.scene.add.image(0,0,`powerup-${s.toLowerCase()}`).setScale(.8),h=this.scene.add.text(0,25,"",{fontFamily:"Arial",fontSize:"12px",color:"#ECF0F1"}).setOrigin(.5);a.add([n,r,h]),this.indicators[s]={container:a,timer:h,bg:n}})}spawnPowerUp(t){const e=Math.random();let s;s=e<.1?"GOLDEN":e<.4?"MAGNET":e<.7?"SHIELD":"DOUBLE";const i=new u(this.scene,t,-30,s);return this.powerUps.add(i),i}collectPowerUp(t){if(!t.collect())return;const e=t.type,s=t.config;this.scene.hud.showMessage(`${s.name}!`,800),this.scene.soundGen&&this.scene.soundGen.playPowerUpSound&&this.scene.soundGen.playPowerUpSound(),"GOLDEN"===e?(this.scene.scoreManager.addBonus(s.points),this.scene.hud.showPointsPopup(t.x,t.y,s.points),this.createGoldenBurst(t.x,t.y)):this.activatePowerUp(e)}activatePowerUp(t){this.activePowerUps[t]?this.activePowerUps[t].timeLeft=e.POWERUPS.DURATION:this.activePowerUps[t]={timeLeft:e.POWERUPS.DURATION,startTime:this.scene.time.now};const s=this.indicators[t];s&&(s.container.setAlpha(1),this.scene.tweens.add({targets:s.bg,scale:{from:1.3,to:1},duration:200})),this.applyPowerUpEffect(t,!0)}applyPowerUpEffect(t,e){"SHIELD"===t&&this.scene.ship&&this.scene.ship.setShielded(e)}update(t){this.powerUps.children.iterate(e=>{e&&e.update(t)}),Object.entries(this.activePowerUps).forEach(([e,s])=>{s.timeLeft-=t;const i=this.indicators[e];if(i){const t=Math.ceil(s.timeLeft/1e3);i.timer.setText(`${t}s`),s.timeLeft<2e3&&i.container.setAlpha(.5*Math.sin(this.scene.time.now/100)+.5)}s.timeLeft<=0&&this.deactivatePowerUp(e)}),this.isActive("MAGNET")&&this.scene.ship&&this.applyMagnetEffect()}applyMagnetEffect(){const t=this.scene.ship,s=e.POWERUPS.TYPES.MAGNET.radius;this.scene.insights.children.iterate(e=>{if(!e||!e.isReal)return;const i=Phaser.Math.Distance.Between(t.x,t.y,e.x,e.y);if(i<s){const o=Phaser.Math.Angle.Between(e.x,e.y,t.x,t.y),a=300*(1-i/s);e.x+=Math.cos(o)*a*.016,e.y+=Math.sin(o)*a*.016}})}createGoldenBurst(t,e){for(let s=0;s<20;s++){const i=2*Math.PI*s/20,o=this.scene.add.circle(t,e,6,16766720).setDepth(150);this.scene.tweens.add({targets:o,x:t+150*Math.cos(i),y:e+150*Math.sin(i),scale:0,duration:600,ease:"Power2",onComplete:()=>o.destroy()})}}deactivatePowerUp(t){this.applyPowerUpEffect(t,!1),delete this.activePowerUps[t];const e=this.indicators[t];e&&this.scene.tweens.add({targets:e.container,alpha:0,duration:300})}isActive(t){return!!this.activePowerUps[t]}getMultiplier(){return this.isActive("DOUBLE")?e.POWERUPS.TYPES.DOUBLE.multiplier:1}destroy(){this.powerUps.clear(!0,!0),Object.values(this.indicators).forEach(t=>t.container.destroy())}}class m{constructor(t){this.scene=t,this.cursors=t.input.keyboard.createCursorKeys(),this.wasd=t.input.keyboard.addKeys({left:Phaser.Input.Keyboard.KeyCodes.A,right:Phaser.Input.Keyboard.KeyCodes.D,boost:Phaser.Input.Keyboard.KeyCodes.SPACE}),this.touchLeft=!1,this.touchRight=!1,this.touchBoost=!1,this.isMobile=this.detectMobile(),this.isMobile&&this.createTouchControls()}detectMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=900&&"ontouchstart"in window}createTouchControls(){const t=this.scene,s=e.HEIGHT-55,i=.7;this.touchContainer=t.add.container(0,0).setDepth(150),this.leftBtn=t.add.circle(70,s,32.5,1752220,i).setInteractive().on("pointerdown",()=>{this.touchLeft=!0,this.leftBtn.setFillStyle(1482885,.9)}).on("pointerup",()=>{this.touchLeft=!1,this.leftBtn.setFillStyle(1752220,i)}).on("pointerout",()=>{this.touchLeft=!1,this.leftBtn.setFillStyle(1752220,i)}),this.leftIcon=t.add.text(70,s,"‚óÄ",{fontSize:"26px",color:"#FFFFFF"}).setOrigin(.5),this.rightBtn=t.add.circle(e.WIDTH-70,s,32.5,1752220,i).setInteractive().on("pointerdown",()=>{this.touchRight=!0,this.rightBtn.setFillStyle(1482885,.9)}).on("pointerup",()=>{this.touchRight=!1,this.rightBtn.setFillStyle(1752220,i)}).on("pointerout",()=>{this.touchRight=!1,this.rightBtn.setFillStyle(1752220,i)}),this.rightIcon=t.add.text(e.WIDTH-70,s,"‚ñ∂",{fontSize:"26px",color:"#FFFFFF"}).setOrigin(.5),this.boostBtn=t.add.circle(e.WIDTH/2,s,27.5,8359053,.4).setInteractive().on("pointerdown",()=>{this.touchBoost=!0}).on("pointerup",()=>{this.touchBoost=!1}),this.boostIcon=t.add.text(e.WIDTH/2,s,"‚ö°",{fontSize:"22px"}).setOrigin(.5),this.boostLabel=t.add.text(e.WIDTH/2,s+38,"BOOST",{fontFamily:"Arial, sans-serif",fontSize:"9px",color:"#7F8C8D"}).setOrigin(.5),this.touchContainer.add([this.leftBtn,this.leftIcon,this.rightBtn,this.rightIcon,this.boostBtn,this.boostIcon,this.boostLabel]),this.setupTapZones()}setupTapZones(){const t=this.scene,s=e.HEIGHT-130;this.leftZone=t.add.rectangle(e.WIDTH/4,s/2,e.WIDTH/2,s,0,0).setInteractive().setDepth(49),this.leftZone.on("pointerdown",t=>{t.x<e.WIDTH/2&&t.y<s&&(this.touchLeft=!0)}),this.leftZone.on("pointerup",()=>{this.touchLeft=!1}),this.leftZone.on("pointerout",()=>{this.touchLeft=!1}),this.rightZone=t.add.rectangle(3*e.WIDTH/4,s/2,e.WIDTH/2,s,0,0).setInteractive().setDepth(49),this.rightZone.on("pointerdown",t=>{t.x>=e.WIDTH/2&&t.y<s&&(this.touchRight=!0)}),this.rightZone.on("pointerup",()=>{this.touchRight=!1}),this.rightZone.on("pointerout",()=>{this.touchRight=!1})}getInput(){const t={left:!1,right:!1,boost:!1};return(this.cursors.left.isDown||this.wasd.left.isDown)&&(t.left=!0),(this.cursors.right.isDown||this.wasd.right.isDown)&&(t.right=!0),Phaser.Input.Keyboard.JustDown(this.wasd.boost)&&(t.boost=!0),this.touchLeft&&(t.left=!0),this.touchRight&&(t.right=!0),this.touchBoost&&(t.boost=!0,this.touchBoost=!1),t}isBoostPressed(){return Phaser.Input.Keyboard.JustDown(this.wasd.boost)||this.touchBoost}setBoostReady(t){this.isMobile&&this.boostBtn&&(t?(this.boostBtn.setFillStyle(15844367,.9),this.boostLabel.setText("BEREIT!"),this.boostLabel.setColor("#F1C40F"),this.boostPulseTween||(this.boostPulseTween=this.scene.tweens.add({targets:[this.boostBtn,this.boostIcon],scale:{from:1,to:1.15},duration:400,yoyo:!0,repeat:-1}))):(this.boostBtn.setFillStyle(8359053,.4),this.boostLabel.setText("BOOST"),this.boostLabel.setColor("#7F8C8D"),this.boostPulseTween&&(this.boostPulseTween.stop(),this.boostPulseTween=null,this.boostBtn.setScale(1),this.boostIcon.setScale(1))))}destroy(){this.scene.input.off("pointerdown"),this.scene.input.off("pointermove"),this.scene.input.off("pointerup"),this.touchContainer&&this.touchContainer.destroy(),this.leftZone&&this.leftZone.destroy(),this.rightZone&&this.rightZone.destroy(),this.boostPulseTween&&this.boostPulseTween.stop()}}class f{constructor(t){this.scene=t,this.reset()}reset(){this.score=0,this.realInsightsCollected=0,this.fakeInsightsCollected=0,this.totalInsightsCollected=0,this.multiplier=1,this.gateChoices=[],this.boostsUsed=0,this.boostEfficiency=0,this.perfectBoosts=0}addInsight(t,s=1){this.totalInsightsCollected++;const i=t?e.INSIGHT.POINTS_REAL:e.INSIGHT.POINTS_FAKE,o=Math.round(i*s*this.multiplier);return this.score+=o,t?this.realInsightsCollected++:this.fakeInsightsCollected++,o}addGateChoice(t){this.gateChoices.push(t);const s=e.GATES[t.toUpperCase()];s&&(this.multiplier*=s.multiplier)}addBoostUsage(t){this.boostsUsed++,t&&this.perfectBoosts++}addBonus(t){this.score+=t}getScore(){return Math.max(0,this.score)}getMultiplier(){return this.multiplier}getQualityRatio(){return 0===this.totalInsightsCollected?0:this.realInsightsCollected/this.totalInsightsCollected}getQualityScore(){return Math.round(100*this.getQualityRatio())}calculateFinalScore(t){let s=this.score;return this.getQualityRatio()>=e.SCORING.QUALITY_BONUS_THRESHOLD&&(s*=e.SCORING.QUALITY_BONUS_MULTIPLIER),s+=t/100*e.SCORING.STABILITY_BONUS_MAX,this.boostsUsed>0&&(s+=this.perfectBoosts/this.boostsUsed*e.SCORING.BOOST_EFFICIENCY_BONUS),Math.round(s)}getStrategyProfile(){if(0===this.gateChoices.length)return"Balanced";const t={};this.gateChoices.forEach(e=>{t[e]=(t[e]||0)+1});const e=Object.entries(t).sort((t,e)=>e[1]-t[1])[0];return e?e[0]:"Balanced"}getCrewImpact(){return 0===this.boostsUsed?"Low":this.boostsUsed<=2?"Medium":"High"}getResultType(t,e){const s=(t+e)/2;return s>=80?"Quality"===this.getStrategyProfile()?"High Quality Navigator":"Stable Course":s>=60?"Speed"===this.getStrategyProfile()?"Fast but Noisy":"Balanced Approach":s>=40?"Rough Waters":"Lost at Sea"}getStats(t){const e=this.getQualityScore();return{finalScore:this.calculateFinalScore(t),qualityScore:e,stabilityScore:Math.round(t),strategyProfile:this.getStrategyProfile(),crewImpact:this.getCrewImpact(),resultType:this.getResultType(e,t),realInsights:this.realInsightsCollected,fakeInsights:this.fakeInsightsCollected,multiplier:this.multiplier.toFixed(2)}}}class g{constructor(t){this.scene=t,this.activeStorm=null,this.stormEndTime=0,this.stormChance=0,this.lastStormTime=0,this.minInterval=e.STORM_MIN_INTERVAL,this.stormTypes=["FOG","CROSSWIND","SIGNAL_FLOOD","NARROW_PASS"],this.createEffects()}createEffects(){this.fogOverlay=this.scene.add.rectangle(e.WIDTH/2,e.HEIGHT/2,e.WIDTH,e.HEIGHT,6122878,0).setDepth(30),this.fogOverlay2=this.scene.add.rectangle(e.WIDTH/2,e.HEIGHT/2,e.WIDTH,e.HEIGHT,8753822,0).setDepth(31),this.fogParticles=null,this.windIndicator=this.scene.add.text(e.WIDTH/2,80,"",{fontFamily:"Arial, sans-serif",fontSize:"24px",color:"#F39C12"}).setOrigin(.5).setDepth(100).setVisible(!1),this.buoys=this.scene.add.group(),this.warningText=this.scene.add.text(e.WIDTH/2,e.HEIGHT/2-100,"",{fontFamily:"Arial, sans-serif",fontSize:"32px",fontStyle:"bold",color:"#E74C3C",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(150).setVisible(!1)}setStormChance(t){this.stormChance=Math.max(0,Math.min(1,t))}adjustStormChance(t){this.stormChance=Math.max(0,Math.min(1,this.stormChance+t))}checkForStorm(t){this.activeStorm||t-this.lastStormTime<this.minInterval||t<e.PHASE_1_END||Math.random()<.02*this.stormChance&&this.triggerRandomStorm(t)}triggerRandomStorm(t){const e=this.stormTypes[Math.floor(Math.random()*this.stormTypes.length)];this.triggerStorm(e,t)}triggerStorm(t,s){this.activeStorm=t,this.stormEndTime=s+e.STORM_DURATION,this.lastStormTime=s;const i=e.STORMS[t];switch(this.showWarning(i.name),t){case"FOG":this.startFog();break;case"CROSSWIND":this.startCrosswind();break;case"SIGNAL_FLOOD":this.startSignalFlood();break;case"NARROW_PASS":this.startNarrowPass()}this.scene.events.emit("stormStarted",t)}showWarning(t){this.warningText.setText(`‚ö† ${t.toUpperCase()}! ‚ö†`),this.warningText.setVisible(!0),this.scene.tweens.add({targets:this.warningText,alpha:{from:1,to:0},scale:{from:1,to:1.2},duration:1500,onComplete:()=>{this.warningText.setVisible(!1),this.warningText.setAlpha(1),this.warningText.setScale(1)}})}startFog(){this.scene.tweens.add({targets:this.fogOverlay,alpha:.7,duration:800}),this.scene.tweens.add({targets:this.fogOverlay2,alpha:.4,duration:1200}),this.fogParticles=this.scene.add.particles(0,0,"insight-real",{x:{min:0,max:e.WIDTH},y:{min:0,max:e.HEIGHT},scale:{min:2,max:5},alpha:{start:.15,end:.05},speedX:{min:-30,max:-10},speedY:{min:10,max:30},lifespan:4e3,frequency:100,tint:11450047,blendMode:"ADD"}).setDepth(32),this.scene.radarUI&&this.scene.radarUI.setBlurred(!0,.8),this.fogLabel=this.scene.add.text(e.WIDTH/2,e.HEIGHT-50,"üå´Ô∏è DICHTER NEBEL - SICHT EINGESCHR√ÑNKT!",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#BDC3C7",stroke:"#2C3E50",strokeThickness:3}).setOrigin(.5).setDepth(100),this.scene.tweens.add({targets:this.fogLabel,alpha:{from:1,to:.6},duration:1e3,yoyo:!0,repeat:-1})}startCrosswind(){const t=Math.random()>.5?1:-1,s=t>0?"‚Üí‚Üí‚Üí":"‚Üê‚Üê‚Üê";this.windIndicator.setText(`WIND ${s}`),this.windIndicator.setVisible(!0),this.scene.ship&&this.scene.ship.setDrift(e.STORMS.CROSSWIND.driftForce,t),this.scene.tweens.add({targets:this.windIndicator,x:e.WIDTH/2+20*t,duration:500,yoyo:!0,repeat:-1})}startSignalFlood(){this.scene.events.emit("signalFlood",{spawnMultiplier:e.STORMS.SIGNAL_FLOOD.spawnMultiplier,noiseRatio:e.STORMS.SIGNAL_FLOOD.noiseRatio})}startNarrowPass(){const t=e.STORMS.NARROW_PASS.passWidth,s=e.WIDTH/2,i=s-t/2,o=s+t/2;for(let e=0;e<6;e++){const t=-50-60*e,s=this.scene.physics.add.sprite(i-20,t,"buoy");s.setVelocityY(150),this.buoys.add(s);const a=this.scene.physics.add.sprite(o+20,t,"buoy");a.setVelocityY(150),this.buoys.add(a)}this.scene.ship&&(this.buoyCollider=this.scene.physics.add.overlap(this.scene.ship,this.buoys,(t,e)=>{t.flash(15158332),this.scene.scoreManager.addInsight(!1),e.destroy()}))}update(t,s){return this.activeStorm?t>=this.stormEndTime?(this.endStorm(),{active:!1}):(this.buoys.children.iterate(t=>{t&&t.y>e.HEIGHT+50&&t.destroy()}),{active:!0,type:this.activeStorm,remaining:this.stormEndTime-t}):(this.checkForStorm(t),{active:!1})}endStorm(){const t=this.activeStorm;switch(this.activeStorm=null,t){case"FOG":this.scene.tweens.add({targets:this.fogOverlay,alpha:0,duration:800}),this.scene.tweens.add({targets:this.fogOverlay2,alpha:0,duration:800}),this.fogParticles&&(this.fogParticles.destroy(),this.fogParticles=null),this.fogLabel&&(this.scene.tweens.killTweensOf(this.fogLabel),this.fogLabel.destroy(),this.fogLabel=null),this.scene.radarUI&&this.scene.radarUI.setBlurred(!1);break;case"CROSSWIND":this.windIndicator.setVisible(!1),this.scene.tweens.killTweensOf(this.windIndicator),this.windIndicator.x=e.WIDTH/2,this.scene.ship&&this.scene.ship.clearDrift();break;case"SIGNAL_FLOOD":this.scene.events.emit("signalFloodEnd");break;case"NARROW_PASS":this.buoys.clear(!0,!0),this.buoyCollider&&(this.buoyCollider.destroy(),this.buoyCollider=null)}this.scene.events.emit("stormEnded",t)}isNavigatorEffective(){return"FOG"===this.activeStorm||"SIGNAL_FLOOD"===this.activeStorm}isCaptainEffective(){return"CROSSWIND"===this.activeStorm}getActiveStorm(){return this.activeStorm}destroy(){this.fogOverlay.destroy(),this.fogOverlay2.destroy(),this.fogParticles&&this.fogParticles.destroy(),this.fogLabel&&this.fogLabel.destroy(),this.windIndicator.destroy(),this.warningText.destroy(),this.buoys.clear(!0,!0)}}class S{constructor(t){this.scene=t,this.combo=0,this.maxCombo=0,this.lastCollectTime=0,this.comboTimer=null,this.createComboDisplay(),this.createParticleEmitter()}createComboDisplay(){this.comboContainer=this.scene.add.container(e.WIDTH/2,100).setDepth(200),this.comboText=this.scene.add.text(0,0,"",{fontFamily:"Arial, sans-serif",fontSize:"48px",fontStyle:"bold",color:"#F1C40F",stroke:"#000000",strokeThickness:6}).setOrigin(.5).setAlpha(0),this.comboLabel=this.scene.add.text(0,35,"COMBO",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5).setAlpha(0),this.comboContainer.add([this.comboText,this.comboLabel])}createParticleEmitter(){if(!this.scene.textures.exists("particle")){const t=this.scene.add.graphics();t.fillStyle(16777215),t.fillCircle(4,4,4),t.generateTexture("particle",8,8),t.destroy()}}addCombo(t,s,i){if(!i)return this.resetCombo(),0;this.combo++,this.maxCombo=Math.max(this.maxCombo,this.combo),this.lastCollectTime=this.scene.time.now,this.comboTimer&&this.comboTimer.remove(),this.comboTimer=this.scene.time.delayedCall(e.COMBO.TIMEOUT,()=>{this.resetCombo()});const o=Math.min(this.combo-1,e.COMBO.MULTIPLIERS.length-1),a=e.COMBO.MULTIPLIERS[o];return this.combo>=2&&(this.showComboDisplay(),this.spawnParticles(t,s,o),this.shakeScreen(o),this.scene.soundGen&&this.scene.soundGen.playComboSound&&this.scene.soundGen.playComboSound(o)),5===this.combo?this.scene.events.emit("achievement","COMBO_5"):10===this.combo&&this.scene.events.emit("achievement","COMBO_10"),a}showComboDisplay(){const t=["#F1C40F","#E67E22","#E74C3C","#9B59B6","#FF0000","#FF00FF"],e=Math.min(this.combo-1,t.length-1);this.comboText.setText(`${this.combo}x`),this.comboText.setColor(t[e]),this.scene.tweens.killTweensOf(this.comboText),this.scene.tweens.killTweensOf(this.comboLabel),this.comboText.setAlpha(1).setScale(1.5),this.comboLabel.setAlpha(1),this.scene.tweens.add({targets:this.comboText,scale:1,duration:200,ease:"Back.out"}),this.combo>=5&&this.scene.tweens.add({targets:this.comboText,scale:{from:1,to:1.1},duration:300,yoyo:!0,repeat:-1})}hideComboDisplay(){this.scene.tweens.add({targets:[this.comboText,this.comboLabel],alpha:0,duration:300})}spawnParticles(t,s,i){const o=e.COMBO.PARTICLE_COUNT[i]||5,a=[3066993,15844367,15105570,15158332,10181046,16711935][i]||3066993;for(let e=0;e<o;e++){const n=2*Math.PI*e/o,r=100+30*i,h=this.scene.add.circle(t,s,4+i,a).setDepth(100);this.scene.tweens.add({targets:h,x:t+Math.cos(n)*r,y:s+Math.sin(n)*r,scale:0,alpha:0,duration:400+50*i,ease:"Power2",onComplete:()=>h.destroy()})}if(i>=3)for(let e=0;e<2*i;e++){const i=this.scene.add.circle(t+Phaser.Math.Between(-30,30),s+Phaser.Math.Between(-30,30),4,16777215).setDepth(101);this.scene.tweens.add({targets:i,scale:0,alpha:0,duration:500,delay:30*e,onComplete:()=>i.destroy()})}}shakeScreen(t){const s=e.COMBO.SHAKE_INTENSITY[t]||0;s>0&&this.scene.cameras.main.shake(100,s/1e3)}resetCombo(){this.combo>=2&&this.hideComboDisplay(),this.combo=0,this.comboTimer&&(this.comboTimer.remove(),this.comboTimer=null)}getCombo(){return this.combo}getMaxCombo(){return this.maxCombo}getMultiplier(){if(0===this.combo)return 1;const t=Math.min(this.combo-1,e.COMBO.MULTIPLIERS.length-1);return e.COMBO.MULTIPLIERS[t]}destroy(){this.comboTimer&&this.comboTimer.remove(),this.comboContainer.destroy()}}class y{constructor(t){this.scene=t,this.createElements()}createElements(){const t=this.scene;this.scoreText=t.add.text(20,20,"SCORE: 0",{fontFamily:"Arial, sans-serif",fontSize:"24px",fontStyle:"bold",color:"#ECF0F1"}).setDepth(100),this.multiplierText=t.add.text(20,50,"x1.00",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#1ABC9C"}).setDepth(100),this.timerText=t.add.text(e.WIDTH-20,20,"90",{fontFamily:"Arial, sans-serif",fontSize:"32px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(1,0).setDepth(100),this.timerLabel=t.add.text(e.WIDTH-20,55,"SEKUNDEN",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(1,0).setDepth(100),this.phaseText=t.add.text(e.WIDTH/2,20,"PHASE 1",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#1ABC9C"}).setOrigin(.5,0).setDepth(100),this.createQualityBar(t)}createQualityBar(t){const s=e.WIDTH/2-75;this.qualityBarBg=t.add.rectangle(s,45,150,8,2899536).setOrigin(0,0).setDepth(100),this.qualityBarFill=t.add.rectangle(s,45,0,8,e.COLORS.INSIGHT_REAL).setOrigin(0,0).setDepth(100),this.qualityLabel=t.add.text(e.WIDTH/2,58,"INSIGHT QUALIT√ÑT",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5,0).setDepth(100),this.highScoreText=t.add.text(20,75,"",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setDepth(100)}setHighScore(t){this.highScoreText.setText(`BEST: ${t}`)}update(t,s,i=1,o=1,a=1,n=0){(isNaN(i)||void 0===i)&&(i=1),this.scoreText.setText(`SCORE: ${s}`),this.multiplierText.setText(`x${i.toFixed(2)}`),i>1?this.multiplierText.setColor("#F1C40F"):i<1?this.multiplierText.setColor("#E74C3C"):this.multiplierText.setColor("#1ABC9C");const r=Math.max(0,Math.ceil((e.GAME_DURATION-t)/1e3));this.timerText.setText(r.toString()),r<=10&&this.timerText.setColor(r%2==0?"#E74C3C":"#ECF0F1"),this.phaseText.setText(`PHASE ${a}`);const h=150*Math.max(0,Math.min(1,o));this.qualityBarFill.width=h,o>=.7?this.qualityBarFill.setFillStyle(e.COLORS.INSIGHT_REAL):o>=.4?this.qualityBarFill.setFillStyle(15965202):this.qualityBarFill.setFillStyle(e.COLORS.INSIGHT_FAKE)}showPointsPopup(t,e,s){const i=s>=0?"#2ECC71":"#E74C3C",o=s>=0?"+":"",a=this.scene.add.text(t,e,`${o}${s}`,{fontFamily:"Arial, sans-serif",fontSize:"20px",fontStyle:"bold",color:i}).setOrigin(.5).setDepth(100);this.scene.tweens.add({targets:a,y:e-50,alpha:0,duration:800,ease:"Power2",onComplete:()=>a.destroy()})}showMessage(t,s=2e3){const i=this.scene.add.text(e.WIDTH/2,e.HEIGHT/2-50,t,{fontFamily:"Arial, sans-serif",fontSize:"28px",fontStyle:"bold",color:"#ECF0F1",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(150).setAlpha(0);this.scene.tweens.add({targets:i,alpha:1,duration:200,yoyo:!0,hold:s-400,onComplete:()=>i.destroy()})}destroy(){this.scoreText.destroy(),this.multiplierText.destroy(),this.timerText.destroy(),this.timerLabel.destroy(),this.phaseText.destroy(),this.qualityBarBg.destroy(),this.qualityBarFill.destroy(),this.qualityLabel.destroy(),this.highScoreText.destroy()}}class T{constructor(t){this.scene=t,this.isBlurred=!1,this.blurAmount=0,this.createRadar()}createRadar(){const t=this.scene,s=e.WIDTH-110,i=e.HEIGHT-110;this.radarBg=t.add.graphics().setDepth(50),this.drawRadarBackground(s,i,80),this.sweep=t.add.image(s,i,"radar-sweep").setScale(.8).setAlpha(.6).setDepth(51),t.tweens.add({targets:this.sweep,angle:360,duration:2e3,repeat:-1,ease:"Linear"}),this.centerDot=t.add.circle(s,i,4,e.COLORS.ACCENT).setDepth(52),this.pings=t.add.group(),this.fogOverlay=t.add.rectangle(s,i,160,160,8359053,0).setDepth(53)}drawRadarBackground(t,s,i){const o=this.radarBg;o.clear(),o.lineStyle(2,e.COLORS.ACCENT,.8),o.strokeCircle(t,s,i),o.lineStyle(1,e.COLORS.ACCENT,.3),o.strokeCircle(t,s,.66*i),o.strokeCircle(t,s,.33*i),o.lineStyle(1,e.COLORS.ACCENT,.2),o.lineBetween(t-i,s,t+i,s),o.lineBetween(t,s-i,t,s+i);const a={fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#1ABC9C"};this.compassN=this.scene.add.text(t,s-i-8,"N",a).setOrigin(.5).setDepth(52),this.compassS=this.scene.add.text(t,s+i+8,"S",a).setOrigin(.5).setDepth(52)}addPing(t,s,i){const o=2*(t/e.WIDTH-.5)*70,a=2*((s+50)/(e.HEIGHT+100)-.5)*70,n=e.WIDTH-110+o,r=e.HEIGHT-110+a;if(Math.sqrt(o*o+a*a)>84)return;const h=i?e.COLORS.INSIGHT_REAL:e.COLORS.INSIGHT_FAKE,l=this.scene.add.circle(n,r,3,h,.8).setDepth(52);this.isBlurred&&!i&&(l.x+=Phaser.Math.Between(-10,10)*this.blurAmount,l.y+=Phaser.Math.Between(-10,10)*this.blurAmount),this.pings.add(l),this.scene.tweens.add({targets:l,alpha:0,scale:2,duration:2e3,onComplete:()=>l.destroy()})}setBlurred(t,e=.6){this.isBlurred=t,this.blurAmount=e,t?this.scene.tweens.add({targets:this.fogOverlay,alpha:.5*e,duration:500}):this.scene.tweens.add({targets:this.fogOverlay,alpha:0,duration:500})}update(t){}destroy(){this.radarBg.destroy(),this.sweep.destroy(),this.centerDot.destroy(),this.fogOverlay.destroy(),this.compassN.destroy(),this.compassS.destroy(),this.pings.clear(!0,!0)}}class C{constructor(t,e){this.scene=t,this.availableBoosts=e,this.meterValue=0,this.maxValue=100,this.isReady=!1,this.activeBoost=null,this.createMeter()}createMeter(){const t=this.scene,s=e.HEIGHT-100;this.meterBg=t.add.rectangle(20,s,30,80,2899536).setOrigin(0,1).setDepth(100),this.meterBorder=t.add.rectangle(20,s,30,80).setOrigin(0,1).setStrokeStyle(2,e.COLORS.ACCENT).setDepth(100),this.meterFill=t.add.rectangle(22,s-2,26,0,e.COLORS.ACCENT).setOrigin(0,1).setDepth(100),this.label=t.add.text(35,s+10,"CREW",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5,0).setDepth(100),this.anchorIcon=t.add.text(35,s-40,"‚öì",{fontSize:"24px"}).setOrigin(.5).setDepth(100),this.readyText=t.add.text(35,s-85,"BEREIT!",{fontFamily:"Arial, sans-serif",fontSize:"12px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(.5).setDepth(100).setVisible(!1),this.createBoostChoicePanel(75,s-60),this.scene.input.keyboard.on("keydown-Q",()=>this.activateBoost(0)),this.scene.input.keyboard.on("keydown-E",()=>this.activateBoost(1))}createBoostChoicePanel(t,s){this.choicePanel=this.scene.add.container(t,s).setDepth(100).setAlpha(0);const i=this.scene.add.rectangle(0,0,100,70,1714746,.95).setStrokeStyle(1,e.COLORS.ACCENT);this.choicePanel.add(i);const o=this.scene.add.text(0,-25,"W√§hle Boost:",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5);this.choicePanel.add(o),this.boostOptions=[],this.availableBoosts.forEach((t,s)=>{const i=e.BOOSTS[t],o=25*s-5,a=this.scene.add.text(-40,o,0===s?"[Q]":"[E]",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#F1C40F"}).setOrigin(0,.5),n=this.scene.add.text(-15,o,i.name,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#ECF0F1"}).setOrigin(0,.5);this.choicePanel.add([a,n]),this.boostOptions.push({keyLabel:a,nameLabel:n,boostKey:t})})}addValue(t){this.activeBoost||(this.meterValue=Math.max(0,Math.min(this.maxValue,this.meterValue+t)),this.updateMeterFill(),this.meterValue>=this.maxValue&&!this.isReady&&(this.isReady=!0,this.showReadyState()))}updateMeterFill(){const t=this.meterValue/this.maxValue*76;this.meterFill.height=t,this.meterValue>=this.maxValue?this.meterFill.setFillStyle(15844367):this.meterValue>=.7*this.maxValue?this.meterFill.setFillStyle(3066993):this.meterFill.setFillStyle(e.COLORS.ACCENT)}showReadyState(){this.readyText.setVisible(!0),this.scene.tweens.add({targets:this.choicePanel,alpha:1,duration:300}),this.scene.tweens.add({targets:[this.readyText,this.meterBorder,this.anchorIcon],scale:{from:1,to:1.1},duration:500,yoyo:!0,repeat:-1})}activateBoost(t){if(!this.isReady||this.activeBoost||t>=this.availableBoosts.length)return null;const e=this.availableBoosts[t];return this.activeBoost=e,this.isReady=!1,this.meterValue=0,this.scene.tweens.killTweensOf(this.readyText),this.scene.tweens.killTweensOf(this.meterBorder),this.scene.tweens.killTweensOf(this.anchorIcon),this.readyText.setVisible(!1),this.meterBorder.setScale(1),this.anchorIcon.setScale(1),this.scene.tweens.add({targets:this.choicePanel,alpha:0,duration:200}),this.updateMeterFill(),this.startBoostTimer(e),e}startBoostTimer(t){const s=e.BOOSTS[t];this.activeBoostText=this.scene.add.text(35,e.HEIGHT-60,s.name,{fontFamily:"Arial, sans-serif",fontSize:"12px",fontStyle:"bold",color:"#"+s.color.toString(16).padStart(6,"0")}).setDepth(100),this.boostTimerText=this.scene.add.text(35,e.HEIGHT-45,"6s",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#F1C40F"}).setDepth(100);let i=e.BOOST_DURATION/1e3;this.boostTimer=this.scene.time.addEvent({delay:1e3,repeat:i-1,callback:()=>{i--,this.boostTimerText&&this.boostTimerText.setText(i+"s")}}),this.scene.time.delayedCall(e.BOOST_DURATION,()=>{this.endBoost()})}endBoost(){const t=this.activeBoost;return this.activeBoost=null,this.boostTimerText&&(this.boostTimerText.destroy(),this.boostTimerText=null),this.activeBoostText&&(this.activeBoostText.destroy(),this.activeBoostText=null),this.boostTimer&&(this.boostTimer.remove(),this.boostTimer=null),t}getActiveBoost(){return this.activeBoost}isBoostActive(){return null!==this.activeBoost}destroy(){this.meterBg.destroy(),this.meterBorder.destroy(),this.meterFill.destroy(),this.label.destroy(),this.readyText.destroy(),this.anchorIcon.destroy(),this.choicePanel.destroy(),this.boostTimerText&&this.boostTimerText.destroy(),this.activeBoostText&&this.activeBoostText.destroy()}}class I{constructor(){this.audioContext=null,this.windSource=null,this.windGain=null,this.enabled=!0}init(){try{return this.audioContext=new(window.AudioContext||window.webkitAudioContext),!0}catch(t){return this.enabled=!1,!1}}resume(){this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume()}playSonarPing(t=!0){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,s=e.currentTime,i=e.createOscillator(),o=e.createGain();i.type="sine",t?(i.frequency.setValueAtTime(600,s),i.frequency.exponentialRampToValueAtTime(1200,s+.1),o.gain.setValueAtTime(.2,s)):(i.frequency.setValueAtTime(400,s),i.frequency.exponentialRampToValueAtTime(200,s+.15),o.gain.setValueAtTime(.15,s)),o.gain.exponentialRampToValueAtTime(.001,s+.3),i.connect(o),o.connect(e.destination),i.start(s),i.stop(s+.3)}playSuccessChime(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,e=t.currentTime;[523.25,659.25,783.99].forEach((s,i)=>{const o=t.createOscillator(),a=t.createGain();o.type="sine",o.frequency.setValueAtTime(s,e);const n=e+.08*i;a.gain.setValueAtTime(0,n),a.gain.linearRampToValueAtTime(.15,n+.02),a.gain.exponentialRampToValueAtTime(.001,n+.3),o.connect(a),a.connect(t.destination),o.start(n),o.stop(n+.3)})}playWarning(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,e=t.currentTime;for(let s=0;s<2;s++){const i=t.createOscillator(),o=t.createGain();i.type="sawtooth",i.frequency.setValueAtTime(200,e+.2*s),i.frequency.linearRampToValueAtTime(400,e+.2*s+.1),o.gain.setValueAtTime(.1,e+.2*s),o.gain.exponentialRampToValueAtTime(.001,e+.2*s+.15),i.connect(o),o.connect(t.destination),i.start(e+.2*s),i.stop(e+.2*s+.15)}}playBoostActivate(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,e=t.currentTime,s=t.createOscillator(),i=t.createGain();s.type="triangle",s.frequency.setValueAtTime(300,e),s.frequency.exponentialRampToValueAtTime(800,e+.2),i.gain.setValueAtTime(.2,e),i.gain.exponentialRampToValueAtTime(.001,e+.4),s.connect(i),i.connect(t.destination),s.start(e),s.stop(e+.4)}startWindAmbience(){if(!this.enabled||!this.audioContext||this.windSource)return;const t=this.audioContext,e=2*t.sampleRate,s=t.createBuffer(1,e,t.sampleRate),i=s.getChannelData(0);for(let a=0;a<e;a++)i[a]=2*Math.random()-1;this.windSource=t.createBufferSource(),this.windSource.buffer=s,this.windSource.loop=!0;const o=t.createBiquadFilter();o.type="bandpass",o.frequency.value=400,o.Q.value=.5,this.windGain=t.createGain(),this.windGain.gain.value=.03,this.windSource.connect(o),o.connect(this.windGain),this.windGain.connect(t.destination),this.windSource.start()}setWindIntensity(t){this.windGain&&this.windGain.gain.linearRampToValueAtTime(.03+.05*t,this.audioContext.currentTime+.1)}stopWindAmbience(){this.windSource&&(this.windSource.stop(),this.windSource=null,this.windGain=null)}playGameOver(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,e=t.currentTime,s=t.createOscillator(),i=t.createGain();s.type="sine",s.frequency.setValueAtTime(440,e),s.frequency.exponentialRampToValueAtTime(220,e+.5),i.gain.setValueAtTime(.2,e),i.gain.exponentialRampToValueAtTime(.001,e+.6),s.connect(i),i.connect(t.destination),s.start(e),s.stop(e+.6)}playComboSound(t){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,s=e.currentTime,i=400+100*t;if([i,1.25*i,1.5*i].forEach((i,o)=>{const a=e.createOscillator(),n=e.createGain();a.type=t>=4?"square":"sine",a.frequency.setValueAtTime(i,s+.05*o),n.gain.setValueAtTime(.15,s+.05*o),n.gain.exponentialRampToValueAtTime(.001,s+.05*o+.15),a.connect(n),n.connect(e.destination),a.start(s+.05*o),a.stop(s+.05*o+.15)}),t>=3){const i=e.createOscillator(),o=e.createGain();i.type="sine",i.frequency.setValueAtTime(2e3+200*t,s),i.frequency.exponentialRampToValueAtTime(3e3,s+.1),o.gain.setValueAtTime(.1,s),o.gain.exponentialRampToValueAtTime(.001,s+.15),i.connect(o),o.connect(e.destination),i.start(s),i.stop(s+.15)}}playPowerUpSound(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,e=t.currentTime;[800,1e3,1200,1500,1800].forEach((s,i)=>{const o=t.createOscillator(),a=t.createGain();o.type="sine",o.frequency.setValueAtTime(s,e+.03*i),a.gain.setValueAtTime(.12,e+.03*i),a.gain.exponentialRampToValueAtTime(.001,e+.03*i+.2),o.connect(a),a.connect(t.destination),o.start(e+.03*i),o.stop(e+.03*i+.2)})}playAchievementSound(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,e=t.currentTime;[{freq:523.25,time:0},{freq:659.25,time:.1},{freq:783.99,time:.2},{freq:1046.5,time:.35}].forEach(({freq:s,time:i})=>{const o=t.createOscillator(),a=t.createGain();o.type="triangle",o.frequency.setValueAtTime(s,e+i),a.gain.setValueAtTime(.2,e+i),a.gain.exponentialRampToValueAtTime(.001,e+i+.4),o.connect(a),a.connect(t.destination),o.start(e+i),o.stop(e+i+.4)})}playPhaseChange(t){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,s=e.currentTime,i=e.createBufferSource(),o=.5*e.sampleRate,a=e.createBuffer(1,o,e.sampleRate),n=a.getChannelData(0);for(let l=0;l<o;l++)n[l]=2*Math.random()-1;i.buffer=a;const r=e.createBiquadFilter();r.type="bandpass",r.frequency.setValueAtTime(200,s),r.frequency.exponentialRampToValueAtTime(2e3,s+.3),r.Q.value=1;const h=e.createGain();if(h.gain.setValueAtTime(.3,s),h.gain.exponentialRampToValueAtTime(.001,s+.5),i.connect(r),r.connect(h),h.connect(e.destination),i.start(s),i.stop(s+.5),3===t){const t=e.createOscillator(),i=e.createGain();t.type="sine",t.frequency.setValueAtTime(80,s),t.frequency.exponentialRampToValueAtTime(40,s+.3),i.gain.setValueAtTime(.4,s),i.gain.exponentialRampToValueAtTime(.001,s+.4),t.connect(i),i.connect(e.destination),t.start(s),t.stop(s+.4)}}playNearMiss(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,e=t.currentTime,s=t.createOscillator(),i=t.createGain();s.type="sine",s.frequency.setValueAtTime(300,e),s.frequency.exponentialRampToValueAtTime(600,e+.1),i.gain.setValueAtTime(.08,e),i.gain.exponentialRampToValueAtTime(.001,e+.15),s.connect(i),i.connect(t.destination),s.start(e),s.stop(e+.15)}destroy(){this.stopWindAmbience(),this.audioContext&&this.audioContext.close()}}class E extends Phaser.Scene{constructor(){super("Game")}init(){this.gameTime=0,this.phase=1,this.currentMultiplier=1,this.noiseModifier=0,this.spawnModifier=0,this.lastInsightSpawn=0,this.lastGateTime=0,this.signalFloodActive=!1,this.isGameOver=!1,this.isPaused=!1,this.stormsWeathered=0,this.insightsInLast30Sec=0,this.last30SecCheck=0,this.collectedNoFakes=!0,this.physics&&this.physics.resume(),this.time&&(this.time.paused=!1)}create(){this.soundGen=new I,this.soundGen.init(),this.waveEffect=new o(this),this.ship=new l(this,e.WIDTH/2,e.SHIP.START_Y),this.insights=this.add.group(),this.gates=[],this.inputManager=new m(this),this.scoreManager=new f(this),this.stormManager=new g(this),this.comboManager=new S(this),this.powerUpManager=new p(this),this.achievementNotification=new r(this);const t=Object.keys(e.BOOSTS),s=Phaser.Utils.Array.Shuffle([...t]);this.availableBoosts=s.slice(0,2),this.hud=new y(this),this.radarUI=new T(this),this.boostMeter=new C(this,this.availableBoosts),this.physics.add.overlap(this.ship,this.insights,this.collectInsight,null,this),this.physics.add.overlap(this.ship,this.powerUpManager.powerUps,(t,e)=>this.powerUpManager.collectPowerUp(e),null,this),this.events.on("gateSelected",this.onGateSelected,this),this.events.on("stormStarted",this.onStormStarted,this),this.events.on("stormEnded",this.onStormEnded,this),this.events.on("signalFlood",this.onSignalFlood,this),this.events.on("signalFloodEnd",this.onSignalFloodEnd,this),this.events.on("achievement",this.onAchievement,this),this.input.keyboard.on("keydown-H",()=>this.togglePauseHelp()),this.input.keyboard.on("keydown-ESC",()=>this.togglePauseHelp()),this.soundGen.startWindAmbience(),this.hud.showMessage("LOS GEHT'S!",1500);const i=n.getHighScore();i>0&&this.hud.setHighScore(i)}update(t,s){try{if(this.isGameOver||this.isPaused)return;if((isNaN(s)||s<=0)&&(s=16),s=Math.min(s,100),this.gameTime+=s,(isNaN(this.gameTime)||this.gameTime<0)&&(this.gameTime=0),this.gameTime>=e.GAME_DURATION-100)return void this.endGame();this.updatePhase();const i=this.inputManager.getInput();this.ship.update(s,i),i.boost&&this.activateBoost(),this.spawnInsights(),this.spawnGates(),this.stormManager.update(this.gameTime,s).active?(this.waveEffect.setIntensity(.5),this.soundGen.setWindIntensity(.5)):(this.waveEffect.setIntensity(0),this.soundGen.setWindIntensity(0)),this.gates=this.gates.filter(t=>!t.update(s)||(t.destroy(),!1)),this.insights.children.iterate(t=>{t&&t.update(s)}),this.powerUpManager.update(s),"NAVIGATOR"===this.boostMeter.getActiveBoost()&&this.insights.children.iterate(t=>{t&&t.isReal&&t.setHighlighted(!0)}),this.checkNearMisses(),this.waveEffect.update(t);const o=this.comboManager.getMultiplier()||1,a=this.powerUpManager.getMultiplier()||1,n=(this.currentMultiplier||1)*o*a;this.hud.update(this.gameTime,this.scoreManager.getScore(),n,this.scoreManager.getQualityRatio(),this.phase,this.comboManager.getCombo()),this.inputManager.isMobile&&this.inputManager.setBoostReady(this.boostMeter.isReady),this.gameTime-this.last30SecCheck>=3e4&&(this.insightsInLast30Sec>=50&&this.events.emit("achievement","SPEED_RUN"),this.insightsInLast30Sec=0,this.last30SecCheck=this.gameTime)}catch(i){}}updatePhase(){let t=1;if(this.gameTime>=e.PHASE_2_END?t=3:this.gameTime>=e.PHASE_1_END&&(t=2),t!==this.phase){this.phase=t,this.hud.showMessage(`PHASE ${this.phase}`,1500),this.soundGen.playPhaseChange(this.phase);const e=s[this.phase];this.stormManager.setStormChance(e.stormChance)}}spawnInsights(){const t=s[this.phase];let i=e.INSIGHT.SPAWN_INTERVAL_BASE*t.insightSpawnRate;if(i*=1+this.spawnModifier,this.signalFloodActive&&(i*=.3),this.gameTime-this.lastInsightSpawn<i)return;if(this.lastInsightSpawn=this.gameTime,Math.random()<e.POWERUPS.SPAWN_CHANCE){const t=Phaser.Math.Between(100,e.WIDTH-100);return void this.powerUpManager.spawnPowerUp(t)}let o=t.realChance-this.noiseModifier;o=Math.max(.3,o),this.signalFloodActive&&(o=.3);const a=Math.random()<o,n=Phaser.Math.Between(50,e.WIDTH-50),r=new c(this,n,-30,a);r.setVelocityY(e.INSIGHT.SPEED_BASE*t.insightSpeed),this.insights.add(r),this.radarUI.addPing(n,-30,a)}spawnGates(){if(this.gameTime<e.GATE_INTERVAL)return;if(this.gameTime-this.lastGateTime<e.GATE_INTERVAL)return;if(this.gates.length>0)return;this.lastGateTime=this.gameTime;const t=new d(this);this.gates.push(t)}collectInsight(t,s){if(s.collected)return;if(!s.collect())return;const i=s.isReal;let o=s.getPoints(),a=s.getMeterValue();i||(this.collectedNoFakes=!1),i||"ANALYST"!==this.boostMeter.getActiveBoost()||(o=0,a=5),!i&&this.powerUpManager.isActive("SHIELD")&&(o=0,a=0,this.hud.showMessage("GEBLOCKT!",500));const n=this.comboManager.addCombo(t.x,t.y,i),r=this.currentMultiplier*n*this.powerUpManager.getMultiplier();o=Math.round(o*r),this.scoreManager.addInsight(i,r),i&&this.insightsInLast30Sec++,this.boostMeter.addValue(a),this.hud.showPointsPopup(t.x,t.y-30,o),t.flash(i?e.COLORS.INSIGHT_REAL:e.COLORS.INSIGHT_FAKE),this.soundGen.playSonarPing(i)}checkNearMisses(){const t=this.ship;this.insights.children.iterate(e=>{if(!e||e.isReal||e.nearMissTriggered)return;const s=Phaser.Math.Distance.Between(t.x,t.y,e.x,e.y);if(s<40&&s>25){e.nearMissTriggered=!0,this.soundGen.playNearMiss();const t=10;this.scoreManager.addBonus(t),this.hud.showPointsPopup(e.x,e.y-20,t);const s=this.add.text(e.x,e.y-30,"NICE!",{fontFamily:"Arial",fontSize:"14px",color:"#F39C12"}).setOrigin(.5).setDepth(100);this.tweens.add({targets:s,y:e.y-60,alpha:0,duration:600,onComplete:()=>s.destroy()})}})}activateBoost(){const t=this.boostMeter.activateBoost(0)||this.boostMeter.activateBoost(1);if(!t)return;switch(this.soundGen.playBoostActivate(),this.hud.showMessage(`${e.BOOSTS[t].name} AKTIVIERT!`,1e3),t){case"CAPTAIN":this.ship.setStabilized(!0),this.time.delayedCall(e.BOOST_DURATION,()=>{this.ship.setStabilized(!1)});break;case"CREW_SYNC":this.currentMultiplier+=1,this.time.delayedCall(e.BOOST_DURATION,()=>{this.currentMultiplier-=1})}const s=this.checkBoostEffectiveness(t);this.scoreManager.addBoostUsage(s)}checkBoostEffectiveness(t){const e=this.stormManager.getActiveStorm();return"NAVIGATOR"===t&&("FOG"===e||"SIGNAL_FLOOD"===e)||"CAPTAIN"===t&&"CROSSWIND"===e||"ANALYST"===t&&"SIGNAL_FLOOD"===e}onGateSelected(t){this.soundGen.playSuccessChime();const s=e.GATES[t];this.currentMultiplier*=s.multiplier,this.scoreManager.addGateChoice(t),s.noiseIncrease&&(this.noiseModifier+=s.noiseIncrease),s.noiseReduction&&(this.noiseModifier-=s.noiseReduction),s.stormChanceIncrease&&this.stormManager.adjustStormChance(s.stormChanceIncrease),s.stormChanceReduction&&this.stormManager.adjustStormChance(-s.stormChanceReduction),s.spawnReduction&&(this.spawnModifier+=s.spawnReduction),this.scoreManager.gateChoices.length>=5&&this.events.emit("achievement","PERFECT_GATE")}onStormStarted(t){this.soundGen.playWarning()}onStormEnded(t){this.stormsWeathered++,this.stormsWeathered>=3&&this.events.emit("achievement","SURVIVOR")}onSignalFlood(t){this.signalFloodActive=!0}onSignalFloodEnd(){this.signalFloodActive=!1}onAchievement(t){this.achievementNotification.show(t)}togglePauseHelp(){if(!this.isGameOver)if(this.isPaused=!this.isPaused,this.isPaused){this.physics.pause(),this.time.paused=!0,this.pauseOverlay=this.add.rectangle(e.WIDTH/2,e.HEIGHT/2,e.WIDTH,e.HEIGHT,0,.85).setDepth(200),this.pauseContainer=this.add.container(e.WIDTH/2,e.HEIGHT/2).setDepth(201);const t=this.add.text(0,-200,"PAUSE",{fontFamily:"Arial, sans-serif",fontSize:"36px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5);this.pauseContainer.add(t);let s=-140;[{title:"STEUERUNG",items:["‚Üê ‚Üí oder A/D: Boot steuern","H oder ESC: Pause/Hilfe"]},{title:"INSIGHTS & POWER-UPS",items:["‚óè Gr√ºn = Echte Insights (+Punkte)","‚óè Rot = Fake/Noise (ausweichen!)","‚¨° Power-Ups: Einsammeln = sofort aktiv!"]},{title:"BOOST-METER (links)",items:["F√ºllt sich durch Insight-Sammeln",'Bei 100%: "BEREIT!" erscheint',"‚Üí Dr√ºcke Q oder E f√ºr Crew-Boost!","Navigator/Captain/Analyst/Crew Sync"]},{title:"STRATEGY GATES (alle ~15 Sek.)",items:["Erscheint oben - KLICKE oder 1/2/3:","SPEED | QUALITY | SAFETY"]}].forEach(t=>{const e=this.add.text(-200,s,t.title,{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#F1C40F"});this.pauseContainer.add(e),s+=20,t.items.forEach(t=>{const e=this.add.text(-200,s,t,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#BDC3C7"});this.pauseContainer.add(e),s+=18}),s+=10});const i=this.add.rectangle(0,180,180,40,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.togglePauseHelp());this.pauseContainer.add(i);const o=this.add.text(0,180,"WEITERSPIELEN",{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5);this.pauseContainer.add(o);const a=this.add.text(0,215,"H oder ESC zum Fortsetzen",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#7F8C8D"}).setOrigin(.5);this.pauseContainer.add(a)}else this.physics.resume(),this.time.paused=!1,this.pauseOverlay&&(this.pauseOverlay.destroy(),this.pauseOverlay=null),this.pauseContainer&&(this.pauseContainer.destroy(),this.pauseContainer=null)}endGame(){if(this.isGameOver)return;this.isGameOver=!0;try{this.soundGen.playGameOver(),this.soundGen.stopWindAmbience()}catch(e){}let t={};try{const e=this.ship?this.ship.getStabilityScore():50;t=this.scoreManager.getStats(e),t.maxCombo=this.comboManager?this.comboManager.getMaxCombo():0,t.totalInsights=(t.realInsights||0)+(t.fakeInsights||0),this.collectedNoFakes&&t.totalInsights>10&&(n.unlockAchievement("NO_FAKE"),t.noFakeAchievement=!0),0===n.getStats().gamesPlayed&&n.unlockAchievement("FIRST_GAME");const s=n.updateHighScore(t.finalScore);t.isNewHighScore=s,s&&n.unlockAchievement("HIGH_SCORE"),n.addGameStats(t)}catch(e){t={finalScore:this.scoreManager?this.scoreManager.getScore():0,realInsights:0,fakeInsights:0,maxCombo:0,totalInsights:0}}window._gameEndStats=t,this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("End",t)}),setTimeout(()=>{this.scene&&this.scene.isActive("Game")&&this.scene.start("End",window._gameEndStats||t)},500)}shutdown(){this.events.off("gateSelected"),this.events.off("stormStarted"),this.events.off("stormEnded"),this.events.off("signalFlood"),this.events.off("signalFloodEnd"),this.events.off("achievement"),this.inputManager.destroy(),this.stormManager.destroy(),this.comboManager.destroy(),this.powerUpManager.destroy(),this.achievementNotification.destroy(),this.hud.destroy(),this.radarUI.destroy(),this.boostMeter.destroy(),this.waveEffect.destroy(),this.soundGen.destroy()}}const w=new class{constructor(){this.isConfigured=t,this.baseUrl="https://smmngegesumuokmrdujx.supabase.co",this.apiKey=t,this.cachedLeaderboard=null,this.lastFetch=0,this.cacheTimeout=3e4}submitScore(t,e){return __async(this,arguments,function*(t,e,s={}){if(!this.isConfigured)return{success:!1,error:"not_configured"};const i={player_name:t.substring(0,20).replace(/[<>]/g,""),score:Math.floor(e),max_combo:s.maxCombo||0,achievements:s.achievements||[],strategy_profile:s.strategyProfile||"Balanced"};try{const t=yield fetch(`${this.baseUrl}/rest/v1/leaderboard`,{method:"POST",headers:{"Content-Type":"application/json",apikey:this.apiKey,Authorization:`Bearer ${this.apiKey}`,Prefer:"return=representation"},body:JSON.stringify(i)});if(!t.ok)throw new Error(`HTTP ${t.status}`);const e=yield t.json();return this.cachedLeaderboard=null,{success:!0,data:e}}catch(o){return{success:!1,error:o.message}}})}getTopScores(t=10){return __async(this,null,function*(){if(!this.isConfigured)return{success:!1,scores:[],error:"not_configured"};const e=Date.now();if(this.cachedLeaderboard&&e-this.lastFetch<this.cacheTimeout)return{success:!0,scores:this.cachedLeaderboard,cached:!0};try{const s=yield fetch(`${this.baseUrl}/rest/v1/leaderboard?select=player_name,score,max_combo,strategy_profile,created_at&order=score.desc&limit=${t}`,{headers:{apikey:this.apiKey,Authorization:`Bearer ${this.apiKey}`}});if(!s.ok)throw new Error(`HTTP ${s.status}`);const i=yield s.json();return this.cachedLeaderboard=i,this.lastFetch=e,{success:!0,scores:i}}catch(s){return{success:!1,scores:[],error:s.message}}})}getPlayerRank(t){return __async(this,null,function*(){if(!this.isConfigured)return{success:!1,rank:null};try{const e=(yield fetch(`${this.baseUrl}/rest/v1/leaderboard?select=count&score=gte.${t}`,{headers:{apikey:this.apiKey,Authorization:`Bearer ${this.apiKey}`,Prefer:"count=exact"}})).headers.get("content-range");return{success:!0,rank:e?parseInt(e.split("/")[1]):null}}catch(e){return{success:!1,rank:null}}})}isAvailable(){return this.isConfigured}};class b extends Phaser.Scene{constructor(){super("End")}init(t){this.stats=t||{},this.nameEntered=!1,this.submittedScore=!1,this.isEnteringName=!1}create(){this.add.rectangle(e.WIDTH/2,e.HEIGHT/2,e.WIDTH,e.HEIGHT,e.COLORS.BACKGROUND),this.createCourseReport(),this.createLeaderboardSection(),this.createCTAButtons(),this.add.text(e.WIDTH/2,e.HEIGHT-15,"SPACE = Neues Spiel",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#5D6D7E"}).setOrigin(.5),this.input.keyboard.on("keydown-SPACE",()=>{this.isEnteringName||this.restartGame()}),this.cameras.main.fadeIn(500),this.loadLeaderboard()}createCourseReport(){const t=200;this.add.text(t,60,"COURSE REPORT",{fontFamily:"Arial, sans-serif",fontSize:"24px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5);const e=this.stats.resultType||"Game Over";this.add.text(t,95,e,{fontFamily:"Arial, sans-serif",fontSize:"18px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5),this.add.text(t,130,"FINAL SCORE",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5);const s=this.stats.finalScore||0;this.add.text(t,160,s.toLocaleString(),{fontFamily:"Arial, sans-serif",fontSize:"42px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(.5),this.createStatBox(100,220,"QUALIT√ÑT",`${this.stats.qualityScore||0}%`,this.getQualityColor(this.stats.qualityScore||0)),this.createStatBox(t,220,"STABILIT√ÑT",`${this.stats.stabilityScore||0}%`,this.getQualityColor(this.stats.stabilityScore||0)),this.createStatBox(300,220,"STRATEGIE",this.stats.strategyProfile||"Balanced","#9B59B6");const i=this.stats.realInsights||0,o=this.stats.fakeInsights||0;this.add.text(t,290,`${i} echte / ${o} falsche Insights`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5);const a=this.stats.multiplier||"1.00";this.add.text(t,310,`Multiplikator: x${a}`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5),this.stats.isNewHighScore&&this.add.text(t,205,"‚òÖ NEUER HIGHSCORE! ‚òÖ",{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(.5)}createStatBox(t,e,s,i,o){this.add.text(t,e,s,{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5),this.add.text(t,e+20,i,{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:o}).setOrigin(.5)}getQualityColor(t){return t>=70?"#2ECC71":t>=40?"#F39C12":"#E74C3C"}createLeaderboardSection(){const t=e.WIDTH-170;this.add.rectangle(t,e.HEIGHT/2-50,260,e.HEIGHT-150,859964,.8).setStrokeStyle(1,1752220,.5),this.add.text(t,60,"LEADERBOARD",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5),this.leaderboardLoading=this.add.text(t,140,"Laden...",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5),this.leaderboardContainer=this.add.container(t-110,90),w.isAvailable()&&this.createNameInput(t,e.HEIGHT-120)}createNameInput(t,e){this.add.text(t,e-35,"Name f√ºr Leaderboard:",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#F1C40F"}).setOrigin(.5),this.add.rectangle(t,e,180,28,1714746).setStrokeStyle(2,1752220),this.playerName="",this.nameText=this.add.text(t,e,"|",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ECF0F1"}).setOrigin(.5),this.add.rectangle(t,e+30,100,24,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.submitScore()),this.add.text(t,e+30,"EINTRAGEN",{fontFamily:"Arial, sans-serif",fontSize:"11px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5),this.isEnteringName=!0,this.input.keyboard.on("keydown",t=>{this.isEnteringName&&!this.submittedScore&&("Enter"===t.key?this.submitScore():"Backspace"===t.key?this.playerName=this.playerName.slice(0,-1):1===t.key.length&&this.playerName.length<12&&/^[a-zA-Z0-9_\-\. ]$/.test(t.key)&&(this.playerName+=t.key),this.nameText.setText(this.playerName+"|"))}),this.time.addEvent({delay:500,callback:()=>{if(this.nameText&&this.isEnteringName&&!this.submittedScore){const t=this.nameText.text.endsWith("|")?"":"|";this.nameText.setText(this.playerName+t)}},loop:!0})}submitScore(){return __async(this,null,function*(){if(this.submittedScore||!this.playerName.trim())return;const t=this.playerName.trim()||"Anonym",e=this.stats.finalScore||0;this.submittedScore=!0,this.isEnteringName=!1,this.nameText.setText(t+" ...");const s=yield w.submitScore(t,e,{maxCombo:this.stats.maxCombo||0,strategyProfile:this.stats.strategyProfile||"Balanced"});s.success?(this.nameText.setText(t+" ‚úì"),this.loadLeaderboard()):this.nameText.setText(t+" ‚úó "+(s.error||""))})}loadLeaderboard(){return __async(this,null,function*(){const t=yield w.getTopScores(8);if(this.leaderboardLoading&&(this.leaderboardLoading.destroy(),this.leaderboardLoading=null),this.leaderboardContainer.removeAll(!0),!t.success||0===t.scores.length){const e=t.success?"Noch keine Eintr√§ge":"Nicht verf√ºgbar: "+(t.error||""),s=this.add.text(110,50,e,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#7F8C8D"}).setOrigin(.5);return void this.leaderboardContainer.add(s)}t.scores.forEach((t,e)=>{const s=24*e,i=t.score===this.stats.finalScore&&this.submittedScore,o=0===e?"#F1C40F":1===e?"#BDC3C7":2===e?"#CD7F32":"#7F8C8D",a=this.add.text(0,s,`${e+1}.`,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:o}),n=this.add.text(22,s,t.player_name.substring(0,10),{fontFamily:"Arial, sans-serif",fontSize:"11px",color:i?"#1ABC9C":"#ECF0F1"}),r=this.add.text(220,s,t.score.toLocaleString(),{fontFamily:"Arial, sans-serif",fontSize:"11px",color:i?"#1ABC9C":"#F1C40F"}).setOrigin(1,0);this.leaderboardContainer.add([a,n,r])})})}createCTAButtons(){const t=e.HEIGHT-55;this.createButton(110,t,160,36,"Gespr√§ch vereinbaren",e.COLORS.ACCENT,()=>window.open("https://www.flybridge.ch/kontakt","_blank")),this.createButton(290,t,160,36,"Mehr erfahren",3426654,()=>window.open("https://www.flybridge.ch","_blank"))}createButton(t,e,s,i,o,a,n){const r=this.add.rectangle(t,e,s,i,a).setInteractive({useHandCursor:!0}).on("pointerover",()=>r.setScale(1.05)).on("pointerout",()=>r.setScale(1)).on("pointerdown",n);this.add.text(t,e,o,{fontFamily:"Arial, sans-serif",fontSize:"12px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5)}restartGame(){this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>{this.scene.start("Menu")})}}const x={type:Phaser.AUTO,parent:"game-container",width:e.WIDTH,height:e.HEIGHT,backgroundColor:e.COLORS.BACKGROUND,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,min:{width:320,height:240},max:{width:1600,height:1200}},physics:{default:"arcade",arcade:{debug:!1}},scene:[i,h,E,b],input:{activePointers:2}},A=new Phaser.Game(x);window.FlybridgeRadarRun={game:A,restart:()=>{A.scene.start("Menu")}}}();
