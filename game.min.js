var __defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(t,e,i)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,__spreadValues=(t,e)=>{for(var i in e||(e={}))__hasOwnProp.call(e,i)&&__defNormalProp(t,i,e[i]);if(__getOwnPropSymbols)for(var i of __getOwnPropSymbols(e))__propIsEnum.call(e,i)&&__defNormalProp(t,i,e[i]);return t},__async=(t,e,i)=>new Promise((s,o)=>{var a=t=>{try{r(i.next(t))}catch(e){o(e)}},n=t=>{try{r(i.throw(t))}catch(e){o(e)}},r=t=>t.done?s(t.value):Promise.resolve(t.value).then(a,n);r((i=i.apply(t,e)).next())});!function(){"use strict";const t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNtbW5nZWdlc3VtdW9rbXJkdWp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyNzIzMDMsImV4cCI6MjA4Mzg0ODMwM30.0tG0QyjReEMh8QXpmaR-vgPa7mGEPENCUaVTZ_Dz6pA",e={WIDTH:1280,HEIGHT:720,GAME_DURATION:9e4,PHASE_1_END:25e3,PHASE_2_END:6e4,GATE_INTERVAL:15e3,STORM_MIN_INTERVAL:12e3,STORM_MAX_INTERVAL:2e4,STORM_DURATION:4e3,BOOST_DURATION:6e3,SHIP:{SPEED:300,DRIFT_SPEED:150,START_Y:500,BOUNDS_MARGIN:40},INSIGHT:{SPAWN_INTERVAL_BASE:800,SPAWN_INTERVAL_MIN:400,SPEED_BASE:150,SPEED_MAX:250,REAL_CHANCE_BASE:.7,REAL_CHANCE_MIN:.4,POINTS_REAL:100,POINTS_FAKE:-30,METER_FILL_REAL:15,METER_FILL_FAKE:-5},COMBO:{TIMEOUT:2e3,MULTIPLIERS:[1,1.2,1.5,2,2.5,3],SHAKE_INTENSITY:[0,2,4,6,8,10],PARTICLE_COUNT:[3,5,8,12,16,20]},POWERUPS:{SPAWN_CHANCE:.15,DURATION:8e3,TYPES:{MAGNET:{name:"Magnet",color:10181046,radius:150,description:"Zieht Insights an"},SHIELD:{name:"Schild",color:3447003,description:"Blockiert Fake-Schaden"},DOUBLE:{name:"2x Punkte",color:15844367,multiplier:2,description:"Doppelte Punkte"},GOLDEN:{name:"Golden Insight",color:16766720,points:500,description:"Mega-Punkte!"}}},ACHIEVEMENTS:{COMBO_5:{id:"combo_5",name:"Combo Master",description:"5er Combo erreichen",icon:"ðŸ”¥"},COMBO_10:{id:"combo_10",name:"Combo Legend",description:"10er Combo erreichen",icon:"ðŸ’¥"},NO_FAKE:{id:"no_fake",name:"Scharfes Auge",description:"Kein Fake gesammelt",icon:"ðŸ‘ï¸"},PERFECT_GATE:{id:"perfect_gate",name:"Stratege",description:"Alle Gates gewÃ¤hlt",icon:"ðŸŽ¯"},HIGH_SCORE:{id:"high_score",name:"Highscore!",description:"Neuer persÃ¶nlicher Rekord",icon:"ðŸ†"},FIRST_GAME:{id:"first_game",name:"Willkommen",description:"Erstes Spiel abgeschlossen",icon:"âš“"},SPEED_RUN:{id:"speed_run",name:"Turbo",description:"50 Insights in 30 Sekunden",icon:"âš¡"},SURVIVOR:{id:"survivor",name:"Ãœberlebender",description:"3 StÃ¼rme Ã¼berstanden",icon:"ðŸŒŠ"}},GATES:{SPEED:{name:"Speed",color:15158332,multiplier:1.5,noiseIncrease:.15,stormChanceIncrease:.1},QUALITY:{name:"Quality",color:3066993,multiplier:1,insightQualityBonus:.2,spawnReduction:.3},SAFETY:{name:"Safety",color:3447003,multiplier:.8,stormChanceReduction:.3,noiseReduction:.1}},BOOSTS:{NAVIGATOR:{name:"Navigator",description:"Zeigt echte Insights klar markiert",color:1752220},ANALYST:{name:"Analyst",description:"Noise wird neutral",color:10181046},CAPTAIN:{name:"Captain",description:"Weniger Drift bei Sturm",color:15965202},CREW_SYNC:{name:"Crew Sync",description:"+1 Multiplikator fÃ¼r saubere Fahrt",color:15277667}},STORMS:{FOG:{name:"Nebel",radarBlur:.6},CROSSWIND:{name:"Seitenwind",driftForce:200},SIGNAL_FLOOD:{name:"Signal Flood",spawnMultiplier:3,noiseRatio:.7},NARROW_PASS:{name:"Engpass",passWidth:200}},COLORS:{BACKGROUND:661032,WATER_DARK:859964,WATER_LIGHT:1718876,ACCENT:1752220,INSIGHT_REAL:3066993,INSIGHT_FAKE:15158332,UI_TEXT:15528177,UI_DARK:2899536},SCORING:{QUALITY_BONUS_THRESHOLD:.7,QUALITY_BONUS_MULTIPLIER:1.5,STABILITY_BONUS_MAX:500,BOOST_EFFICIENCY_BONUS:200},SHIP_SKINS:{DEFAULT:{id:"default",name:"Standard",hullColor:1752220,cabinColor:15528177,accentColor:1482885,unlockPoints:0,icon:"â›µ"},BRONZE:{id:"bronze",name:"Bronze",hullColor:13467442,cabinColor:16770229,accentColor:9127187,unlockPoints:1e4,icon:"ðŸ¥‰"},SILVER:{id:"silver",name:"Silber",hullColor:12632256,cabinColor:16777215,accentColor:8421504,unlockPoints:25e3,icon:"ðŸ¥ˆ"},GOLD:{id:"gold",name:"Gold",hullColor:16766720,cabinColor:16775885,accentColor:14329120,unlockPoints:5e4,icon:"ðŸ¥‡"},DIAMOND:{id:"diamond",name:"Diamant",hullColor:49151,cabinColor:14745599,accentColor:2003199,unlockPoints:1e5,icon:"ðŸ’Ž"},RUBY:{id:"ruby",name:"Rubin",hullColor:14684511,cabinColor:16758465,accentColor:10162462,unlockPoints:2e5,icon:"ðŸ’ "}}},i={1:{insightSpawnRate:1,insightSpeed:1,realChance:e.INSIGHT.REAL_CHANCE_BASE,stormChance:0},2:{insightSpawnRate:.8,insightSpeed:1.2,realChance:.6,stormChance:.3},3:{insightSpawnRate:.6,insightSpeed:1.5,realChance:.5,stormChance:.5}};class s extends Phaser.Scene{constructor(){super("Boot")}create(){this.generateTextures(),this.scene.start("Menu")}generateTextures(){this.generateShipTextures(),this.generateInsightTextures(),this.generateBuoyTexture(),this.generateRadarSweep(),this.generateGateTextures(),this.generateBoostIcons()}generateShipTextures(){this.generateShipTexture();const t=e.SHIP_SKINS;Object.keys(t).forEach(e=>{const i=t[e];this.generateShipTextureWithColors(i.id,i.hullColor,i.cabinColor,i.accentColor)})}generateShipTexture(){const t=this.add.graphics(),i=28;t.fillStyle(661032,.4),t.fillEllipse(i,66,44,10),t.fillStyle(15528177),t.beginPath(),t.moveTo(i,4),t.lineTo(34,8),t.lineTo(42,20),t.lineTo(44,45),t.lineTo(42,58),t.lineTo(32,62),t.lineTo(24,62),t.lineTo(14,58),t.lineTo(12,45),t.lineTo(14,20),t.lineTo(22,8),t.closePath(),t.fillPath(),t.fillStyle(2899536),t.beginPath(),t.moveTo(42,52),t.lineTo(44,45),t.lineTo(44,55),t.lineTo(42,60),t.lineTo(14,60),t.lineTo(12,55),t.lineTo(12,45),t.lineTo(14,52),t.closePath(),t.fillPath(),t.fillStyle(12436423,.5),t.beginPath(),t.moveTo(i,6),t.lineTo(23,10),t.lineTo(15,22),t.lineTo(13,44),t.lineTo(15,56),t.lineTo(25,60),t.lineTo(i,60),t.lineTo(i,6),t.closePath(),t.fillPath(),t.fillStyle(9139029),t.beginPath(),t.moveTo(i,12),t.lineTo(38,22),t.lineTo(40,44),t.lineTo(38,54),t.lineTo(18,54),t.lineTo(16,44),t.lineTo(18,22),t.closePath(),t.fillPath(),t.lineStyle(1,7033668,.3);for(let e=-8;e<=8;e+=4)t.lineBetween(i+e,24,i+e,52);t.fillStyle(16777215),t.fillRoundedRect(18,26,20,20,3),t.fillStyle(15528177),t.fillRoundedRect(17,24,22,6,2),t.fillStyle(6139362,.9),t.fillRoundedRect(21,28,6,5,1),t.fillRoundedRect(29,28,6,5,1),t.fillStyle(8765929,.7),t.fillRect(18,32,2,8),t.fillRect(36,32,2,8),t.fillStyle(16777215),t.fillRoundedRect(20,16,16,10,2),t.lineStyle(1,9807270),t.strokeRect(21,17,14,8),t.fillStyle(2899536),t.fillCircle(25,21,2),t.fillCircle(31,21,2),t.fillStyle(3426654),t.fillRect(26,17,4,3),t.fillStyle(8359053),t.fillRect(27,6,2,12),t.fillStyle(16777215),t.fillCircle(i,6,4),t.fillStyle(e.COLORS.ACCENT,.6),t.fillCircle(i,6,3),t.lineStyle(1,1752220),t.strokeCircle(i,6,4),t.fillStyle(9139029),t.fillRect(20,60,16,4),t.fillStyle(2899536),t.fillRect(22,62,4,5),t.fillRect(30,62,4,5),t.fillStyle(1710618),t.fillRect(23,65,2,3),t.fillRect(31,65,2,3),t.fillStyle(3066993),t.fillCircle(40,22,2),t.fillStyle(15158332),t.fillCircle(16,22,2),t.fillStyle(16777215),t.fillCircle(i,10,1.5),t.generateTexture("ship",56,70),t.destroy()}generateShipTextureWithColors(t,e,i,s){const o=this.add.graphics(),a=28,n=(t,e)=>Math.max(0,(t>>16&255)-e)<<16|Math.max(0,(t>>8&255)-e)<<8|Math.max(0,(255&t)-e);o.fillStyle(661032,.4),o.fillEllipse(a,66,44,10),o.fillStyle(e),o.beginPath(),o.moveTo(a,4),o.lineTo(34,8),o.lineTo(42,20),o.lineTo(44,45),o.lineTo(42,58),o.lineTo(32,62),o.lineTo(24,62),o.lineTo(14,58),o.lineTo(12,45),o.lineTo(14,20),o.lineTo(22,8),o.closePath(),o.fillPath(),o.fillStyle(n(e,60)),o.beginPath(),o.moveTo(42,52),o.lineTo(44,45),o.lineTo(44,55),o.lineTo(42,60),o.lineTo(14,60),o.lineTo(12,55),o.lineTo(12,45),o.lineTo(14,52),o.closePath(),o.fillPath(),o.fillStyle(n(e,30),.5),o.beginPath(),o.moveTo(a,6),o.lineTo(23,10),o.lineTo(15,22),o.lineTo(13,44),o.lineTo(15,56),o.lineTo(25,60),o.lineTo(a,60),o.lineTo(a,6),o.closePath(),o.fillPath(),o.fillStyle(9139029),o.beginPath(),o.moveTo(a,12),o.lineTo(38,22),o.lineTo(40,44),o.lineTo(38,54),o.lineTo(18,54),o.lineTo(16,44),o.lineTo(18,22),o.closePath(),o.fillPath(),o.lineStyle(1,7033668,.3);for(let r=-8;r<=8;r+=4)o.lineBetween(a+r,24,a+r,52);o.fillStyle(i),o.fillRoundedRect(18,26,20,20,3),o.fillStyle(n(i,20)),o.fillRoundedRect(17,24,22,6,2),o.fillStyle(6139362,.9),o.fillRoundedRect(21,28,6,5,1),o.fillRoundedRect(29,28,6,5,1),o.fillStyle(8765929,.7),o.fillRect(18,32,2,8),o.fillRect(36,32,2,8),o.fillStyle(i),o.fillRoundedRect(20,16,16,10,2),o.lineStyle(1,9807270),o.strokeRect(21,17,14,8),o.fillStyle(s),o.fillCircle(25,21,2),o.fillCircle(31,21,2),o.fillStyle(n(s,40)),o.fillRect(26,17,4,3),o.fillStyle(8359053),o.fillRect(27,6,2,12),o.fillStyle(i),o.fillCircle(a,6,4),o.fillStyle(s,.6),o.fillCircle(a,6,3),o.lineStyle(1,s),o.strokeCircle(a,6,4),o.fillStyle(9139029),o.fillRect(20,60,16,4),o.fillStyle(2899536),o.fillRect(22,62,4,5),o.fillRect(30,62,4,5),o.fillStyle(1710618),o.fillRect(23,65,2,3),o.fillRect(31,65,2,3),o.fillStyle(3066993),o.fillCircle(40,22,2),o.fillStyle(15158332),o.fillCircle(16,22,2),o.fillStyle(16777215),o.fillCircle(a,10,1.5),o.generateTexture(`ship-${t}`,56,70),o.destroy()}generateInsightTextures(){const t=40,i=20,s=this.add.graphics();s.fillStyle(3066993,.08),s.fillCircle(i,i,18),s.fillStyle(3066993,.12),s.fillCircle(i,i,15),s.fillStyle(3066993,.2),s.fillCircle(i,i,12),s.fillStyle(e.COLORS.INSIGHT_REAL,.9),s.fillCircle(i,i,10),s.lineStyle(2,2600544),s.strokeCircle(i,i,10),s.fillStyle(5822093,.7),s.fillCircle(i,i,6),s.fillStyle(8577194,.8),s.fillCircle(i,i,3),s.fillStyle(16777215,.4),s.fillCircle(17,17,2),s.generateTexture("insight-real",t,t),s.destroy();const o=this.add.graphics();o.fillStyle(15158332,.06),o.fillCircle(21,i,16),o.fillStyle(15158332,.1),o.fillCircle(19,21,14),o.fillStyle(15158332,.15),o.fillCircle(i,i,11),o.fillStyle(e.COLORS.INSIGHT_FAKE,.8),o.fillCircle(i,i,8),o.lineStyle(2,12597547),o.strokeCircle(i,i,8),o.fillStyle(15037299,.5),o.fillCircle(18,18,3),o.fillStyle(15832202,.4),o.fillCircle(22,21,2),o.generateTexture("insight-fake",t,t),o.destroy();const a=this.add.graphics();a.fillStyle(15844367,.15),a.fillCircle(i,i,19),a.fillStyle(15844367,.25),a.fillCircle(i,i,16),a.lineStyle(3,15844367,.9),a.strokeCircle(i,i,14),a.fillStyle(3066993,.2),a.fillCircle(i,i,12),a.fillStyle(e.COLORS.INSIGHT_REAL,.95),a.fillCircle(i,i,10),a.lineStyle(2,2600544),a.strokeCircle(i,i,10),a.fillStyle(5822093,.8),a.fillCircle(i,i,6),a.fillStyle(11267014,.9),a.fillCircle(i,i,3),a.generateTexture("insight-highlighted",t,t),a.destroy()}generateBuoyTexture(){const t=this.add.graphics();t.fillStyle(15158332),t.fillRoundedRect(4,0,12,30,4),t.fillStyle(16777215),t.fillRect(4,10,12,8),t.fillStyle(12597547),t.fillCircle(10,4,6),t.generateTexture("buoy",20,34),t.destroy()}generateRadarSweep(){const t=this.add.graphics(),i=100;for(let s=0;s<60;s++){const o=(60-s)/60*.4,a=-s*(Math.PI/180);t.lineStyle(3,e.COLORS.ACCENT,o),t.beginPath(),t.moveTo(i,i),t.lineTo(i+90*Math.cos(a),i+90*Math.sin(a)),t.strokePath()}t.generateTexture("radar-sweep",200,200),t.destroy()}generateGateTextures(){const t=[15158332,3066993,3447003];["SPEED","QUALITY","SAFETY"].forEach((e,i)=>{const s=this.add.graphics();s.lineStyle(4,t[i],.9),s.strokeRoundedRect(2,2,96,56,8),s.fillStyle(t[i],.2),s.fillRoundedRect(4,4,92,52,6),s.fillStyle(t[i],.8),s.fillTriangle(50,45,40,35,60,35),s.generateTexture(`gate-${e.toLowerCase()}`,100,60),s.destroy()})}generateBoostIcons(){const t=e.BOOSTS;Object.entries(t).forEach(([t,e])=>{const i=this.add.graphics();i.fillStyle(e.color,.3),i.fillCircle(20,20,18),i.lineStyle(3,e.color),i.strokeCircle(20,20,18),i.fillStyle(e.color),"NAVIGATOR"===t?i.fillTriangle(20,8,14,26,26,26):"ANALYST"===t?(i.fillRect(10,24,6,10),i.fillRect(17,18,6,16),i.fillRect(24,12,6,22)):"CAPTAIN"===t?(i.lineStyle(3,e.color),i.strokeCircle(20,14,5),i.lineBetween(20,19,20,32),i.lineBetween(12,28,20,32),i.lineBetween(28,28,20,32)):"CREW_SYNC"===t&&(i.fillCircle(14,14,4),i.fillCircle(26,14,4),i.fillRect(10,20,8,12),i.fillRect(22,20,8,12)),i.generateTexture(`boost-${t.toLowerCase()}`,40,40),i.destroy()})}}class o{constructor(t){this.scene=t,this.waves=[],this.stars=[],this.particles=[],this.createBackground(),this.createStars(),this.createWaves(),this.createAmbientParticles()}createBackground(){const t=this.scene.add.graphics().setDepth(-10);for(let i=0;i<.6*e.HEIGHT;i+=4){const s=i/(.6*e.HEIGHT),o=Math.floor(10+5*s)<<16|Math.floor(22+10*s)<<8|Math.floor(40+20*s);t.fillStyle(o,1),t.fillRect(0,i,e.WIDTH,4)}t.fillStyle(1718876,.3),t.fillRect(0,.4*e.HEIGHT,e.WIDTH,60),t.fillStyle(2771564,.2),t.fillRect(0,.42*e.HEIGHT,e.WIDTH,40),this.background=t}createStars(){for(let t=0;t<50;t++){const t=Phaser.Math.Between(0,e.WIDTH),i=Phaser.Math.Between(0,.5*e.HEIGHT),s=Phaser.Math.FloatBetween(.5,2),o=Phaser.Math.FloatBetween(.3,.8),a=Phaser.Math.FloatBetween(.001,.003),n=Phaser.Math.FloatBetween(0,2*Math.PI),r=this.scene.add.circle(t,i,s,16777215,o).setDepth(-5);this.stars.push({sprite:r,baseAlpha:o,twinkleSpeed:a,twinkleOffset:n})}}createAmbientParticles(){for(let t=0;t<20;t++){const t=Phaser.Math.Between(0,e.WIDTH),i=Phaser.Math.Between(.3*e.HEIGHT,e.HEIGHT),s=Phaser.Math.FloatBetween(1,3),o=Phaser.Math.FloatBetween(.1,.3),a=Phaser.Math.FloatBetween(-.3,.3),n=Phaser.Math.FloatBetween(-.2,.1),r=this.scene.add.circle(t,i,s,6139362,o).setDepth(2);this.particles.push({sprite:r,speedX:a,speedY:n,baseY:i})}}createWaves(){const t=[661032,859964,1718876,859964,1453386],e=[.9,.7,.5,.4,.3];for(let i=0;i<5;i++){const s=this.createWaveGraphics(t[i],e[i],i);this.waves.push(s)}}createWaveGraphics(t,i,s){return{graphics:this.scene.add.graphics().setDepth(s),amplitude:15+5*s,frequency:.02-.003*s,baseY:e.HEIGHT-150+40*s,speed:.5+.2*s,offset:50*s,color:t,alpha:i}}update(t){this.stars.forEach(e=>{const i=Math.sin(t*e.twinkleSpeed+e.twinkleOffset);e.sprite.setAlpha(e.baseAlpha*(.5+.5*i))}),this.particles.forEach(t=>{t.sprite.x+=t.speedX,t.sprite.y+=t.speedY,t.sprite.x<0&&(t.sprite.x=e.WIDTH),t.sprite.x>e.WIDTH&&(t.sprite.x=0),t.sprite.y<.3*e.HEIGHT&&(t.sprite.y=e.HEIGHT),t.sprite.y>e.HEIGHT&&(t.sprite.y=.3*e.HEIGHT)}),this.waves.forEach((i,s)=>{const o=i.graphics;o.clear(),o.fillStyle(i.color,i.alpha),o.beginPath(),o.moveTo(0,e.HEIGHT);for(let a=0;a<=e.WIDTH;a+=8){const e=i.baseY+Math.sin((a+t*i.speed+i.offset)*i.frequency)*i.amplitude+Math.sin((.5*a+t*i.speed*1.5)*i.frequency*2)*(.3*i.amplitude);o.lineTo(a,e)}if(o.lineTo(e.WIDTH,e.HEIGHT),o.closePath(),o.fillPath(),s===this.waves.length-1){o.lineStyle(1,6139362,.2);for(let s=0;s<=e.WIDTH;s+=8){const e=i.baseY+Math.sin((s+t*i.speed+i.offset)*i.frequency)*i.amplitude+Math.sin((.5*s+t*i.speed*1.5)*i.frequency*2)*(.3*i.amplitude);o.lineTo(s,e)}}})}setIntensity(t){this.waves.forEach((e,i)=>{e.amplitude=(15+5*i)*(1+.5*t),e.speed=(.5+.2*i)*(1+.3*t)})}destroy(){this.waves.forEach(t=>t.graphics.destroy()),this.waves=[],this.stars.forEach(t=>t.sprite.destroy()),this.stars=[],this.particles.forEach(t=>t.sprite.destroy()),this.particles=[],this.background&&this.background.destroy()}}const a="flybridge_radar_run",n=new class{constructor(){this.data=this.loadData()}loadData(){try{const t=localStorage.getItem(a);if(t)return JSON.parse(t)}catch(t){}return{highScore:0,gamesPlayed:0,totalInsightsCollected:0,totalFakesAvoided:0,totalPointsEarned:0,maxCombo:0,achievements:[],selectedSkin:"default",lastPlayed:null}}saveData(){try{this.data.lastPlayed=(new Date).toISOString(),localStorage.setItem(a,JSON.stringify(this.data))}catch(t){}}getHighScore(){return this.data.highScore}updateHighScore(t){return t>this.data.highScore&&(this.data.highScore=t,this.saveData(),!0)}addGameStats(t){this.data.gamesPlayed++,this.data.totalInsightsCollected+=t.realInsights||0,this.data.totalPointsEarned+=t.finalScore||0,t.maxCombo>this.data.maxCombo&&(this.data.maxCombo=t.maxCombo),this.saveData()}getSelectedSkin(){return this.data.selectedSkin||"default"}setSelectedSkin(t){return!!this.isSkinUnlocked(t)&&(this.data.selectedSkin=t,this.saveData(),!0)}getTotalPointsEarned(){return this.data.totalPointsEarned||0}isSkinUnlocked(t){const i=e.SHIP_SKINS,s=Object.keys(i).find(e=>i[e].id===t);if(!s)return!1;const o=i[s];return this.getTotalPointsEarned()>=o.unlockPoints}getUnlockedSkins(){const t=this.getTotalPointsEarned(),i=e.SHIP_SKINS;return Object.keys(i).filter(e=>i[e].unlockPoints<=t).map(t=>i[t])}getNextSkinToUnlock(){const t=this.getTotalPointsEarned(),i=e.SHIP_SKINS,s=Object.keys(i).filter(e=>i[e].unlockPoints>t).sort((t,e)=>i[t].unlockPoints-i[e].unlockPoints);return s.length>0?i[s[0]]:null}unlockAchievement(t){return!this.data.achievements.includes(t)&&(this.data.achievements.push(t),this.saveData(),!0)}hasAchievement(t){return this.data.achievements.includes(t)}getUnlockedAchievements(){return this.data.achievements}getStats(){return __spreadValues({},this.data)}resetProgress(){this.data={highScore:0,gamesPlayed:0,totalInsightsCollected:0,totalFakesAvoided:0,totalPointsEarned:0,maxCombo:0,achievements:[],selectedSkin:"default",lastPlayed:null},this.saveData()}};class r{constructor(t){this.scene=t,this.queue=[],this.isShowing=!1,this.createContainer()}createContainer(){this.container=this.scene.add.container(e.WIDTH/2,-80).setDepth(500),this.bg=this.scene.add.rectangle(0,0,300,70,0,.9).setStrokeStyle(3,15844367),this.icon=this.scene.add.text(-120,0,"",{fontSize:"32px"}).setOrigin(.5),this.title=this.scene.add.text(-80,-12,"",{fontFamily:"Arial",fontSize:"18px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(0,.5),this.desc=this.scene.add.text(-80,12,"",{fontFamily:"Arial",fontSize:"14px",color:"#BDC3C7"}).setOrigin(0,.5),this.container.add([this.bg,this.icon,this.title,this.desc])}show(t){const i=e.ACHIEVEMENTS[t];i&&(n.hasAchievement(t)||(n.unlockAchievement(t),this.queue.push(i),this.processQueue()))}processQueue(){if(this.isShowing||0===this.queue.length)return;this.isShowing=!0;const t=this.queue.shift();this.icon.setText(t.icon),this.title.setText(t.name),this.desc.setText(t.description),this.scene.tweens.add({targets:this.container,y:50,duration:500,ease:"Back.out",onComplete:()=>{this.scene.time.delayedCall(2500,()=>{this.scene.tweens.add({targets:this.container,y:-80,duration:400,ease:"Back.in",onComplete:()=>{this.isShowing=!1,this.processQueue()}})})}}),this.scene.soundGen&&this.scene.soundGen.playAchievementSound&&this.scene.soundGen.playAchievementSound()}destroy(){this.container.destroy()}}class l extends Phaser.Scene{constructor(){super("Menu")}create(){this.showingTutorial=!1;const t="ontouchstart"in window||navigator.maxTouchPoints>0,i=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),s=window.innerWidth<=1024;this.isMobile=i||t&&s,this.waveEffect=new o(this),this.isMobile&&this.createOrientationOverlay(),this.title=this.add.text(e.WIDTH/2,60,"SET THE COURSE",{fontFamily:"Arial, sans-serif",fontSize:"48px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5),this.subtitle=this.add.text(e.WIDTH/2,110,"FLYBRIDGE RADAR RUN",{fontFamily:"Arial, sans-serif",fontSize:"24px",color:"#1ABC9C"}).setOrigin(.5);const a=n.getSelectedSkin();this.shipPreview=this.add.image(e.WIDTH/2,200,`ship-${a}`).setScale(2.2),this.tweens.add({targets:this.shipPreview,y:215,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.createSkinButton();const r=n.getStats();r.highScore>0&&(this.add.text(e.WIDTH/2,305,`HIGHSCORE: ${r.highScore.toLocaleString()}`,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#F1C40F"}).setOrigin(.5),this.add.text(e.WIDTH/2,327,`Spiele: ${r.gamesPlayed} | Max Combo: ${r.maxCombo}x`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5)),this.createQuickInstructions(),this.createButtons(),this.cameras.main.fadeIn(500)}createQuickInstructions(){this.isMobile||(this.add.text(e.WIDTH/2,330,"90 Sekunden. Sammle echte Insights. Setze deinen Kurs.",{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"italic",color:"#95A5A6"}).setOrigin(.5),[{icon:"â†â†’",text:"Pfeiltasten / A+D zum Steuern",color:"#ECF0F1"},{icon:"â—",text:"GrÃ¼n = Echte Insights (+Punkte)",color:"#2ECC71"},{icon:"â—",text:"Rot = Noise (ausweichen!)",color:"#E74C3C"},{icon:"â–®",text:"Boost-Meter links: Bei 100% â†’ Taste Q/E",color:"#F1C40F"},{icon:"â›³",text:"Strategy Gates: Klicke oder 1/2/3",color:"#F39C12"}].forEach((t,i)=>{const s=370+32*i;this.add.text(e.WIDTH/2-160,s,t.icon,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:t.color}).setOrigin(.5),this.add.text(e.WIDTH/2-130,s,t.text,{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#BDC3C7"}).setOrigin(0,.5)}))}createButtons(){const t=this.isMobile?e.HEIGHT-80:e.HEIGHT-120,i=this.isMobile?e.HEIGHT-35:e.HEIGHT-60,s=this.createButton(e.WIDTH/2,t,"SPIEL STARTEN","#1ABC9C",()=>{this.startGame()});this.tweens.add({targets:s.bg,scaleX:1.05,scaleY:1.05,duration:600,yoyo:!0,repeat:-1}),this.createButton(e.WIDTH/2,i,"ANLEITUNG","#34495E",()=>{this.showTutorial()}),this.isMobile||this.add.text(e.WIDTH/2,e.HEIGHT-20,"SPACE = Start | H = Anleitung",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#5D6D7E"}).setOrigin(.5),this.createFullscreenButton(),this.input.keyboard.on("keydown-SPACE",()=>{this.showingTutorial||this.startGame()}),this.input.keyboard.on("keydown-H",()=>{this.showingTutorial||this.showTutorial()})}createButton(t,e,i,s,o){const a=this.add.rectangle(t,e,200,40,Phaser.Display.Color.HexStringToColor(s).color,.9).setInteractive({useHandCursor:!0}).on("pointerover",()=>a.setFillStyle(Phaser.Display.Color.HexStringToColor(s).color,1)).on("pointerout",()=>a.setFillStyle(Phaser.Display.Color.HexStringToColor(s).color,.9)).on("pointerdown",o),n=this.add.text(t,e,i,{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5);return{bg:a,label:n}}createOrientationOverlay(){this.orientationOverlay=this.add.container(e.WIDTH/2,e.HEIGHT/2).setDepth(200);const t=this.add.rectangle(0,0,e.WIDTH,e.HEIGHT,859964,.98);this.orientationOverlay.add(t);const i=this.add.text(0,-40,"ðŸ“±â†»",{fontSize:"48px"}).setOrigin(.5);this.orientationOverlay.add(i);const s=this.add.text(0,30,"Bitte drehe dein GerÃ¤t\nins Querformat",{fontFamily:"Arial, sans-serif",fontSize:"20px",fontStyle:"bold",color:"#ECF0F1",align:"center"}).setOrigin(.5);this.orientationOverlay.add(s);const o=this.add.text(0,90,"Das Spiel funktioniert am besten\nim Landscape-Modus",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#7F8C8D",align:"center"}).setOrigin(.5);this.orientationOverlay.add(o),this.checkOrientation(),window.addEventListener("resize",()=>this.checkOrientation()),window.addEventListener("orientationchange",()=>{setTimeout(()=>this.checkOrientation(),100)})}checkOrientation(){if(!this.orientationOverlay)return;const t=window.innerHeight>window.innerWidth;this.orientationOverlay.setVisible(t)}createSkinButton(){const t=n.getSelectedSkin(),i=e.SHIP_SKINS,s=Object.values(i).find(e=>e.id===t)||i.DEFAULT;this.skinBtn=this.add.rectangle(e.WIDTH/2,265,120,22,1752220,.3).setStrokeStyle(1,1752220,.6).setInteractive({useHandCursor:!0}).on("pointerover",()=>this.skinBtn.setFillStyle(1752220,.5)).on("pointerout",()=>this.skinBtn.setFillStyle(1752220,.3)).on("pointerdown",()=>this.showSkinSelector()),this.skinBtnText=this.add.text(e.WIDTH/2,265,`${s.icon} ${s.name} â–¼`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#ECF0F1"}).setOrigin(.5);const o=n.getNextSkinToUnlock();if(o){const t=n.getTotalPointsEarned(),i=Math.min(100,Math.round(t/o.unlockPoints*100));this.add.text(e.WIDTH/2,283,`NÃ¤chstes: ${o.icon} ${o.name} (${i}%)`,{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5)}}showSkinSelector(){if(this.showingTutorial)return;this.showingTutorial=!0;const t=this.add.rectangle(e.WIDTH/2,e.HEIGHT/2,e.WIDTH,e.HEIGHT,0,.9).setDepth(100).setInteractive(),i=this.add.container(e.WIDTH/2,e.HEIGHT/2).setDepth(101),s=this.isMobile,o=s?e.WIDTH-40:e.WIDTH-80,a=s?e.HEIGHT-40:e.HEIGHT-100,r=this.add.rectangle(0,0,o,a,1714746,.98).setStrokeStyle(2,1752220);i.add(r);const l=s?-a/2+25:-200,h=this.add.text(0,l,"SCHIFF AUSWÃ„HLEN",{fontFamily:"Arial, sans-serif",fontSize:s?"18px":"24px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5);i.add(h);const c=n.getTotalPointsEarned(),d=this.add.text(0,l+25,`Gesammelte Punkte: ${c.toLocaleString()}`,{fontFamily:"Arial, sans-serif",fontSize:s?"12px":"14px",color:"#F1C40F"}).setOrigin(.5);i.add(d);const u=e.SHIP_SKINS,p=Object.keys(u),f=s?130:180,m=s?115:160,S=s?90:120,g=s?100:140,y=-2*f/2,T=s?-60:-80;p.forEach((e,o)=>{const a=u[e],r=o%3,l=Math.floor(o/3),h=y+r*f,c=T+l*g,d=n.isSkinUnlocked(a.id),p=n.getSelectedSkin()===a.id,C=p?1752220:d?2899536:1710618,I=this.add.rectangle(h,c,m,S,C,d?.8:.4).setStrokeStyle(2,p?1752220:d?8359053:4473924);d&&I.setInteractive({useHandCursor:!0}).on("pointerdown",()=>{n.setSelectedSkin(a.id),this.shipPreview.setTexture(`ship-${a.id}`),this.skinBtnText.setText(`${a.icon} ${a.name}`),i.destroy(),t.destroy(),this.showingTutorial=!1}),i.add(I);const E=s?.9:1.2,b=s?-18:-25,x=this.add.image(h,c+b,`ship-${a.id}`).setScale(E);d||x.setAlpha(.3),i.add(x);const w=s?18:25,A=this.add.text(h,c+w,`${a.icon} ${a.name}`,{fontFamily:"Arial, sans-serif",fontSize:s?"11px":"14px",fontStyle:"bold",color:d?"#ECF0F1":"#666666"}).setOrigin(.5);let O;i.add(A),O=p?"AUSGEWÃ„HLT":d?s?"AuswÃ¤hlen":"Klicken zum AuswÃ¤hlen":`ðŸ”’ ${a.unlockPoints.toLocaleString()}`;const F=s?32:45,R=this.add.text(h,c+F,O,{fontFamily:"Arial, sans-serif",fontSize:s?"9px":"10px",color:p?"#1ABC9C":d?"#7F8C8D":"#E74C3C"}).setOrigin(.5);i.add(R)});const C=s?a/2-25:200,I=this.add.rectangle(0,C,120,32,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{i.destroy(),t.destroy(),this.showingTutorial=!1});i.add(I);const E=this.add.text(0,C,"SCHLIESSEN",{fontFamily:"Arial, sans-serif",fontSize:"12px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5);i.add(E),this.input.keyboard.once("keydown-ESC",()=>{i.destroy(),t.destroy(),this.showingTutorial=!1})}createFullscreenButton(){const t=e.WIDTH-50;this.add.rectangle(t,30,70,30,2899536,.8).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.toggleFullscreen()),this.fullscreenIcon=this.add.text(t,30,"â›¶ Vollbild",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#ECF0F1"}).setOrigin(.5),document.addEventListener("fullscreenchange",()=>this.updateFullscreenButton())}toggleFullscreen(){const t=document.getElementById("game-container")||document.documentElement;document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():(t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen(),screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape").catch(()=>{}))}updateFullscreenButton(){this.fullscreenIcon&&(document.fullscreenElement?this.fullscreenIcon.setText("âœ• Beenden"):this.fullscreenIcon.setText("â›¶ Vollbild"))}showTutorial(){this.showingTutorial=!0;const t=this.isMobile,i=this.add.rectangle(e.WIDTH/2,e.HEIGHT/2,e.WIDTH,e.HEIGHT,0,.9).setDepth(100).setInteractive(),s=this.add.container(e.WIDTH/2,e.HEIGHT/2).setDepth(101),o=t?e.WIDTH-30:e.WIDTH-60,a=t?e.HEIGHT-30:e.HEIGHT-60,n=this.add.rectangle(0,0,o,a,1714746,.98).setStrokeStyle(2,1752220);s.add(n);const r=t?-a/2+25:-220,l=this.add.text(0,r,"WIE SPIELT MAN?",{fontFamily:"Arial, sans-serif",fontSize:t?"20px":"28px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5);s.add(l);const h=t?55:70,c=t?-o/2+20:-300;let d=t?-a/2+65:-170;(t?[{title:"ZIEL",content:"90 Sek. Boot steuern, grÃ¼ne Insights sammeln, rote vermeiden."},{title:"STEUERUNG",content:"Links/rechts tippen oder wischen zum Steuern."},{title:"BOOST",content:"Boost-Meter fÃ¼llt sich durch Insights. Bei 100% â†’ Boost-Button drÃ¼cken!"},{title:"GATES",content:"Alle 15 Sek.: SPEED (schneller) | QUALITY | SAFETY (sicherer)"}]:[{title:"ZIEL DES SPIELS",content:"Navigiere dein Boot 90 Sekunden lang durch den Datenstrom.\nSammle echte Insights (grÃ¼n) und vermeide Noise (rot)."},{title:"STEUERUNG",content:"â† â†’ oder A/D: Boot steuern | H/ESC: Pause"},{title:"INSIGHTS & POWER-UPS",content:"â— GrÃ¼ne Insights: +100 Punkte, fÃ¼llt Boost-Meter\nâ— Rote Noise: -30 Punkte, bricht Combo\nâ¬¡ Power-Ups erscheinen zufÃ¤llig - einsammeln!"},{title:"BOOST-METER (gelber Balken links)",content:'FÃ¼llt sich durch Insight-Sammeln\nBei 100%: "BEREIT!" erscheint\nâ†’ DrÃ¼cke dann Q oder E fÃ¼r Crew-Boost!'},{title:"STRATEGY GATES (alle ~15 Sek.)",content:"MenÃ¼ erscheint oben - KLICKE oder 1/2/3:\nSPEED (x1.5) | QUALITY | SAFETY (x0.8)"},{title:"RADAR & STÃœRME",content:"Radar (unten rechts): Zeigt wo Insights kommen\nStÃ¼rme: Nebel, Wind, Signal-Flut"}]).forEach((e,i)=>{const a=this.add.text(c,d,e.title,{fontFamily:"Arial, sans-serif",fontSize:t?"12px":"14px",fontStyle:"bold",color:"#F1C40F"});s.add(a);const n=this.add.text(c,d+16,e.content,{fontFamily:"Arial, sans-serif",fontSize:t?"10px":"12px",color:"#BDC3C7",lineSpacing:t?2:4,wordWrap:{width:o-40}});s.add(n),d+=h});const u=t?a/2-25:220,p=this.add.rectangle(0,u,150,36,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{s.destroy(),i.destroy(),this.showingTutorial=!1});s.add(p);const f=this.add.text(0,u,"VERSTANDEN!",{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5);s.add(f),this.input.keyboard.once("keydown-ESC",()=>{s.destroy(),i.destroy(),this.showingTutorial=!1})}update(t,e){this.waveEffect.update(t)}startGame(){this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>{this.waveEffect.destroy(),this.scene.start("Game")})}}class h extends Phaser.Physics.Arcade.Sprite{constructor(t,i,s){super(t,i,s,`ship-${n.getSelectedSkin()}`),t.add.existing(this),t.physics.add.existing(this),this.setCollideWorldBounds(!0),this.body.setSize(36,50),this.setDrag(800),this.setMaxVelocity(e.SHIP.SPEED,50),this.driftForce=0,this.driftDirection=0,this.isStabilized=!1,this.isShielded=!1,this.stabilityScore=100,this.lastX=i,this.createTrail(t)}createTrail(t){this.trail=t.add.particles(this.x,this.y,"insight-real",{scale:{start:.25,end:0},alpha:{start:.4,end:0},speed:{min:15,max:30},lifespan:500,frequency:40,follow:this,followOffset:{x:0,y:32},tint:6139362}),this.wakeLeft=t.add.particles(this.x,this.y,"insight-real",{scale:{start:.15,end:0},alpha:{start:.3,end:0},speed:{min:20,max:40},angle:{min:150,max:180},lifespan:400,frequency:60,follow:this,followOffset:{x:-14,y:28},tint:8765929}),this.wakeRight=t.add.particles(this.x,this.y,"insight-real",{scale:{start:.15,end:0},alpha:{start:.3,end:0},speed:{min:20,max:40},angle:{min:0,max:30},lifespan:400,frequency:60,follow:this,followOffset:{x:14,y:28},tint:8765929}),this.radarGlow=t.add.circle(this.x,this.y-28,8,1752220,.3).setDepth(this.depth+1),t.tweens.add({targets:this.radarGlow,scale:{from:1,to:1.5},alpha:{from:.3,to:.1},duration:1e3,yoyo:!0,repeat:-1}),this.shieldGraphic=t.add.circle(this.x,this.y,40,3447003,.2).setStrokeStyle(3,3447003,.8).setDepth(this.depth+1).setVisible(!1)}update(t,i){if(i.left?(this.setVelocityX(-300),this.setAngle(-8)):i.right?(this.setVelocityX(e.SHIP.SPEED),this.setAngle(8)):this.setAngle(0),this.driftForce>0&&!this.isStabilized){const i=this.driftForce*this.driftDirection*(t/1e3);this.x+=i,this.x=Phaser.Math.Clamp(this.x,e.SHIP.BOUNDS_MARGIN,e.WIDTH-e.SHIP.BOUNDS_MARGIN)}const s=Math.abs(this.x-this.lastX);s<2?this.stabilityScore=Math.min(100,this.stabilityScore+.1):s>5&&(this.stabilityScore=Math.max(0,this.stabilityScore-.2)),this.lastX=this.x,this.shieldGraphic&&this.shieldGraphic.setPosition(this.x,this.y),this.radarGlow&&this.radarGlow.setPosition(this.x,this.y-24)}setShielded(t){this.isShielded=t,this.shieldGraphic&&(this.shieldGraphic.setVisible(t),t?this.scene.tweens.add({targets:this.shieldGraphic,scale:{from:1,to:1.1},alpha:{from:.3,to:.5},duration:500,yoyo:!0,repeat:-1}):(this.scene.tweens.killTweensOf(this.shieldGraphic),this.shieldGraphic.setScale(1)))}setDrift(t,e){this.driftForce=t,this.driftDirection=e}clearDrift(){this.driftForce=0,this.driftDirection=0}setStabilized(t){this.isStabilized=t}getStabilityScore(){return this.stabilityScore}flash(t=16777215){this.setTint(t),this.scene.time.delayedCall(100,()=>{this.clearTint()})}destroy(){this.trail&&this.trail.destroy(),this.wakeLeft&&this.wakeLeft.destroy(),this.wakeRight&&this.wakeRight.destroy(),this.radarGlow&&(this.scene&&this.scene.tweens&&this.scene.tweens.killTweensOf(this.radarGlow),this.radarGlow.destroy()),this.shieldGraphic&&this.shieldGraphic.destroy(),super.destroy()}}class c extends Phaser.Physics.Arcade.Sprite{constructor(t,i,s,o=!0){super(t,i,s,o?"insight-real":"insight-fake"),t.add.existing(this),t.physics.add.existing(this),this.isReal=o,this.isHighlighted=!1,this.collected=!1,this.setVelocityY(e.INSIGHT.SPEED_BASE),o?(this.createPulseEffect(t),this.createGlowTrail(t)):this.createFlickerEffect(t),this.body.setCircle(14,6,6)}createGlowTrail(t){this.glowTrail=t.add.circle(this.x,this.y,18,3066993,.15).setDepth(this.depth-1),t.tweens.add({targets:this.glowTrail,scale:{from:1,to:1.3},alpha:{from:.15,to:.05},duration:800,yoyo:!0,repeat:-1})}createPulseEffect(t){t.tweens.add({targets:this,scale:{from:.95,to:1.15},alpha:{from:.85,to:1},duration:700,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),t.tweens.add({targets:this,angle:{from:-3,to:3},duration:1200,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createFlickerEffect(t){t.tweens.add({targets:this,alpha:{from:.35,to:.85},scale:{from:.7,to:1},duration:180,yoyo:!0,repeat:-1,ease:"Stepped",hold:Phaser.Math.Between(30,150)}),t.tweens.add({targets:this,angle:{from:-20,to:20},duration:250,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),t.tweens.add({targets:this,scaleX:{from:.8,to:1.1},scaleY:{from:1.1,to:.85},duration:350,yoyo:!0,repeat:-1,ease:"Stepped"})}setHighlighted(t){t&&this.isReal&&!this.isHighlighted&&(this.isHighlighted=!0,this.setTexture("insight-highlighted"))}collect(){return!this.collected&&(this.collected=!0,this.glowTrail&&(this.scene.tweens.killTweensOf(this.glowTrail),this.glowTrail.destroy(),this.glowTrail=null),this.scene.tweens.add({targets:this,scale:1.8,alpha:0,duration:250,ease:"Quad.out",onComplete:()=>this.destroy()}),this.isReal&&this.createCollectionBurst(),!0)}createCollectionBurst(){const t=this.isReal?3066993:15158332;for(let e=0;e<8;e++){const i=e/8*Math.PI*2,s=this.scene.add.circle(this.x,this.y,4,t,.8).setDepth(100);this.scene.tweens.add({targets:s,x:this.x+40*Math.cos(i),y:this.y+40*Math.sin(i),alpha:0,scale:0,duration:300,ease:"Quad.out",onComplete:()=>s.destroy()})}}update(t){this.glowTrail&&this.glowTrail.setPosition(this.x,this.y),this.y>e.HEIGHT+50&&(this.glowTrail&&this.glowTrail.destroy(),this.destroy())}getPoints(){return this.isReal?e.INSIGHT.POINTS_REAL:e.INSIGHT.POINTS_FAKE}getMeterValue(){return this.isReal?e.INSIGHT.METER_FILL_REAL:e.INSIGHT.METER_FILL_FAKE}}class d{constructor(t,e=-100){this.scene=t,this.y=e,this.speed=100,this.selected=!1,this.selectedRoute=null,this.routes=["SPEED","QUALITY","SAFETY"],this.createGate()}createGate(){const t=this.scene,i=e.WIDTH/3;this.container=t.add.container(0,this.y).setDepth(40);const s="ontouchstart"in window||navigator.maxTouchPoints>0,o=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),a=window.innerWidth<=1024;this.isMobile=o||s&&a;const n=this.isMobile?140:120;this.overlay=t.add.rectangle(e.WIDTH/2,30,e.WIDTH,n,661032,.95),this.container.add(this.overlay),this.title=t.add.text(e.WIDTH/2,8,"WÃ„HLE DEINEN KURS",{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"20px":"18px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5,0),this.container.add(this.title),this.routeButtons=[];const r=this.isMobile?1.3:1;this.routes.forEach((s,o)=>{const a=i*o+i/2,n=e.GATES[s],l=t.add.rectangle(a,75,i-10,90,0,0).setInteractive({useHandCursor:!0}).on("pointerover",()=>this.onRouteHover(o)).on("pointerout",()=>this.onRouteOut(o)).on("pointerdown",()=>this.selectRoute(o)),h=t.add.image(a,60,`gate-${s.toLowerCase()}`).setScale(r),c=t.add.text(a,95,n.name,{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"16px":"14px",fontStyle:"bold",color:"#"+n.color.toString(16).padStart(6,"0")}).setOrigin(.5,0),d=t.add.text(a,114,`x${n.multiplier.toFixed(1)}`,{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"14px":"12px",color:"#7F8C8D"}).setOrigin(.5,0),u=t.add.text(a,45,this.isMobile?"TAP":`[${o+1}]`,{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5,1);this.routeButtons.push({button:h,hitArea:l,nameText:c,multiplierText:d,keyHint:u,route:s}),this.container.add([l,h,c,d,u])}),t.input.keyboard.on("keydown-ONE",()=>this.selectRoute(0)),t.input.keyboard.on("keydown-TWO",()=>this.selectRoute(1)),t.input.keyboard.on("keydown-THREE",()=>this.selectRoute(2));for(let e=1;e<3;e++){const s=t.add.line(0,0,i*e,40,i*e,120,3426654,.5).setLineWidth(2);this.container.add(s)}}onRouteHover(t){if(this.selected)return;const{button:e}=this.routeButtons[t];this.scene.tweens.add({targets:e,scale:1.15,duration:100})}onRouteOut(t){if(this.selected)return;const{button:e}=this.routeButtons[t];this.scene.tweens.add({targets:e,scale:1,duration:100})}selectRoute(t){if(this.selected||t>=this.routes.length)return;this.selected=!0,this.selectedRoute=this.routes[t];const i=e.GATES[this.selectedRoute],s=this.routeButtons[t];this.scene.tweens.add({targets:s.button,scale:1.3,duration:200}),this.routeButtons.forEach((e,i)=>{i!==t&&this.scene.tweens.add({targets:[e.button,e.nameText,e.multiplierText],alpha:.3,duration:200})});const o=this.scene.add.text(e.WIDTH/2,140,`${i.name} gewÃ¤hlt!`,{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#"+i.color.toString(16).padStart(6,"0")}).setOrigin(.5,0);this.container.add(o),this.speed=300,this.scene.events.emit("gateSelected",this.selectedRoute)}update(t){return this.container.y+=this.speed*(t/1e3),!this.selected&&this.container.y>150&&this.selectRoute(1),this.container.y>e.HEIGHT+200}getSelectedRoute(){return this.selectedRoute}getModifiers(){if(!this.selectedRoute)return{};const t=e.GATES[this.selectedRoute];return{multiplier:t.multiplier,noiseChange:t.noiseIncrease||-(t.noiseReduction||0),stormChange:t.stormChanceIncrease||-(t.stormChanceReduction||0),qualityBonus:t.insightQualityBonus||0,spawnReduction:t.spawnReduction||0}}destroy(){this.scene.input.keyboard.off("keydown-ONE"),this.scene.input.keyboard.off("keydown-TWO"),this.scene.input.keyboard.off("keydown-THREE"),this.container.destroy()}}class u extends Phaser.Physics.Arcade.Sprite{constructor(t,i,s,o){const a=e.POWERUPS.TYPES[o];super(t,i,s,`powerup-${o.toLowerCase()}`),t.add.existing(this),t.physics.add.existing(this),this.type=o,this.config=a,this.collected=!1,this.speed=120,this.floatOffset=0,this.floatDirection=1,this.createGlow(),"GOLDEN"!==o?t.tweens.add({targets:this,angle:360,duration:3e3,repeat:-1,ease:"Linear"}):t.tweens.add({targets:this,scale:{from:1,to:1.3},duration:400,yoyo:!0,repeat:-1}),this.body.setCircle(16,0,0)}createGlow(){this.glow=this.scene.add.circle(this.x,this.y,25,this.config.color,.3).setDepth(this.depth-1),this.scene.tweens.add({targets:this.glow,scale:{from:1,to:1.5},alpha:{from:.3,to:0},duration:800,repeat:-1})}update(t){this.y+=this.speed*(t/1e3),this.floatOffset+=.1*this.floatDirection,Math.abs(this.floatOffset)>5&&(this.floatDirection*=-1),this.x+=.3*this.floatDirection,this.glow&&this.glow.setPosition(this.x,this.y),this.y>e.HEIGHT+50&&this.destroy()}collect(){return!this.collected&&(this.collected=!0,this.scene.tweens.add({targets:this,scale:2,alpha:0,duration:300,ease:"Power2",onComplete:()=>this.destroy()}),this.glow&&this.scene.tweens.add({targets:this.glow,scale:3,alpha:0,duration:300,onComplete:()=>this.glow.destroy()}),!0)}destroy(){this.glow&&this.glow.destroy(),super.destroy()}}class p{constructor(t){this.scene=t,this.powerUps=t.add.group(),this.activePowerUps={},this.generateTextures(),this.createUI()}generateTextures(){const t=e.POWERUPS.TYPES;Object.entries(t).forEach(([t,e])=>{const i=`powerup-${t.toLowerCase()}`;if(this.scene.textures.exists(i))return;const s=this.scene.add.graphics();if("MAGNET"===t)s.fillStyle(e.color),s.fillRoundedRect(4,4,8,24,2),s.fillRoundedRect(20,4,8,24,2),s.fillRoundedRect(4,4,24,8,2),s.fillStyle(15158332),s.fillRect(4,20,8,8),s.fillStyle(3447003),s.fillRect(20,20,8,8);else if("SHIELD"===t)s.fillStyle(e.color,.8),s.beginPath(),s.moveTo(16,4),s.lineTo(28,10),s.lineTo(26,24),s.lineTo(16,30),s.lineTo(6,24),s.lineTo(4,10),s.closePath(),s.fillPath(),s.lineStyle(2,16777215,.5),s.strokePath();else if("DOUBLE"===t)s.fillStyle(e.color),s.fillRoundedRect(2,8,28,18,4);else if("GOLDEN"===t){s.fillStyle(e.color),s.beginPath();const t=16,i=16,o=5,a=14,n=7;let r=Math.PI/2*3;const l=Math.PI/o;s.moveTo(t,i-a);for(let e=0;e<o;e++){let e=t+Math.cos(r)*a,o=i+Math.sin(r)*a;s.lineTo(e,o),r+=l,e=t+Math.cos(r)*n,o=i+Math.sin(r)*n,s.lineTo(e,o),r+=l}s.lineTo(t,i-a),s.closePath(),s.fillPath(),s.lineStyle(2,16777215,.8),s.strokePath()}s.generateTexture(i,32,32),s.destroy()})}createUI(){this.indicators={};let t=e.WIDTH/2-100;Object.keys(e.POWERUPS.TYPES).forEach((i,s)=>{if("GOLDEN"===i)return;const o=e.POWERUPS.TYPES[i],a=this.scene.add.container(t+70*s,75).setDepth(100).setAlpha(0),n=this.scene.add.circle(0,0,20,o.color,.3),r=this.scene.add.image(0,0,`powerup-${i.toLowerCase()}`).setScale(.8),l=this.scene.add.text(0,25,"",{fontFamily:"Arial",fontSize:"12px",color:"#ECF0F1"}).setOrigin(.5);a.add([n,r,l]),this.indicators[i]={container:a,timer:l,bg:n}})}spawnPowerUp(t){const e=Math.random();let i;i=e<.1?"GOLDEN":e<.4?"MAGNET":e<.7?"SHIELD":"DOUBLE";const s=new u(this.scene,t,-30,i);return this.powerUps.add(s),s}collectPowerUp(t){if(!t.collect())return;const e=t.type,i=t.config;this.scene.hud.showMessage(`${i.name}!`,800),this.scene.soundGen&&this.scene.soundGen.playPowerUpSound&&this.scene.soundGen.playPowerUpSound(),"GOLDEN"===e?(this.scene.scoreManager.addBonus(i.points),this.scene.hud.showPointsPopup(t.x,t.y,i.points),this.createGoldenBurst(t.x,t.y)):this.activatePowerUp(e)}activatePowerUp(t){this.activePowerUps[t]?this.activePowerUps[t].timeLeft=e.POWERUPS.DURATION:this.activePowerUps[t]={timeLeft:e.POWERUPS.DURATION,startTime:this.scene.time.now};const i=this.indicators[t];i&&(i.container.setAlpha(1),this.scene.tweens.add({targets:i.bg,scale:{from:1.3,to:1},duration:200})),this.applyPowerUpEffect(t,!0)}applyPowerUpEffect(t,e){"SHIELD"===t&&this.scene.ship&&this.scene.ship.setShielded(e)}update(t){this.powerUps.children.iterate(e=>{e&&e.update(t)}),Object.entries(this.activePowerUps).forEach(([e,i])=>{i.timeLeft-=t;const s=this.indicators[e];if(s){const t=Math.ceil(i.timeLeft/1e3);s.timer.setText(`${t}s`),i.timeLeft<2e3&&s.container.setAlpha(.5*Math.sin(this.scene.time.now/100)+.5)}i.timeLeft<=0&&this.deactivatePowerUp(e)}),this.isActive("MAGNET")&&this.scene.ship&&this.applyMagnetEffect()}applyMagnetEffect(){const t=this.scene.ship,i=e.POWERUPS.TYPES.MAGNET.radius;this.scene.insights.children.iterate(e=>{if(!e||!e.isReal)return;const s=Phaser.Math.Distance.Between(t.x,t.y,e.x,e.y);if(s<i){const o=Phaser.Math.Angle.Between(e.x,e.y,t.x,t.y),a=300*(1-s/i);e.x+=Math.cos(o)*a*.016,e.y+=Math.sin(o)*a*.016}})}createGoldenBurst(t,e){for(let i=0;i<20;i++){const s=2*Math.PI*i/20,o=this.scene.add.circle(t,e,6,16766720).setDepth(150);this.scene.tweens.add({targets:o,x:t+150*Math.cos(s),y:e+150*Math.sin(s),scale:0,duration:600,ease:"Power2",onComplete:()=>o.destroy()})}}deactivatePowerUp(t){this.applyPowerUpEffect(t,!1),delete this.activePowerUps[t];const e=this.indicators[t];e&&this.scene.tweens.add({targets:e.container,alpha:0,duration:300})}isActive(t){return!!this.activePowerUps[t]}getMultiplier(){return this.isActive("DOUBLE")?e.POWERUPS.TYPES.DOUBLE.multiplier:1}destroy(){this.powerUps.clear(!0,!0),Object.values(this.indicators).forEach(t=>t.container.destroy())}}class f{constructor(t){if(this.scene=t,this.cursors=t.input.keyboard.createCursorKeys(),this.wasd=t.input.keyboard.addKeys({left:Phaser.Input.Keyboard.KeyCodes.A,right:Phaser.Input.Keyboard.KeyCodes.D,boost:Phaser.Input.Keyboard.KeyCodes.SPACE}),this.touchLeft=!1,this.touchRight=!1,this.touchBoost=!1,this.isMobile=this.detectMobile(),this.isMobile)try{this.createTouchControls()}catch(e){this.isMobile=!1}}detectMobile(){const t="ontouchstart"in window||navigator.maxTouchPoints>0,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),i=window.innerWidth<=1024;return e||t&&i}createTouchControls(){const t=this.scene,i=e.HEIGHT-50,s=60;this.touchContainer=t.add.container(0,0).setDepth(150),this.leftBtn=t.add.rectangle(150,i,s,s,1752220,.7).setInteractive().on("pointerdown",()=>{this.touchLeft=!0,this.leftBtn.setFillStyle(1482885,.9)}).on("pointerup",()=>{this.touchLeft=!1,this.leftBtn.setFillStyle(1752220,.7)}).on("pointerout",()=>{this.touchLeft=!1,this.leftBtn.setFillStyle(1752220,.7)}),this.leftIcon=t.add.text(150,i,"â—€",{fontSize:"24px",color:"#FFFFFF"}).setOrigin(.5);const o=e.WIDTH-150;this.rightBtn=t.add.rectangle(o,i,s,s,1752220,.7).setInteractive().on("pointerdown",()=>{this.touchRight=!0,this.rightBtn.setFillStyle(1482885,.9)}).on("pointerup",()=>{this.touchRight=!1,this.rightBtn.setFillStyle(1752220,.7)}).on("pointerout",()=>{this.touchRight=!1,this.rightBtn.setFillStyle(1752220,.7)}),this.rightIcon=t.add.text(o,i,"â–¶",{fontSize:"24px",color:"#FFFFFF"}).setOrigin(.5),this.boostBtn=t.add.rectangle(e.WIDTH/2,i,s,s,8359053,.5).setInteractive().on("pointerdown",()=>{this.touchBoost=!0}).on("pointerup",()=>{this.touchBoost=!1}),this.boostIcon=t.add.text(e.WIDTH/2,i,"âš¡",{fontSize:"22px"}).setOrigin(.5),this.boostLabel=t.add.text(e.WIDTH/2,i+35,"BOOST",{fontFamily:"Arial, sans-serif",fontSize:"9px",color:"#7F8C8D"}).setOrigin(.5),this.touchContainer.add([this.leftBtn,this.leftIcon,this.rightBtn,this.rightIcon,this.boostBtn,this.boostIcon,this.boostLabel])}getInput(){const t={left:!1,right:!1,boost:!1};return(this.cursors.left.isDown||this.wasd.left.isDown)&&(t.left=!0),(this.cursors.right.isDown||this.wasd.right.isDown)&&(t.right=!0),Phaser.Input.Keyboard.JustDown(this.wasd.boost)&&(t.boost=!0),this.touchLeft&&(t.left=!0),this.touchRight&&(t.right=!0),this.touchBoost&&(t.boost=!0,this.touchBoost=!1),t}isBoostPressed(){return Phaser.Input.Keyboard.JustDown(this.wasd.boost)||this.touchBoost}setBoostReady(t){this.isMobile&&this.boostBtn&&(t?(this.boostBtn.setFillStyle(15844367,.9),this.boostLabel.setText("BEREIT!"),this.boostLabel.setColor("#F1C40F"),this.boostPulseTween||(this.boostPulseTween=this.scene.tweens.add({targets:[this.boostBtn,this.boostIcon],scale:{from:1,to:1.15},duration:400,yoyo:!0,repeat:-1}))):(this.boostBtn.setFillStyle(8359053,.4),this.boostLabel.setText("BOOST"),this.boostLabel.setColor("#7F8C8D"),this.boostPulseTween&&(this.boostPulseTween.stop(),this.boostPulseTween=null,this.boostBtn.setScale(1),this.boostIcon.setScale(1))))}destroy(){this.touchContainer&&this.touchContainer.destroy(),this.boostPulseTween&&this.boostPulseTween.stop()}}class m{constructor(t){this.scene=t,this.reset()}reset(){this.score=0,this.realInsightsCollected=0,this.fakeInsightsCollected=0,this.totalInsightsCollected=0,this.multiplier=1,this.gateChoices=[],this.boostsUsed=0,this.boostEfficiency=0,this.perfectBoosts=0}addInsight(t,i=1){this.totalInsightsCollected++;const s=t?e.INSIGHT.POINTS_REAL:e.INSIGHT.POINTS_FAKE,o=Math.round(s*i*this.multiplier);return this.score+=o,t?this.realInsightsCollected++:this.fakeInsightsCollected++,o}addGateChoice(t){this.gateChoices.push(t);const i=e.GATES[t.toUpperCase()];i&&(this.multiplier*=i.multiplier)}addBoostUsage(t){this.boostsUsed++,t&&this.perfectBoosts++}addBonus(t){this.score+=t}getScore(){return Math.max(0,this.score)}getMultiplier(){return this.multiplier}getQualityRatio(){return 0===this.totalInsightsCollected?0:this.realInsightsCollected/this.totalInsightsCollected}getQualityScore(){return Math.round(100*this.getQualityRatio())}calculateFinalScore(t){let i=this.score;return this.getQualityRatio()>=e.SCORING.QUALITY_BONUS_THRESHOLD&&(i*=e.SCORING.QUALITY_BONUS_MULTIPLIER),i+=t/100*e.SCORING.STABILITY_BONUS_MAX,this.boostsUsed>0&&(i+=this.perfectBoosts/this.boostsUsed*e.SCORING.BOOST_EFFICIENCY_BONUS),Math.round(i)}getStrategyProfile(){if(0===this.gateChoices.length)return"Balanced";const t={};this.gateChoices.forEach(e=>{t[e]=(t[e]||0)+1});const e=Object.entries(t).sort((t,e)=>e[1]-t[1])[0];return e?e[0]:"Balanced"}getCrewImpact(){return 0===this.boostsUsed?"Low":this.boostsUsed<=2?"Medium":"High"}getResultType(t,e){const i=(t+e)/2;return i>=80?"Quality"===this.getStrategyProfile()?"High Quality Navigator":"Stable Course":i>=60?"Speed"===this.getStrategyProfile()?"Fast but Noisy":"Balanced Approach":i>=40?"Rough Waters":"Lost at Sea"}getStats(t){const e=this.getQualityScore();return{finalScore:this.calculateFinalScore(t),qualityScore:e,stabilityScore:Math.round(t),strategyProfile:this.getStrategyProfile(),crewImpact:this.getCrewImpact(),resultType:this.getResultType(e,t),realInsights:this.realInsightsCollected,fakeInsights:this.fakeInsightsCollected,multiplier:this.multiplier.toFixed(2)}}}class S{constructor(t){this.scene=t,this.activeStorm=null,this.stormEndTime=0,this.stormChance=0,this.lastStormTime=0,this.minInterval=e.STORM_MIN_INTERVAL,this.stormTypes=["FOG","CROSSWIND","SIGNAL_FLOOD","NARROW_PASS"],this.createEffects()}createEffects(){this.fogOverlay=this.scene.add.rectangle(e.WIDTH/2,e.HEIGHT/2,e.WIDTH,e.HEIGHT,6122878,0).setDepth(30),this.fogOverlay2=this.scene.add.rectangle(e.WIDTH/2,e.HEIGHT/2,e.WIDTH,e.HEIGHT,8753822,0).setDepth(31),this.fogParticles=null,this.windIndicator=this.scene.add.text(e.WIDTH/2,80,"",{fontFamily:"Arial, sans-serif",fontSize:"24px",color:"#F39C12"}).setOrigin(.5).setDepth(100).setVisible(!1),this.buoys=this.scene.add.group(),this.warningText=this.scene.add.text(e.WIDTH/2,e.HEIGHT/2-100,"",{fontFamily:"Arial, sans-serif",fontSize:"32px",fontStyle:"bold",color:"#E74C3C",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(150).setVisible(!1)}setStormChance(t){this.stormChance=Math.max(0,Math.min(1,t))}adjustStormChance(t){this.stormChance=Math.max(0,Math.min(1,this.stormChance+t))}checkForStorm(t){this.activeStorm||t-this.lastStormTime<this.minInterval||t<e.PHASE_1_END||Math.random()<.02*this.stormChance&&this.triggerRandomStorm(t)}triggerRandomStorm(t){const e=this.stormTypes[Math.floor(Math.random()*this.stormTypes.length)];this.triggerStorm(e,t)}triggerStorm(t,i){this.activeStorm=t,this.stormEndTime=i+e.STORM_DURATION,this.lastStormTime=i;const s=e.STORMS[t];switch(this.showWarning(s.name),t){case"FOG":this.startFog();break;case"CROSSWIND":this.startCrosswind();break;case"SIGNAL_FLOOD":this.startSignalFlood();break;case"NARROW_PASS":this.startNarrowPass()}this.scene.events.emit("stormStarted",t)}showWarning(t){this.warningText.setText(`âš  ${t.toUpperCase()}! âš `),this.warningText.setVisible(!0),this.scene.tweens.add({targets:this.warningText,alpha:{from:1,to:0},scale:{from:1,to:1.2},duration:1500,onComplete:()=>{this.warningText.setVisible(!1),this.warningText.setAlpha(1),this.warningText.setScale(1)}})}startFog(){this.scene.tweens.add({targets:this.fogOverlay,alpha:.7,duration:800}),this.scene.tweens.add({targets:this.fogOverlay2,alpha:.4,duration:1200}),this.fogParticles=this.scene.add.particles(0,0,"insight-real",{x:{min:0,max:e.WIDTH},y:{min:0,max:e.HEIGHT},scale:{min:2,max:5},alpha:{start:.15,end:.05},speedX:{min:-30,max:-10},speedY:{min:10,max:30},lifespan:4e3,frequency:100,tint:11450047,blendMode:"ADD"}).setDepth(32),this.scene.radarUI&&this.scene.radarUI.setBlurred(!0,.8),this.fogLabel=this.scene.add.text(e.WIDTH/2,e.HEIGHT-50,"ðŸŒ«ï¸ DICHTER NEBEL - SICHT EINGESCHRÃ„NKT!",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#BDC3C7",stroke:"#2C3E50",strokeThickness:3}).setOrigin(.5).setDepth(100),this.scene.tweens.add({targets:this.fogLabel,alpha:{from:1,to:.6},duration:1e3,yoyo:!0,repeat:-1})}startCrosswind(){const t=Math.random()>.5?1:-1,i=t>0?"â†’â†’â†’":"â†â†â†";this.windIndicator.setText(`WIND ${i}`),this.windIndicator.setVisible(!0),this.scene.ship&&this.scene.ship.setDrift(e.STORMS.CROSSWIND.driftForce,t),this.scene.tweens.add({targets:this.windIndicator,x:e.WIDTH/2+20*t,duration:500,yoyo:!0,repeat:-1})}startSignalFlood(){this.scene.events.emit("signalFlood",{spawnMultiplier:e.STORMS.SIGNAL_FLOOD.spawnMultiplier,noiseRatio:e.STORMS.SIGNAL_FLOOD.noiseRatio})}startNarrowPass(){const t=e.STORMS.NARROW_PASS.passWidth,i=e.WIDTH/2,s=i-t/2,o=i+t/2;for(let e=0;e<6;e++){const t=-50-60*e,i=this.scene.physics.add.sprite(s-20,t,"buoy");i.setVelocityY(150),this.buoys.add(i);const a=this.scene.physics.add.sprite(o+20,t,"buoy");a.setVelocityY(150),this.buoys.add(a)}this.scene.ship&&(this.buoyCollider=this.scene.physics.add.overlap(this.scene.ship,this.buoys,(t,e)=>{t.flash(15158332),this.scene.scoreManager.addInsight(!1),e.destroy()}))}update(t,i){return this.activeStorm?t>=this.stormEndTime?(this.endStorm(),{active:!1}):(this.buoys.children.iterate(t=>{t&&t.y>e.HEIGHT+50&&t.destroy()}),{active:!0,type:this.activeStorm,remaining:this.stormEndTime-t}):(this.checkForStorm(t),{active:!1})}endStorm(){const t=this.activeStorm;switch(this.activeStorm=null,t){case"FOG":this.scene.tweens.add({targets:this.fogOverlay,alpha:0,duration:800}),this.scene.tweens.add({targets:this.fogOverlay2,alpha:0,duration:800}),this.fogParticles&&(this.fogParticles.destroy(),this.fogParticles=null),this.fogLabel&&(this.scene.tweens.killTweensOf(this.fogLabel),this.fogLabel.destroy(),this.fogLabel=null),this.scene.radarUI&&this.scene.radarUI.setBlurred(!1);break;case"CROSSWIND":this.windIndicator.setVisible(!1),this.scene.tweens.killTweensOf(this.windIndicator),this.windIndicator.x=e.WIDTH/2,this.scene.ship&&this.scene.ship.clearDrift();break;case"SIGNAL_FLOOD":this.scene.events.emit("signalFloodEnd");break;case"NARROW_PASS":this.buoys.clear(!0,!0),this.buoyCollider&&(this.buoyCollider.destroy(),this.buoyCollider=null)}this.scene.events.emit("stormEnded",t)}isNavigatorEffective(){return"FOG"===this.activeStorm||"SIGNAL_FLOOD"===this.activeStorm}isCaptainEffective(){return"CROSSWIND"===this.activeStorm}getActiveStorm(){return this.activeStorm}destroy(){this.fogOverlay.destroy(),this.fogOverlay2.destroy(),this.fogParticles&&this.fogParticles.destroy(),this.fogLabel&&this.fogLabel.destroy(),this.windIndicator.destroy(),this.warningText.destroy(),this.buoys.clear(!0,!0)}}class g{constructor(t){this.scene=t,this.combo=0,this.maxCombo=0,this.lastCollectTime=0,this.comboTimer=null,this.createComboDisplay(),this.createParticleEmitter()}createComboDisplay(){this.comboContainer=this.scene.add.container(e.WIDTH/2,100).setDepth(200),this.comboText=this.scene.add.text(0,0,"",{fontFamily:"Arial, sans-serif",fontSize:"48px",fontStyle:"bold",color:"#F1C40F",stroke:"#000000",strokeThickness:6}).setOrigin(.5).setAlpha(0),this.comboLabel=this.scene.add.text(0,35,"COMBO",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5).setAlpha(0),this.comboContainer.add([this.comboText,this.comboLabel])}createParticleEmitter(){if(!this.scene.textures.exists("particle")){const t=this.scene.add.graphics();t.fillStyle(16777215),t.fillCircle(4,4,4),t.generateTexture("particle",8,8),t.destroy()}}addCombo(t,i,s){if(!s)return this.resetCombo(),0;this.combo++,this.maxCombo=Math.max(this.maxCombo,this.combo),this.lastCollectTime=this.scene.time.now,this.comboTimer&&this.comboTimer.remove(),this.comboTimer=this.scene.time.delayedCall(e.COMBO.TIMEOUT,()=>{this.resetCombo()});const o=Math.min(this.combo-1,e.COMBO.MULTIPLIERS.length-1),a=e.COMBO.MULTIPLIERS[o];return this.combo>=2&&(this.showComboDisplay(),this.spawnParticles(t,i,o),this.shakeScreen(o),this.scene.soundGen&&this.scene.soundGen.playComboSound&&this.scene.soundGen.playComboSound(o)),5===this.combo?this.scene.events.emit("achievement","COMBO_5"):10===this.combo&&this.scene.events.emit("achievement","COMBO_10"),a}showComboDisplay(){const t=["#F1C40F","#E67E22","#E74C3C","#9B59B6","#FF0000","#FF00FF"],e=Math.min(this.combo-1,t.length-1);this.comboText.setText(`${this.combo}x`),this.comboText.setColor(t[e]),this.scene.tweens.killTweensOf(this.comboText),this.scene.tweens.killTweensOf(this.comboLabel),this.comboText.setAlpha(1).setScale(1.5),this.comboLabel.setAlpha(1),this.scene.tweens.add({targets:this.comboText,scale:1,duration:200,ease:"Back.out"}),this.combo>=5&&this.scene.tweens.add({targets:this.comboText,scale:{from:1,to:1.1},duration:300,yoyo:!0,repeat:-1})}hideComboDisplay(){this.scene.tweens.add({targets:[this.comboText,this.comboLabel],alpha:0,duration:300})}spawnParticles(t,i,s){const o=e.COMBO.PARTICLE_COUNT[s]||5,a=[3066993,15844367,15105570,15158332,10181046,16711935][s]||3066993;for(let e=0;e<o;e++){const n=2*Math.PI*e/o,r=100+30*s,l=this.scene.add.circle(t,i,4+s,a).setDepth(100);this.scene.tweens.add({targets:l,x:t+Math.cos(n)*r,y:i+Math.sin(n)*r,scale:0,alpha:0,duration:400+50*s,ease:"Power2",onComplete:()=>l.destroy()})}if(s>=3)for(let e=0;e<2*s;e++){const s=this.scene.add.circle(t+Phaser.Math.Between(-30,30),i+Phaser.Math.Between(-30,30),4,16777215).setDepth(101);this.scene.tweens.add({targets:s,scale:0,alpha:0,duration:500,delay:30*e,onComplete:()=>s.destroy()})}}shakeScreen(t){const i=e.COMBO.SHAKE_INTENSITY[t]||0;i>0&&this.scene.cameras.main.shake(100,i/1e3)}resetCombo(){this.combo>=2&&this.hideComboDisplay(),this.combo=0,this.comboTimer&&(this.comboTimer.remove(),this.comboTimer=null)}getCombo(){return this.combo}getMaxCombo(){return this.maxCombo}getMultiplier(){if(0===this.combo)return 1;const t=Math.min(this.combo-1,e.COMBO.MULTIPLIERS.length-1);return e.COMBO.MULTIPLIERS[t]}destroy(){this.comboTimer&&this.comboTimer.remove(),this.comboContainer.destroy()}}class y{constructor(t){this.scene=t,this.createElements()}createElements(){const t=this.scene;this.scoreText=t.add.text(20,20,"SCORE: 0",{fontFamily:"Arial, sans-serif",fontSize:"24px",fontStyle:"bold",color:"#ECF0F1"}).setDepth(100),this.multiplierText=t.add.text(20,50,"x1.00",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#1ABC9C"}).setDepth(100),this.timerText=t.add.text(e.WIDTH-20,20,"90",{fontFamily:"Arial, sans-serif",fontSize:"32px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(1,0).setDepth(100),this.timerLabel=t.add.text(e.WIDTH-20,55,"SEKUNDEN",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(1,0).setDepth(100),this.phaseText=t.add.text(e.WIDTH/2,20,"PHASE 1",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#1ABC9C"}).setOrigin(.5,0).setDepth(100),this.createQualityBar(t)}createQualityBar(t){const i=e.WIDTH/2-75;this.qualityBarBg=t.add.rectangle(i,45,150,8,2899536).setOrigin(0,0).setDepth(100),this.qualityBarFill=t.add.rectangle(i,45,0,8,e.COLORS.INSIGHT_REAL).setOrigin(0,0).setDepth(100),this.qualityLabel=t.add.text(e.WIDTH/2,58,"INSIGHT QUALITÃ„T",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5,0).setDepth(100),this.highScoreText=t.add.text(20,75,"",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setDepth(100)}setHighScore(t){this.highScoreText.setText(`BEST: ${t}`)}update(t,i,s=1,o=1,a=1,n=0){(isNaN(s)||void 0===s)&&(s=1),this.scoreText.setText(`SCORE: ${i}`),this.multiplierText.setText(`x${s.toFixed(2)}`),s>1?this.multiplierText.setColor("#F1C40F"):s<1?this.multiplierText.setColor("#E74C3C"):this.multiplierText.setColor("#1ABC9C");const r=Math.max(0,Math.ceil((e.GAME_DURATION-t)/1e3));this.timerText.setText(r.toString()),r<=10&&this.timerText.setColor(r%2==0?"#E74C3C":"#ECF0F1"),this.phaseText.setText(`PHASE ${a}`);const l=150*Math.max(0,Math.min(1,o));this.qualityBarFill.width=l,o>=.7?this.qualityBarFill.setFillStyle(e.COLORS.INSIGHT_REAL):o>=.4?this.qualityBarFill.setFillStyle(15965202):this.qualityBarFill.setFillStyle(e.COLORS.INSIGHT_FAKE)}showPointsPopup(t,e,i){const s=i>=0?"#2ECC71":"#E74C3C",o=i>=0?"+":"",a=this.scene.add.text(t,e,`${o}${i}`,{fontFamily:"Arial, sans-serif",fontSize:"20px",fontStyle:"bold",color:s}).setOrigin(.5).setDepth(100);this.scene.tweens.add({targets:a,y:e-50,alpha:0,duration:800,ease:"Power2",onComplete:()=>a.destroy()})}showMessage(t,i=2e3){const s=this.scene.add.text(e.WIDTH/2,e.HEIGHT/2-50,t,{fontFamily:"Arial, sans-serif",fontSize:"28px",fontStyle:"bold",color:"#ECF0F1",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(150).setAlpha(0);this.scene.tweens.add({targets:s,alpha:1,duration:200,yoyo:!0,hold:i-400,onComplete:()=>s.destroy()})}destroy(){this.scoreText.destroy(),this.multiplierText.destroy(),this.timerText.destroy(),this.timerLabel.destroy(),this.phaseText.destroy(),this.qualityBarBg.destroy(),this.qualityBarFill.destroy(),this.qualityLabel.destroy(),this.highScoreText.destroy()}}class T{constructor(t){this.scene=t,this.isBlurred=!1,this.blurAmount=0,this.createRadar()}createRadar(){const t=this.scene,i=e.WIDTH-110,s=e.HEIGHT-110;this.radarBg=t.add.graphics().setDepth(50),this.drawRadarBackground(i,s,80),this.sweep=t.add.image(i,s,"radar-sweep").setScale(.8).setAlpha(.6).setDepth(51),t.tweens.add({targets:this.sweep,angle:360,duration:2e3,repeat:-1,ease:"Linear"}),this.centerDot=t.add.circle(i,s,4,e.COLORS.ACCENT).setDepth(52),this.pings=t.add.group(),this.fogOverlay=t.add.rectangle(i,s,160,160,8359053,0).setDepth(53)}drawRadarBackground(t,i,s){const o=this.radarBg;o.clear(),o.lineStyle(2,e.COLORS.ACCENT,.8),o.strokeCircle(t,i,s),o.lineStyle(1,e.COLORS.ACCENT,.3),o.strokeCircle(t,i,.66*s),o.strokeCircle(t,i,.33*s),o.lineStyle(1,e.COLORS.ACCENT,.2),o.lineBetween(t-s,i,t+s,i),o.lineBetween(t,i-s,t,i+s);const a={fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#1ABC9C"};this.compassN=this.scene.add.text(t,i-s-8,"N",a).setOrigin(.5).setDepth(52),this.compassS=this.scene.add.text(t,i+s+8,"S",a).setOrigin(.5).setDepth(52)}addPing(t,i,s){const o=2*(t/e.WIDTH-.5)*70,a=2*((i+50)/(e.HEIGHT+100)-.5)*70,n=e.WIDTH-110+o,r=e.HEIGHT-110+a;if(Math.sqrt(o*o+a*a)>84)return;const l=s?e.COLORS.INSIGHT_REAL:e.COLORS.INSIGHT_FAKE,h=this.scene.add.circle(n,r,3,l,.8).setDepth(52);this.isBlurred&&!s&&(h.x+=Phaser.Math.Between(-10,10)*this.blurAmount,h.y+=Phaser.Math.Between(-10,10)*this.blurAmount),this.pings.add(h),this.scene.tweens.add({targets:h,alpha:0,scale:2,duration:2e3,onComplete:()=>h.destroy()})}setBlurred(t,e=.6){this.isBlurred=t,this.blurAmount=e,t?this.scene.tweens.add({targets:this.fogOverlay,alpha:.5*e,duration:500}):this.scene.tweens.add({targets:this.fogOverlay,alpha:0,duration:500})}update(t){}destroy(){this.radarBg.destroy(),this.sweep.destroy(),this.centerDot.destroy(),this.fogOverlay.destroy(),this.compassN.destroy(),this.compassS.destroy(),this.pings.clear(!0,!0)}}class C{constructor(t,e){this.scene=t,this.availableBoosts=e,this.meterValue=0,this.maxValue=100,this.isReady=!1,this.activeBoost=null,this.createMeter()}createMeter(){const t=this.scene,i=e.HEIGHT-100;this.meterBg=t.add.rectangle(20,i,30,80,2899536).setOrigin(0,1).setDepth(100),this.meterBorder=t.add.rectangle(20,i,30,80).setOrigin(0,1).setStrokeStyle(2,e.COLORS.ACCENT).setDepth(100),this.meterFill=t.add.rectangle(22,i-2,26,0,e.COLORS.ACCENT).setOrigin(0,1).setDepth(100),this.label=t.add.text(35,i+10,"CREW",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5,0).setDepth(100),this.anchorIcon=t.add.text(35,i-40,"âš“",{fontSize:"24px"}).setOrigin(.5).setDepth(100),this.readyText=t.add.text(35,i-85,"BEREIT!",{fontFamily:"Arial, sans-serif",fontSize:"12px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(.5).setDepth(100).setVisible(!1),this.createBoostChoicePanel(75,i-60),this.scene.input.keyboard.on("keydown-Q",()=>this.activateBoost(0)),this.scene.input.keyboard.on("keydown-E",()=>this.activateBoost(1))}createBoostChoicePanel(t,i){this.choicePanel=this.scene.add.container(t,i).setDepth(100).setAlpha(0);const s=this.scene.add.rectangle(0,0,100,70,1714746,.95).setStrokeStyle(1,e.COLORS.ACCENT);this.choicePanel.add(s);const o=this.scene.add.text(0,-25,"WÃ¤hle Boost:",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5);this.choicePanel.add(o),this.boostOptions=[],this.availableBoosts.forEach((t,i)=>{const s=e.BOOSTS[t],o=25*i-5,a=this.scene.add.text(-40,o,0===i?"[Q]":"[E]",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#F1C40F"}).setOrigin(0,.5),n=this.scene.add.text(-15,o,s.name,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#ECF0F1"}).setOrigin(0,.5);this.choicePanel.add([a,n]),this.boostOptions.push({keyLabel:a,nameLabel:n,boostKey:t})})}addValue(t){this.activeBoost||(this.meterValue=Math.max(0,Math.min(this.maxValue,this.meterValue+t)),this.updateMeterFill(),this.meterValue>=this.maxValue&&!this.isReady&&(this.isReady=!0,this.showReadyState()))}updateMeterFill(){const t=this.meterValue/this.maxValue*76;this.meterFill.height=t,this.meterValue>=this.maxValue?this.meterFill.setFillStyle(15844367):this.meterValue>=.7*this.maxValue?this.meterFill.setFillStyle(3066993):this.meterFill.setFillStyle(e.COLORS.ACCENT)}showReadyState(){this.readyText.setVisible(!0),this.scene.tweens.add({targets:this.choicePanel,alpha:1,duration:300}),this.scene.tweens.add({targets:[this.readyText,this.meterBorder,this.anchorIcon],scale:{from:1,to:1.1},duration:500,yoyo:!0,repeat:-1})}activateBoost(t){if(!this.isReady||this.activeBoost||t>=this.availableBoosts.length)return null;const e=this.availableBoosts[t];return this.activeBoost=e,this.isReady=!1,this.meterValue=0,this.scene.tweens.killTweensOf(this.readyText),this.scene.tweens.killTweensOf(this.meterBorder),this.scene.tweens.killTweensOf(this.anchorIcon),this.readyText.setVisible(!1),this.meterBorder.setScale(1),this.anchorIcon.setScale(1),this.scene.tweens.add({targets:this.choicePanel,alpha:0,duration:200}),this.updateMeterFill(),this.startBoostTimer(e),e}startBoostTimer(t){const i=e.BOOSTS[t];this.activeBoostText=this.scene.add.text(35,e.HEIGHT-60,i.name,{fontFamily:"Arial, sans-serif",fontSize:"12px",fontStyle:"bold",color:"#"+i.color.toString(16).padStart(6,"0")}).setDepth(100),this.boostTimerText=this.scene.add.text(35,e.HEIGHT-45,"6s",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#F1C40F"}).setDepth(100);let s=e.BOOST_DURATION/1e3;this.boostTimer=this.scene.time.addEvent({delay:1e3,repeat:s-1,callback:()=>{s--,this.boostTimerText&&this.boostTimerText.setText(s+"s")}}),this.scene.time.delayedCall(e.BOOST_DURATION,()=>{this.endBoost()})}endBoost(){const t=this.activeBoost;return this.activeBoost=null,this.boostTimerText&&(this.boostTimerText.destroy(),this.boostTimerText=null),this.activeBoostText&&(this.activeBoostText.destroy(),this.activeBoostText=null),this.boostTimer&&(this.boostTimer.remove(),this.boostTimer=null),t}getActiveBoost(){return this.activeBoost}isBoostActive(){return null!==this.activeBoost}destroy(){this.meterBg.destroy(),this.meterBorder.destroy(),this.meterFill.destroy(),this.label.destroy(),this.readyText.destroy(),this.anchorIcon.destroy(),this.choicePanel.destroy(),this.boostTimerText&&this.boostTimerText.destroy(),this.activeBoostText&&this.activeBoostText.destroy()}}class I{constructor(){this.audioContext=null,this.windSource=null,this.windGain=null,this.enabled=!0}init(){try{return this.audioContext=new(window.AudioContext||window.webkitAudioContext),!0}catch(t){return this.enabled=!1,!1}}resume(){this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume()}playSonarPing(t=!0){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,i=e.currentTime,s=e.createOscillator(),o=e.createGain();s.type="sine",t?(s.frequency.setValueAtTime(600,i),s.frequency.exponentialRampToValueAtTime(1200,i+.1),o.gain.setValueAtTime(.2,i)):(s.frequency.setValueAtTime(400,i),s.frequency.exponentialRampToValueAtTime(200,i+.15),o.gain.setValueAtTime(.15,i)),o.gain.exponentialRampToValueAtTime(.001,i+.3),s.connect(o),o.connect(e.destination),s.start(i),s.stop(i+.3)}playSuccessChime(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,e=t.currentTime;[523.25,659.25,783.99].forEach((i,s)=>{const o=t.createOscillator(),a=t.createGain();o.type="sine",o.frequency.setValueAtTime(i,e);const n=e+.08*s;a.gain.setValueAtTime(0,n),a.gain.linearRampToValueAtTime(.15,n+.02),a.gain.exponentialRampToValueAtTime(.001,n+.3),o.connect(a),a.connect(t.destination),o.start(n),o.stop(n+.3)})}playWarning(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,e=t.currentTime;for(let i=0;i<2;i++){const s=t.createOscillator(),o=t.createGain();s.type="sawtooth",s.frequency.setValueAtTime(200,e+.2*i),s.frequency.linearRampToValueAtTime(400,e+.2*i+.1),o.gain.setValueAtTime(.1,e+.2*i),o.gain.exponentialRampToValueAtTime(.001,e+.2*i+.15),s.connect(o),o.connect(t.destination),s.start(e+.2*i),s.stop(e+.2*i+.15)}}playBoostActivate(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,e=t.currentTime,i=t.createOscillator(),s=t.createGain();i.type="triangle",i.frequency.setValueAtTime(300,e),i.frequency.exponentialRampToValueAtTime(800,e+.2),s.gain.setValueAtTime(.2,e),s.gain.exponentialRampToValueAtTime(.001,e+.4),i.connect(s),s.connect(t.destination),i.start(e),i.stop(e+.4)}startWindAmbience(){if(!this.enabled||!this.audioContext||this.windSource)return;const t=this.audioContext,e=2*t.sampleRate,i=t.createBuffer(1,e,t.sampleRate),s=i.getChannelData(0);for(let a=0;a<e;a++)s[a]=2*Math.random()-1;this.windSource=t.createBufferSource(),this.windSource.buffer=i,this.windSource.loop=!0;const o=t.createBiquadFilter();o.type="bandpass",o.frequency.value=400,o.Q.value=.5,this.windGain=t.createGain(),this.windGain.gain.value=.03,this.windSource.connect(o),o.connect(this.windGain),this.windGain.connect(t.destination),this.windSource.start()}setWindIntensity(t){this.windGain&&this.windGain.gain.linearRampToValueAtTime(.03+.05*t,this.audioContext.currentTime+.1)}stopWindAmbience(){this.windSource&&(this.windSource.stop(),this.windSource=null,this.windGain=null)}playGameOver(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,e=t.currentTime,i=t.createOscillator(),s=t.createGain();i.type="sine",i.frequency.setValueAtTime(440,e),i.frequency.exponentialRampToValueAtTime(220,e+.5),s.gain.setValueAtTime(.2,e),s.gain.exponentialRampToValueAtTime(.001,e+.6),i.connect(s),s.connect(t.destination),i.start(e),i.stop(e+.6)}playComboSound(t){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,i=e.currentTime,s=400+100*t;if([s,1.25*s,1.5*s].forEach((s,o)=>{const a=e.createOscillator(),n=e.createGain();a.type=t>=4?"square":"sine",a.frequency.setValueAtTime(s,i+.05*o),n.gain.setValueAtTime(.15,i+.05*o),n.gain.exponentialRampToValueAtTime(.001,i+.05*o+.15),a.connect(n),n.connect(e.destination),a.start(i+.05*o),a.stop(i+.05*o+.15)}),t>=3){const s=e.createOscillator(),o=e.createGain();s.type="sine",s.frequency.setValueAtTime(2e3+200*t,i),s.frequency.exponentialRampToValueAtTime(3e3,i+.1),o.gain.setValueAtTime(.1,i),o.gain.exponentialRampToValueAtTime(.001,i+.15),s.connect(o),o.connect(e.destination),s.start(i),s.stop(i+.15)}}playPowerUpSound(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,e=t.currentTime;[800,1e3,1200,1500,1800].forEach((i,s)=>{const o=t.createOscillator(),a=t.createGain();o.type="sine",o.frequency.setValueAtTime(i,e+.03*s),a.gain.setValueAtTime(.12,e+.03*s),a.gain.exponentialRampToValueAtTime(.001,e+.03*s+.2),o.connect(a),a.connect(t.destination),o.start(e+.03*s),o.stop(e+.03*s+.2)})}playAchievementSound(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,e=t.currentTime;[{freq:523.25,time:0},{freq:659.25,time:.1},{freq:783.99,time:.2},{freq:1046.5,time:.35}].forEach(({freq:i,time:s})=>{const o=t.createOscillator(),a=t.createGain();o.type="triangle",o.frequency.setValueAtTime(i,e+s),a.gain.setValueAtTime(.2,e+s),a.gain.exponentialRampToValueAtTime(.001,e+s+.4),o.connect(a),a.connect(t.destination),o.start(e+s),o.stop(e+s+.4)})}playPhaseChange(t){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,i=e.currentTime,s=e.createBufferSource(),o=.5*e.sampleRate,a=e.createBuffer(1,o,e.sampleRate),n=a.getChannelData(0);for(let h=0;h<o;h++)n[h]=2*Math.random()-1;s.buffer=a;const r=e.createBiquadFilter();r.type="bandpass",r.frequency.setValueAtTime(200,i),r.frequency.exponentialRampToValueAtTime(2e3,i+.3),r.Q.value=1;const l=e.createGain();if(l.gain.setValueAtTime(.3,i),l.gain.exponentialRampToValueAtTime(.001,i+.5),s.connect(r),r.connect(l),l.connect(e.destination),s.start(i),s.stop(i+.5),3===t){const t=e.createOscillator(),s=e.createGain();t.type="sine",t.frequency.setValueAtTime(80,i),t.frequency.exponentialRampToValueAtTime(40,i+.3),s.gain.setValueAtTime(.4,i),s.gain.exponentialRampToValueAtTime(.001,i+.4),t.connect(s),s.connect(e.destination),t.start(i),t.stop(i+.4)}}playNearMiss(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,e=t.currentTime,i=t.createOscillator(),s=t.createGain();i.type="sine",i.frequency.setValueAtTime(300,e),i.frequency.exponentialRampToValueAtTime(600,e+.1),s.gain.setValueAtTime(.08,e),s.gain.exponentialRampToValueAtTime(.001,e+.15),i.connect(s),s.connect(t.destination),i.start(e),i.stop(e+.15)}destroy(){this.stopWindAmbience(),this.audioContext&&this.audioContext.close()}}class E extends Phaser.Scene{constructor(){super("Game")}init(){this.gameTime=0,this.phase=1,this.currentMultiplier=1,this.noiseModifier=0,this.spawnModifier=0,this.lastInsightSpawn=0,this.lastGateTime=0,this.signalFloodActive=!1,this.isGameOver=!1,this.isPaused=!1,this.stormsWeathered=0,this.insightsInLast30Sec=0,this.last30SecCheck=0,this.collectedNoFakes=!0,this.physics&&this.physics.resume(),this.time&&(this.time.paused=!1)}create(){this.soundGen=new I,this.soundGen.init(),this.waveEffect=new o(this),this.ship=new h(this,e.WIDTH/2,e.SHIP.START_Y),this.insights=this.add.group(),this.gates=[],this.inputManager=new f(this),this.scoreManager=new m(this),this.stormManager=new S(this),this.comboManager=new g(this),this.powerUpManager=new p(this),this.achievementNotification=new r(this);const t=Object.keys(e.BOOSTS),i=Phaser.Utils.Array.Shuffle([...t]);this.availableBoosts=i.slice(0,2),this.hud=new y(this),this.radarUI=new T(this),this.boostMeter=new C(this,this.availableBoosts),this.physics.add.overlap(this.ship,this.insights,this.collectInsight,null,this),this.physics.add.overlap(this.ship,this.powerUpManager.powerUps,(t,e)=>this.powerUpManager.collectPowerUp(e),null,this),this.events.on("gateSelected",this.onGateSelected,this),this.events.on("stormStarted",this.onStormStarted,this),this.events.on("stormEnded",this.onStormEnded,this),this.events.on("signalFlood",this.onSignalFlood,this),this.events.on("signalFloodEnd",this.onSignalFloodEnd,this),this.events.on("achievement",this.onAchievement,this),this.input.keyboard.on("keydown-H",()=>this.togglePauseHelp()),this.input.keyboard.on("keydown-ESC",()=>this.togglePauseHelp()),this.soundGen.startWindAmbience(),this.hud.showMessage("LOS GEHT'S!",1500);const s=n.getHighScore();s>0&&this.hud.setHighScore(s)}update(t,i){try{if(this.isGameOver||this.isPaused)return;if((isNaN(i)||i<=0)&&(i=16),i=Math.min(i,100),this.gameTime+=i,(isNaN(this.gameTime)||this.gameTime<0)&&(this.gameTime=0),this.gameTime>=e.GAME_DURATION-100)return void this.endGame();this.updatePhase();const s=this.inputManager.getInput();this.ship.update(i,s),s.boost&&this.activateBoost(),this.spawnInsights(),this.spawnGates(),this.stormManager.update(this.gameTime,i).active?(this.waveEffect.setIntensity(.5),this.soundGen.setWindIntensity(.5)):(this.waveEffect.setIntensity(0),this.soundGen.setWindIntensity(0)),this.gates=this.gates.filter(t=>!t.update(i)||(t.destroy(),!1)),this.insights.children.iterate(t=>{t&&t.update(i)}),this.powerUpManager.update(i),"NAVIGATOR"===this.boostMeter.getActiveBoost()&&this.insights.children.iterate(t=>{t&&t.isReal&&t.setHighlighted(!0)}),this.checkNearMisses(),this.waveEffect.update(t);const o=this.comboManager.getMultiplier()||1,a=this.powerUpManager.getMultiplier()||1,n=(this.currentMultiplier||1)*o*a;this.hud.update(this.gameTime,this.scoreManager.getScore(),n,this.scoreManager.getQualityRatio(),this.phase,this.comboManager.getCombo()),this.inputManager.isMobile&&this.inputManager.setBoostReady(this.boostMeter.isReady),this.gameTime-this.last30SecCheck>=3e4&&(this.insightsInLast30Sec>=50&&this.events.emit("achievement","SPEED_RUN"),this.insightsInLast30Sec=0,this.last30SecCheck=this.gameTime)}catch(s){}}updatePhase(){let t=1;if(this.gameTime>=e.PHASE_2_END?t=3:this.gameTime>=e.PHASE_1_END&&(t=2),t!==this.phase){this.phase=t,this.hud.showMessage(`PHASE ${this.phase}`,1500),this.soundGen.playPhaseChange(this.phase);const e=i[this.phase];this.stormManager.setStormChance(e.stormChance)}}spawnInsights(){const t=i[this.phase];let s=e.INSIGHT.SPAWN_INTERVAL_BASE*t.insightSpawnRate;if(s*=1+this.spawnModifier,this.signalFloodActive&&(s*=.3),this.gameTime-this.lastInsightSpawn<s)return;if(this.lastInsightSpawn=this.gameTime,Math.random()<e.POWERUPS.SPAWN_CHANCE){const t=Phaser.Math.Between(100,e.WIDTH-100);return void this.powerUpManager.spawnPowerUp(t)}let o=t.realChance-this.noiseModifier;o=Math.max(.3,o),this.signalFloodActive&&(o=.3);const a=Math.random()<o,n=Phaser.Math.Between(50,e.WIDTH-50),r=new c(this,n,-30,a);r.setVelocityY(e.INSIGHT.SPEED_BASE*t.insightSpeed),this.insights.add(r),this.radarUI.addPing(n,-30,a)}spawnGates(){if(this.gameTime<e.GATE_INTERVAL)return;if(this.gameTime-this.lastGateTime<e.GATE_INTERVAL)return;if(this.gates.length>0)return;this.lastGateTime=this.gameTime;const t=new d(this);this.gates.push(t)}collectInsight(t,i){if(i.collected)return;if(!i.collect())return;const s=i.isReal;let o=i.getPoints(),a=i.getMeterValue();s||(this.collectedNoFakes=!1),s||"ANALYST"!==this.boostMeter.getActiveBoost()||(o=0,a=5),!s&&this.powerUpManager.isActive("SHIELD")&&(o=0,a=0,this.hud.showMessage("GEBLOCKT!",500));const n=this.comboManager.addCombo(t.x,t.y,s),r=this.currentMultiplier*n*this.powerUpManager.getMultiplier();o=Math.round(o*r),this.scoreManager.addInsight(s,r),s&&this.insightsInLast30Sec++,this.boostMeter.addValue(a),this.hud.showPointsPopup(t.x,t.y-30,o),t.flash(s?e.COLORS.INSIGHT_REAL:e.COLORS.INSIGHT_FAKE),this.soundGen.playSonarPing(s)}checkNearMisses(){const t=this.ship;this.insights.children.iterate(e=>{if(!e||e.isReal||e.nearMissTriggered)return;const i=Phaser.Math.Distance.Between(t.x,t.y,e.x,e.y);if(i<40&&i>25){e.nearMissTriggered=!0,this.soundGen.playNearMiss();const t=10;this.scoreManager.addBonus(t),this.hud.showPointsPopup(e.x,e.y-20,t);const i=this.add.text(e.x,e.y-30,"NICE!",{fontFamily:"Arial",fontSize:"14px",color:"#F39C12"}).setOrigin(.5).setDepth(100);this.tweens.add({targets:i,y:e.y-60,alpha:0,duration:600,onComplete:()=>i.destroy()})}})}activateBoost(){const t=this.boostMeter.activateBoost(0)||this.boostMeter.activateBoost(1);if(!t)return;switch(this.soundGen.playBoostActivate(),this.hud.showMessage(`${e.BOOSTS[t].name} AKTIVIERT!`,1e3),t){case"CAPTAIN":this.ship.setStabilized(!0),this.time.delayedCall(e.BOOST_DURATION,()=>{this.ship.setStabilized(!1)});break;case"CREW_SYNC":this.currentMultiplier+=1,this.time.delayedCall(e.BOOST_DURATION,()=>{this.currentMultiplier-=1})}const i=this.checkBoostEffectiveness(t);this.scoreManager.addBoostUsage(i)}checkBoostEffectiveness(t){const e=this.stormManager.getActiveStorm();return"NAVIGATOR"===t&&("FOG"===e||"SIGNAL_FLOOD"===e)||"CAPTAIN"===t&&"CROSSWIND"===e||"ANALYST"===t&&"SIGNAL_FLOOD"===e}onGateSelected(t){this.soundGen.playSuccessChime();const i=e.GATES[t];this.currentMultiplier*=i.multiplier,this.scoreManager.addGateChoice(t),i.noiseIncrease&&(this.noiseModifier+=i.noiseIncrease),i.noiseReduction&&(this.noiseModifier-=i.noiseReduction),i.stormChanceIncrease&&this.stormManager.adjustStormChance(i.stormChanceIncrease),i.stormChanceReduction&&this.stormManager.adjustStormChance(-i.stormChanceReduction),i.spawnReduction&&(this.spawnModifier+=i.spawnReduction),this.scoreManager.gateChoices.length>=5&&this.events.emit("achievement","PERFECT_GATE")}onStormStarted(t){this.soundGen.playWarning()}onStormEnded(t){this.stormsWeathered++,this.stormsWeathered>=3&&this.events.emit("achievement","SURVIVOR")}onSignalFlood(t){this.signalFloodActive=!0}onSignalFloodEnd(){this.signalFloodActive=!1}onAchievement(t){this.achievementNotification.show(t)}togglePauseHelp(){if(!this.isGameOver)if(this.isPaused=!this.isPaused,this.isPaused){this.physics.pause(),this.time.paused=!0,this.pauseOverlay=this.add.rectangle(e.WIDTH/2,e.HEIGHT/2,e.WIDTH,e.HEIGHT,0,.85).setDepth(200),this.pauseContainer=this.add.container(e.WIDTH/2,e.HEIGHT/2).setDepth(201);const t=this.add.text(0,-200,"PAUSE",{fontFamily:"Arial, sans-serif",fontSize:"36px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5);this.pauseContainer.add(t);let i=-140;[{title:"STEUERUNG",items:["â† â†’ oder A/D: Boot steuern","H oder ESC: Pause/Hilfe"]},{title:"INSIGHTS & POWER-UPS",items:["â— GrÃ¼n = Echte Insights (+Punkte)","â— Rot = Fake/Noise (ausweichen!)","â¬¡ Power-Ups: Einsammeln = sofort aktiv!"]},{title:"BOOST-METER (links)",items:["FÃ¼llt sich durch Insight-Sammeln",'Bei 100%: "BEREIT!" erscheint',"â†’ DrÃ¼cke Q oder E fÃ¼r Crew-Boost!","Navigator/Captain/Analyst/Crew Sync"]},{title:"STRATEGY GATES (alle ~15 Sek.)",items:["Erscheint oben - KLICKE oder 1/2/3:","SPEED | QUALITY | SAFETY"]}].forEach(t=>{const e=this.add.text(-200,i,t.title,{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#F1C40F"});this.pauseContainer.add(e),i+=20,t.items.forEach(t=>{const e=this.add.text(-200,i,t,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#BDC3C7"});this.pauseContainer.add(e),i+=18}),i+=10});const s=this.add.rectangle(0,180,180,40,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.togglePauseHelp());this.pauseContainer.add(s);const o=this.add.text(0,180,"WEITERSPIELEN",{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5);this.pauseContainer.add(o);const a=this.add.text(0,215,"H oder ESC zum Fortsetzen",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#7F8C8D"}).setOrigin(.5);this.pauseContainer.add(a)}else this.physics.resume(),this.time.paused=!1,this.pauseOverlay&&(this.pauseOverlay.destroy(),this.pauseOverlay=null),this.pauseContainer&&(this.pauseContainer.destroy(),this.pauseContainer=null)}endGame(){if(this.isGameOver)return;this.isGameOver=!0;try{this.soundGen.playGameOver(),this.soundGen.stopWindAmbience()}catch(e){}let t={};try{const e=this.ship?this.ship.getStabilityScore():50;t=this.scoreManager.getStats(e),t.maxCombo=this.comboManager?this.comboManager.getMaxCombo():0,t.totalInsights=(t.realInsights||0)+(t.fakeInsights||0),this.collectedNoFakes&&t.totalInsights>10&&(n.unlockAchievement("NO_FAKE"),t.noFakeAchievement=!0),0===n.getStats().gamesPlayed&&n.unlockAchievement("FIRST_GAME");const i=n.updateHighScore(t.finalScore);t.isNewHighScore=i,i&&n.unlockAchievement("HIGH_SCORE"),n.addGameStats(t)}catch(e){t={finalScore:this.scoreManager?this.scoreManager.getScore():0,realInsights:0,fakeInsights:0,maxCombo:0,totalInsights:0}}window._gameEndStats=t,this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("End",t)}),setTimeout(()=>{this.scene&&this.scene.isActive("Game")&&this.scene.start("End",window._gameEndStats||t)},500)}shutdown(){this.events.off("gateSelected"),this.events.off("stormStarted"),this.events.off("stormEnded"),this.events.off("signalFlood"),this.events.off("signalFloodEnd"),this.events.off("achievement"),this.inputManager.destroy(),this.stormManager.destroy(),this.comboManager.destroy(),this.powerUpManager.destroy(),this.achievementNotification.destroy(),this.hud.destroy(),this.radarUI.destroy(),this.boostMeter.destroy(),this.waveEffect.destroy(),this.soundGen.destroy()}}const b=new class{constructor(){this.isConfigured=t,this.baseUrl="https://smmngegesumuokmrdujx.supabase.co",this.apiKey=t,this.cachedLeaderboard=null,this.lastFetch=0,this.cacheTimeout=3e4}submitScore(t,e){return __async(this,arguments,function*(t,e,i={}){if(!this.isConfigured)return{success:!1,error:"not_configured"};const s={player_name:t.substring(0,20).replace(/[<>]/g,""),score:Math.floor(e),max_combo:i.maxCombo||0,achievements:i.achievements||[],strategy_profile:i.strategyProfile||"Balanced",ship_skin:i.shipSkin||"default"};try{const t=yield fetch(`${this.baseUrl}/rest/v1/leaderboard`,{method:"POST",headers:{"Content-Type":"application/json",apikey:this.apiKey,Authorization:`Bearer ${this.apiKey}`,Prefer:"return=representation"},body:JSON.stringify(s)});if(!t.ok)throw new Error(`HTTP ${t.status}`);const e=yield t.json();return this.cachedLeaderboard=null,{success:!0,data:e}}catch(o){return{success:!1,error:o.message}}})}getTopScores(t=10){return __async(this,null,function*(){if(!this.isConfigured)return{success:!1,scores:[],error:"not_configured"};const e=Date.now();if(this.cachedLeaderboard&&e-this.lastFetch<this.cacheTimeout)return{success:!0,scores:this.cachedLeaderboard,cached:!0};try{const i=yield fetch(`${this.baseUrl}/rest/v1/leaderboard?select=player_name,score,max_combo,strategy_profile,ship_skin,created_at&order=score.desc&limit=${t}`,{headers:{apikey:this.apiKey,Authorization:`Bearer ${this.apiKey}`}});if(!i.ok)throw new Error(`HTTP ${i.status}`);const s=yield i.json();return this.cachedLeaderboard=s,this.lastFetch=e,{success:!0,scores:s}}catch(i){return{success:!1,scores:[],error:i.message}}})}getPlayerRank(t){return __async(this,null,function*(){if(!this.isConfigured)return{success:!1,rank:null};try{const e=(yield fetch(`${this.baseUrl}/rest/v1/leaderboard?select=count&score=gte.${t}`,{headers:{apikey:this.apiKey,Authorization:`Bearer ${this.apiKey}`,Prefer:"count=exact"}})).headers.get("content-range");return{success:!0,rank:e?parseInt(e.split("/")[1]):null}}catch(e){return{success:!1,rank:null}}})}isAvailable(){return this.isConfigured}};class x extends Phaser.Scene{constructor(){super("End")}init(t){this.stats=t||{},this.nameEntered=!1,this.submittedScore=!1,this.isEnteringName=!1}create(){const t="ontouchstart"in window||navigator.maxTouchPoints>0,i=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),s=window.innerWidth<=1024;this.isMobile=i||t&&s,this.add.rectangle(e.WIDTH/2,e.HEIGHT/2,e.WIDTH,e.HEIGHT,e.COLORS.BACKGROUND),this.createCourseReport(),this.createLeaderboardSection(),this.createCTAButtons();const o=this.isMobile?e.HEIGHT-35:e.HEIGHT-15,a=this.isMobile?140:130,n=this.isMobile?32:24,r=this.isMobile?85:80;this.add.rectangle(e.WIDTH/2-r,o,a,n,1752220,.9).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.restartGame()),this.add.text(e.WIDTH/2-r,o,"â–¶ Nochmal spielen",{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"12px":"11px",color:"#FFFFFF"}).setOrigin(.5),this.add.rectangle(e.WIDTH/2+r,o,a,n,2899536,.8).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.goToMenu()),this.add.text(e.WIDTH/2+r,o,"âš™ Zum MenÃ¼",{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"12px":"11px",color:"#ECF0F1"}).setOrigin(.5),this.input.keyboard.on("keydown-SPACE",()=>{this.isEnteringName||this.restartGame()}),this.cameras.main.fadeIn(500),this.loadLeaderboard()}createCourseReport(){const t=this.isMobile?e.WIDTH/2:.25*e.WIDTH,i=this.isMobile?30:60;this.add.text(t,i,"COURSE REPORT",{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"20px":"28px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5);const s=this.stats.resultType||"Game Over";this.add.text(t,i+28,s,{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"14px":"18px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5),this.add.text(t,i+55,"FINAL SCORE",{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"10px":"12px",color:"#7F8C8D"}).setOrigin(.5);const o=this.stats.finalScore||0;if(this.add.text(t,i+82,o.toLocaleString(),{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"36px":"48px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(.5),this.stats.isNewHighScore&&this.add.text(t,i+115,"â˜… NEUER HIGHSCORE! â˜…",{fontFamily:"Arial, sans-serif",fontSize:this.isMobile?"12px":"14px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(.5),this.isMobile){const e=i+(this.stats.isNewHighScore?140:125),s=this.stats.realInsights||0,o=this.stats.qualityScore||0;this.add.text(t,e,`${s} Insights | ${o}% QualitÃ¤t`,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#7F8C8D"}).setOrigin(.5)}else{const e=i+170,s=120;this.createStatBox(t-s,e,"QUALITÃ„T",`${this.stats.qualityScore||0}%`,this.getQualityColor(this.stats.qualityScore||0)),this.createStatBox(t,e,"STABILITÃ„T",`${this.stats.stabilityScore||0}%`,this.getQualityColor(this.stats.stabilityScore||0)),this.createStatBox(t+s,e,"STRATEGIE",this.stats.strategyProfile||"Balanced","#9B59B6");const o=this.stats.realInsights||0,a=this.stats.fakeInsights||0;this.add.text(t,e+80,`${o} echte / ${a} falsche Insights`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#7F8C8D"}).setOrigin(.5);const n=this.stats.multiplier||"1.00";this.add.text(t,e+105,`Multiplikator: x${n}`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#7F8C8D"}).setOrigin(.5)}}createStatBox(t,e,i,s,o){this.add.text(t,e,i,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5),this.add.text(t,e+22,s,{fontFamily:"Arial, sans-serif",fontSize:"18px",fontStyle:"bold",color:o}).setOrigin(.5)}getQualityColor(t){return t>=70?"#2ECC71":t>=40?"#F39C12":"#E74C3C"}createLeaderboardSection(){if(this.isMobile)return b.isAvailable()&&this.createNameInput(e.WIDTH/2,e.HEIGHT-180),void(this.leaderboardContainer=this.add.container(0,0));const t=e.WIDTH-200;this.add.rectangle(t,e.HEIGHT/2-40,280,e.HEIGHT-140,859964,.8).setStrokeStyle(1,1752220,.5),this.add.text(t,60,"LEADERBOARD",{fontFamily:"Arial, sans-serif",fontSize:"18px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5),this.leaderboardLoading=this.add.text(t,140,"Laden...",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5),this.leaderboardContainer=this.add.container(t-120,90),b.isAvailable()&&this.createNameInput(t,e.HEIGHT-120)}createNameInput(t,e){this.add.text(t,e-35,"Name fÃ¼r Leaderboard:",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#F1C40F"}).setOrigin(.5),this.add.rectangle(t,e,180,28,1714746).setStrokeStyle(2,1752220),this.playerName="",this.nameText=this.add.text(t,e,"|",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ECF0F1"}).setOrigin(.5),this.add.rectangle(t,e+30,100,24,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.submitScore()),this.add.text(t,e+30,"EINTRAGEN",{fontFamily:"Arial, sans-serif",fontSize:"11px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5),this.isEnteringName=!0,this.input.keyboard.on("keydown",t=>{this.isEnteringName&&!this.submittedScore&&("Enter"===t.key?this.submitScore():"Backspace"===t.key?this.playerName=this.playerName.slice(0,-1):1===t.key.length&&this.playerName.length<12&&/^[a-zA-Z0-9_\-\. ]$/.test(t.key)&&(this.playerName+=t.key),this.nameText.setText(this.playerName+"|"))}),this.time.addEvent({delay:500,callback:()=>{if(this.nameText&&this.isEnteringName&&!this.submittedScore){const t=this.nameText.text.endsWith("|")?"":"|";this.nameText.setText(this.playerName+t)}},loop:!0})}submitScore(){return __async(this,null,function*(){if(this.submittedScore||!this.playerName.trim())return;const t=this.playerName.trim()||"Anonym",e=this.stats.finalScore||0;this.submittedScore=!0,this.isEnteringName=!1,this.nameText.setText(t+" ...");const i=yield b.submitScore(t,e,{maxCombo:this.stats.maxCombo||0,strategyProfile:this.stats.strategyProfile||"Balanced",shipSkin:n.getSelectedSkin()});i.success?(this.nameText.setText(t+" âœ“"),this.loadLeaderboard()):this.nameText.setText(t+" âœ— "+(i.error||""))})}loadLeaderboard(){return __async(this,null,function*(){const t=yield b.getTopScores(8);if(this.leaderboardLoading&&(this.leaderboardLoading.destroy(),this.leaderboardLoading=null),this.leaderboardContainer.removeAll(!0),!t.success||0===t.scores.length){const e=t.success?"Noch keine EintrÃ¤ge":"Nicht verfÃ¼gbar: "+(t.error||""),i=this.add.text(110,50,e,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#7F8C8D"}).setOrigin(.5);return void this.leaderboardContainer.add(i)}t.scores.forEach((t,i)=>{const s=28*i,o=t.score===this.stats.finalScore&&this.submittedScore,a=0===i?"#F1C40F":1===i?"#BDC3C7":2===i?"#CD7F32":"#7F8C8D",n=this.add.text(0,s,`${i+1}.`,{fontFamily:"Arial, sans-serif",fontSize:"13px",color:a}),r=this.add.text(24,s,(t=>{const i=e.SHIP_SKINS,s=Object.values(i).find(e=>e.id===t);return s?s.icon:"â›µ"})(t.ship_skin),{fontSize:"14px"}),l=this.add.text(46,s,t.player_name.substring(0,10),{fontFamily:"Arial, sans-serif",fontSize:"13px",color:o?"#1ABC9C":"#ECF0F1"}),h=this.add.text(240,s,t.score.toLocaleString(),{fontFamily:"Arial, sans-serif",fontSize:"13px",color:o?"#1ABC9C":"#F1C40F"}).setOrigin(1,0);this.leaderboardContainer.add([n,r,l,h])})})}createCTAButtons(){if(this.isMobile)return;const t=e.HEIGHT-55,i=.25*e.WIDTH;this.createButton(i-90,t,160,36,"GesprÃ¤ch vereinbaren",e.COLORS.ACCENT,()=>window.open("https://www.flybridge.ch/kontakt","_blank")),this.createButton(i+90,t,160,36,"Mehr erfahren",3426654,()=>window.open("https://www.flybridge.ch","_blank"))}createButton(t,e,i,s,o,a,n){const r=this.add.rectangle(t,e,i,s,a).setInteractive({useHandCursor:!0}).on("pointerover",()=>r.setScale(1.05)).on("pointerout",()=>r.setScale(1)).on("pointerdown",n);this.add.text(t,e,o,{fontFamily:"Arial, sans-serif",fontSize:"12px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5)}restartGame(){this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>{this.scene.start("Game")})}goToMenu(){this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>{this.scene.start("Menu")})}}const w={type:Phaser.AUTO,parent:"game-container",width:e.WIDTH,height:e.HEIGHT,backgroundColor:e.COLORS.BACKGROUND,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,min:{width:640,height:360},max:{width:1920,height:1080}},physics:{default:"arcade",arcade:{debug:!1}},scene:[s,l,E,x],input:{activePointers:2}},A=new Phaser.Game(w);window.FlybridgeRadarRun={game:A,restart:()=>{A.scene.start("Menu")}}}();
