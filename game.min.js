var __defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,s)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,__spreadValues=(e,t)=>{for(var s in t||(t={}))__hasOwnProp.call(t,s)&&__defNormalProp(e,s,t[s]);if(__getOwnPropSymbols)for(var s of __getOwnPropSymbols(t))__propIsEnum.call(t,s)&&__defNormalProp(e,s,t[s]);return e},__async=(e,t,s)=>new Promise((i,a)=>{var o=e=>{try{r(s.next(e))}catch(t){a(t)}},n=e=>{try{r(s.throw(e))}catch(t){a(t)}},r=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,n);r((s=s.apply(e,t)).next())});!function(){"use strict";const e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNtbW5nZWdlc3VtdW9rbXJkdWp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyNzIzMDMsImV4cCI6MjA4Mzg0ODMwM30.0tG0QyjReEMh8QXpmaR-vgPa7mGEPENCUaVTZ_Dz6pA",t={WIDTH:800,HEIGHT:600,GAME_DURATION:9e4,PHASE_1_END:25e3,PHASE_2_END:6e4,GATE_INTERVAL:15e3,STORM_MIN_INTERVAL:12e3,STORM_MAX_INTERVAL:2e4,STORM_DURATION:4e3,BOOST_DURATION:6e3,SHIP:{SPEED:300,DRIFT_SPEED:150,START_Y:500,BOUNDS_MARGIN:40},INSIGHT:{SPAWN_INTERVAL_BASE:800,SPAWN_INTERVAL_MIN:400,SPEED_BASE:150,SPEED_MAX:250,REAL_CHANCE_BASE:.7,REAL_CHANCE_MIN:.4,POINTS_REAL:100,POINTS_FAKE:-30,METER_FILL_REAL:15,METER_FILL_FAKE:-5},COMBO:{TIMEOUT:2e3,MULTIPLIERS:[1,1.2,1.5,2,2.5,3],SHAKE_INTENSITY:[0,2,4,6,8,10],PARTICLE_COUNT:[3,5,8,12,16,20]},POWERUPS:{SPAWN_CHANCE:.15,DURATION:8e3,TYPES:{MAGNET:{name:"Magnet",color:10181046,radius:150,description:"Zieht Insights an"},SHIELD:{name:"Schild",color:3447003,description:"Blockiert Fake-Schaden"},DOUBLE:{name:"2x Punkte",color:15844367,multiplier:2,description:"Doppelte Punkte"},GOLDEN:{name:"Golden Insight",color:16766720,points:500,description:"Mega-Punkte!"}}},ACHIEVEMENTS:{COMBO_5:{id:"combo_5",name:"Combo Master",description:"5er Combo erreichen",icon:"üî•"},COMBO_10:{id:"combo_10",name:"Combo Legend",description:"10er Combo erreichen",icon:"üí•"},NO_FAKE:{id:"no_fake",name:"Scharfes Auge",description:"Kein Fake gesammelt",icon:"üëÅÔ∏è"},PERFECT_GATE:{id:"perfect_gate",name:"Stratege",description:"Alle Gates gew√§hlt",icon:"üéØ"},HIGH_SCORE:{id:"high_score",name:"Highscore!",description:"Neuer pers√∂nlicher Rekord",icon:"üèÜ"},FIRST_GAME:{id:"first_game",name:"Willkommen",description:"Erstes Spiel abgeschlossen",icon:"‚öì"},SPEED_RUN:{id:"speed_run",name:"Turbo",description:"50 Insights in 30 Sekunden",icon:"‚ö°"},SURVIVOR:{id:"survivor",name:"√úberlebender",description:"3 St√ºrme √ºberstanden",icon:"üåä"}},GATES:{SPEED:{name:"Speed",color:15158332,multiplier:1.5,noiseIncrease:.15,stormChanceIncrease:.1},QUALITY:{name:"Quality",color:3066993,multiplier:1,insightQualityBonus:.2,spawnReduction:.3},SAFETY:{name:"Safety",color:3447003,multiplier:.8,stormChanceReduction:.3,noiseReduction:.1}},BOOSTS:{NAVIGATOR:{name:"Navigator",description:"Zeigt echte Insights klar markiert",color:1752220},ANALYST:{name:"Analyst",description:"Noise wird neutral",color:10181046},CAPTAIN:{name:"Captain",description:"Weniger Drift bei Sturm",color:15965202},CREW_SYNC:{name:"Crew Sync",description:"+1 Multiplikator f√ºr saubere Fahrt",color:15277667}},STORMS:{FOG:{name:"Nebel",radarBlur:.6},CROSSWIND:{name:"Seitenwind",driftForce:200},SIGNAL_FLOOD:{name:"Signal Flood",spawnMultiplier:3,noiseRatio:.7},NARROW_PASS:{name:"Engpass",passWidth:200}},COLORS:{BACKGROUND:661032,WATER_DARK:859964,WATER_LIGHT:1718876,ACCENT:1752220,INSIGHT_REAL:3066993,INSIGHT_FAKE:15158332,UI_TEXT:15528177,UI_DARK:2899536},SCORING:{QUALITY_BONUS_THRESHOLD:.7,QUALITY_BONUS_MULTIPLIER:1.5,STABILITY_BONUS_MAX:500,BOOST_EFFICIENCY_BONUS:200}},s={1:{insightSpawnRate:1,insightSpeed:1,realChance:t.INSIGHT.REAL_CHANCE_BASE,stormChance:0},2:{insightSpawnRate:.8,insightSpeed:1.2,realChance:.6,stormChance:.3},3:{insightSpawnRate:.6,insightSpeed:1.5,realChance:.5,stormChance:.5}};class i extends Phaser.Scene{constructor(){super("Boot")}create(){this.generateTextures(),this.scene.start("Menu")}generateTextures(){this.generateShipTexture(),this.generateInsightTextures(),this.generateBuoyTexture(),this.generateRadarSweep(),this.generateGateTextures(),this.generateBoostIcons()}generateShipTexture(){const e=this.add.graphics(),s=28;e.fillStyle(661032,.4),e.fillEllipse(s,66,44,10),e.fillStyle(15528177),e.beginPath(),e.moveTo(s,4),e.lineTo(34,8),e.lineTo(42,20),e.lineTo(44,45),e.lineTo(42,58),e.lineTo(32,62),e.lineTo(24,62),e.lineTo(14,58),e.lineTo(12,45),e.lineTo(14,20),e.lineTo(22,8),e.closePath(),e.fillPath(),e.fillStyle(2899536),e.beginPath(),e.moveTo(42,52),e.lineTo(44,45),e.lineTo(44,55),e.lineTo(42,60),e.lineTo(14,60),e.lineTo(12,55),e.lineTo(12,45),e.lineTo(14,52),e.closePath(),e.fillPath(),e.fillStyle(12436423,.5),e.beginPath(),e.moveTo(s,6),e.lineTo(23,10),e.lineTo(15,22),e.lineTo(13,44),e.lineTo(15,56),e.lineTo(25,60),e.lineTo(s,60),e.lineTo(s,6),e.closePath(),e.fillPath(),e.fillStyle(9139029),e.beginPath(),e.moveTo(s,12),e.lineTo(38,22),e.lineTo(40,44),e.lineTo(38,54),e.lineTo(18,54),e.lineTo(16,44),e.lineTo(18,22),e.closePath(),e.fillPath(),e.lineStyle(1,7033668,.3);for(let t=-8;t<=8;t+=4)e.lineBetween(s+t,24,s+t,52);e.fillStyle(16777215),e.fillRoundedRect(18,26,20,20,3),e.fillStyle(15528177),e.fillRoundedRect(17,24,22,6,2),e.fillStyle(6139362,.9),e.fillRoundedRect(21,28,6,5,1),e.fillRoundedRect(29,28,6,5,1),e.fillStyle(8765929,.7),e.fillRect(18,32,2,8),e.fillRect(36,32,2,8),e.fillStyle(16777215),e.fillRoundedRect(20,16,16,10,2),e.lineStyle(1,9807270),e.strokeRect(21,17,14,8),e.fillStyle(2899536),e.fillCircle(25,21,2),e.fillCircle(31,21,2),e.fillStyle(3426654),e.fillRect(26,17,4,3),e.fillStyle(8359053),e.fillRect(27,6,2,12),e.fillStyle(16777215),e.fillCircle(s,6,4),e.fillStyle(t.COLORS.ACCENT,.6),e.fillCircle(s,6,3),e.lineStyle(1,1752220),e.strokeCircle(s,6,4),e.fillStyle(9139029),e.fillRect(20,60,16,4),e.fillStyle(2899536),e.fillRect(22,62,4,5),e.fillRect(30,62,4,5),e.fillStyle(1710618),e.fillRect(23,65,2,3),e.fillRect(31,65,2,3),e.fillStyle(3066993),e.fillCircle(40,22,2),e.fillStyle(15158332),e.fillCircle(16,22,2),e.fillStyle(16777215),e.fillCircle(s,10,1.5),e.generateTexture("ship",56,70),e.destroy()}generateInsightTextures(){const e=40,s=20,i=this.add.graphics();i.fillStyle(3066993,.08),i.fillCircle(s,s,18),i.fillStyle(3066993,.12),i.fillCircle(s,s,15),i.fillStyle(3066993,.2),i.fillCircle(s,s,12),i.fillStyle(t.COLORS.INSIGHT_REAL,.9),i.fillCircle(s,s,10),i.lineStyle(2,2600544),i.strokeCircle(s,s,10),i.fillStyle(5822093,.7),i.fillCircle(s,s,6),i.fillStyle(8577194,.8),i.fillCircle(s,s,3),i.fillStyle(16777215,.4),i.fillCircle(17,17,2),i.generateTexture("insight-real",e,e),i.destroy();const a=this.add.graphics();a.fillStyle(15158332,.06),a.fillCircle(21,s,16),a.fillStyle(15158332,.1),a.fillCircle(19,21,14),a.fillStyle(15158332,.15),a.fillCircle(s,s,11),a.fillStyle(t.COLORS.INSIGHT_FAKE,.8),a.fillCircle(s,s,8),a.lineStyle(2,12597547),a.strokeCircle(s,s,8),a.fillStyle(15037299,.5),a.fillCircle(18,18,3),a.fillStyle(15832202,.4),a.fillCircle(22,21,2),a.generateTexture("insight-fake",e,e),a.destroy();const o=this.add.graphics();o.fillStyle(15844367,.15),o.fillCircle(s,s,19),o.fillStyle(15844367,.25),o.fillCircle(s,s,16),o.lineStyle(3,15844367,.9),o.strokeCircle(s,s,14),o.fillStyle(3066993,.2),o.fillCircle(s,s,12),o.fillStyle(t.COLORS.INSIGHT_REAL,.95),o.fillCircle(s,s,10),o.lineStyle(2,2600544),o.strokeCircle(s,s,10),o.fillStyle(5822093,.8),o.fillCircle(s,s,6),o.fillStyle(11267014,.9),o.fillCircle(s,s,3),o.generateTexture("insight-highlighted",e,e),o.destroy()}generateBuoyTexture(){const e=this.add.graphics();e.fillStyle(15158332),e.fillRoundedRect(4,0,12,30,4),e.fillStyle(16777215),e.fillRect(4,10,12,8),e.fillStyle(12597547),e.fillCircle(10,4,6),e.generateTexture("buoy",20,34),e.destroy()}generateRadarSweep(){const e=this.add.graphics(),s=100;for(let i=0;i<60;i++){const a=(60-i)/60*.4,o=-i*(Math.PI/180);e.lineStyle(3,t.COLORS.ACCENT,a),e.beginPath(),e.moveTo(s,s),e.lineTo(s+90*Math.cos(o),s+90*Math.sin(o)),e.strokePath()}e.generateTexture("radar-sweep",200,200),e.destroy()}generateGateTextures(){const e=[15158332,3066993,3447003];["SPEED","QUALITY","SAFETY"].forEach((t,s)=>{const i=this.add.graphics();i.lineStyle(4,e[s],.9),i.strokeRoundedRect(2,2,96,56,8),i.fillStyle(e[s],.2),i.fillRoundedRect(4,4,92,52,6),i.fillStyle(e[s],.8),i.fillTriangle(50,45,40,35,60,35),i.generateTexture(`gate-${t.toLowerCase()}`,100,60),i.destroy()})}generateBoostIcons(){const e=t.BOOSTS;Object.entries(e).forEach(([e,t])=>{const s=this.add.graphics();s.fillStyle(t.color,.3),s.fillCircle(20,20,18),s.lineStyle(3,t.color),s.strokeCircle(20,20,18),s.fillStyle(t.color),"NAVIGATOR"===e?s.fillTriangle(20,8,14,26,26,26):"ANALYST"===e?(s.fillRect(10,24,6,10),s.fillRect(17,18,6,16),s.fillRect(24,12,6,22)):"CAPTAIN"===e?(s.lineStyle(3,t.color),s.strokeCircle(20,14,5),s.lineBetween(20,19,20,32),s.lineBetween(12,28,20,32),s.lineBetween(28,28,20,32)):"CREW_SYNC"===e&&(s.fillCircle(14,14,4),s.fillCircle(26,14,4),s.fillRect(10,20,8,12),s.fillRect(22,20,8,12)),s.generateTexture(`boost-${e.toLowerCase()}`,40,40),s.destroy()})}}class a{constructor(e){this.scene=e,this.waves=[],this.stars=[],this.particles=[],this.createBackground(),this.createStars(),this.createWaves(),this.createAmbientParticles()}createBackground(){const e=this.scene.add.graphics().setDepth(-10);for(let s=0;s<.6*t.HEIGHT;s+=4){const i=s/(.6*t.HEIGHT),a=Math.floor(10+5*i)<<16|Math.floor(22+10*i)<<8|Math.floor(40+20*i);e.fillStyle(a,1),e.fillRect(0,s,t.WIDTH,4)}e.fillStyle(1718876,.3),e.fillRect(0,.4*t.HEIGHT,t.WIDTH,60),e.fillStyle(2771564,.2),e.fillRect(0,.42*t.HEIGHT,t.WIDTH,40),this.background=e}createStars(){for(let e=0;e<50;e++){const e=Phaser.Math.Between(0,t.WIDTH),s=Phaser.Math.Between(0,.5*t.HEIGHT),i=Phaser.Math.FloatBetween(.5,2),a=Phaser.Math.FloatBetween(.3,.8),o=Phaser.Math.FloatBetween(.001,.003),n=Phaser.Math.FloatBetween(0,2*Math.PI),r=this.scene.add.circle(e,s,i,16777215,a).setDepth(-5);this.stars.push({sprite:r,baseAlpha:a,twinkleSpeed:o,twinkleOffset:n})}}createAmbientParticles(){for(let e=0;e<20;e++){const e=Phaser.Math.Between(0,t.WIDTH),s=Phaser.Math.Between(.3*t.HEIGHT,t.HEIGHT),i=Phaser.Math.FloatBetween(1,3),a=Phaser.Math.FloatBetween(.1,.3),o=Phaser.Math.FloatBetween(-.3,.3),n=Phaser.Math.FloatBetween(-.2,.1),r=this.scene.add.circle(e,s,i,6139362,a).setDepth(2);this.particles.push({sprite:r,speedX:o,speedY:n,baseY:s})}}createWaves(){const e=[661032,859964,1718876,859964,1453386],t=[.9,.7,.5,.4,.3];for(let s=0;s<5;s++){const i=this.createWaveGraphics(e[s],t[s],s);this.waves.push(i)}}createWaveGraphics(e,s,i){return{graphics:this.scene.add.graphics().setDepth(i),amplitude:15+5*i,frequency:.02-.003*i,baseY:t.HEIGHT-150+40*i,speed:.5+.2*i,offset:50*i,color:e,alpha:s}}update(e){this.stars.forEach(t=>{const s=Math.sin(e*t.twinkleSpeed+t.twinkleOffset);t.sprite.setAlpha(t.baseAlpha*(.5+.5*s))}),this.particles.forEach(e=>{e.sprite.x+=e.speedX,e.sprite.y+=e.speedY,e.sprite.x<0&&(e.sprite.x=t.WIDTH),e.sprite.x>t.WIDTH&&(e.sprite.x=0),e.sprite.y<.3*t.HEIGHT&&(e.sprite.y=t.HEIGHT),e.sprite.y>t.HEIGHT&&(e.sprite.y=.3*t.HEIGHT)}),this.waves.forEach((s,i)=>{const a=s.graphics;a.clear(),a.fillStyle(s.color,s.alpha),a.beginPath(),a.moveTo(0,t.HEIGHT);for(let o=0;o<=t.WIDTH;o+=8){const t=s.baseY+Math.sin((o+e*s.speed+s.offset)*s.frequency)*s.amplitude+Math.sin((.5*o+e*s.speed*1.5)*s.frequency*2)*(.3*s.amplitude);a.lineTo(o,t)}if(a.lineTo(t.WIDTH,t.HEIGHT),a.closePath(),a.fillPath(),i===this.waves.length-1){a.lineStyle(1,6139362,.2);for(let i=0;i<=t.WIDTH;i+=8){const t=s.baseY+Math.sin((i+e*s.speed+s.offset)*s.frequency)*s.amplitude+Math.sin((.5*i+e*s.speed*1.5)*s.frequency*2)*(.3*s.amplitude);a.lineTo(i,t)}}})}setIntensity(e){this.waves.forEach((t,s)=>{t.amplitude=(15+5*s)*(1+.5*e),t.speed=(.5+.2*s)*(1+.3*e)})}destroy(){this.waves.forEach(e=>e.graphics.destroy()),this.waves=[],this.stars.forEach(e=>e.sprite.destroy()),this.stars=[],this.particles.forEach(e=>e.sprite.destroy()),this.particles=[],this.background&&this.background.destroy()}}const o="flybridge_radar_run",n=new class{constructor(){this.data=this.loadData()}loadData(){try{const e=localStorage.getItem(o);if(e)return JSON.parse(e)}catch(e){}return{highScore:0,gamesPlayed:0,totalInsightsCollected:0,totalFakesAvoided:0,maxCombo:0,achievements:[],lastPlayed:null}}saveData(){try{this.data.lastPlayed=(new Date).toISOString(),localStorage.setItem(o,JSON.stringify(this.data))}catch(e){}}getHighScore(){return this.data.highScore}updateHighScore(e){return e>this.data.highScore&&(this.data.highScore=e,this.saveData(),!0)}addGameStats(e){this.data.gamesPlayed++,this.data.totalInsightsCollected+=e.realInsights||0,e.maxCombo>this.data.maxCombo&&(this.data.maxCombo=e.maxCombo),this.saveData()}unlockAchievement(e){return!this.data.achievements.includes(e)&&(this.data.achievements.push(e),this.saveData(),!0)}hasAchievement(e){return this.data.achievements.includes(e)}getUnlockedAchievements(){return this.data.achievements}getStats(){return __spreadValues({},this.data)}resetProgress(){this.data={highScore:0,gamesPlayed:0,totalInsightsCollected:0,totalFakesAvoided:0,maxCombo:0,achievements:[],lastPlayed:null},this.saveData()}};class r{constructor(e){this.scene=e,this.queue=[],this.isShowing=!1,this.createContainer()}createContainer(){this.container=this.scene.add.container(t.WIDTH/2,-80).setDepth(500),this.bg=this.scene.add.rectangle(0,0,300,70,0,.9).setStrokeStyle(3,15844367),this.icon=this.scene.add.text(-120,0,"",{fontSize:"32px"}).setOrigin(.5),this.title=this.scene.add.text(-80,-12,"",{fontFamily:"Arial",fontSize:"18px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(0,.5),this.desc=this.scene.add.text(-80,12,"",{fontFamily:"Arial",fontSize:"14px",color:"#BDC3C7"}).setOrigin(0,.5),this.container.add([this.bg,this.icon,this.title,this.desc])}show(e){const s=t.ACHIEVEMENTS[e];s&&(n.hasAchievement(e)||(n.unlockAchievement(e),this.queue.push(s),this.processQueue()))}processQueue(){if(this.isShowing||0===this.queue.length)return;this.isShowing=!0;const e=this.queue.shift();this.icon.setText(e.icon),this.title.setText(e.name),this.desc.setText(e.description),this.scene.tweens.add({targets:this.container,y:50,duration:500,ease:"Back.out",onComplete:()=>{this.scene.time.delayedCall(2500,()=>{this.scene.tweens.add({targets:this.container,y:-80,duration:400,ease:"Back.in",onComplete:()=>{this.isShowing=!1,this.processQueue()}})})}}),this.scene.soundGen&&this.scene.soundGen.playAchievementSound&&this.scene.soundGen.playAchievementSound()}destroy(){this.container.destroy()}}class h extends Phaser.Scene{constructor(){super("Menu")}create(){this.showingTutorial=!1,this.waveEffect=new a(this),this.title=this.add.text(t.WIDTH/2,80,"SET THE COURSE",{fontFamily:"Arial, sans-serif",fontSize:"42px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5),this.subtitle=this.add.text(t.WIDTH/2,120,"FLYBRIDGE RADAR RUN",{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#1ABC9C"}).setOrigin(.5),this.shipPreview=this.add.image(t.WIDTH/2,190,"ship").setScale(1.8),this.tweens.add({targets:this.shipPreview,y:200,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"});const e=n.getStats();e.highScore>0&&(this.add.text(t.WIDTH/2,245,`HIGHSCORE: ${e.highScore}`,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#F1C40F"}).setOrigin(.5),this.add.text(t.WIDTH/2,265,`Spiele: ${e.gamesPlayed} | Max Combo: ${e.maxCombo}x`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5)),this.createQuickInstructions(),this.createButtons(),this.cameras.main.fadeIn(500)}createQuickInstructions(){this.add.text(t.WIDTH/2,280,"90 Sekunden. Sammle echte Insights. Setze deinen Kurs.",{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"italic",color:"#95A5A6"}).setOrigin(.5),[{icon:"‚Üê‚Üí",text:"Pfeiltasten / A+D zum Steuern",color:"#ECF0F1"},{icon:"‚óè",text:"Gr√ºn = Echte Insights (+Punkte)",color:"#2ECC71"},{icon:"‚óè",text:"Rot = Noise (ausweichen!)",color:"#E74C3C"},{icon:"‚ñÆ",text:"Boost-Meter links: Bei 100% ‚Üí Taste Q/E",color:"#F1C40F"},{icon:"‚õ≥",text:"Strategy Gates: Klicke oder 1/2/3",color:"#F39C12"}].forEach((e,s)=>{const i=320+28*s;this.add.text(t.WIDTH/2-160,i,e.icon,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:e.color}).setOrigin(.5),this.add.text(t.WIDTH/2-130,i,e.text,{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#BDC3C7"}).setOrigin(0,.5)})}createButtons(){const e=this.createButton(t.WIDTH/2,t.HEIGHT-120,"SPIEL STARTEN","#1ABC9C",()=>{this.startGame()});this.tweens.add({targets:e.bg,scaleX:1.05,scaleY:1.05,duration:600,yoyo:!0,repeat:-1}),this.createButton(t.WIDTH/2,t.HEIGHT-60,"ANLEITUNG","#34495E",()=>{this.showTutorial()}),this.add.text(t.WIDTH/2,t.HEIGHT-20,"SPACE = Start | H = Anleitung",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#5D6D7E"}).setOrigin(.5),this.input.keyboard.on("keydown-SPACE",()=>{this.showingTutorial||this.startGame()}),this.input.keyboard.on("keydown-H",()=>{this.showingTutorial||this.showTutorial()})}createButton(e,t,s,i,a){const o=this.add.rectangle(e,t,200,40,Phaser.Display.Color.HexStringToColor(i).color,.9).setInteractive({useHandCursor:!0}).on("pointerover",()=>o.setFillStyle(Phaser.Display.Color.HexStringToColor(i).color,1)).on("pointerout",()=>o.setFillStyle(Phaser.Display.Color.HexStringToColor(i).color,.9)).on("pointerdown",a),n=this.add.text(e,t,s,{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5);return{bg:o,label:n}}showTutorial(){this.showingTutorial=!0;const e=this.add.rectangle(t.WIDTH/2,t.HEIGHT/2,t.WIDTH,t.HEIGHT,0,.9).setDepth(100).setInteractive(),s=this.add.container(t.WIDTH/2,t.HEIGHT/2).setDepth(101),i=this.add.rectangle(0,0,t.WIDTH-60,t.HEIGHT-60,1714746,.98).setStrokeStyle(2,1752220);s.add(i);const a=this.add.text(0,-220,"WIE SPIELT MAN?",{fontFamily:"Arial, sans-serif",fontSize:"28px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5);s.add(a);let o=-170;[{title:"ZIEL DES SPIELS",content:"Navigiere dein Boot 90 Sekunden lang durch den Datenstrom.\nSammle echte Insights (gr√ºn) und vermeide Noise (rot)."},{title:"STEUERUNG",content:"‚Üê ‚Üí oder A/D: Boot steuern | H/ESC: Pause"},{title:"INSIGHTS & POWER-UPS",content:"‚óè Gr√ºne Insights: +100 Punkte, f√ºllt Boost-Meter\n‚óè Rote Noise: -30 Punkte, bricht Combo\n‚¨° Power-Ups erscheinen zuf√§llig - einsammeln!"},{title:"BOOST-METER (gelber Balken links)",content:'F√ºllt sich durch Insight-Sammeln\nBei 100%: "BEREIT!" erscheint\n‚Üí Dr√ºcke dann Q oder E f√ºr Crew-Boost!'},{title:"STRATEGY GATES (alle ~15 Sek.)",content:"Men√º erscheint oben - KLICKE oder 1/2/3:\nSPEED (x1.5) | QUALITY | SAFETY (x0.8)"},{title:"RADAR & ST√úRME",content:"Radar (unten rechts): Zeigt wo Insights kommen\nSt√ºrme: Nebel, Wind, Signal-Flut"}].forEach((e,t)=>{const i=this.add.text(-300,o,e.title,{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#F1C40F"});s.add(i);const a=this.add.text(-300,o+18,e.content,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#BDC3C7",lineSpacing:4});s.add(a),o+=70});const n=this.add.rectangle(0,220,150,36,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{s.destroy(),e.destroy(),this.showingTutorial=!1});s.add(n);const r=this.add.text(0,220,"VERSTANDEN!",{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5);s.add(r),this.input.keyboard.once("keydown-ESC",()=>{s.destroy(),e.destroy(),this.showingTutorial=!1})}update(e,t){this.waveEffect.update(e)}startGame(){this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>{this.waveEffect.destroy(),this.scene.start("Game")})}}class l extends Phaser.Physics.Arcade.Sprite{constructor(e,s,i){super(e,s,i,"ship"),e.add.existing(this),e.physics.add.existing(this),this.setCollideWorldBounds(!0),this.body.setSize(36,50),this.setDrag(800),this.setMaxVelocity(t.SHIP.SPEED,50),this.driftForce=0,this.driftDirection=0,this.isStabilized=!1,this.isShielded=!1,this.stabilityScore=100,this.lastX=s,this.createTrail(e)}createTrail(e){this.trail=e.add.particles(this.x,this.y,"insight-real",{scale:{start:.25,end:0},alpha:{start:.4,end:0},speed:{min:15,max:30},lifespan:500,frequency:40,follow:this,followOffset:{x:0,y:32},tint:6139362}),this.wakeLeft=e.add.particles(this.x,this.y,"insight-real",{scale:{start:.15,end:0},alpha:{start:.3,end:0},speed:{min:20,max:40},angle:{min:150,max:180},lifespan:400,frequency:60,follow:this,followOffset:{x:-14,y:28},tint:8765929}),this.wakeRight=e.add.particles(this.x,this.y,"insight-real",{scale:{start:.15,end:0},alpha:{start:.3,end:0},speed:{min:20,max:40},angle:{min:0,max:30},lifespan:400,frequency:60,follow:this,followOffset:{x:14,y:28},tint:8765929}),this.radarGlow=e.add.circle(this.x,this.y-28,8,1752220,.3).setDepth(this.depth+1),e.tweens.add({targets:this.radarGlow,scale:{from:1,to:1.5},alpha:{from:.3,to:.1},duration:1e3,yoyo:!0,repeat:-1}),this.shieldGraphic=e.add.circle(this.x,this.y,40,3447003,.2).setStrokeStyle(3,3447003,.8).setDepth(this.depth+1).setVisible(!1)}update(e,s){if(s.left?(this.setVelocityX(-300),this.setAngle(-8)):s.right?(this.setVelocityX(t.SHIP.SPEED),this.setAngle(8)):this.setAngle(0),this.driftForce>0&&!this.isStabilized){const s=this.driftForce*this.driftDirection*(e/1e3);this.x+=s,this.x=Phaser.Math.Clamp(this.x,t.SHIP.BOUNDS_MARGIN,t.WIDTH-t.SHIP.BOUNDS_MARGIN)}const i=Math.abs(this.x-this.lastX);i<2?this.stabilityScore=Math.min(100,this.stabilityScore+.1):i>5&&(this.stabilityScore=Math.max(0,this.stabilityScore-.2)),this.lastX=this.x,this.shieldGraphic&&this.shieldGraphic.setPosition(this.x,this.y),this.radarGlow&&this.radarGlow.setPosition(this.x,this.y-24)}setShielded(e){this.isShielded=e,this.shieldGraphic&&(this.shieldGraphic.setVisible(e),e?this.scene.tweens.add({targets:this.shieldGraphic,scale:{from:1,to:1.1},alpha:{from:.3,to:.5},duration:500,yoyo:!0,repeat:-1}):(this.scene.tweens.killTweensOf(this.shieldGraphic),this.shieldGraphic.setScale(1)))}setDrift(e,t){this.driftForce=e,this.driftDirection=t}clearDrift(){this.driftForce=0,this.driftDirection=0}setStabilized(e){this.isStabilized=e}getStabilityScore(){return this.stabilityScore}flash(e=16777215){this.setTint(e),this.scene.time.delayedCall(100,()=>{this.clearTint()})}destroy(){this.trail&&this.trail.destroy(),this.wakeLeft&&this.wakeLeft.destroy(),this.wakeRight&&this.wakeRight.destroy(),this.radarGlow&&(this.scene&&this.scene.tweens&&this.scene.tweens.killTweensOf(this.radarGlow),this.radarGlow.destroy()),this.shieldGraphic&&this.shieldGraphic.destroy(),super.destroy()}}class c extends Phaser.Physics.Arcade.Sprite{constructor(e,s,i,a=!0){super(e,s,i,a?"insight-real":"insight-fake"),e.add.existing(this),e.physics.add.existing(this),this.isReal=a,this.isHighlighted=!1,this.collected=!1,this.setVelocityY(t.INSIGHT.SPEED_BASE),a?(this.createPulseEffect(e),this.createGlowTrail(e)):this.createFlickerEffect(e),this.body.setCircle(14,6,6)}createGlowTrail(e){this.glowTrail=e.add.circle(this.x,this.y,18,3066993,.15).setDepth(this.depth-1),e.tweens.add({targets:this.glowTrail,scale:{from:1,to:1.3},alpha:{from:.15,to:.05},duration:800,yoyo:!0,repeat:-1})}createPulseEffect(e){e.tweens.add({targets:this,scale:{from:.95,to:1.15},alpha:{from:.85,to:1},duration:700,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:this,angle:{from:-3,to:3},duration:1200,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createFlickerEffect(e){e.tweens.add({targets:this,alpha:{from:.35,to:.85},scale:{from:.7,to:1},duration:180,yoyo:!0,repeat:-1,ease:"Stepped",hold:Phaser.Math.Between(30,150)}),e.tweens.add({targets:this,angle:{from:-20,to:20},duration:250,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:this,scaleX:{from:.8,to:1.1},scaleY:{from:1.1,to:.85},duration:350,yoyo:!0,repeat:-1,ease:"Stepped"})}setHighlighted(e){e&&this.isReal&&!this.isHighlighted&&(this.isHighlighted=!0,this.setTexture("insight-highlighted"))}collect(){return!this.collected&&(this.collected=!0,this.glowTrail&&(this.scene.tweens.killTweensOf(this.glowTrail),this.glowTrail.destroy(),this.glowTrail=null),this.scene.tweens.add({targets:this,scale:1.8,alpha:0,duration:250,ease:"Quad.out",onComplete:()=>this.destroy()}),this.isReal&&this.createCollectionBurst(),!0)}createCollectionBurst(){const e=this.isReal?3066993:15158332;for(let t=0;t<8;t++){const s=t/8*Math.PI*2,i=this.scene.add.circle(this.x,this.y,4,e,.8).setDepth(100);this.scene.tweens.add({targets:i,x:this.x+40*Math.cos(s),y:this.y+40*Math.sin(s),alpha:0,scale:0,duration:300,ease:"Quad.out",onComplete:()=>i.destroy()})}}update(e){this.glowTrail&&this.glowTrail.setPosition(this.x,this.y),this.y>t.HEIGHT+50&&(this.glowTrail&&this.glowTrail.destroy(),this.destroy())}getPoints(){return this.isReal?t.INSIGHT.POINTS_REAL:t.INSIGHT.POINTS_FAKE}getMeterValue(){return this.isReal?t.INSIGHT.METER_FILL_REAL:t.INSIGHT.METER_FILL_FAKE}}class d{constructor(e,t=-100){this.scene=e,this.y=t,this.speed=100,this.selected=!1,this.selectedRoute=null,this.routes=["SPEED","QUALITY","SAFETY"],this.createGate()}createGate(){const e=this.scene,s=t.WIDTH/3;this.container=e.add.container(0,this.y).setDepth(40),this.overlay=e.add.rectangle(t.WIDTH/2,30,t.WIDTH,120,661032,.9),this.container.add(this.overlay),this.title=e.add.text(t.WIDTH/2,10,"W√ÑHLE DEINEN KURS",{fontFamily:"Arial, sans-serif",fontSize:"18px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5,0),this.container.add(this.title),this.routeButtons=[],this.routes.forEach((i,a)=>{const o=s*a+s/2,n=t.GATES[i],r=e.add.image(o,60,`gate-${i.toLowerCase()}`).setInteractive({useHandCursor:!0}).on("pointerover",()=>this.onRouteHover(a)).on("pointerout",()=>this.onRouteOut(a)).on("pointerdown",()=>this.selectRoute(a)),h=e.add.text(o,95,n.name,{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#"+n.color.toString(16).padStart(6,"0")}).setOrigin(.5,0),l=e.add.text(o,112,`x${n.multiplier.toFixed(1)}`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5,0),c=e.add.text(o,45,`[${a+1}]`,{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5,1);this.routeButtons.push({button:r,nameText:h,multiplierText:l,keyHint:c,route:i}),this.container.add([r,h,l,c])}),e.input.keyboard.on("keydown-ONE",()=>this.selectRoute(0)),e.input.keyboard.on("keydown-TWO",()=>this.selectRoute(1)),e.input.keyboard.on("keydown-THREE",()=>this.selectRoute(2));for(let t=1;t<3;t++){const i=e.add.line(0,0,s*t,40,s*t,120,3426654,.5).setLineWidth(2);this.container.add(i)}}onRouteHover(e){if(this.selected)return;const{button:t}=this.routeButtons[e];this.scene.tweens.add({targets:t,scale:1.15,duration:100})}onRouteOut(e){if(this.selected)return;const{button:t}=this.routeButtons[e];this.scene.tweens.add({targets:t,scale:1,duration:100})}selectRoute(e){if(this.selected||e>=this.routes.length)return;this.selected=!0,this.selectedRoute=this.routes[e];const s=t.GATES[this.selectedRoute],i=this.routeButtons[e];this.scene.tweens.add({targets:i.button,scale:1.3,duration:200}),this.routeButtons.forEach((t,s)=>{s!==e&&this.scene.tweens.add({targets:[t.button,t.nameText,t.multiplierText],alpha:.3,duration:200})});const a=this.scene.add.text(t.WIDTH/2,140,`${s.name} gew√§hlt!`,{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#"+s.color.toString(16).padStart(6,"0")}).setOrigin(.5,0);this.container.add(a),this.speed=300,this.scene.events.emit("gateSelected",this.selectedRoute)}update(e){return this.container.y+=this.speed*(e/1e3),!this.selected&&this.container.y>150&&this.selectRoute(1),this.container.y>t.HEIGHT+200}getSelectedRoute(){return this.selectedRoute}getModifiers(){if(!this.selectedRoute)return{};const e=t.GATES[this.selectedRoute];return{multiplier:e.multiplier,noiseChange:e.noiseIncrease||-(e.noiseReduction||0),stormChange:e.stormChanceIncrease||-(e.stormChanceReduction||0),qualityBonus:e.insightQualityBonus||0,spawnReduction:e.spawnReduction||0}}destroy(){this.scene.input.keyboard.off("keydown-ONE"),this.scene.input.keyboard.off("keydown-TWO"),this.scene.input.keyboard.off("keydown-THREE"),this.container.destroy()}}class u extends Phaser.Physics.Arcade.Sprite{constructor(e,s,i,a){const o=t.POWERUPS.TYPES[a];super(e,s,i,`powerup-${a.toLowerCase()}`),e.add.existing(this),e.physics.add.existing(this),this.type=a,this.config=o,this.collected=!1,this.speed=120,this.floatOffset=0,this.floatDirection=1,this.createGlow(),"GOLDEN"!==a?e.tweens.add({targets:this,angle:360,duration:3e3,repeat:-1,ease:"Linear"}):e.tweens.add({targets:this,scale:{from:1,to:1.3},duration:400,yoyo:!0,repeat:-1}),this.body.setCircle(16,0,0)}createGlow(){this.glow=this.scene.add.circle(this.x,this.y,25,this.config.color,.3).setDepth(this.depth-1),this.scene.tweens.add({targets:this.glow,scale:{from:1,to:1.5},alpha:{from:.3,to:0},duration:800,repeat:-1})}update(e){this.y+=this.speed*(e/1e3),this.floatOffset+=.1*this.floatDirection,Math.abs(this.floatOffset)>5&&(this.floatDirection*=-1),this.x+=.3*this.floatDirection,this.glow&&this.glow.setPosition(this.x,this.y),this.y>t.HEIGHT+50&&this.destroy()}collect(){return!this.collected&&(this.collected=!0,this.scene.tweens.add({targets:this,scale:2,alpha:0,duration:300,ease:"Power2",onComplete:()=>this.destroy()}),this.glow&&this.scene.tweens.add({targets:this.glow,scale:3,alpha:0,duration:300,onComplete:()=>this.glow.destroy()}),!0)}destroy(){this.glow&&this.glow.destroy(),super.destroy()}}class p{constructor(e){this.scene=e,this.powerUps=e.add.group(),this.activePowerUps={},this.generateTextures(),this.createUI()}generateTextures(){const e=t.POWERUPS.TYPES;Object.entries(e).forEach(([e,t])=>{const s=`powerup-${e.toLowerCase()}`;if(this.scene.textures.exists(s))return;const i=this.scene.add.graphics();if("MAGNET"===e)i.fillStyle(t.color),i.fillRoundedRect(4,4,8,24,2),i.fillRoundedRect(20,4,8,24,2),i.fillRoundedRect(4,4,24,8,2),i.fillStyle(15158332),i.fillRect(4,20,8,8),i.fillStyle(3447003),i.fillRect(20,20,8,8);else if("SHIELD"===e)i.fillStyle(t.color,.8),i.beginPath(),i.moveTo(16,4),i.lineTo(28,10),i.lineTo(26,24),i.lineTo(16,30),i.lineTo(6,24),i.lineTo(4,10),i.closePath(),i.fillPath(),i.lineStyle(2,16777215,.5),i.strokePath();else if("DOUBLE"===e)i.fillStyle(t.color),i.fillRoundedRect(2,8,28,18,4);else if("GOLDEN"===e){i.fillStyle(t.color),i.beginPath();const e=16,s=16,a=5,o=14,n=7;let r=Math.PI/2*3;const h=Math.PI/a;i.moveTo(e,s-o);for(let t=0;t<a;t++){let t=e+Math.cos(r)*o,a=s+Math.sin(r)*o;i.lineTo(t,a),r+=h,t=e+Math.cos(r)*n,a=s+Math.sin(r)*n,i.lineTo(t,a),r+=h}i.lineTo(e,s-o),i.closePath(),i.fillPath(),i.lineStyle(2,16777215,.8),i.strokePath()}i.generateTexture(s,32,32),i.destroy()})}createUI(){this.indicators={};let e=t.WIDTH/2-100;Object.keys(t.POWERUPS.TYPES).forEach((s,i)=>{if("GOLDEN"===s)return;const a=t.POWERUPS.TYPES[s],o=this.scene.add.container(e+70*i,75).setDepth(100).setAlpha(0),n=this.scene.add.circle(0,0,20,a.color,.3),r=this.scene.add.image(0,0,`powerup-${s.toLowerCase()}`).setScale(.8),h=this.scene.add.text(0,25,"",{fontFamily:"Arial",fontSize:"12px",color:"#ECF0F1"}).setOrigin(.5);o.add([n,r,h]),this.indicators[s]={container:o,timer:h,bg:n}})}spawnPowerUp(e){const t=Math.random();let s;s=t<.1?"GOLDEN":t<.4?"MAGNET":t<.7?"SHIELD":"DOUBLE";const i=new u(this.scene,e,-30,s);return this.powerUps.add(i),i}collectPowerUp(e){if(!e.collect())return;const t=e.type,s=e.config;this.scene.hud.showMessage(`${s.name}!`,800),this.scene.soundGen&&this.scene.soundGen.playPowerUpSound&&this.scene.soundGen.playPowerUpSound(),"GOLDEN"===t?(this.scene.scoreManager.addBonus(s.points),this.scene.hud.showPointsPopup(e.x,e.y,s.points),this.createGoldenBurst(e.x,e.y)):this.activatePowerUp(t)}activatePowerUp(e){this.activePowerUps[e]?this.activePowerUps[e].timeLeft=t.POWERUPS.DURATION:this.activePowerUps[e]={timeLeft:t.POWERUPS.DURATION,startTime:this.scene.time.now};const s=this.indicators[e];s&&(s.container.setAlpha(1),this.scene.tweens.add({targets:s.bg,scale:{from:1.3,to:1},duration:200})),this.applyPowerUpEffect(e,!0)}applyPowerUpEffect(e,t){"SHIELD"===e&&this.scene.ship&&this.scene.ship.setShielded(t)}update(e){this.powerUps.children.iterate(t=>{t&&t.update(e)}),Object.entries(this.activePowerUps).forEach(([t,s])=>{s.timeLeft-=e;const i=this.indicators[t];if(i){const e=Math.ceil(s.timeLeft/1e3);i.timer.setText(`${e}s`),s.timeLeft<2e3&&i.container.setAlpha(.5*Math.sin(this.scene.time.now/100)+.5)}s.timeLeft<=0&&this.deactivatePowerUp(t)}),this.isActive("MAGNET")&&this.scene.ship&&this.applyMagnetEffect()}applyMagnetEffect(){const e=this.scene.ship,s=t.POWERUPS.TYPES.MAGNET.radius;this.scene.insights.children.iterate(t=>{if(!t||!t.isReal)return;const i=Phaser.Math.Distance.Between(e.x,e.y,t.x,t.y);if(i<s){const a=Phaser.Math.Angle.Between(t.x,t.y,e.x,e.y),o=300*(1-i/s);t.x+=Math.cos(a)*o*.016,t.y+=Math.sin(a)*o*.016}})}createGoldenBurst(e,t){for(let s=0;s<20;s++){const i=2*Math.PI*s/20,a=this.scene.add.circle(e,t,6,16766720).setDepth(150);this.scene.tweens.add({targets:a,x:e+150*Math.cos(i),y:t+150*Math.sin(i),scale:0,duration:600,ease:"Power2",onComplete:()=>a.destroy()})}}deactivatePowerUp(e){this.applyPowerUpEffect(e,!1),delete this.activePowerUps[e];const t=this.indicators[e];t&&this.scene.tweens.add({targets:t.container,alpha:0,duration:300})}isActive(e){return!!this.activePowerUps[e]}getMultiplier(){return this.isActive("DOUBLE")?t.POWERUPS.TYPES.DOUBLE.multiplier:1}destroy(){this.powerUps.clear(!0,!0),Object.values(this.indicators).forEach(e=>e.container.destroy())}}class m{constructor(e){this.scene=e,this.cursors=e.input.keyboard.createCursorKeys(),this.wasd=e.input.keyboard.addKeys({left:Phaser.Input.Keyboard.KeyCodes.A,right:Phaser.Input.Keyboard.KeyCodes.D,boost:Phaser.Input.Keyboard.KeyCodes.SPACE}),this.touchStartX=0,this.touchCurrentX=0,this.isTouching=!1,this.boostTapped=!1,this.setupTouchInput()}setupTouchInput(){const e=this.scene;e.input.on("pointerdown",t=>{this.isTouching=!0,this.touchStartX=t.x,this.touchCurrentX=t.x,t.getDuration()<200&&this.lastTapTime&&e.time.now-this.lastTapTime<300&&(this.boostTapped=!0),this.lastTapTime=e.time.now}),e.input.on("pointermove",e=>{this.isTouching&&(this.touchCurrentX=e.x)}),e.input.on("pointerup",()=>{this.isTouching=!1,this.touchStartX=0,this.touchCurrentX=0})}getInput(){const e={left:!1,right:!1,boost:!1};if((this.cursors.left.isDown||this.wasd.left.isDown)&&(e.left=!0),(this.cursors.right.isDown||this.wasd.right.isDown)&&(e.right=!0),Phaser.Input.Keyboard.JustDown(this.wasd.boost)&&(e.boost=!0),this.isTouching){const t=this.touchCurrentX-this.touchStartX,s=20;t<-s?e.left=!0:t>s&&(e.right=!0)}return this.boostTapped&&(e.boost=!0,this.boostTapped=!1),e}isBoostPressed(){return Phaser.Input.Keyboard.JustDown(this.wasd.boost)||this.boostTapped}destroy(){this.scene.input.off("pointerdown"),this.scene.input.off("pointermove"),this.scene.input.off("pointerup")}}class f{constructor(e){this.scene=e,this.reset()}reset(){this.score=0,this.realInsightsCollected=0,this.fakeInsightsCollected=0,this.totalInsightsCollected=0,this.multiplier=1,this.gateChoices=[],this.boostsUsed=0,this.boostEfficiency=0,this.perfectBoosts=0}addInsight(e,s=1){this.totalInsightsCollected++;const i=e?t.INSIGHT.POINTS_REAL:t.INSIGHT.POINTS_FAKE,a=Math.round(i*s*this.multiplier);return this.score+=a,e?this.realInsightsCollected++:this.fakeInsightsCollected++,a}addGateChoice(e){this.gateChoices.push(e);const s=t.GATES[e.toUpperCase()];s&&(this.multiplier*=s.multiplier)}addBoostUsage(e){this.boostsUsed++,e&&this.perfectBoosts++}addBonus(e){this.score+=e}getScore(){return Math.max(0,this.score)}getMultiplier(){return this.multiplier}getQualityRatio(){return 0===this.totalInsightsCollected?0:this.realInsightsCollected/this.totalInsightsCollected}getQualityScore(){return Math.round(100*this.getQualityRatio())}calculateFinalScore(e){let s=this.score;return this.getQualityRatio()>=t.SCORING.QUALITY_BONUS_THRESHOLD&&(s*=t.SCORING.QUALITY_BONUS_MULTIPLIER),s+=e/100*t.SCORING.STABILITY_BONUS_MAX,this.boostsUsed>0&&(s+=this.perfectBoosts/this.boostsUsed*t.SCORING.BOOST_EFFICIENCY_BONUS),Math.round(s)}getStrategyProfile(){if(0===this.gateChoices.length)return"Balanced";const e={};this.gateChoices.forEach(t=>{e[t]=(e[t]||0)+1});const t=Object.entries(e).sort((e,t)=>t[1]-e[1])[0];return t?t[0]:"Balanced"}getCrewImpact(){return 0===this.boostsUsed?"Low":this.boostsUsed<=2?"Medium":"High"}getResultType(e,t){const s=(e+t)/2;return s>=80?"Quality"===this.getStrategyProfile()?"High Quality Navigator":"Stable Course":s>=60?"Speed"===this.getStrategyProfile()?"Fast but Noisy":"Balanced Approach":s>=40?"Rough Waters":"Lost at Sea"}getStats(e){const t=this.getQualityScore();return{finalScore:this.calculateFinalScore(e),qualityScore:t,stabilityScore:Math.round(e),strategyProfile:this.getStrategyProfile(),crewImpact:this.getCrewImpact(),resultType:this.getResultType(t,e),realInsights:this.realInsightsCollected,fakeInsights:this.fakeInsightsCollected,multiplier:this.multiplier.toFixed(2)}}}class S{constructor(e){this.scene=e,this.activeStorm=null,this.stormEndTime=0,this.stormChance=0,this.lastStormTime=0,this.minInterval=t.STORM_MIN_INTERVAL,this.stormTypes=["FOG","CROSSWIND","SIGNAL_FLOOD","NARROW_PASS"],this.createEffects()}createEffects(){this.fogOverlay=this.scene.add.rectangle(t.WIDTH/2,t.HEIGHT/2,t.WIDTH,t.HEIGHT,6122878,0).setDepth(30),this.fogOverlay2=this.scene.add.rectangle(t.WIDTH/2,t.HEIGHT/2,t.WIDTH,t.HEIGHT,8753822,0).setDepth(31),this.fogParticles=null,this.windIndicator=this.scene.add.text(t.WIDTH/2,80,"",{fontFamily:"Arial, sans-serif",fontSize:"24px",color:"#F39C12"}).setOrigin(.5).setDepth(100).setVisible(!1),this.buoys=this.scene.add.group(),this.warningText=this.scene.add.text(t.WIDTH/2,t.HEIGHT/2-100,"",{fontFamily:"Arial, sans-serif",fontSize:"32px",fontStyle:"bold",color:"#E74C3C",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(150).setVisible(!1)}setStormChance(e){this.stormChance=Math.max(0,Math.min(1,e))}adjustStormChance(e){this.stormChance=Math.max(0,Math.min(1,this.stormChance+e))}checkForStorm(e){this.activeStorm||e-this.lastStormTime<this.minInterval||e<t.PHASE_1_END||Math.random()<.02*this.stormChance&&this.triggerRandomStorm(e)}triggerRandomStorm(e){const t=this.stormTypes[Math.floor(Math.random()*this.stormTypes.length)];this.triggerStorm(t,e)}triggerStorm(e,s){this.activeStorm=e,this.stormEndTime=s+t.STORM_DURATION,this.lastStormTime=s;const i=t.STORMS[e];switch(this.showWarning(i.name),e){case"FOG":this.startFog();break;case"CROSSWIND":this.startCrosswind();break;case"SIGNAL_FLOOD":this.startSignalFlood();break;case"NARROW_PASS":this.startNarrowPass()}this.scene.events.emit("stormStarted",e)}showWarning(e){this.warningText.setText(`‚ö† ${e.toUpperCase()}! ‚ö†`),this.warningText.setVisible(!0),this.scene.tweens.add({targets:this.warningText,alpha:{from:1,to:0},scale:{from:1,to:1.2},duration:1500,onComplete:()=>{this.warningText.setVisible(!1),this.warningText.setAlpha(1),this.warningText.setScale(1)}})}startFog(){this.scene.tweens.add({targets:this.fogOverlay,alpha:.7,duration:800}),this.scene.tweens.add({targets:this.fogOverlay2,alpha:.4,duration:1200}),this.fogParticles=this.scene.add.particles(0,0,"insight-real",{x:{min:0,max:t.WIDTH},y:{min:0,max:t.HEIGHT},scale:{min:2,max:5},alpha:{start:.15,end:.05},speedX:{min:-30,max:-10},speedY:{min:10,max:30},lifespan:4e3,frequency:100,tint:11450047,blendMode:"ADD"}).setDepth(32),this.scene.radarUI&&this.scene.radarUI.setBlurred(!0,.8),this.fogLabel=this.scene.add.text(t.WIDTH/2,t.HEIGHT-50,"üå´Ô∏è DICHTER NEBEL - SICHT EINGESCHR√ÑNKT!",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#BDC3C7",stroke:"#2C3E50",strokeThickness:3}).setOrigin(.5).setDepth(100),this.scene.tweens.add({targets:this.fogLabel,alpha:{from:1,to:.6},duration:1e3,yoyo:!0,repeat:-1})}startCrosswind(){const e=Math.random()>.5?1:-1,s=e>0?"‚Üí‚Üí‚Üí":"‚Üê‚Üê‚Üê";this.windIndicator.setText(`WIND ${s}`),this.windIndicator.setVisible(!0),this.scene.ship&&this.scene.ship.setDrift(t.STORMS.CROSSWIND.driftForce,e),this.scene.tweens.add({targets:this.windIndicator,x:t.WIDTH/2+20*e,duration:500,yoyo:!0,repeat:-1})}startSignalFlood(){this.scene.events.emit("signalFlood",{spawnMultiplier:t.STORMS.SIGNAL_FLOOD.spawnMultiplier,noiseRatio:t.STORMS.SIGNAL_FLOOD.noiseRatio})}startNarrowPass(){const e=t.STORMS.NARROW_PASS.passWidth,s=t.WIDTH/2,i=s-e/2,a=s+e/2;for(let t=0;t<6;t++){const e=-50-60*t,s=this.scene.physics.add.sprite(i-20,e,"buoy");s.setVelocityY(150),this.buoys.add(s);const o=this.scene.physics.add.sprite(a+20,e,"buoy");o.setVelocityY(150),this.buoys.add(o)}this.scene.ship&&(this.buoyCollider=this.scene.physics.add.overlap(this.scene.ship,this.buoys,(e,t)=>{e.flash(15158332),this.scene.scoreManager.addInsight(!1),t.destroy()}))}update(e,s){return this.activeStorm?e>=this.stormEndTime?(this.endStorm(),{active:!1}):(this.buoys.children.iterate(e=>{e&&e.y>t.HEIGHT+50&&e.destroy()}),{active:!0,type:this.activeStorm,remaining:this.stormEndTime-e}):(this.checkForStorm(e),{active:!1})}endStorm(){const e=this.activeStorm;switch(this.activeStorm=null,e){case"FOG":this.scene.tweens.add({targets:this.fogOverlay,alpha:0,duration:800}),this.scene.tweens.add({targets:this.fogOverlay2,alpha:0,duration:800}),this.fogParticles&&(this.fogParticles.destroy(),this.fogParticles=null),this.fogLabel&&(this.scene.tweens.killTweensOf(this.fogLabel),this.fogLabel.destroy(),this.fogLabel=null),this.scene.radarUI&&this.scene.radarUI.setBlurred(!1);break;case"CROSSWIND":this.windIndicator.setVisible(!1),this.scene.tweens.killTweensOf(this.windIndicator),this.windIndicator.x=t.WIDTH/2,this.scene.ship&&this.scene.ship.clearDrift();break;case"SIGNAL_FLOOD":this.scene.events.emit("signalFloodEnd");break;case"NARROW_PASS":this.buoys.clear(!0,!0),this.buoyCollider&&(this.buoyCollider.destroy(),this.buoyCollider=null)}this.scene.events.emit("stormEnded",e)}isNavigatorEffective(){return"FOG"===this.activeStorm||"SIGNAL_FLOOD"===this.activeStorm}isCaptainEffective(){return"CROSSWIND"===this.activeStorm}getActiveStorm(){return this.activeStorm}destroy(){this.fogOverlay.destroy(),this.fogOverlay2.destroy(),this.fogParticles&&this.fogParticles.destroy(),this.fogLabel&&this.fogLabel.destroy(),this.windIndicator.destroy(),this.warningText.destroy(),this.buoys.clear(!0,!0)}}class g{constructor(e){this.scene=e,this.combo=0,this.maxCombo=0,this.lastCollectTime=0,this.comboTimer=null,this.createComboDisplay(),this.createParticleEmitter()}createComboDisplay(){this.comboContainer=this.scene.add.container(t.WIDTH/2,100).setDepth(200),this.comboText=this.scene.add.text(0,0,"",{fontFamily:"Arial, sans-serif",fontSize:"48px",fontStyle:"bold",color:"#F1C40F",stroke:"#000000",strokeThickness:6}).setOrigin(.5).setAlpha(0),this.comboLabel=this.scene.add.text(0,35,"COMBO",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5).setAlpha(0),this.comboContainer.add([this.comboText,this.comboLabel])}createParticleEmitter(){if(!this.scene.textures.exists("particle")){const e=this.scene.add.graphics();e.fillStyle(16777215),e.fillCircle(4,4,4),e.generateTexture("particle",8,8),e.destroy()}}addCombo(e,s,i){if(!i)return this.resetCombo(),0;this.combo++,this.maxCombo=Math.max(this.maxCombo,this.combo),this.lastCollectTime=this.scene.time.now,this.comboTimer&&this.comboTimer.remove(),this.comboTimer=this.scene.time.delayedCall(t.COMBO.TIMEOUT,()=>{this.resetCombo()});const a=Math.min(this.combo-1,t.COMBO.MULTIPLIERS.length-1),o=t.COMBO.MULTIPLIERS[a];return this.combo>=2&&(this.showComboDisplay(),this.spawnParticles(e,s,a),this.shakeScreen(a),this.scene.soundGen&&this.scene.soundGen.playComboSound&&this.scene.soundGen.playComboSound(a)),5===this.combo?this.scene.events.emit("achievement","COMBO_5"):10===this.combo&&this.scene.events.emit("achievement","COMBO_10"),o}showComboDisplay(){const e=["#F1C40F","#E67E22","#E74C3C","#9B59B6","#FF0000","#FF00FF"],t=Math.min(this.combo-1,e.length-1);this.comboText.setText(`${this.combo}x`),this.comboText.setColor(e[t]),this.scene.tweens.killTweensOf(this.comboText),this.scene.tweens.killTweensOf(this.comboLabel),this.comboText.setAlpha(1).setScale(1.5),this.comboLabel.setAlpha(1),this.scene.tweens.add({targets:this.comboText,scale:1,duration:200,ease:"Back.out"}),this.combo>=5&&this.scene.tweens.add({targets:this.comboText,scale:{from:1,to:1.1},duration:300,yoyo:!0,repeat:-1})}hideComboDisplay(){this.scene.tweens.add({targets:[this.comboText,this.comboLabel],alpha:0,duration:300})}spawnParticles(e,s,i){const a=t.COMBO.PARTICLE_COUNT[i]||5,o=[3066993,15844367,15105570,15158332,10181046,16711935][i]||3066993;for(let t=0;t<a;t++){const n=2*Math.PI*t/a,r=100+30*i,h=this.scene.add.circle(e,s,4+i,o).setDepth(100);this.scene.tweens.add({targets:h,x:e+Math.cos(n)*r,y:s+Math.sin(n)*r,scale:0,alpha:0,duration:400+50*i,ease:"Power2",onComplete:()=>h.destroy()})}if(i>=3)for(let t=0;t<2*i;t++){const i=this.scene.add.circle(e+Phaser.Math.Between(-30,30),s+Phaser.Math.Between(-30,30),4,16777215).setDepth(101);this.scene.tweens.add({targets:i,scale:0,alpha:0,duration:500,delay:30*t,onComplete:()=>i.destroy()})}}shakeScreen(e){const s=t.COMBO.SHAKE_INTENSITY[e]||0;s>0&&this.scene.cameras.main.shake(100,s/1e3)}resetCombo(){this.combo>=2&&this.hideComboDisplay(),this.combo=0,this.comboTimer&&(this.comboTimer.remove(),this.comboTimer=null)}getCombo(){return this.combo}getMaxCombo(){return this.maxCombo}getMultiplier(){if(0===this.combo)return 1;const e=Math.min(this.combo-1,t.COMBO.MULTIPLIERS.length-1);return t.COMBO.MULTIPLIERS[e]}destroy(){this.comboTimer&&this.comboTimer.remove(),this.comboContainer.destroy()}}class y{constructor(e){this.scene=e,this.createElements()}createElements(){const e=this.scene;this.scoreText=e.add.text(20,20,"SCORE: 0",{fontFamily:"Arial, sans-serif",fontSize:"24px",fontStyle:"bold",color:"#ECF0F1"}).setDepth(100),this.multiplierText=e.add.text(20,50,"x1.00",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#1ABC9C"}).setDepth(100),this.timerText=e.add.text(t.WIDTH-20,20,"90",{fontFamily:"Arial, sans-serif",fontSize:"32px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(1,0).setDepth(100),this.timerLabel=e.add.text(t.WIDTH-20,55,"SEKUNDEN",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(1,0).setDepth(100),this.phaseText=e.add.text(t.WIDTH/2,20,"PHASE 1",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#1ABC9C"}).setOrigin(.5,0).setDepth(100),this.createQualityBar(e)}createQualityBar(e){const s=t.WIDTH/2-75;this.qualityBarBg=e.add.rectangle(s,45,150,8,2899536).setOrigin(0,0).setDepth(100),this.qualityBarFill=e.add.rectangle(s,45,0,8,t.COLORS.INSIGHT_REAL).setOrigin(0,0).setDepth(100),this.qualityLabel=e.add.text(t.WIDTH/2,58,"INSIGHT QUALIT√ÑT",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5,0).setDepth(100),this.highScoreText=e.add.text(20,75,"",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setDepth(100)}setHighScore(e){this.highScoreText.setText(`BEST: ${e}`)}update(e,s,i=1,a=1,o=1,n=0){(isNaN(i)||void 0===i)&&(i=1),this.scoreText.setText(`SCORE: ${s}`),this.multiplierText.setText(`x${i.toFixed(2)}`),i>1?this.multiplierText.setColor("#F1C40F"):i<1?this.multiplierText.setColor("#E74C3C"):this.multiplierText.setColor("#1ABC9C");const r=Math.max(0,Math.ceil((t.GAME_DURATION-e)/1e3));this.timerText.setText(r.toString()),r<=10&&this.timerText.setColor(r%2==0?"#E74C3C":"#ECF0F1"),this.phaseText.setText(`PHASE ${o}`);const h=150*Math.max(0,Math.min(1,a));this.qualityBarFill.width=h,a>=.7?this.qualityBarFill.setFillStyle(t.COLORS.INSIGHT_REAL):a>=.4?this.qualityBarFill.setFillStyle(15965202):this.qualityBarFill.setFillStyle(t.COLORS.INSIGHT_FAKE)}showPointsPopup(e,t,s){const i=s>=0?"#2ECC71":"#E74C3C",a=s>=0?"+":"",o=this.scene.add.text(e,t,`${a}${s}`,{fontFamily:"Arial, sans-serif",fontSize:"20px",fontStyle:"bold",color:i}).setOrigin(.5).setDepth(100);this.scene.tweens.add({targets:o,y:t-50,alpha:0,duration:800,ease:"Power2",onComplete:()=>o.destroy()})}showMessage(e,s=2e3){const i=this.scene.add.text(t.WIDTH/2,t.HEIGHT/2-50,e,{fontFamily:"Arial, sans-serif",fontSize:"28px",fontStyle:"bold",color:"#ECF0F1",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(150).setAlpha(0);this.scene.tweens.add({targets:i,alpha:1,duration:200,yoyo:!0,hold:s-400,onComplete:()=>i.destroy()})}destroy(){this.scoreText.destroy(),this.multiplierText.destroy(),this.timerText.destroy(),this.timerLabel.destroy(),this.phaseText.destroy(),this.qualityBarBg.destroy(),this.qualityBarFill.destroy(),this.qualityLabel.destroy(),this.highScoreText.destroy()}}class T{constructor(e){this.scene=e,this.isBlurred=!1,this.blurAmount=0,this.createRadar()}createRadar(){const e=this.scene,s=t.WIDTH-110,i=t.HEIGHT-110;this.radarBg=e.add.graphics().setDepth(50),this.drawRadarBackground(s,i,80),this.sweep=e.add.image(s,i,"radar-sweep").setScale(.8).setAlpha(.6).setDepth(51),e.tweens.add({targets:this.sweep,angle:360,duration:2e3,repeat:-1,ease:"Linear"}),this.centerDot=e.add.circle(s,i,4,t.COLORS.ACCENT).setDepth(52),this.pings=e.add.group(),this.fogOverlay=e.add.rectangle(s,i,160,160,8359053,0).setDepth(53)}drawRadarBackground(e,s,i){const a=this.radarBg;a.clear(),a.lineStyle(2,t.COLORS.ACCENT,.8),a.strokeCircle(e,s,i),a.lineStyle(1,t.COLORS.ACCENT,.3),a.strokeCircle(e,s,.66*i),a.strokeCircle(e,s,.33*i),a.lineStyle(1,t.COLORS.ACCENT,.2),a.lineBetween(e-i,s,e+i,s),a.lineBetween(e,s-i,e,s+i);const o={fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#1ABC9C"};this.compassN=this.scene.add.text(e,s-i-8,"N",o).setOrigin(.5).setDepth(52),this.compassS=this.scene.add.text(e,s+i+8,"S",o).setOrigin(.5).setDepth(52)}addPing(e,s,i){const a=2*(e/t.WIDTH-.5)*70,o=2*((s+50)/(t.HEIGHT+100)-.5)*70,n=t.WIDTH-110+a,r=t.HEIGHT-110+o;if(Math.sqrt(a*a+o*o)>84)return;const h=i?t.COLORS.INSIGHT_REAL:t.COLORS.INSIGHT_FAKE,l=this.scene.add.circle(n,r,3,h,.8).setDepth(52);this.isBlurred&&!i&&(l.x+=Phaser.Math.Between(-10,10)*this.blurAmount,l.y+=Phaser.Math.Between(-10,10)*this.blurAmount),this.pings.add(l),this.scene.tweens.add({targets:l,alpha:0,scale:2,duration:2e3,onComplete:()=>l.destroy()})}setBlurred(e,t=.6){this.isBlurred=e,this.blurAmount=t,e?this.scene.tweens.add({targets:this.fogOverlay,alpha:.5*t,duration:500}):this.scene.tweens.add({targets:this.fogOverlay,alpha:0,duration:500})}update(e){}destroy(){this.radarBg.destroy(),this.sweep.destroy(),this.centerDot.destroy(),this.fogOverlay.destroy(),this.compassN.destroy(),this.compassS.destroy(),this.pings.clear(!0,!0)}}class C{constructor(e,t){this.scene=e,this.availableBoosts=t,this.meterValue=0,this.maxValue=100,this.isReady=!1,this.activeBoost=null,this.createMeter()}createMeter(){const e=this.scene,s=t.HEIGHT-100;this.meterBg=e.add.rectangle(20,s,30,80,2899536).setOrigin(0,1).setDepth(100),this.meterBorder=e.add.rectangle(20,s,30,80).setOrigin(0,1).setStrokeStyle(2,t.COLORS.ACCENT).setDepth(100),this.meterFill=e.add.rectangle(22,s-2,26,0,t.COLORS.ACCENT).setOrigin(0,1).setDepth(100),this.label=e.add.text(35,s+10,"CREW",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5,0).setDepth(100),this.anchorIcon=e.add.text(35,s-40,"‚öì",{fontSize:"24px"}).setOrigin(.5).setDepth(100),this.readyText=e.add.text(35,s-85,"BEREIT!",{fontFamily:"Arial, sans-serif",fontSize:"12px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(.5).setDepth(100).setVisible(!1),this.createBoostChoicePanel(75,s-60),this.scene.input.keyboard.on("keydown-Q",()=>this.activateBoost(0)),this.scene.input.keyboard.on("keydown-E",()=>this.activateBoost(1))}createBoostChoicePanel(e,s){this.choicePanel=this.scene.add.container(e,s).setDepth(100).setAlpha(0);const i=this.scene.add.rectangle(0,0,100,70,1714746,.95).setStrokeStyle(1,t.COLORS.ACCENT);this.choicePanel.add(i);const a=this.scene.add.text(0,-25,"W√§hle Boost:",{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5);this.choicePanel.add(a),this.boostOptions=[],this.availableBoosts.forEach((e,s)=>{const i=t.BOOSTS[e],a=25*s-5,o=this.scene.add.text(-40,a,0===s?"[Q]":"[E]",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#F1C40F"}).setOrigin(0,.5),n=this.scene.add.text(-15,a,i.name,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#ECF0F1"}).setOrigin(0,.5);this.choicePanel.add([o,n]),this.boostOptions.push({keyLabel:o,nameLabel:n,boostKey:e})})}addValue(e){this.activeBoost||(this.meterValue=Math.max(0,Math.min(this.maxValue,this.meterValue+e)),this.updateMeterFill(),this.meterValue>=this.maxValue&&!this.isReady&&(this.isReady=!0,this.showReadyState()))}updateMeterFill(){const e=this.meterValue/this.maxValue*76;this.meterFill.height=e,this.meterValue>=this.maxValue?this.meterFill.setFillStyle(15844367):this.meterValue>=.7*this.maxValue?this.meterFill.setFillStyle(3066993):this.meterFill.setFillStyle(t.COLORS.ACCENT)}showReadyState(){this.readyText.setVisible(!0),this.scene.tweens.add({targets:this.choicePanel,alpha:1,duration:300}),this.scene.tweens.add({targets:[this.readyText,this.meterBorder,this.anchorIcon],scale:{from:1,to:1.1},duration:500,yoyo:!0,repeat:-1})}activateBoost(e){if(!this.isReady||this.activeBoost||e>=this.availableBoosts.length)return null;const t=this.availableBoosts[e];return this.activeBoost=t,this.isReady=!1,this.meterValue=0,this.scene.tweens.killTweensOf(this.readyText),this.scene.tweens.killTweensOf(this.meterBorder),this.scene.tweens.killTweensOf(this.anchorIcon),this.readyText.setVisible(!1),this.meterBorder.setScale(1),this.anchorIcon.setScale(1),this.scene.tweens.add({targets:this.choicePanel,alpha:0,duration:200}),this.updateMeterFill(),this.startBoostTimer(t),t}startBoostTimer(e){const s=t.BOOSTS[e];this.activeBoostText=this.scene.add.text(35,t.HEIGHT-60,s.name,{fontFamily:"Arial, sans-serif",fontSize:"12px",fontStyle:"bold",color:"#"+s.color.toString(16).padStart(6,"0")}).setDepth(100),this.boostTimerText=this.scene.add.text(35,t.HEIGHT-45,"6s",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#F1C40F"}).setDepth(100);let i=t.BOOST_DURATION/1e3;this.boostTimer=this.scene.time.addEvent({delay:1e3,repeat:i-1,callback:()=>{i--,this.boostTimerText&&this.boostTimerText.setText(i+"s")}}),this.scene.time.delayedCall(t.BOOST_DURATION,()=>{this.endBoost()})}endBoost(){const e=this.activeBoost;return this.activeBoost=null,this.boostTimerText&&(this.boostTimerText.destroy(),this.boostTimerText=null),this.activeBoostText&&(this.activeBoostText.destroy(),this.activeBoostText=null),this.boostTimer&&(this.boostTimer.remove(),this.boostTimer=null),e}getActiveBoost(){return this.activeBoost}isBoostActive(){return null!==this.activeBoost}destroy(){this.meterBg.destroy(),this.meterBorder.destroy(),this.meterFill.destroy(),this.label.destroy(),this.readyText.destroy(),this.anchorIcon.destroy(),this.choicePanel.destroy(),this.boostTimerText&&this.boostTimerText.destroy(),this.activeBoostText&&this.activeBoostText.destroy()}}class E{constructor(){this.audioContext=null,this.windSource=null,this.windGain=null,this.enabled=!0}init(){try{return this.audioContext=new(window.AudioContext||window.webkitAudioContext),!0}catch(e){return this.enabled=!1,!1}}resume(){this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume()}playSonarPing(e=!0){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,s=t.currentTime,i=t.createOscillator(),a=t.createGain();i.type="sine",e?(i.frequency.setValueAtTime(600,s),i.frequency.exponentialRampToValueAtTime(1200,s+.1),a.gain.setValueAtTime(.2,s)):(i.frequency.setValueAtTime(400,s),i.frequency.exponentialRampToValueAtTime(200,s+.15),a.gain.setValueAtTime(.15,s)),a.gain.exponentialRampToValueAtTime(.001,s+.3),i.connect(a),a.connect(t.destination),i.start(s),i.stop(s+.3)}playSuccessChime(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,t=e.currentTime;[523.25,659.25,783.99].forEach((s,i)=>{const a=e.createOscillator(),o=e.createGain();a.type="sine",a.frequency.setValueAtTime(s,t);const n=t+.08*i;o.gain.setValueAtTime(0,n),o.gain.linearRampToValueAtTime(.15,n+.02),o.gain.exponentialRampToValueAtTime(.001,n+.3),a.connect(o),o.connect(e.destination),a.start(n),a.stop(n+.3)})}playWarning(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,t=e.currentTime;for(let s=0;s<2;s++){const i=e.createOscillator(),a=e.createGain();i.type="sawtooth",i.frequency.setValueAtTime(200,t+.2*s),i.frequency.linearRampToValueAtTime(400,t+.2*s+.1),a.gain.setValueAtTime(.1,t+.2*s),a.gain.exponentialRampToValueAtTime(.001,t+.2*s+.15),i.connect(a),a.connect(e.destination),i.start(t+.2*s),i.stop(t+.2*s+.15)}}playBoostActivate(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,t=e.currentTime,s=e.createOscillator(),i=e.createGain();s.type="triangle",s.frequency.setValueAtTime(300,t),s.frequency.exponentialRampToValueAtTime(800,t+.2),i.gain.setValueAtTime(.2,t),i.gain.exponentialRampToValueAtTime(.001,t+.4),s.connect(i),i.connect(e.destination),s.start(t),s.stop(t+.4)}startWindAmbience(){if(!this.enabled||!this.audioContext||this.windSource)return;const e=this.audioContext,t=2*e.sampleRate,s=e.createBuffer(1,t,e.sampleRate),i=s.getChannelData(0);for(let o=0;o<t;o++)i[o]=2*Math.random()-1;this.windSource=e.createBufferSource(),this.windSource.buffer=s,this.windSource.loop=!0;const a=e.createBiquadFilter();a.type="bandpass",a.frequency.value=400,a.Q.value=.5,this.windGain=e.createGain(),this.windGain.gain.value=.03,this.windSource.connect(a),a.connect(this.windGain),this.windGain.connect(e.destination),this.windSource.start()}setWindIntensity(e){this.windGain&&this.windGain.gain.linearRampToValueAtTime(.03+.05*e,this.audioContext.currentTime+.1)}stopWindAmbience(){this.windSource&&(this.windSource.stop(),this.windSource=null,this.windGain=null)}playGameOver(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,t=e.currentTime,s=e.createOscillator(),i=e.createGain();s.type="sine",s.frequency.setValueAtTime(440,t),s.frequency.exponentialRampToValueAtTime(220,t+.5),i.gain.setValueAtTime(.2,t),i.gain.exponentialRampToValueAtTime(.001,t+.6),s.connect(i),i.connect(e.destination),s.start(t),s.stop(t+.6)}playComboSound(e){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,s=t.currentTime,i=400+100*e;if([i,1.25*i,1.5*i].forEach((i,a)=>{const o=t.createOscillator(),n=t.createGain();o.type=e>=4?"square":"sine",o.frequency.setValueAtTime(i,s+.05*a),n.gain.setValueAtTime(.15,s+.05*a),n.gain.exponentialRampToValueAtTime(.001,s+.05*a+.15),o.connect(n),n.connect(t.destination),o.start(s+.05*a),o.stop(s+.05*a+.15)}),e>=3){const i=t.createOscillator(),a=t.createGain();i.type="sine",i.frequency.setValueAtTime(2e3+200*e,s),i.frequency.exponentialRampToValueAtTime(3e3,s+.1),a.gain.setValueAtTime(.1,s),a.gain.exponentialRampToValueAtTime(.001,s+.15),i.connect(a),a.connect(t.destination),i.start(s),i.stop(s+.15)}}playPowerUpSound(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,t=e.currentTime;[800,1e3,1200,1500,1800].forEach((s,i)=>{const a=e.createOscillator(),o=e.createGain();a.type="sine",a.frequency.setValueAtTime(s,t+.03*i),o.gain.setValueAtTime(.12,t+.03*i),o.gain.exponentialRampToValueAtTime(.001,t+.03*i+.2),a.connect(o),o.connect(e.destination),a.start(t+.03*i),a.stop(t+.03*i+.2)})}playAchievementSound(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,t=e.currentTime;[{freq:523.25,time:0},{freq:659.25,time:.1},{freq:783.99,time:.2},{freq:1046.5,time:.35}].forEach(({freq:s,time:i})=>{const a=e.createOscillator(),o=e.createGain();a.type="triangle",a.frequency.setValueAtTime(s,t+i),o.gain.setValueAtTime(.2,t+i),o.gain.exponentialRampToValueAtTime(.001,t+i+.4),a.connect(o),o.connect(e.destination),a.start(t+i),a.stop(t+i+.4)})}playPhaseChange(e){if(!this.enabled||!this.audioContext)return;const t=this.audioContext,s=t.currentTime,i=t.createBufferSource(),a=.5*t.sampleRate,o=t.createBuffer(1,a,t.sampleRate),n=o.getChannelData(0);for(let l=0;l<a;l++)n[l]=2*Math.random()-1;i.buffer=o;const r=t.createBiquadFilter();r.type="bandpass",r.frequency.setValueAtTime(200,s),r.frequency.exponentialRampToValueAtTime(2e3,s+.3),r.Q.value=1;const h=t.createGain();if(h.gain.setValueAtTime(.3,s),h.gain.exponentialRampToValueAtTime(.001,s+.5),i.connect(r),r.connect(h),h.connect(t.destination),i.start(s),i.stop(s+.5),3===e){const e=t.createOscillator(),i=t.createGain();e.type="sine",e.frequency.setValueAtTime(80,s),e.frequency.exponentialRampToValueAtTime(40,s+.3),i.gain.setValueAtTime(.4,s),i.gain.exponentialRampToValueAtTime(.001,s+.4),e.connect(i),i.connect(t.destination),e.start(s),e.stop(s+.4)}}playNearMiss(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext,t=e.currentTime,s=e.createOscillator(),i=e.createGain();s.type="sine",s.frequency.setValueAtTime(300,t),s.frequency.exponentialRampToValueAtTime(600,t+.1),i.gain.setValueAtTime(.08,t),i.gain.exponentialRampToValueAtTime(.001,t+.15),s.connect(i),i.connect(e.destination),s.start(t),s.stop(t+.15)}destroy(){this.stopWindAmbience(),this.audioContext&&this.audioContext.close()}}class I extends Phaser.Scene{constructor(){super("Game")}init(){this.gameTime=0,this.phase=1,this.currentMultiplier=1,this.noiseModifier=0,this.spawnModifier=0,this.lastInsightSpawn=0,this.lastGateTime=0,this.signalFloodActive=!1,this.isGameOver=!1,this.isPaused=!1,this.stormsWeathered=0,this.insightsInLast30Sec=0,this.last30SecCheck=0,this.collectedNoFakes=!0,this.physics&&this.physics.resume(),this.time&&(this.time.paused=!1)}create(){this.soundGen=new E,this.soundGen.init(),this.waveEffect=new a(this),this.ship=new l(this,t.WIDTH/2,t.SHIP.START_Y),this.insights=this.add.group(),this.gates=[],this.inputManager=new m(this),this.scoreManager=new f(this),this.stormManager=new S(this),this.comboManager=new g(this),this.powerUpManager=new p(this),this.achievementNotification=new r(this);const e=Object.keys(t.BOOSTS),s=Phaser.Utils.Array.Shuffle([...e]);this.availableBoosts=s.slice(0,2),this.hud=new y(this),this.radarUI=new T(this),this.boostMeter=new C(this,this.availableBoosts),this.physics.add.overlap(this.ship,this.insights,this.collectInsight,null,this),this.physics.add.overlap(this.ship,this.powerUpManager.powerUps,(e,t)=>this.powerUpManager.collectPowerUp(t),null,this),this.events.on("gateSelected",this.onGateSelected,this),this.events.on("stormStarted",this.onStormStarted,this),this.events.on("stormEnded",this.onStormEnded,this),this.events.on("signalFlood",this.onSignalFlood,this),this.events.on("signalFloodEnd",this.onSignalFloodEnd,this),this.events.on("achievement",this.onAchievement,this),this.input.keyboard.on("keydown-H",()=>this.togglePauseHelp()),this.input.keyboard.on("keydown-ESC",()=>this.togglePauseHelp()),this.soundGen.startWindAmbience(),this.hud.showMessage("LOS GEHT'S!",1500);const i=n.getHighScore();i>0&&this.hud.setHighScore(i)}update(e,s){try{if(this.isGameOver||this.isPaused)return;if((isNaN(s)||s<=0)&&(s=16),s=Math.min(s,100),this.gameTime+=s,(isNaN(this.gameTime)||this.gameTime<0)&&(this.gameTime=0),this.gameTime>=t.GAME_DURATION-100)return void this.endGame();this.updatePhase();const i=this.inputManager.getInput();this.ship.update(s,i),i.boost&&this.activateBoost(),this.spawnInsights(),this.spawnGates(),this.stormManager.update(this.gameTime,s).active?(this.waveEffect.setIntensity(.5),this.soundGen.setWindIntensity(.5)):(this.waveEffect.setIntensity(0),this.soundGen.setWindIntensity(0)),this.gates=this.gates.filter(e=>!e.update(s)||(e.destroy(),!1)),this.insights.children.iterate(e=>{e&&e.update(s)}),this.powerUpManager.update(s),"NAVIGATOR"===this.boostMeter.getActiveBoost()&&this.insights.children.iterate(e=>{e&&e.isReal&&e.setHighlighted(!0)}),this.checkNearMisses(),this.waveEffect.update(e);const a=this.comboManager.getMultiplier()||1,o=this.powerUpManager.getMultiplier()||1,n=(this.currentMultiplier||1)*a*o;this.hud.update(this.gameTime,this.scoreManager.getScore(),n,this.scoreManager.getQualityRatio(),this.phase,this.comboManager.getCombo()),this.gameTime-this.last30SecCheck>=3e4&&(this.insightsInLast30Sec>=50&&this.events.emit("achievement","SPEED_RUN"),this.insightsInLast30Sec=0,this.last30SecCheck=this.gameTime)}catch(i){}}updatePhase(){let e=1;if(this.gameTime>=t.PHASE_2_END?e=3:this.gameTime>=t.PHASE_1_END&&(e=2),e!==this.phase){this.phase=e,this.hud.showMessage(`PHASE ${this.phase}`,1500),this.soundGen.playPhaseChange(this.phase);const t=s[this.phase];this.stormManager.setStormChance(t.stormChance)}}spawnInsights(){const e=s[this.phase];let i=t.INSIGHT.SPAWN_INTERVAL_BASE*e.insightSpawnRate;if(i*=1+this.spawnModifier,this.signalFloodActive&&(i*=.3),this.gameTime-this.lastInsightSpawn<i)return;if(this.lastInsightSpawn=this.gameTime,Math.random()<t.POWERUPS.SPAWN_CHANCE){const e=Phaser.Math.Between(100,t.WIDTH-100);return void this.powerUpManager.spawnPowerUp(e)}let a=e.realChance-this.noiseModifier;a=Math.max(.3,a),this.signalFloodActive&&(a=.3);const o=Math.random()<a,n=Phaser.Math.Between(50,t.WIDTH-50),r=new c(this,n,-30,o);r.setVelocityY(t.INSIGHT.SPEED_BASE*e.insightSpeed),this.insights.add(r),this.radarUI.addPing(n,-30,o)}spawnGates(){if(this.gameTime<t.GATE_INTERVAL)return;if(this.gameTime-this.lastGateTime<t.GATE_INTERVAL)return;if(this.gates.length>0)return;this.lastGateTime=this.gameTime;const e=new d(this);this.gates.push(e)}collectInsight(e,s){if(s.collected)return;if(!s.collect())return;const i=s.isReal;let a=s.getPoints(),o=s.getMeterValue();i||(this.collectedNoFakes=!1),i||"ANALYST"!==this.boostMeter.getActiveBoost()||(a=0,o=5),!i&&this.powerUpManager.isActive("SHIELD")&&(a=0,o=0,this.hud.showMessage("GEBLOCKT!",500));const n=this.comboManager.addCombo(e.x,e.y,i),r=this.currentMultiplier*n*this.powerUpManager.getMultiplier();a=Math.round(a*r),this.scoreManager.addInsight(i,r),i&&this.insightsInLast30Sec++,this.boostMeter.addValue(o),this.hud.showPointsPopup(e.x,e.y-30,a),e.flash(i?t.COLORS.INSIGHT_REAL:t.COLORS.INSIGHT_FAKE),this.soundGen.playSonarPing(i)}checkNearMisses(){const e=this.ship;this.insights.children.iterate(t=>{if(!t||t.isReal||t.nearMissTriggered)return;const s=Phaser.Math.Distance.Between(e.x,e.y,t.x,t.y);if(s<40&&s>25){t.nearMissTriggered=!0,this.soundGen.playNearMiss();const e=10;this.scoreManager.addBonus(e),this.hud.showPointsPopup(t.x,t.y-20,e);const s=this.add.text(t.x,t.y-30,"NICE!",{fontFamily:"Arial",fontSize:"14px",color:"#F39C12"}).setOrigin(.5).setDepth(100);this.tweens.add({targets:s,y:t.y-60,alpha:0,duration:600,onComplete:()=>s.destroy()})}})}activateBoost(){const e=this.boostMeter.activateBoost(0)||this.boostMeter.activateBoost(1);if(!e)return;switch(this.soundGen.playBoostActivate(),this.hud.showMessage(`${t.BOOSTS[e].name} AKTIVIERT!`,1e3),e){case"CAPTAIN":this.ship.setStabilized(!0),this.time.delayedCall(t.BOOST_DURATION,()=>{this.ship.setStabilized(!1)});break;case"CREW_SYNC":this.currentMultiplier+=1,this.time.delayedCall(t.BOOST_DURATION,()=>{this.currentMultiplier-=1})}const s=this.checkBoostEffectiveness(e);this.scoreManager.addBoostUsage(s)}checkBoostEffectiveness(e){const t=this.stormManager.getActiveStorm();return"NAVIGATOR"===e&&("FOG"===t||"SIGNAL_FLOOD"===t)||"CAPTAIN"===e&&"CROSSWIND"===t||"ANALYST"===e&&"SIGNAL_FLOOD"===t}onGateSelected(e){this.soundGen.playSuccessChime();const s=t.GATES[e];this.currentMultiplier*=s.multiplier,this.scoreManager.addGateChoice(e),s.noiseIncrease&&(this.noiseModifier+=s.noiseIncrease),s.noiseReduction&&(this.noiseModifier-=s.noiseReduction),s.stormChanceIncrease&&this.stormManager.adjustStormChance(s.stormChanceIncrease),s.stormChanceReduction&&this.stormManager.adjustStormChance(-s.stormChanceReduction),s.spawnReduction&&(this.spawnModifier+=s.spawnReduction),this.scoreManager.gateChoices.length>=5&&this.events.emit("achievement","PERFECT_GATE")}onStormStarted(e){this.soundGen.playWarning()}onStormEnded(e){this.stormsWeathered++,this.stormsWeathered>=3&&this.events.emit("achievement","SURVIVOR")}onSignalFlood(e){this.signalFloodActive=!0}onSignalFloodEnd(){this.signalFloodActive=!1}onAchievement(e){this.achievementNotification.show(e)}togglePauseHelp(){if(!this.isGameOver)if(this.isPaused=!this.isPaused,this.isPaused){this.physics.pause(),this.time.paused=!0,this.pauseOverlay=this.add.rectangle(t.WIDTH/2,t.HEIGHT/2,t.WIDTH,t.HEIGHT,0,.85).setDepth(200),this.pauseContainer=this.add.container(t.WIDTH/2,t.HEIGHT/2).setDepth(201);const e=this.add.text(0,-200,"PAUSE",{fontFamily:"Arial, sans-serif",fontSize:"36px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5);this.pauseContainer.add(e);let s=-140;[{title:"STEUERUNG",items:["‚Üê ‚Üí oder A/D: Boot steuern","H oder ESC: Pause/Hilfe"]},{title:"INSIGHTS & POWER-UPS",items:["‚óè Gr√ºn = Echte Insights (+Punkte)","‚óè Rot = Fake/Noise (ausweichen!)","‚¨° Power-Ups: Einsammeln = sofort aktiv!"]},{title:"BOOST-METER (links)",items:["F√ºllt sich durch Insight-Sammeln",'Bei 100%: "BEREIT!" erscheint',"‚Üí Dr√ºcke Q oder E f√ºr Crew-Boost!","Navigator/Captain/Analyst/Crew Sync"]},{title:"STRATEGY GATES (alle ~15 Sek.)",items:["Erscheint oben - KLICKE oder 1/2/3:","SPEED | QUALITY | SAFETY"]}].forEach(e=>{const t=this.add.text(-200,s,e.title,{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#F1C40F"});this.pauseContainer.add(t),s+=20,e.items.forEach(e=>{const t=this.add.text(-200,s,e,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#BDC3C7"});this.pauseContainer.add(t),s+=18}),s+=10});const i=this.add.rectangle(0,180,180,40,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.togglePauseHelp());this.pauseContainer.add(i);const a=this.add.text(0,180,"WEITERSPIELEN",{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5);this.pauseContainer.add(a);const o=this.add.text(0,215,"H oder ESC zum Fortsetzen",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#7F8C8D"}).setOrigin(.5);this.pauseContainer.add(o)}else this.physics.resume(),this.time.paused=!1,this.pauseOverlay&&(this.pauseOverlay.destroy(),this.pauseOverlay=null),this.pauseContainer&&(this.pauseContainer.destroy(),this.pauseContainer=null)}endGame(){if(this.isGameOver)return;this.isGameOver=!0;try{this.soundGen.playGameOver(),this.soundGen.stopWindAmbience()}catch(t){}let e={};try{const t=this.ship?this.ship.getStabilityScore():50;e=this.scoreManager.getStats(t),e.maxCombo=this.comboManager?this.comboManager.getMaxCombo():0,e.totalInsights=(e.realInsights||0)+(e.fakeInsights||0),this.collectedNoFakes&&e.totalInsights>10&&(n.unlockAchievement("NO_FAKE"),e.noFakeAchievement=!0),0===n.getStats().gamesPlayed&&n.unlockAchievement("FIRST_GAME");const s=n.updateHighScore(e.finalScore);e.isNewHighScore=s,s&&n.unlockAchievement("HIGH_SCORE"),n.addGameStats(e)}catch(t){e={finalScore:this.scoreManager?this.scoreManager.getScore():0,realInsights:0,fakeInsights:0,maxCombo:0,totalInsights:0}}window._gameEndStats=e,this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("End",e)}),setTimeout(()=>{this.scene&&this.scene.isActive("Game")&&this.scene.start("End",window._gameEndStats||e)},500)}shutdown(){this.events.off("gateSelected"),this.events.off("stormStarted"),this.events.off("stormEnded"),this.events.off("signalFlood"),this.events.off("signalFloodEnd"),this.events.off("achievement"),this.inputManager.destroy(),this.stormManager.destroy(),this.comboManager.destroy(),this.powerUpManager.destroy(),this.achievementNotification.destroy(),this.hud.destroy(),this.radarUI.destroy(),this.boostMeter.destroy(),this.waveEffect.destroy(),this.soundGen.destroy()}}const x=new class{constructor(){this.isConfigured=e,this.baseUrl="https://smmngegesumuokmrdujx.supabase.co",this.apiKey=e,this.cachedLeaderboard=null,this.lastFetch=0,this.cacheTimeout=3e4}submitScore(e,t){return __async(this,arguments,function*(e,t,s={}){if(!this.isConfigured)return{success:!1,error:"not_configured"};const i={player_name:e.substring(0,20).replace(/[<>]/g,""),score:Math.floor(t),max_combo:s.maxCombo||0,achievements:s.achievements||[],strategy_profile:s.strategyProfile||"Balanced"};try{const e=yield fetch(`${this.baseUrl}/rest/v1/leaderboard`,{method:"POST",headers:{"Content-Type":"application/json",apikey:this.apiKey,Authorization:`Bearer ${this.apiKey}`,Prefer:"return=representation"},body:JSON.stringify(i)});if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=yield e.json();return this.cachedLeaderboard=null,{success:!0,data:t}}catch(a){return{success:!1,error:a.message}}})}getTopScores(e=10){return __async(this,null,function*(){if(!this.isConfigured)return{success:!1,scores:[],error:"not_configured"};const t=Date.now();if(this.cachedLeaderboard&&t-this.lastFetch<this.cacheTimeout)return{success:!0,scores:this.cachedLeaderboard,cached:!0};try{const s=yield fetch(`${this.baseUrl}/rest/v1/leaderboard?select=player_name,score,max_combo,strategy_profile,created_at&order=score.desc&limit=${e}`,{headers:{apikey:this.apiKey,Authorization:`Bearer ${this.apiKey}`}});if(!s.ok)throw new Error(`HTTP ${s.status}`);const i=yield s.json();return this.cachedLeaderboard=i,this.lastFetch=t,{success:!0,scores:i}}catch(s){return{success:!1,scores:[],error:s.message}}})}getPlayerRank(e){return __async(this,null,function*(){if(!this.isConfigured)return{success:!1,rank:null};try{const t=(yield fetch(`${this.baseUrl}/rest/v1/leaderboard?select=count&score=gte.${e}`,{headers:{apikey:this.apiKey,Authorization:`Bearer ${this.apiKey}`,Prefer:"count=exact"}})).headers.get("content-range");return{success:!0,rank:t?parseInt(t.split("/")[1]):null}}catch(t){return{success:!1,rank:null}}})}isAvailable(){return this.isConfigured}};class A extends Phaser.Scene{constructor(){super("End")}init(e){this.stats=e||{},this.nameEntered=!1,this.submittedScore=!1,this.isEnteringName=!1}create(){this.add.rectangle(t.WIDTH/2,t.HEIGHT/2,t.WIDTH,t.HEIGHT,t.COLORS.BACKGROUND),this.createCourseReport(),this.createLeaderboardSection(),this.createCTAButtons(),this.add.text(t.WIDTH/2,t.HEIGHT-15,"SPACE = Neues Spiel",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#5D6D7E"}).setOrigin(.5),this.input.keyboard.on("keydown-SPACE",()=>{this.isEnteringName||this.restartGame()}),this.cameras.main.fadeIn(500),this.loadLeaderboard()}createCourseReport(){const e=200;this.add.text(e,60,"COURSE REPORT",{fontFamily:"Arial, sans-serif",fontSize:"24px",fontStyle:"bold",color:"#ECF0F1"}).setOrigin(.5);const t=this.stats.resultType||"Game Over";this.add.text(e,95,t,{fontFamily:"Arial, sans-serif",fontSize:"18px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5),this.add.text(e,130,"FINAL SCORE",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5);const s=this.stats.finalScore||0;this.add.text(e,160,s.toLocaleString(),{fontFamily:"Arial, sans-serif",fontSize:"42px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(.5),this.createStatBox(100,220,"QUALIT√ÑT",`${this.stats.qualityScore||0}%`,this.getQualityColor(this.stats.qualityScore||0)),this.createStatBox(e,220,"STABILIT√ÑT",`${this.stats.stabilityScore||0}%`,this.getQualityColor(this.stats.stabilityScore||0)),this.createStatBox(300,220,"STRATEGIE",this.stats.strategyProfile||"Balanced","#9B59B6");const i=this.stats.realInsights||0,a=this.stats.fakeInsights||0;this.add.text(e,290,`${i} echte / ${a} falsche Insights`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5);const o=this.stats.multiplier||"1.00";this.add.text(e,310,`Multiplikator: x${o}`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5),this.stats.isNewHighScore&&this.add.text(e,205,"‚òÖ NEUER HIGHSCORE! ‚òÖ",{fontFamily:"Arial, sans-serif",fontSize:"14px",fontStyle:"bold",color:"#F1C40F"}).setOrigin(.5)}createStatBox(e,t,s,i,a){this.add.text(e,t,s,{fontFamily:"Arial, sans-serif",fontSize:"10px",color:"#7F8C8D"}).setOrigin(.5),this.add.text(e,t+20,i,{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:a}).setOrigin(.5)}getQualityColor(e){return e>=70?"#2ECC71":e>=40?"#F39C12":"#E74C3C"}createLeaderboardSection(){const e=t.WIDTH-170;this.add.rectangle(e,t.HEIGHT/2-50,260,t.HEIGHT-150,859964,.8).setStrokeStyle(1,1752220,.5),this.add.text(e,60,"LEADERBOARD",{fontFamily:"Arial, sans-serif",fontSize:"16px",fontStyle:"bold",color:"#1ABC9C"}).setOrigin(.5),this.leaderboardLoading=this.add.text(e,140,"Laden...",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#7F8C8D"}).setOrigin(.5),this.leaderboardContainer=this.add.container(e-110,90),x.isAvailable()&&this.createNameInput(e,t.HEIGHT-120)}createNameInput(e,t){this.add.text(e,t-35,"Name f√ºr Leaderboard:",{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#F1C40F"}).setOrigin(.5),this.add.rectangle(e,t,180,28,1714746).setStrokeStyle(2,1752220),this.playerName="",this.nameText=this.add.text(e,t,"|",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ECF0F1"}).setOrigin(.5),this.add.rectangle(e,t+30,100,24,1752220).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.submitScore()),this.add.text(e,t+30,"EINTRAGEN",{fontFamily:"Arial, sans-serif",fontSize:"11px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5),this.isEnteringName=!0,this.input.keyboard.on("keydown",e=>{this.isEnteringName&&!this.submittedScore&&("Enter"===e.key?this.submitScore():"Backspace"===e.key?this.playerName=this.playerName.slice(0,-1):1===e.key.length&&this.playerName.length<12&&/^[a-zA-Z0-9_\-\. ]$/.test(e.key)&&(this.playerName+=e.key),this.nameText.setText(this.playerName+"|"))}),this.time.addEvent({delay:500,callback:()=>{if(this.nameText&&this.isEnteringName&&!this.submittedScore){const e=this.nameText.text.endsWith("|")?"":"|";this.nameText.setText(this.playerName+e)}},loop:!0})}submitScore(){return __async(this,null,function*(){if(this.submittedScore||!this.playerName.trim())return;const e=this.playerName.trim()||"Anonym",t=this.stats.finalScore||0;this.submittedScore=!0,this.isEnteringName=!1,this.nameText.setText(e+" ...");const s=yield x.submitScore(e,t,{maxCombo:this.stats.maxCombo||0,strategyProfile:this.stats.strategyProfile||"Balanced"});s.success?(this.nameText.setText(e+" ‚úì"),this.loadLeaderboard()):this.nameText.setText(e+" ‚úó "+(s.error||""))})}loadLeaderboard(){return __async(this,null,function*(){const e=yield x.getTopScores(8);if(this.leaderboardLoading&&(this.leaderboardLoading.destroy(),this.leaderboardLoading=null),this.leaderboardContainer.removeAll(!0),!e.success||0===e.scores.length){const t=e.success?"Noch keine Eintr√§ge":"Nicht verf√ºgbar: "+(e.error||""),s=this.add.text(110,50,t,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#7F8C8D"}).setOrigin(.5);return void this.leaderboardContainer.add(s)}e.scores.forEach((e,t)=>{const s=24*t,i=e.score===this.stats.finalScore&&this.submittedScore,a=0===t?"#F1C40F":1===t?"#BDC3C7":2===t?"#CD7F32":"#7F8C8D",o=this.add.text(0,s,`${t+1}.`,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:a}),n=this.add.text(22,s,e.player_name.substring(0,10),{fontFamily:"Arial, sans-serif",fontSize:"11px",color:i?"#1ABC9C":"#ECF0F1"}),r=this.add.text(220,s,e.score.toLocaleString(),{fontFamily:"Arial, sans-serif",fontSize:"11px",color:i?"#1ABC9C":"#F1C40F"}).setOrigin(1,0);this.leaderboardContainer.add([o,n,r])})})}createCTAButtons(){const e=t.HEIGHT-55;this.createButton(110,e,160,36,"Gespr√§ch vereinbaren",t.COLORS.ACCENT,()=>window.open("https://www.flybridge.ch/kontakt","_blank")),this.createButton(290,e,160,36,"Mehr erfahren",3426654,()=>window.open("https://www.flybridge.ch","_blank"))}createButton(e,t,s,i,a,o,n){const r=this.add.rectangle(e,t,s,i,o).setInteractive({useHandCursor:!0}).on("pointerover",()=>r.setScale(1.05)).on("pointerout",()=>r.setScale(1)).on("pointerdown",n);this.add.text(e,t,a,{fontFamily:"Arial, sans-serif",fontSize:"12px",fontStyle:"bold",color:"#FFFFFF"}).setOrigin(.5)}restartGame(){this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>{this.scene.start("Menu")})}}const w={type:Phaser.AUTO,parent:"game-container",width:t.WIDTH,height:t.HEIGHT,backgroundColor:t.COLORS.BACKGROUND,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,min:{width:320,height:240},max:{width:1600,height:1200}},physics:{default:"arcade",arcade:{debug:!1}},scene:[i,h,I,A],input:{activePointers:2}},b=new Phaser.Game(w);window.FlybridgeRadarRun={game:b,restart:()=>{b.scene.start("Menu")}}}();
